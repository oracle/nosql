<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- Note: release.version.full is set by maven -->

<head>
  <title>The Oracle NoSQL Database (Release ${release.version.full}) Change Log</title>
  <meta name="description"
        content="Oracle NoSQL Database: A Distributed Key-Value Store.">
  <meta name="keywords"
        content="distributed,database,key,value,nosql,bigdata,transaction,transactions,java">
  <style type="text/css">
    li {margin-top:1em;} <!-- Blank line before each list item -->
 </style>
</head>
<body bgcolor="white">

<h2 align="center">Oracle NoSQL Database Change Log
</h2>
<p align="center">Release ${release.version.full}</p>

<h3><a name="Upgrade">Upgrade Requirements</a></h3>
<p>
Release 24.4 supports upgrades from releases for
the prior four calendar years. To upgrade a store directly to the
current release, the store must be running release 20.1 or later.
<p>
If you have a store running a 19.x release, we recommend that you
upgrade it to the current release by first upgrading to the 21.2 or 20.3
release (or another 21.x or 20.x release) and then upgrading from that
to the current release. If you have a store running an 18.x release, we
recommend that you upgrade to the 20.3 release (or another 20.x release)
and then upgrade from that to the current release. If you have a store
running a 4.x release, we recommend that you first upgrade to the 19.5
release (or another 19.x release) and then follow our recommendations
for upgrading from 19.x. If you have a store running a release earlier
than the 4.x release and you are an Enterprise Edition user, please
contact support. If you are a Community Edition user with this issue,
please post a question to the
<a href="https://community.oracle.com/tech/developers/categories/nosql_database_discuss">NoSQL
Database Discussions forum on Oracle Communities</a>.
<p>
For more information, see the section
on <a href="oradoc-lookup:/NSADM-GUID-A768BFD0-E205-48E3-855D-9616526DE014/Upgrading+an+Existing+Oracle+NoSQL+Database+Deployment">
Upgrading an Existing Oracle NoSQL Database Deployment</a> in the Admin
Guide.
<p>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in ${release.version.full}</u></h3>
<h3><a name="NewFeatures25100">New Features</a></h3>
<ol>
<li>
Extended the SQL dialect of Oracle NoSQL to support inner joins among tables
in the same table hierarchy. Two or more tables in the same hierarchy may be
joined in a query. There are no restriction on the position of the tables 
within the hierarchy. Self-joins (joining a table with itself) are also allowed.
However, to avoid distributed joins (i.e., joins where matching rows may be
located in different shards) the following restriction applies:
<p>
The join predicates must include equality predicates between all the
shard-key columns of the joined tables. More specifically, for any pair of
joined tables, a row from one table will match with a row from the other
table only if the 2 rows have the same values on their shard-key columns.
This guarantees that the 2 rows will be located on the same replication node.
<p>
To show some examples of join queries we use the following tables that model
a (simple) email application:

<pre>
create table users(uid integer, user_info json, primary key(uid))

create table users.messages(msgid integer, msg_info json, primary key(msg_id))

create table users.inbox(msgid integer, primary key(msgid))

create table users.sent(msgid long, primary key(msgid))

create table users.deleted(msgid long, primary key(msgid))
</pre>

The users table stores information for each user account. The users.messages
table is a child table of users and stores each message sent/received from
each user. The other 3 tables are also children of users and they model
different email folders. The just store a message primary key (uid and msgid)
for the messages that belong to the corresponding folder. All tables share
the same shard-key column, i.e., the uid column. A sample user row and an
associated message row are shown below:

<pre>
{
  "uid" : 2,
  "user_info" : {
      "userName" : "markos",
      "emailAddr" : "markos.zaharioudakis@oracle.com",
      "firstName" : "Markos",
      "lastName" : "Zaharioudakis"
      "organization" : "NoSQL"
  }
}

{
  "uid" : 2,
  "msgid" : 10,
  "msg_info" : {
      "sender" : "markos",
      "receivers" : [ "dave", "john", "george" ],
      "views" : [ "2024-07-01", "2024-07-02", "2024-07-05" ],
      "size" : 20,
      "date" : "2024-07-01",
      "thread_id" : 1
  }
}
</pre>

The following query selects the messages that (a) belong to users working on
NoSQL, and (b) are in the inbox folder of their corresponding user. The join
predicates  "msg.uid = u.uid" and "msg.uid = inbox.uid" make the query satisfy
the above restriction.
<pre>
SELECT msg.uid, msg.msgid, msg.msg_info
FROM users u, users.inbox inbox, users.messages msg
WHERE msg.uid = u.uid and msg.uid = inbox.uid and
      msg.msgid = inbox.msgid and
      u.user_info.organization = "NoSQL"
</pre>

The following query returns for each message M in the inbox folder, the number
of messages that belong to the same user and the same thread as M.
<pre>
SELECT msg1.uid, msg1.msgid, count(*)
FROM users.messages msg1, users.messages msg2, users.inbox inbox
WHERE msg2.uid = msg1.uid and
      msg1.uid = inbox.uid and
      msg2.msg_info.thread_id = msg1.msg_info.thread_id and
      msg1.msgid != msg2.msgid
GROUP BY msg1.uid, msg1.msgid
</pre>

The following query groups the inbox messages of each user according to their
view date and computes the number of messages viewed per date. Notice that in
this query we have to use the "$" in the alias of the users.messages table.
Without the "$", the unnesting expression in the FROM clause would be
msg.content.views[], and msg.content would be interpreted as a table name.
<pre>
SELECT $msg.uid, $view_date, count(*)
FROM users.messages $msg, users.inbox $inbox, $msg.content.views[] as $view_date
WHERE $msg.uid = $inbox.uid and $msg.msgid = $inbox.msgid
GROUP BY $msg.uid, $view_date
</pre>
<p>
[KVSTORE-2193]
</li>
<li>
Extended the SQL UPDATE statement to support updates of json fields via
the json merge patch specification (described here:
https://datatracker.ietf.org/doc/html/rfc7386). 

For example, assuming that "info" is a column of type json in a table called "Foo",
the following query updates the info column of the row with id = 0. It sets the
value of the "state" field inside the "address" field to "OR". It also sets the
value of the "firstName" field to the value of the $name external variable. If
any of the targeted fields ("address", "state", and "firstName") does not exist
in info, it is inserted.
<pre>
update Foo f
json merge f.info with patch { "address" : { "state" : "OR" }, "firstName" : $name }
where id = 0
</pre>

And the following query removes the "city" field, if it exists, from the address
of the row with id = 2. 
<pre>
update Foo f
json merge f.info.address with patch { "city" : null }
where id = 2
</pre>
<p>
[KVSTORE-1015]
</li>
<li>
Supports updating multiple records if the query predicate contains a shard key.
<p>
Here is an example:
<pre>
create table users(groupId string,
                   uid integer,
                   name string,
                   level integer,
                   primary key(shard(groupId), uid))

insert into users values("g01", 1, "alex", 0)
insert into users values("g01", 2, "jack", 0)
insert into users values("g02", 1, "flex", 0)

update users set level = level + 1 where groupId = "g01"
{"NumRowsUpdated":2}

select * from users;
{"groupId":"g01","uid":1,"name":"alex","level":1}
{"groupId":"g01","uid":2,"name":"jack","level":1}
{"groupId":"g02","uid":1,"name":"flex","level":0}
</pre>
<p>
[KVSTORE-2292]
</li>
</ol>
<h3><a name="BugFixes25100">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug that write operations may fail in some cases in absence of elastic operation.
<p>
[KVSTORE-2610]
</li>
<li>
Fixed a bug that subscription stream might fail to re-authenticate itself during streaming
if the source kvstore is overloaded.
<p>
[KVSTORE-2571]
</li>
<li>
Fixed a bug that write operations including puts and deletions may be possibly missed
in elastic operations.
<p>
[KVSTORE-2373]
</li>
<li>
Modified the implementation of Password store file format to refuse to
store alias names or secret values that start or end with a space or
other whitespace character. Previously these whitespace characters were
trimmed from the values stored, meaning that aliases or secrets with
these whitespace characters would not work correctly. Leading and
trailing whitespace is still permitted for aliases and secrets stored in
an Oracle Wallet.
<p>
[KVSTORE-2437]
</li>
<li>
Fixed an issue where ping command when used as a single subcommand within
runadmin would return zero exit code regardless of ping's output. For example,
if one of the shards in the kvstore does not have quorum, the following command
would return zero exit code:
<pre>
java -jar KVHOME/kvstore.jar runadmin -host &lt;hostname&gt; -port &lt;portname&gt; ping
</pre>
Now this command would return the correct error code of 3, similar to the
stand-alone ping utility command.
<p>
[KVSTORE-2163]
</li>
<li>
Modified Admin CLI commands 'topology change-repfactor', 'topology
rebalance', and 'topology redistribute' to check if newly added SN
storage directory sizes are smaller than existing in-use sizes. In this
case, the topology will not be able to use new SNs. The topology
commands now include information about the issue to alert users.
<p>
A sample warning message:
<pre>
Note: Some new SN storage directory sizes are smaller than the smallest
existing storage directory size, which may prevent new SNs from being
used in the new topology. The smallest existing SN storage directory
size is 2147483648, but the following smaller new SN storage directory
sizes were specified: {sn4={/usr/kvroot4=1073741824},
sn5={/usr/kvroot5=1073741824}}
</pre>
<p>
[KVSTORE-2036]
</li>
<li>
Fixed an issue that while setting a storage directory size parameter on an
SN, it should check to see that the sizes for all storage directories on the
same device don't sum to a size larger than the storage size of the device.
Before the fix, makebootconfig and 'plan change-storagedir' check if the size
of a single storage directory is larger than the device size, but not if
multiple directories on the same device add up to larger than the device size.
<p>
[KVSTORE-1684]
</li>
<li>
Fixed an issue in Admin CLI pool create command.It doesn't check pool name
and zone name in case of empty string and blank string.
After the fix, it checks for empty and blank string in the pool name
and zone name.
<p>
[KVSTORE-1694]
</li>
<li>
Fixed a problem that could cause the JVM to fail the start of replica
nodes process because of unsupported JVM arguments. The change is to add
known unsupported arguments for a specific java version and exclude them
before process start.
<p>
[KVSTORE-2509]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 24.4.4}</u></h3>
<h3><a name="BugFixes24400">Bug and Performance Fixes</a></h3>
<ol>
<li>
Made improvements for managing the TLS credentials files for a store.
<p>
Two new commands were added to the Admin CLI for managing new and
current TLS credentials:
<ul>
<li>The <code>plan update-tls-credentials</code> command can be used to
retrieve and install updates to the set of shared TLS credentials used
by SNAs in the store.
<li>The <code>show tls-credentials</code> command displays information
for all SNAs about the TLS credentials currently installed as well as
any updates waiting to be installed.
</ul>
<p>
Also made modifications to allow store services to read updated
credentials without requiring a restart.
<p>
[KVSTORE-1979]
</li>
<li>
Fixed an issue that the message with the following stack may be logged by the
client driver but is in fact a false alarm:
<pre>
2024-10-13 21:59:32.767 UTC SEVERE - Uncaught exception in thread:KVoracle.kv.impl.async.dialog.nio.NioChannelThreadPool_2 at: java.base/java.lang.Thread.getStackTrace(Thread.java:2514)
        oracle.kv.impl.util.CommonLoggerUtils.getStackTrace(CommonLoggerUtils.java:74)
        oracle.kv.impl.util.CommonLoggerUtils.getStackTrace(CommonLoggerUtils.java:60)
        oracle.kv.KVStoreFactory$KVSHandler.uncaughtException(KVStoreFactory.java:383)
        oracle.kv.impl.api.parallelscan.BaseParallelScanIteratorImpl$Stream.lambda$0(BaseParallelScanIteratorImpl.java:952)
        ...
</pre>
<p>
[KVSTORE-2268]
</li>
<li>
Fixed a bug that when a transaction to the subscribed tables is aborted,
the current stream position returned from NoSQLSubscription#getCurrentPosition()
may be blocked on a certain shard.
<p>
[KVSTORE-2452]
</li>
<li>
Fixed a bug on indexes created from only the key part of multi-region tables.
Deletes and inserts on the multi-region table could result in either a
NullPointerException or a SecondaryIntegrityException that would require the
index to be dropped and re-created.
<p>
[KVSTORE-2485]
</li>
<li>
Fixed a bug where if multi-region tables are deployed on three or more regions,
the stream checkpoint table used by the cross-region service agent might be
incorrectly dropped.
<p>
[KVSTORE-2406]
</li>
<li>
Fixed a bug where the Admin process may fail repeatedly and cannot recover
by restarting. The issue happens more often if tables are frequently
created and deleted.  This failure generates a stack trace similar to the
following in the Admin log:
<pre>
2024-08-19 22:39:01.127 UTC SEVERE [admin2] Process exiting
com.sleepycat.je.ThreadInterruptedException: (JE 24.3.6) 2(2):... java.lang.InterruptedException THREAD_INTERRUPTED: InterruptedException may cause incorrect internal state, unable to continue. Environment is invalid and must be closed.
	at com.sleepycat.je.ThreadInterruptedException.wrapSelf(ThreadInterruptedException.java:107)
	at com.sleepycat.je.dbi.EnvironmentImpl.checkIfInvalid(EnvironmentImpl.java:1773)
	at com.sleepycat.je.dbi.EnvironmentImpl.checkOpen(EnvironmentImpl.java:1782)
	at com.sleepycat.je.Environment.checkOpen(Environment.java:2395)
	at com.sleepycat.je.DbInternal.checkOpen(DbInternal.java:111)
	at com.sleepycat.je.rep.ReplicatedEnvironment.checkOpen(ReplicatedEnvironment.java:1039)
	at com.sleepycat.je.rep.ReplicatedEnvironment.getState(ReplicatedEnvironment.java:751)
	at oracle.kv.impl.admin.Admin.getReplicationMode(Admin.java:3251)
    ...
Caused by: com.sleepycat.je.ThreadInterruptedException: (JE 24.3.6) 2(2):... java.lang.InterruptedException THREAD_INTERRUPTED: InterruptedException may cause incorrect internal state, unable to continue. Environment is invalid and must be closed.
    ...
	at oracle.kv.impl.admin.AdminDatabase.get(AdminDatabase.java:240)
	at oracle.kv.impl.admin.GeneralStore.getParameters(GeneralStore.java:59)
	at oracle.kv.impl.admin.AdminStores.getParameters(AdminStores.java:179)
    ...
	at oracle.kv.impl.admin.Admin.getCurrentParameters(Admin.java:1240)
	at oracle.kv.impl.admin.AdminSecurity$AdminParamsHandle.getParameters(AdminSecurity.java:216)
	at oracle.kv.impl.security.login.ParamTopoResolver.getStorageNode(ParamTopoResolver.java:155)
	at oracle.kv.impl.security.login.ParamTopoResolver.getStorageNode(ParamTopoResolver.java:84)
	at oracle.kv.impl.security.login.InternalLoginManager.getHandle(InternalLoginManager.java:132)
	at oracle.kv.impl.api.AsyncRequestDispatcherImpl.withLoginHandle(AsyncRequestDispatcherImpl.java:695)
    ...
Caused by: java.lang.InterruptedException
	at java.base/java.util.concurrent.locks.ReentrantLock$Sync.tryLockNanos(ReentrantLock.java:167)
    ...
	at com.sleepycat.je.Database.get(Database.java:1261)
	at oracle.kv.impl.admin.AdminDatabase.get(AdminDatabase.java:240)
	at oracle.kv.impl.admin.GeneralStore.getParameters(GeneralStore.java:59)
	at oracle.kv.impl.admin.AdminStores.getParameters(AdminStores.java:179)
    ...
</pre>
<p>
[KVSTORE-2425]
</li>
<li>
Fixed a bug where if a query has a UUID field with a variable in the 'where'
clause, the UUID field is one of the primary key fields, and the full
shard key is provided in the 'where' clause, then preparing the query may throw
an IllegalArgumentException with the message "Invalid UUID string".
<p>
[KVSTORE-2451]
</li>
<li>
Handle the cases where a prepared query is executed after (a) one or more of
the referenced tables has been dropped and then re-created with a different
schema, or (b) the index used by the query has been dropped and then
re-created with a different schema, or (c) one or more of the referenced
tables has been altered (via the alter table statement).
<p>
In case (a) the query will throw an IllegalArgumentException. In cases
(b) and (c) the query will throw a PrepareQueryException indicating
that the query must be prepared again before it can be executed.
<p>
[KVSTORE-2475]
</li>
<li>
Fixed a query bug that would cause a query with 'order by' to return the results
in the wrong order. The bug occurs when (a) the query has nested tables with
descendant tables (or left outer joins), (b) the query specifies a complete
primary key for the target table, (c) the query orders by fields in a
descendant table, and (d) the ordering is descending. For example, the following
query, where column <code>ida</code> is the primary key of table A, returned its results in
ascending order, instead of the requested descending order:
<code>
select a.ida as a_ida, b.ida as b_ida, b.idb as b_idb
from nested tables(A a descendants(A.B b))
where a.ida = 40
order by b.idb desc
</code>
<p>
[KVSTORE-2462]
</li>
<li>
Fixed a bug where client requests may fail due to SecondaryIntegrityException
with a stack trace like the following:
<pre>
Caused by: com.sleepycat.je.SecondaryIntegrityException: (JE 24.3.4) Secondary is corrupt: the primary record contains a key that is not present in the secondary secDbName=IdxIndex.DataCheck priDbName=p173 expiration=2026-10-28.00 NOT_EXTINCT priLsn=0x4/0xaa1fe8a
    at com.sleepycat.je.SecondaryDatabase.deleteKey(SecondaryDatabase.java:1526)
    at com.sleepycat.je.SecondaryDatabase.updateSecondary(SecondaryDatabase.java:1347)
    at com.sleepycat.je.Cursor.putNotify(Cursor.java:2826)
    at com.sleepycat.je.Cursor.putNoDups(Cursor.java:2640)
    at com.sleepycat.je.Cursor.putInternal(Cursor.java:2538)
    at com.sleepycat.je.Cursor.putInternal(Cursor.java:846)
    at com.sleepycat.je.Database.put(Database.java:1435)
    at oracle.kv.impl.rep.migration.MigrationTarget$Reader$CopyOp.execute(MigrationTarget.java:1545)
    at oracle.kv.impl.rep.migration.MigrationTarget.consumeOps(MigrationTarget.java:998)
</pre>
The issue only happens when a concurrent elasticity operation on the server side
fails and in turn causes a secondary integrity issue. One likely trigger event
of such failure is disk IO error which may yield server-side logging messages like the following:
<pre>
java.io.IOException: No space left on device LOG_WRITE: IOException on write,
log is likely incomplete. Environment is invalid and must be closed.
</pre>
The issue may cause multiple client operations to fail. The
store may recover itself, with the elasticity operation resume on healthy nodes
and the secondary index rebuilt.
<p>
[KVSTORE-2372]
</li>
<li>
Fixed a problem that could cause the Admin CLI ping or verify
configuration commands to report incorrect status for Rep Nodes or
Arbiters in rare cases when used in store configurations with storage
nodes that host multiple services of the same type.
<p>
[KVSTORE-2383]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 24.3.9</u></h3>
<h3><a name="NewFeatures24300">New Features</a></h3>
<ol>
<li>
Added support of elasticity operations in the presence of multiple subscribers
to the Streams API. This means that writes to the same key
will be streamed and delivered to the application in the correct order,
even if data was moved as a result of an elasticity operation.
<p>
With the new feature, the checkpoint table mapper is required for multiple
sharded subscribers, and an exception will be thrown if the stream is
configured without a mapper.
<p>
[KVSTORE-1153]
</li>
<li>
Added support for cross-region elasticity operations with multi-region tables.
This means that multi-region tables will behave correctly while one or
more stores is undergoing an elasticity operation (expansion or contraction).
When a user configures a group of service agents
connecting different regions, multi-region tables now support elasticity
operations in any region. As a result, data in a multi-region table will be
eventually consistent in the presence of elasticity operations.
<p>
[KVSTORE-2151]
</li>
<li>
Implemented new Timestamp SQL functions: timestamp_ceil, timestamp_floor,
timestamp_round, timestamp_trunc, timestamp_bucket, format_timestamp,
parse_to_timestamp quarter, day_of_week, day_of_month, day_of_year,
to_last_day_of_month.
<p>
[KVSTORE-1157]
</li>
<li>
Added support for SSL credentials login in the administrative shell command line.
The SSL credentials must be from server-side security directory, which can be
specified with <code>-store-security-dir</code> in the administrative CLI.
Administrators who have access to the server security directory can log in to
the store to reset the password when it has been forgotten.
<p>
[KVSTORE-1672]
</li>
<li>
Added new statistics for data verification.
<p>
New statistics are:
<ul>
<li>nDbVerifyRuns: Number of times that DbVerify has been called.</li>
<li>DbVerifyRunTime: Total run time of DBVerify</li>
<li>nDbVerifyProblemsFound: Total number of problems that DbVerify found among all executions.</li>
</ul>
<p>
[KVSTORE-582]
</li>
</ol>
<h3><a name="BugFixes24300">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug that could cause a query with index-based order-by and IN predicate
to sort its results in a wrong order. For example, the following query will
return wrongly sorted results if there is an index on info.bar:
<pre>
select id, f.info.bar
from foo f
where f.info.bar in (6, 3, 7)
order by f.info.bar
</pre>
First, all the results with info.bar = 6 will appear, then all the results with
info.bar = 3, and finally all the results with info.bar = 7.
<p>
[KVSTORE-2409]
</li>
<li>
Fixed an issue where a select-and-modify query execution failed to make the
expected modification because it could not find the specified rows.
For example, a query delete might have failed to delete certain rows
even though the rows were present. This issue was triggered in a very rare
situation when a server-side master transfer raced with the query execution.
There was no data corruption at the server side, and retrying the operation
would return the correct answer unless the race was encountered again.
<p>
[KVSTORE-2351]
</li>
<li>
Fixed a bug where if a multi-region table is missing in the remote regions,
the XRegionService might get stuck and be unable to serve future requests.
<p>
[KVSTORE-2346]
</li>
<li>
Fixed a bug with index metadata initialization. The problem can occur if index
metadata (i.e. IndexImpl instances) is accessed by multiple threads in parallel
while it is being initialized. The bug can cause the wrong query execution plan
to be generated. Possibly it can cause other operations to fail as well.
This is a continuation of kvstore-2185. This fix done for this bug in 24.1 was
not quite correct.
<p>
[KVSTORE-2185]
</li>
<li>
Fixed a bug that when the stream underlying multi-region tables cannot resume
from a checkpoint that is unavailable in remote region, rows in the
multi-region tables that are deleted in the remote region might not be
deleted locally.
<p>
[KVSTORE-986]
</li>
<li>
Fixed a bug where the Streams API might fail to recognize the following
two security properties: (1) <code>oracle.kv.ssl.trustStorePassword</code>
and (2) <code>oracle.kv.ssl.trustStorePasswordAlias</code> if storing
the password in external password storage.
<p>
[KVSTORE-2364]
</li>
<li>
Fixed a bug where the multiDelete operation on a multi-region table with
a child table might fail to delete ancestor keys.
<p>
[KVSTORE-2224]
</li>
<li>
Fixed an issue that can cause an OutOfMemoryError on replication nodes
and storage nodes. When this failure occurs, a heap dump should reveal a huge number
of objects with the prefix of NioEndpointHandler$InCompletionHandler. Most
likely, a thread dump would also reveal that there is a blocking event (e.g., a
DNS resolution or a synchronization attempt waiting) on the thread named
KVNioEndpointGroup.backup_1.
<p>
[KVSTORE-2260]
</li>
<li>
Improve ping output to include details if the service is disabled. Ping
text output now includes the (Stopped) status if the service is disabled
by the user. The new ping output looks like the following:
<pre>
Ping command output: Pinging components of store kvstore based upon topology sequence #18
10 partitions and 3 storage nodes
Time: 2024-05-01 16:59:48 UTC   Version: 24.2.0
Shard Status: healthy: 0 writable-degraded: 0 read-only: 0 offline: 1 total: 1
Admin Status: writable-degraded
Zone [name=Zone1 id=zn1 type=PRIMARY allowArbiters=true masterAffinity=false]   RN Status: online: 0 read-only: 0 offline: 2
Storage Node [sn1] on localhost: 5001    Zone: [name=Zone1 id=zn1 type=PRIMARY allowArbiters=true masterAffinity=false]    Status: RUNNING   Ver: 24.2.0 2024-05-01 16:57:37 UTC  Build id: 6e05b77646a7 Edition: Enterprise    isMasterBalanced: true     serviceStartTime: 2024-05-01 16:59:33 UTC
                Admin [admin1]                              Status: RUNNING,MASTER        serviceStartTime: 2024-05-01 16:59:36 UTC                stateChangeTime: 2024-05-01 16:59:36 UTC   availableStorageSize: 2 GB
                Rep Node [rg1-rn1]        Status: UNREACHABLE <b>(Stopped)</b>
Storage Node [sn2] on localhost: 5021    Zone: [name=Zone1 id=zn1 type=PRIMARY allowArbiters=true masterAffinity=false]    Status: RUNNING   Ver: 24.2.0 2024-05-01 16:57:37 UTC  Build id: 6e05b77646a7 Edition: Enterprise    isMasterBalanced: true     serviceStartTime: 2024-05-01 16:59:34 UTC
                Admin [admin2]                              Status: RUNNING,REPLICA       serviceStartTime: 2024-05-01 16:59:39 UTC                stateChangeTime: 2024-05-01 16:59:39 UTC   availableStorageSize: 2 GB
                Rep Node [rg1-rn2]        Status: UNREACHABLE <b>(Stopped)</b>
Storage Node [sn3] on localhost: 5041    Zone: [name=Zone1 id=zn1 type=PRIMARY allowArbiters=true masterAffinity=false]    Status: RUNNING   Ver: 24.2.0 2024-05-01 16:57:37 UTC  Build id: 6e05b77646a7 Edition: Enterprise    isMasterBalanced: unknown          serviceStartTime: 2024-05-01 16:59:35 UTC
                Admin [admin3]                              Status: UNREACHABLE (Stopped)         serviceStartTime: ?                stateChangeTime: ?      availableStorageSize: ?
                Arb Node [rg1-an1]        Status: UNREACHABLE <b>(Stopped)</b>
</pre>
Ping JSON output now lists 'expectedStatus' as 'UNREACHABLE' if the service
is disabled by the user. The new JSON output looks like following:
<pre>
  {
  "topology": {
    ...
  },
  "adminStatus": "",
  "shardStatus": {
   ...
  },
  "zoneStatus": [
    ...
  ],
  "snStatus": [
    {
      ...,
      "rnStatus": [
        {
          "resourceId": "",
          "status": "",
          <b>"expectedStatus": "UNREACHABLE"</b>
        }
      ],
      "anStatus": []
    },
    {
      ...
      "rnStatus": [
        {
          "resourceId": "",
          "status": "",
          <b>"expectedStatus": "UNREACHABLE"</b>
        }
      ],
      "anStatus": []
    },
    {
     ...
      "rnStatus": [],
      "anStatus": [
        {
          "resourceId": "",
          "status": "",
          <b>"expectedStatus": "UNREACHABLE"</b>
        }
      ]
    }

</pre>
<p>
[KVSTORE-2072]
</li>
<li>
Fixed an issue where queries executed concurrently with an elasticity operation
involving the addition of new replication nodes may encounter an exception with a
message that looks like the following:
<pre>
java.lang.IllegalStateException: oracle.kv.impl.query.QueryStateException: Unexpected state in query engine:
Failed to read base topology with sequence number 1524
Stack trace: java.lang.RuntimeException: oracle.kv.impl.query.QueryStateException: Unexpected state in query engine:
Failed to read base topology with sequence number 1524, got null result
</pre>
<p>
[KVSTORE-2166]
</li>
<li>
Fixed a bug that causes a RequestTimeoutException during store contraction. The
RequestTimeoutException would have a stack trace that looks like the following,
listing the target replication nodes being removed during the contraction.
<pre>
oracle.kv.RequestTimeoutException: Request dispatcher: c1609890242275412734, dispatch timed out after 0 attempt(s) to dispatch the request to an RN. Target: rg3-rn1 (24.1.0) on [2023-11-29 21:18:01.735 UTC]. Timeout: 19999ms
Fault class name: oracle.kv.RequestTimeoutException
Dispatch event trace: (DISPATCH_REQUEST_RESPONDED, 2023-11-29 21:18:01.424 UTC, rg3-rn1, null)(OBTAIN_REQUEST_HANDLER, 2023-11-29 21:18:01.552 UTC, rg3-rn3, null)(OBTAIN_REQUEST_HANDLER_RESPONDED, 2023-11-29 21:18:01.552 UTC, rg3-rn3, null)(DISPATCH_REQUEST_RESPONDED, 2023-11-29 21:18:01.552 UTC, rg3-rn3, null)(OBTAIN_REQUEST_HANDLER, 2023-11-29 21:18:01.552 UTC, rg3-rn1, null)(OBTAIN_REQUEST_HANDLER_RESPONDED, 2023-11-29 21:18:01.552 UTC, rg3-rn1, null)(DISPATCH_REQUEST_RESPONDED, 2023-11-29 21:18:01.552 UTC, rg3-rn1, null)(OBTAIN_REQUEST_HANDLER, 2023-11-29 21:18:01.552 UTC, rg3-rn2, null)(OBTAIN_REQUEST_HANDLER_RESPONDED, 2023-11-29 21:18:01.552 UTC, rg3-rn2, null)(DISPATCH_REQUEST_RESPONDED, 2023-11-29 21:18:01.552 UTC, rg3-rn2, null)(OBTAIN_REQUEST_HANDLER, 2023-11-29 21:18:01.681 UTC, rg3-rn3, null)(OBTAIN_REQUEST_HANDLER_RESPONDED, 2023-11-29 21:18:01.681 UTC, rg3-rn3, null)(DISPATCH_REQUEST_RESPONDED, 2023-11-29 21:18:01.681 UTC, rg3-rn3, null)(OBTAIN_REQUEST_HANDLER, 2023-11-29 21:18:01.681 UTC, rg3-rn1, null)(OBTAIN_REQUEST_HANDLER_RESPONDED, 2023-11-29 21:18:01.681 UTC, rg3-rn1, null)(DISPATCH_REQUEST_RESPONDED, 2023-11-29 21:18:01.681 UTC, rg3-rn1, null).
      at oracle.kv.impl.api.RequestDispatcherImpl.getTimeoutException(RequestDispatcherImpl.java:1270)
      at oracle.kv.impl.api.AsyncRequestDispatcherImpl$AsyncExecuteRequest.run(AsyncRequestDispatcherImpl.java:458)
      at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
      at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
      at oracle.kv.impl.async.dialog.nio.NioChannelExecutor$WrappedFutureTask.run(NioChannelExecutor.java:1326)
      at oracle.kv.impl.async.dialog.nio.NioChannelExecutor$ScheduledFutureTask.run(NioChannelExecutor.java:1434)
      at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.runTasks(NioChannelExecutor.java:2030)
      at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.runOnce(NioChannelExecutor.java:1107)
      at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.lambda$run$13(NioChannelExecutor.java:1060)
      at oracle.kv.impl.fault.AsyncEndpointGroupFaultHandler.lambda$static$0(AsyncEndpointGroupFaultHandler.java:21)
      at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.run(NioChannelExecutor.java:1057)
      at java.base/java.lang.Thread.run(Thread.java:842)
</pre>
<p>
[KVSTORE-2175]
</li>
<li>
Fixed an issue that could generate a misleading warning message in the logging output if
an application had logging enabled. The message only occurred when a network
connection handshake timed out. The message was related to an an internal issue
that has been fixed and that had no impact on applications. The message was
like the following:
<pre>
2024-02-27 22:40:39.488 UTC WARNING - Failed to complete future using exception oracle.kv.impl.async.exception.PersistentDialogException: Problem with channel (nosql-vm-test
-e3-3:40687 (closed)): Connect timeout, handshake is not done within 3000 ms since the endpoint handler is created, endpointHandlerId=680d54f747e78e31, future was completed
exceptionally: oracle.kv.RequestTimeoutException: Dialog timed out locally. Dialog context before abort: DialogContext[ dialogId=0:680d54f747e78e31 contextId=1 dialogType=40
1 dialogHandler=AsyncVersionedRemoteDialogInitiator@d06ad71[methodCall=AsyncRequestHandler.ExecuteCall[NOP]] onCreatingEndpoint=true initTimeMillis=22:40:36.488 UTC latencyM
s=-0.00 timeout=1024 state=INITED_NEED_DIALOGSTART writeState=0 abortInfo=null infoPerf=not sampled] (24.1.11) on [2024-02-27 22:40:37.512 UTC]. Timeout: 1024ms
Fault class name: oracle.kv.RequestTimeoutException
java.lang.Throwable
        at oracle.kv.impl.async.FutureUtils.checkedCompleteExceptionally(FutureUtils.java:278)
        at oracle.kv.impl.async.AsyncVersionedRemoteDialogInitiator.onAbort(AsyncVersionedRemoteDialogInitiator.java:229)
        at oracle.kv.impl.async.NullDialogStart.doFail(NullDialogStart.java:104)
        at oracle.kv.impl.async.NullDialogStart.fail(NullDialogStart.java:74)
        at oracle.kv.impl.async.dialog.AbstractDialogEndpointHandler.abortDialogs(AbstractDialogEndpointHandler.java:2135)
        at oracle.kv.impl.async.dialog.AbstractDialogEndpointHandler.terminate(AbstractDialogEndpointHandler.java:1354)
        at oracle.kv.impl.async.dialog.AbstractDialogEndpointHandler$ConnectTimeoutTask.run(AbstractDialogEndpointHandler.java:2437)
        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
        at oracle.kv.impl.async.dialog.nio.NioChannelExecutor$WrappedFutureTask.run(NioChannelExecutor.java:1326)
        at oracle.kv.impl.async.dialog.nio.NioChannelExecutor$ScheduledFutureTask.run(NioChannelExecutor.java:1434)
        at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.runTasks(NioChannelExecutor.java:2030)
        at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.runOnce(NioChannelExecutor.java:1107)
        at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.lambda$run$13(NioChannelExecutor.java:1060)
        at oracle.kv.impl.fault.AsyncEndpointGroupFaultHandler.lambda$static$0(AsyncEndpointGroupFaultHandler.java:21)
        at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.run(NioChannelExecutor.java:1057)
        at java.base/java.lang.Thread.run(Thread.java:1583)
</pre>
<p>
[KVSTORE-2228]
</li>
<li>
Fixed an issue in the admin command 'plan verify-data' where verification errors
were not reported when the command was run without -json flag. Additionally, if the
verify-data plan reports btree/log file corruption then the plan will fail.
This fix introduces two new error messages:
<pre>
1. NOSQL_5600: RN Btree corruption only
2. NOSQL_5601: RN Logfile corruption or RN Logfile/Btree corruption
</pre>
<p>
[KVSTORE-1747]
</li>
<li>
Fixed an issue where the command history feature of the shell command line did not work
properly if the shell was started with the user password specified manually.
<p>
[KVSTORE-2259]
</li>
<li>
Fixed an issue where clients were unable to connect to the store using the
java API call KVStoreFactory.getStore() when client helper hosts were storage
nodes that hosted only admin nodes, not replication nodes or arbiter nodes.
For example, obtaining the store handle using an admin-only SN running on localhost:5000
for a non-secure store would lead to the following exception:
<pre>
oracle.kv.FaultException: Could not contact any RepNode at: [localhost:5000] (24.1.11) on [2024-07-09 07:00:38.754 UTC]
</pre>
And in the case of a secure store:
<pre>
oracle.kv.FaultException: Could not establish an initial login from: [localhost:5000] (24.1.11) on [2024-07-09 07:01:06.930 UTC]
</pre>
[KVSTORE-1695]
</li>
<li>
Fixed an issue where the parameter javaRnParamsOverride is used to override
Replication Node JVM arguments. The user can set the parameter and run a
"change-parameters" plan to set the value in the store. In some cases, the
store did not process the javaRnParamsOverride correctly and this resulted in
an unrecoverable error when a replication node started.
The error looked like this:
<pre>
ProcessMonitor: Unexpected exception in MonitorThread: java.lang.NumberFormatException: For input string: "11253m-xx:parallel"java.lang.NumberFormatException: For input string: "11253m-xx:parallel"
at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:67)
</pre>
<p>
[KVSTORE-2257]
</li>
<li>
Node restart will no longer fail if a persistent error, such as a checksum
error, is discovered.  This was done to increase node availability.
<p>
[KVSTORE-2317]
</li>
</ol>
<h3><a name="APIChanges24300">API Changes</a></h3>
<ol>
<li>
Removed various deprecated JE configuration parameters.  If one of these
deprecated configurations is found in the je.properties file, it will be
ignored and a warning will be printed in the logs.
<p>
Removed configurations are:
<ul>
<li>je.evictor.wakeupInterval</li>
<li>je.evictor.useMemoryFloor</li>
<li>je.evictor.nodeScanPercentage</li>
<li>je.evictor.evictionBatchPercentage</li>
<li>je.maxOffHeapMemory</li>
<li>je.offHeap.evictBytes</li>
<li>je.offHeap.checksum</li>
<li>je.env.runOffHeapEvictor</li>
<li>je.offHeap.coreThreads</li>
<li>je.offHeap.maxThreads</li>
<li>je.offHeap.keepAlive</li>
<li>je.checkpointer.wakeupInterval</li>
<li>je.cleaner.minFilesToDelete</li>
<li>je.cleaner.retries</li>
<li>je.cleaner.restartRetries</li>
<li>je.cleaner.calc.recentLNSizes</li>
<li>je.cleaner.calc.minUncountedLNs</li>
<li>je.cleaner.calc.initialAdjustments</li>
<li>je.cleaner.calc.minProbeSkipFiles</li>
<li>je.cleaner.calc.maxProbeSkipFiles</li>
<li>je.cleaner.cluster</li>
<li>je.cleaner.clusterAll</li>
<li>je.cleaner.rmwFix</li>
<li>je.txn.serializableIsolation</li>
<li>je.lock.oldLockExceptions</li>
<li>je.log.groupCommitInterval</li>
<li>je.log.groupCommitThreshold</li>
<li>je.log.useNIO</li>
<li>je.log.directNIO</li>
<li>je.log.chunkedNIO</li>
<li>je.nodeDupTreeMaxEntries</li>
<li>je.tree.maxDelta</li>
<li>je.compressor.purgeRoot</li>
<li>je.evictor.deadlockRetry</li>
<li>je.cleaner.adjustUtilization</li>
<li>je.cleaner.maxBatchFiles</li>
<li>je.cleaner.foregroundProactiveMigration</li>
<li>je.cleaner.backgroundProactiveMigration</li>
<li>je.cleaner.lazyMigration</li>
<li>je.rep.preserveRecordVersion</li>
<li>je.rep.minRetainedVLSNs</li>
<li>je.rep.repStreamTimeout</li>
<li>je.rep.replayCostPercent</li>
<li>java.util.logging.FileHandler.on</li>
<li>java.util.logging.ConsoleHandler.on</li>
<li>java.util.logging.DbLogHandler.on</li>
<li>java.util.logging.level.lockMgr</li>
<li>java.util.logging.level.recovery</li>
<li>java.util.logging.level.evictor</li>
<li>java.util.logging.level.cleaner</li>
</ul>
<p>
[KVSTORE-1788]
</li>
</ol>
<h3 align="center"><u>Changes in 24.1.14</u></h3>
<h3><a name="NewFeatures24100">New Features</a></h3>
<ol>
<li>
Implemented the following mathematical SQL functions:
ABS, ACOS, ASIN, ATAN, ATAN2, CEIL, COS, COT, DEGREES, EXP, FLOOR,
LOG, LOG10, POWER, RADIANS, RAND, ROUND, SIGN, SIN, SQRT, TAN, TRUNC.
</li>
</ol>
<h3><a name="BugFixes24100">Bug and Performance Fixes</a></h3>
<ol>
<li>
Improved the error message of the ShellException thrown when a runadmin
command is executed on a storage node incompatible with the current
client version. The error message now reports the minimum prerequisite
version for the client JAR file.
<p>
[KVSTORE-917]
</li>
<li>
Added expiration information for the current password as a new field
<code>current-passwd-expiration</code> to the user description returned by the
<code>show user</code> command. The value will be <code>expired</code> when
password is expired and <code>non-expiring</code> if the lifetime of password
is set to unlimited. Otherwise the value will be the expiration date time in
the format of <code>yyyy-MM-dd HH:mm:ss z</code>.
<p>
[KVSTORE-1904]
</li>
<li>
Added a new configuration API that allows Streams API users to configure
the memory usage of subscribers by size instead of number of stream
operations. The new method is called
NoSQLSubscriptionConfig.Builder.setOutputQueueSizeMB.
<p>
[KVSTORE-2061]
</li>
<li>
Fixed a bug where, if multiple XRegion service agents are deployed for
multi-region tables, the initial transfer of data for the table from
another region could fail to include all rows.
<p>
[KVSTORE-2111]
</li>
<li>
Corruption of the election.persisted file, used to track master elections,
will no longer prevent Replication Node or Admin node startup.
<p>
[KVSTORE-2162]
</li>
<li>
Fixed an issue where a store request may encounter a failure with the
following cause on the stack trace:
"Caused by: oracle.kv.impl.async.exception.TemporaryDialogException: Idle
timeout, connection is idle during last 20000 ms".
<p>
[KVSTORE-2214]
</li>
<li>
Fixed an issue that could prevent objects related to network connections
from being garbage collected, which might have led to OutOfMemoryErrors
during a network outage. The issue can be identified by checking a heap
dump for a large number of NioEndpointHandler objects referenced by
ForkJoinTask$AdaptedRunnableAction objects.
<p>
[KVSTORE-2190]
</li>
<li>
Fixed a bug in the Streams API where a runtime error like OutOfMemoryError
might fail to terminate a subscription and thus leave the subscription hanging.
<p>
[KVSTORE-2199]
</li>
<li>
Fixed a problem that could cause a store operation to fail with a
FaultException whose message includes the text "Secondary/primary
record already present".
<p>
The fix eliminates a problem that could cause corruption of secondary
indexes in some cases where the index was specified to include part of
the primary key. When the index corruption was detected during a store
operation, the operation would fail with a FaultException as described,
and a SEVERE logging entry would be logged for the associated
Replication Node. The affected node would be restarted, and the
secondary index would be dropped and rebuilt automatically, causing the
index to be unavailable while it was being rebuilt.
<p>
[KVSTORE-2027]
</li>
<li>
Fixed a problem that could cause bulk put operations to fail with a
NullPointerException if the operation was performed while increasing the
number of shards in the store. The problem was present for both the
TableAPI.put(List&lt;EntryStream&lt;Row&gt;&gt;, BulkWriteOptions) and
KVStore.put(List&lt;EntryStream&lt;KeyValue&gt;&gt;, BulkWriteOptions)
methods.
<p>
For example:
<pre>
java.lang.NullPointerException: Cannot invoke "java.util.List.size()"
because "list" is null
	at oracle.kv.impl.api.bulk.BulkPut.startShardExecutor(BulkPut.java:423)
	at oracle.kv.impl.api.bulk.BulkPut.execute(BulkPut.java:292)
	at oracle.kv.impl.api.table.TableAPIImpl.put(TableAPIImpl.java:1564)
</pre>
<p>
[KVSTORE-2173]
</li>
<li>
Fixed a bug that could cause a query with a LIMIT clause, but no OFFSET clause,
to miss results if the query was using a multikey index.
<p>
[KVSTORE-2184]
</li>
<li>
Fixed a bug that could cause queries (and possibly other operations as
well) to fail with a ConcurrentModificationException. The problem was
due to the fact that index metadata could be used before it was fully
initialized.
<p>
[KVSTORE-2185]
</li>
<li>
Fixed an issue with multi-region tables where a Direct Java Driver table
iteration on a child table that also requested rows for the parent
table might return tombstone (deleted) rows from the parent table. The
incorrect results would appear as rows or keys that match the
iteration's key value but the value of the row is empty, resulting in
null values in all fields.
<p>
[KVSTORE-2223]
</li>
<li>
Fixed a bug that could cause decimal values to lose precision when creating a
table row from a JSON string.
<p>
[KVSTORE-2189]
</li>
<li>
Modified the handling of security configuration properties to convert
relative pathname values to absolute pathnames. If an application calls
the KVStoreConfig.setSecurityProperties method to specify security
properties and the properties contain relative pathname values for
properties such as AUTH_WALLET_PROPERTY or AUTH_PWDFILE_PROPERTY, the
pathnames are now converted to absolute pathnames relative to the
current directory. Previously, the presence of relative pathnames could
either produce confusing exception messages for wallet configurations or
NullPointerExceptions when used with file stores. Security configuration
files generated by KVLite use relative pathnames, so these problems
could occur if applications called KVStoreConfig.setSecurityProperties
with properties read from a KVLite security configuration file.
<p>
[KVSTORE-1938]
</li>
<li>
Modified the network port checks performed by the makebootconfig and
diagnostics commands to only check TCP ports, not UDP ports. Previously,
in-use UDP ports would be flagged as conflicting with the ports required
to support a store. Stores use only TCP for network connections so the
UDP port checks were unnecessary.
<p>
[KVSTORE-2164]
</li>
<li>
Fixed an issue where securityconfig verify may report that a security configuration
created with certificate signed by certificate authority has an incorrect keystore
installation even if the keystore is valid. This happened because the previous
verification incorrectly required the keystore to have a separate root and
intermediate certificate entries, even if the keystore was valid, where the private
key entry has the full chain of certificates.
<p>
[KVSTORE-1505]
</li>
<li>
Updated the required privilege of an internal API used by NoSQL Database Admin
CLI from SYSVIEW to USRVIEW. After this change, the CLI command
<code>await-consistent</code> now requires USRVIEW privilege instead of SYSVIEW.
<p>
[KVSTORE-2183]
</li>
<li>
Fixed an issue where KVLite failed to start up when using Java 11 and an
NFS-mounted kvroot directory.
<p>
[KVSTORE-2015]
</li>
<li>
Fixed a bug in the ping Admin CLI command where the -shard argument failed to
show arbiter nodes.
<p>
[KVSTORE-1692]
</li>
<li>
Fixed a bug in re-run of contraction plan. If a contraction plan failed due to
failure of RemoveShard task, then a re-run of the plan caused the task previous
to the RemoveShard task (removeRepNodeJob) to fail with a NullPointerException.
This behavior has been corrected.
<p>
[KVSTORE-1844]
</li>
<li>
Fixed a bug where storage node agent startup with the command line argument
'-update-config false' and an unknown/invalid shapshot would hang.
<p>
[KVSTORE-1786]
</li>
<li>
Fixed a bug where the local region was shown in the output of the SQL
"describe table" command for a table that was not a multi-region table.
<p>
[KVSTORE-2201]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 23.3.29</u></h3>
<h3><a name="NewFeatures23300">New Features</a></h3>
<ol>
<li>
Implemented three new SQL aggregate functions: count(distinct), array_collect(),
and array_collect(distinct).
<p>
count(distinct expr) returns the number of distinct values that are returned by
its input expression when computed on the rows belonging to the same group.
<p>
array_collect(expr) computes its input expression on each row of a group and
collects all the resulting values into an array, returning this constructed
array as its result.
<p>
array_collect(distinct expr) computes its input expression on each row of a
group and collects all the resulting distinct values into an array, returning
this constructed array as its result.
<p>
For example, the following query groups sales transactions by account number
and returns, for each account number, an array containing the distinct categories
of products purchased by the account:
<pre>
select s.xact.acctno, array_collect(distinct s.xact.prodcat) as categories
from sales s
group by s.xact.acctno
</pre>
<p>
[KVSTORE-1861]
</li>
<li>
Added JSON Collection as a new table type. This type allows a user to
specify <em>only</em> key fields for a table, supplying other top-level
fields as non-schema-defined JSON types. In addition MR Counter types
can be defined as top-level paths in a JSON Collection for use in a
multi-region configuration. Ad-hoc fields created in a JSON collection must
be valid JSON types, which excludes records, binary, timestamp, uuid,
and enum types. Maps, arrays, numeric values, string values, etc., are valid.
<p>
An advantage of JSON Collection tables over a normal schema table is
simplification. If, for example, an application is using unstructured
(e.g. JSON) data it is not necessary to create an intermediate field of
type JSON to contain that data. All non-key fields are automatically added
as JSON. Because of this semantic it is not necessary (or possible) to
evolve the schema of a JSON Collection table. There are no fields to add or
remove. It <em>is</em> possible to modify the TTL. JSON Collection
tables are also very well suited to multi-region operation as only the
primary keys must match across regions.
<p>
At this time JSON collection tables do not support a parent/child
relationship. That is, a JSON collection must be a top-level parent with
no child tables.
<p>
A JSON Collection table with a single primary key can be created this way:
<pre>
    create table jsonCollection(id integer, primary key(id)) as json collection
</pre>
Arbitrary fields can then be added. This example uses the Direct Java Driver
API:
<pre>
    Table t = tableAPI.getTable("jsonCollection");
    Row row = t.createRow();
    row.put("id", 1);
    /* put some JSON -- these must be valid JSON types */
    row.put("name", "some_name"); // note that this isn't in the schema
    row.put("age", 15); // note that this isn't in the schema
    tableAPI.put(row, ...);
    PrimaryKey pkey = t.createPrimaryKey();
    pkey.put("id", 1);
    row = tableAPI.get(pkey, ...);
    /*
     * the row will look like this if toString is used:
     * {"id": 1, "name": "some_name", "age": 15}
     */
</pre>
<p>
[KVSTORE-1717]
</li>
<li>
Added support for running multiple multi-region agents to replicate data
from a remote region. When multiple agents are deployed, they divide up
the data from the store so that each agent only replicates a portion of
the data, to support increased throughput.
<p>
[KVSTORE-984]
</li>
<li>
Previous releases of the Full Text Search (FTS) capability were tested
with Elasticsearch (ES) version 2. Starting with this release, FTS
requires ES version 7 or later, and was tested with ES version 8.
<p>
In addition, previous releases of FTS required the use of the Shield ES
plugin if users wanted secure communication between the store and the
Elasticsearch cluster. Starting with this release, the Shield plugin is
no longer supported. Users should configure ES with PKI security to
enable secure communications.
<p>
Please note that this update requires changes to existing deployments to
update the ES clusters to the newly supported versions. Be sure to
review the FTS documentation for guidance on migrating the ES data.
<p>
[KVSTORE-1917]
</li>
</ol>
<h3><a name="BugFixes23300">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug where, in some cases, the Streams API
NoSQLSubscription.getOptimizedPosition method could return a stream
position earlier than the stream position specified in the method
parameter. The method now always returns a stream position equal to or
later than the one provided.
<p>
[KVSTORE-2037]
</li>
<li>
Fixed a bug with queries using geojson indexes. Previously, the index
would be used incorrectly if the index definition specified one or more
non-geojson fields before the geojson field and the query did not
contain equality predicates on the non-geojson fields. For example, the
following index and query would return wrong results:
<pre>
create index idx_kind_ptn on points(info.kind as string,
                                    info.point as point)

select id, p.info.point
from points p
where geo_near(p.info.point,
               { "type" : "point", "coordinates" : [ 24.0175, 35.5156 ] },
               5000)
</pre>
<p>
[KVSTORE-2134]
</li>
<li>
Fixed a bug in converting typed maps/arrays to JSON maps/arrays. Such a
conversion is needed when the typed map/array is going to be inserted in
a JSON map/array. In queries using the seq_transform function, the
conversion would not be done in some cases, resulting in a runtime type
error. For example, the following query (where "info" is a column of
type json) would raise an error, because, by itself, the expression
{"num_phones": size($.phones)} has type map(integer), which must be
converted to map(json), because the outer map constructor has type
map(json)
<pre>
select {
         "id" : t.id,
         "phones" : [seq_transform(t.info.addresses[],
                                   {"num_phones": size($.phones)})]
       }
from foo t
</pre>
<p>
[KVSTORE-2139]
</li>
<li>
Fixed a bug where, in rare cases, the Streams API
NoSQLSubscription.getCurrentPosition method could return a stream
position that failed to include a few elements that had not yet been
delivered to the subscriber via calls to NoSQLSubscriber.onNext. As a
result, checkpointing the stream position returned by
NoSQLSubscription.getCurrentPosition could have failed to stream the
missing events after resuming from the checkpoint.
<p>
[KVSTORE-1998]
</li>
<li>
Fixed a bug that could have caused the Streams API to miss a few writes
to the subscribed tables when performing elasticity operations on the
associated store.
<p>
[KVSTORE-2062]
</li>
<li>
Fixed a bug where the XRegion Service agent might fail to start if the
stores in local or remote regions were unavailable at start up time.
With the fix, the agent retries until the stores become available.
<p>
[KVSTORE-2057]
</li>
<li>
Fixed a bug that, in rare cases, could cause a small number of
operations to be missed in Streams API when the store was undergoing
elasticity operations involving partition migration.
<p>
[KVSTORE-1838]
</li>
<li>
Fixed an issue where SSL handshake task exceptions were silently ignored on the
client causing the problem only to be observed as a connection timeout. The
following is an example exception:
<pre>
java.lang.IllegalAccessError:
org.bouncycastle.jcajce.provider.ProvSunTLSKDF$TLSExtendedMasterSecretGenerator$1
(in unnamed module @0xd504137) cannot access class
sun.security.internal.spec.TlsMasterSecretParameterSpec (in module
java.base) because module java.base does not export
sun.security.internal.spec to unnamed module @0xd504137
    at org.bouncycastle.jcajce.provider.ProvSunTLSKDF$TLSExtendedMasterSecretGenerator$1.run(Unknown Source)
    at java.base/java.security.AccessController.doPrivileged(AccessController.java:318)
    at org.bouncycastle.jcajce.provider.ProvSunTLSKDF$TLSExtendedMasterSecretGenerator.engineInit(Unknown Source)
    at java.base/javax.crypto.KeyGenerator.init(KeyGenerator.java:476)
    at java.base/javax.crypto.KeyGenerator.init(KeyGenerator.java:452)
    at java.base/sun.security.ssl.SSLMasterKeyDerivation$LegacyMasterKeyDerivation.deriveKey(SSLMasterKeyDerivation.java:149)
    at java.base/sun.security.ssl.KAKeyDerivation.t12DeriveKey(KAKeyDerivation.java:89)
    at java.base/sun.security.ssl.KAKeyDerivation.deriveKey(KAKeyDerivation.java:61)
    at java.base/sun.security.ssl.ECDHClientKeyExchange$ECDHEClientKeyExchangeProducer.produce(ECDHClientKeyExchange.java:426)
    at java.base/sun.security.ssl.ClientKeyExchange$ClientKeyExchangeProducer.produce(ClientKeyExchange.java:65)
    at java.base/sun.security.ssl.SSLHandshake.produce(SSLHandshake.java:440)
    at java.base/sun.security.ssl.ServerHelloDone$ServerHelloDoneConsumer.consume(ServerHelloDone.java:182)
    at java.base/sun.security.ssl.SSLHandshake.consume(SSLHandshake.java:396)
    at java.base/sun.security.ssl.HandshakeContext.dispatch(HandshakeContext.java:480)
    at java.base/sun.security.ssl.HandshakeContext.dispatch(HandshakeContext.java:458)
    at java.base/sun.security.ssl.TransportContext.dispatch(TransportContext.java:201)
    at java.base/sun.security.ssl.SSLTransport.decode(SSLTransport.java:172)
</pre>
Previously, such exceptions were only logged. However, since client-side
logging is usually disabled, the exception was not being seen. With this
fix, the request will time out with a message that looks like the
following:
<pre>
oracle.kv.RequestTimeoutException: Request dispatcher: c2409576586975841402, dispatch timed out after 0 attempt(s) to dispatch the request to an RN. Target: rg1-rn1 (23.2.6) on [2023-06-08 19:38:47.346 UTC]. Timeout: 5000ms. Dispatch event trace: (DISPATCH_REQUEST_RESPONDED, 2023-06-08 19:38:46.623 UTC, rg1-rn1, PersistentDialogException|ConnectionUnknownException|CompletionException|IllegalAccessError org.bouncycastle...
</pre>
<p>
[KVSTORE-1816]
</li>
<li>
Fixed a bug that affected queries using GROUP BY that also ordered by
the grouping expressions in descending order. If such a query performed
index-based grouping, the query results were ordered in ascending order,
instead of the requested descending order. For example, the following
query exhibited the bug if there is also an index on address.state:
<pre>
select u.address.state, count(*)
from users
group by u.address.state
order by u.address.state desc
</pre>
<p>
[KVSTORE-2078]
</li>
<li>
Fixed a bug in resuming queries at RNs. The bug may occur when the row on which the
query has to resume from has been deleted. The bug causes duplicate query results to
be returned.
<p>
[KVSTORE-2144]
</li>
<li>
Fixed a bug with the "any" comparison operators. The operators could return a
wrong result when the right-hand-side operand would return more than 2 items.
<p>
[KVSTORE-2150]
</li>
<li>
Fixed a compatibility issue in communications between store processes
running releases before and after release 22.3. For example, suppose the
server had been upgraded to a new version with an old client. In that
case, the client might observe requests throwing
DialogNoBackoffException with messages "Heartbeat timeout, no read event
during last ..." or "endpoint already shutdown". Communication between
server processes with different versions could also be affected by this
issue. This issue was more likely to appear under light load and did not
occur if there was at least one request/response exchange within each 10
second time period.
<p>
[KVSTORE-1935]
</li>
<li>
Fixed a bug when (a) a SET TLL USING TABLE DEFAULT was used in an UPDATE
statement and (b) the target table did not have an explicitly specified
default TTL. In this case, the UPDATE statement failed to update
the expiration time of the row.
<p>
[KVSTORE-1981]
</li>
<li>
Fix a bug in the Streams API that could cause subscribing or
unsubscribing a table to hang.
<p>
[KVSTORE-1860]
</li>
<li>
Fixed a race condition in the implementation of table iteration that could
occasionally produce a NullPointerException like:
<pre>
java.lang.NullPointerException: Cannot invoke
"java.util.concurrent.CompletableFuture.whenComplete(java.util.function.BiConsumer)"
because the return value of
"oracle.kv.impl.api.table.TableScan$BasicMultiGetIteratorWrapper.getMoreElementsAsync()"
is null
      at oracle.kv.impl.api.table.TableScan$BasicMultiGetIteratorWrapper.nextLocal(TableScan.java:950)
      at oracle.kv.impl.async.AsyncIterationHandleImpl.notifyOneNext(AsyncIterationHandleImpl.java:478)
      at oracle.kv.impl.async.AsyncIterationHandleImpl.notifyNext(AsyncIterationHandleImpl.java:373)
      at oracle.kv.impl.async.AsyncIterationHandleImpl.subscribe(AsyncIterationHandleImpl.java:156)
      at oracle.kv.impl.async.AsyncPublisherImpl.subscribe(AsyncPublisherImpl.java:127)
</pre>
<p>
[KVSTORE-1828]
</li>
<li>
Fixed a problem where the 'plan network-restore' Admin CLI command could
report that it had succeeded when it had actually failed.
<p>
[KVSTORE-1811]
</li>
<li>
Fixed a problem introduced in the 22.1 release that could cause key
stats scans to be throttled incorrectly, causing the scans to take
significantly longer to complete in some cases.
<p>
[KVSTORE-1929]
</li>
<li>
Fixed thread safety flaws in the plan execution code that could cause
plans to hang in rare cases.
<p>
[KVSTORE-1920]
</li>
<li>
Fixed a problem where the Admin CLI 'verify prerequisite' command
produced an incorrect error message when the version of the Admin CLI was
earlier than the version of one or more of the storage nodes. Note that
the 'verify prerequisite' command checks to see if the store supports
upgrading to the version being used by the Admin CLI.
<p>
Previously, the error message talked about downgrading the node but
mentioned the prerequisite version instead of the intended upgrade
version. Now the message refers to the upgrade version and the wording
has been improved.
<p>
For example, if an SNA in the store is running version 23.2.1 and the
Admin CLI version is 22.1.1, the error message will be:
<pre>
  Node cannot be changed to use version 22.1.1 because that would
  require a downgrade from newer version 23.2.1 it is currently running,
  and that downgrade is not supported.
</pre>
<p>
[KVSTORE-1803]
</li>
<li>
Fixed a SQL query bug that occurred when a map-filter step expression
was applied directly to a row variable. For example, the following query
would raise an exception, because the keys() step was applied to the "b"
row variable.
<pre>
select *
from bar $b, $b.keys() $k, $b.$k $v
</pre>
<p>
[KVSTORE-1968]
</li>
<li>
Reverted changes made in the 22.1 release for KVSTORE-1194 to execute
plans found in the APPROVED state during an Admin restart. The previous
change was incorrect and meant that plans created with the
<code>-noexecute</code> flag could be executed without plan execution
being requested explicitly.
<p>
[KVSTORE-1591]
</li>
<li>
Modified the key distribution statistics collector to wait to perform
scans until user tables have been created. The keys stats collector
stores data in system tables, both for its own bookkeeping and to record
the resulting statistics. Table rows and key/value entries share the
same keyspace, so these system table entries could potentially collide
with key/value data. Once a user table is created, though, it is up to
the user to handle any potential collisions between table rows and
key/value entries, so it is safe for the collector to write to the
system tables. As a result of this change, key distribution statistics
will only become available after the first user table is created, and
will not be available for system tables or the key/value keyspace before
then.
<p>
[KVSTORE-2007]
</li>
<li>
Fixed a bug where the ping command using the Admin REST API with a
secure store always returned UNREACHABLE for the admin status and
returned a response with HTTP status code 308 even if admin was healthy.
<p>
[KVSTORE-1862]
</li>
<li>
Changed the behavior of TableAPI.putIfPresent() when a GENERATED ALWAYS
primary key column value is present. If the value is present, generation
of a new value is skipped and the putIfPresent is performed on the row
with the specified primary key. This way existing rows can be updated on
tables using GENERATED ALWAYS in columns that are part of the primary
key. Previously, the Row.put method threw IllegalArgumentException in
this case.
<p>
[KVSTORE-152]
</li>
<li>
Fixed a problem where enabling FINE logging in a Java direct driver
application used with a secure store could cause the application to get
NoClassDefFoundErrors such as:
<pre>
Exception in thread "main" java.lang.NoClassDefFoundError: oracle/kv/impl/security/login/LoginSession$Id
	at oracle.kv.impl.security.login.SessionId.hashId(SessionId.java:273)
	at oracle.kv.impl.security.login.LoginToken.hashId(LoginToken.java:178)
	at oracle.kv.impl.security.login.LoginToken.toString(LoginToken.java:173)
	at java.base/java.lang.String.valueOf(String.java:4218)
	at java.base/java.lang.StringBuilder.append(StringBuilder.java:173)
	at oracle.kv.impl.security.login.AsyncUserLogin$LogoutCall.describeParams(AsyncUserLogin.java:558)
	at oracle.kv.impl.security.login.AsyncUserLogin$AbstractCall.describeCall(AsyncUserLogin.java:582)
	at oracle.kv.impl.async.AsyncVersionedRemoteDialogInitiator.toString(AsyncVersionedRemoteDialogInitiator.java:236)
	at java.base/java.lang.String.valueOf(String.java:4218)
	at java.base/java.lang.StringBuilder.append(StringBuilder.java:173)
	at oracle.kv.impl.async.AsyncVersionedRemoteInitiator.lambda$startDialog$8(AsyncVersionedRemoteInitiator.java:239)
	at oracle.kv.impl.async.FutureUtils.lambda$unwrapExceptionVoid$2(FutureUtils.java:381)
	at java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)
	at java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)
	at java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)
	at java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)
	at oracle.kv.impl.async.FutureUtils.checkedComplete(FutureUtils.java:245)
	at oracle.kv.impl.async.AsyncVersionedRemoteDialogInitiator.onCanRead(AsyncVersionedRemoteDialogInitiator.java:179)
	at oracle.kv.impl.util.registry.AsyncRegistryUtils$WrappedDialogHandler.onCanRead(AsyncRegistryUtils.java:670)
	at oracle.kv.impl.async.dialog.DialogContextImpl$OnCanReadTask.doWork(DialogContextImpl.java:1088)
	at oracle.kv.impl.async.dialog.DialogContextImpl$OnCanReadTask.run(DialogContextImpl.java:1059)
	at oracle.kv.impl.async.dialog.DialogContextImpl.callOnCanRead(DialogContextImpl.java:964)
	at oracle.kv.impl.async.dialog.DialogContextImpl.onReadDialogFrame(DialogContextImpl.java:648)
	at oracle.kv.impl.async.dialog.AbstractDialogEndpointHandler.onReadDialogFrame(AbstractDialogEndpointHandler.java:1783)
	at oracle.kv.impl.async.dialog.AbstractDialogEndpointHandler.onMessageReady(AbstractDialogEndpointHandler.java:1528)
	at oracle.kv.impl.async.dialog.AbstractDialogEndpointHandler.onChannelInputRead(AbstractDialogEndpointHandler.java:1088)
	at oracle.kv.impl.async.dialog.AbstractDialogEndpointHandler.onChannelInputRead(AbstractDialogEndpointHandler.java:1046)
	at oracle.kv.impl.async.dialog.nio.NioEndpointHandler.read(NioEndpointHandler.java:246)
	at oracle.kv.impl.async.dialog.nio.NioEndpointHandler.onRead(NioEndpointHandler.java:198)
	at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.doProcess(NioChannelExecutor.java:1596)
	at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.selectAndProcess(NioChannelExecutor.java:1318)
	at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.runOnce(NioChannelExecutor.java:845)
	at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.lambda$run$9(NioChannelExecutor.java:801)
	at oracle.kv.impl.fault.AsyncEndpointGroupFaultHandler.lambda$static$0(AsyncEndpointGroupFaultHandler.java:21)
	at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.run(NioChannelExecutor.java:798)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: java.lang.ClassNotFoundException: oracle.kv.impl.security.login.LoginSession$Id
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)
	at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)
	at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:520)
	... 36 more
</pre>
<p>
[KVSTORE-1937]
</li>
<li>
Modified the Admin CLI to print out error messages when renewing an
expired password fails due to password complexity violations even if
debug mode is disabled. The error messages were previously only printed
out in debug mode, making it difficult to understand why the password
renewal failed.
<p>
[KVSTORE-1902]
</li>
<li>
Fixed an issue where the SQL shell's "show ddl" command could fail for a
table with a geo-json index such as GEOMETRY or POINT.
<p>
[KVSTORE-1978]
</li>
<li>
Fixed an issue where a Storage Node did not shut down if its listening
socket failed. The problem produced "Listener shutting down" messages in
the snaboot log and the SN process did not exit. For fault tolerance
of SNs, we expect administrators to install some mechanism (e.g., a cron
job) to monitor and restart SNs when they fail. With the fix, that
mechanism will now restart the SN when a listening socket fails.
<p>
[KVSTORE-2041]
</li>
<li>
Fixed a resource leak that was accompanied by messages like "Endpoint handler
encounters that ... start unknown dialog type" appearing in logs. There
were no immediate symptoms when the leak started, but when the resource
was exhausted, network communications with the problematic node failed,
and eventually the node failed with an OutOfMemoryError.
<p>
[KVSTORE-2033]
</li>
<li>
Fixed a resource leak that produced the error message "Maximum permit
count exceeded" either in logs or in the exception message for an
exception thrown for a request. The issue was usually the result of
other issues in the network layer (e.g., a slow network or DNS failures)
and could go away when the root cause was addressed.
<p>
[KVSTORE-2044]
</li>
<li>
Fixed an issue that could cause an RN failure during a topology
elasticity operation. The issue could be observed with RN being either
shut down or restarted with the sequences of logging messages like the
following:
<pre>
2023-07-15 02:55:51.295 UTC INFO [rg5-rn2] Cannot localize topology seq#: 387 because it is < migration topology seq#: 392
...
2023-07-15 02:55:52.297 UTC SEVERE [rg5-rn2] JE: Replica unexpected exception com.sleepycat.je.EnvironmentFailureException: (JE 23.3.3) rg5-rn2(2):/scratch/tests/workspace/kv_elasticity/kv/kvstore/build/test/standalone/elasticity-stress/scratch/kvtest-standalone.ElasticityStress/sn8/rg5-rn2/env java.lang.IllegalStateException: update of local topology failed from commit trigger for topology seq#: 392 UNEXPECTED_EXCEPTION_FATAL: Unexpected internal Exception, unable to continue. Environment is invalid and must be closed. Problem seen replaying entry Commit/22 vlsn=1306 isReplicated="1"  com.sleepycat.je.EnvironmentFailureException: (JE 23.3.3) rg5-rn2(2):/scratch/tests/workspace/kv_elasticity/kv/kvstore/build/test/standalone/elasticity-stress/scratch/kvtest-standalone.ElasticityStress/sn8/rg5-rn2/env java.lang.IllegalStateException: update of local topology failed from commit trigger for topology seq#: 392 UNEXPECTED_EXCEPTION_FATAL: Unexpected internal Exception, unable to continue. Environment is invalid and must be closed. Problem seen replaying entry Commit/22 vlsn=1306 isReplicated="1"
	at com.sleepycat.je.EnvironmentFailureException.unexpectedException(EnvironmentFailureException.java:403)
	at com.sleepycat.je.dbi.TriggerManager.runTriggers(TriggerManager.java:347)
	at com.sleepycat.je.dbi.TriggerManager.runCommitTriggers(TriggerManager.java:231)
	at com.sleepycat.je.txn.Txn.commit(Txn.java:809)
	at com.sleepycat.je.rep.txn.ReplayTxn.commit(ReplayTxn.java:299)
	at com.sleepycat.je.rep.impl.node.Replay.replayEntry(Replay.java:770)
	at com.sleepycat.je.rep.impl.node.Replica$ReplayThread.run(Replica.java:1382)
Caused by: java.lang.IllegalStateException: update of local topology failed from commit trigger for topology seq#: 392
	at oracle.kv.impl.rep.migration.MigrationManager$CompletionTrigger.commit(MigrationManager.java:2196)
	at com.sleepycat.je.dbi.TriggerManager$7.run(TriggerManager.java:237)
	at com.sleepycat.je.dbi.TriggerManager.runTriggers(TriggerManager.java:343)
	... 5 more
</pre>
<p>
[KVSTORE-1868]
</li>
<li>
Changed the error message of ConnectionTimeoutException to include endpoint
information. The resulting message looks like the following for
connections without SSL:
<pre>
    oracle.kv.impl.async.exception.ConnectionTimeoutException: Problem with channel ((/127.0.0.1:33430->uranus/127.0.1.1:34455)NBL): Heartbeat timeout, no read event during last 1000 ms, endpointHandlerId=6479ecc3c752b3aa
</pre>
And the message looks like the following for connections with SSL:
<pre>
    oracle.kv.impl.async.exception.ConnectionTimeoutException: Problem with channel ((/127.0.0.1:35615->localhost/127.0.0.1:40019)NBL client): Heartbeat timeout, no read event during last 200 ms, endpointHandlerId=45c554258911aa74
</pre>
<p>
[KVSTORE-1888]
</li>
<li>
Fixed a vulnerability to DNS failure. Before the fix, slow DNS
resolution could cause the failure of some or all network communications
on a node. The problem was fixed by moving potentially blocking DNS
operations out of critical paths in the network layer.
<p>
[KVSTORE-1766]
</li>
<li>
Added the new -storage-type flag to the makebootconfig command. The flag
can be used to specify the type of disk where the storage directory
resides. Valid storage type values are HD, SSD, NVME, and UNKNOWN. Note
that a somewhat similar -storage-dir-storage-type flag was previously
documented but was not implemented.
<p>
[KVSTORE-1174]
</li>
<li>
Updated the version of transport layer security (TLS) used in
communications between an Elasticsearch cluster and the store from TLSv1 to
TLSv1.2 to improve security.
<p>
[KVSTORE-2031]
</li>
<li>
Fixed a problem that caused the 'plan change-parameters' Admin CLI
command to fail if called to change SN parameters on a store that had
been upgraded to 23.1. The failed plan would display a stack trace such
as:
<pre>
kv-> show plan -id 72;
Plan Change Storage Node Params
Owner:                 root(id:u1)
Id:                    72
State:                 ERROR
Attempt number:        1
Started:               2023-10-31 11:13:12 UTC
Ended:                 2023-10-31 11:13:38 UTC
Plan failures:
	Failure 1: 1/WriteNewSNParams sn1 failed.: java.lang.NullPointerException:null (23.1.25)
Total tasks:           4
 Progress percent:     75
 Successful:           3
 Failed:               1

Failures:
   Task   1       ERROR at   2023-10-31 11:13:13 UTC: Plan 72 [Change Storage Node Params] task [WriteNewSNParams sn1]: 1/WriteNewSNParams sn1 failed.: java.lang.NullPointerException:null (23.1.25): oracle.kv.impl.sna.SNAFaultException: java.lang.NullPointerException:null (23.1.25)
Fault StackTrace: java.lang.NullPointerException
	at oracle.kv.impl.param.ParameterMap.merge(ParameterMap.java:316)
	at oracle.kv.impl.param.ParameterMap.merge(ParameterMap.java:290)
	at oracle.kv.impl.sna.StorageNodeAgent.replaceStorageNodeParams(StorageNodeAgent.java:4202)
	at oracle.kv.impl.sna.StorageNodeAgentImpl.lambda$newStorageNodeParameters$15(StorageNodeAgentImpl.java:605)
	at oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:170)
	at oracle.kv.impl.sna.StorageNodeAgentImpl.newStorageNodeParameters(StorageNodeAgentImpl.java:602)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at oracle.kv.impl.util.AbstractInvocationHandler.invokeMethod(AbstractInvocationHandler.java:60)
	at oracle.kv.impl.security.SecureProxy$CheckingHandler.lambda$invoke$1(SecureProxy.java:568)
	at oracle.kv.impl.security.ExecutionContext.runWithContext(ExecutionContext.java:179)
	at oracle.kv.impl.security.SecureProxy$CheckingHandler.invoke(SecureProxy.java:566)
	at oracle.kv.impl.security.SecureProxy.invokeNonObject(SecureProxy.java:108)
	at oracle.kv.impl.util.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:107)
	at com.sun.proxy.$Proxy21.newStorageNodeParameters(Unknown Source)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at oracle.kv.impl.util.AbstractInvocationHandler.invokeMethod(AbstractInvocationHandler.java:60)
	at oracle.kv.impl.async.JavaSerialMethodTable$JavaSerialMethodCall.callService(JavaSerialMethodTable.java:174)
	at oracle.kv.impl.async.JavaSerialResponder.callServer(JavaSerialResponder.java:104)
	at oracle.kv.impl.async.JavaSerialResponder.lambda$handleRequest$0(JavaSerialResponder.java:87)
	at oracle.kv.impl.async.AsyncVersionedRemoteDialogResponder.withThreadDialogContext(AsyncVersionedRemoteDialogResponder.java:315)
	at oracle.kv.impl.async.JavaSerialResponder.lambda$handleRequest$1(JavaSerialResponder.java:85)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at java.base/java.lang.Thread.run(Thread.java:834)
</pre>
<p>
[KVSTORE-2152]
</li>
<li>
    Fixed a bug that caused multi-key function index creation to fail on empty arrays.
</li>
</ol>
<h3><a name="Storage23300">Storage Engine Changes (JE 23.3)</a></h3>
<ol>
<li>
Recovery from backup will no longer fail due to missing reserve files.
<p>
To describe the problem and solution in more detail, backups do not
include reserved files, only the active log set. As such when restoring
from a backup recovery finds which reserve files are missing and removes
them from the reservedFileDB and truncates the VLSNIndex to get rid of
any references to VLSNs in the missing reserved files. However, it is
possible in rare cases that the active log files do not contain any
replicated logs, or at least do not contain the last matchpoint. In
the case of KVSTORE-467, the active log files did not contain any
replicated logs, thus causing startup to fail because the VLSNIndex was
truncated till it was empty. In this case, the issue is that the
matchpoint was not in the active log set, so the admin node could not
start up because the VLSNIndex cannot truncate away the last matchpoint.
<p>
The fix is to determine during backup the last matchpoint, and if the
matchpoint is not in the active log set, add reserved files to the
active log set until the matchpoint is part of the backup set.
<p>
Note that JE backup is part of the implementation of the NoSQL Database
snapshot facility, so the benefits of this fix will be seen there.
<p>
[KVSTORE-1931] (23.2.0)
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 23.1.1</u></h3>
<h3><a name="NewFeatures23100">New Features</a></h3>
<ol>
<li>
Implemented the SQL BETWEEN operator. This is a convenience operator
that makes it easier to write queries that include range predicates with
both a lower and an upper bound.
<p>
[KVSTORE-1727]
</li>
<li>
Modified the build process to compile Java files to require Java 11.
<p>
[KVSTORE-1752]
</li>
<li>
Removed support for Hive, including all of the classes in the
<code>oracle.kv.hadoop.hive.table</code> package. Hive support was
removed because this release requires Java 11 and the Hive package has
not been updated to support that Java release. Hive support was needed
for BigDataSQL, which is now also no longer supported.
<p>
[KVSTORE-1790]
</li>
<li>
Introduced a new column in the system table SYS$TableStatsPartition that
tracks the table size including the storage overhead of deleted rows
in multi-region tables. For non-multi-region tables, the stat is identical
to the existing stat that tracks table size.
<p>
[KVSTORE-1775]
</li>
<li>
Added health check functionality to on-premises bundled proxy at url:
<br>
<code>http[s]://&lt;proxy host&gt;/V2/health</code>
<p>
[KVSTORE-1842]
</li>
</ol>
<h3><a name="BugFixes23100">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a race condition that could cause a RepNode to reach its request limit
and fail to server future requests. A thread dump would reveal a large number
of "KVRepNodeService misc async executor" threads, a heap dump would include a
terminated NioChannelExecutor referenced by one or more CONNECTING
NioEndpointHandlers and many non-terminated DialogContextImpls. Other symptoms
such as the RepNode exiting with an OutOfMemoryError are also possible.
Restarting the node resolves the problem, although it could occur again. The
present fix allows NioChannelExecutor threads to remain idle rather than
shutting them down after an application closes all of its KVStore instances.
This behavior will be addressed in a future release.
<p>
[KVSTORE-1882]
</li>
<li>
Fix a bug in multi-region tables where deleting a row, then within seven
days inserting a new row with the same key, could result in the new row
expiring as if had been configured with time-to-live (TTL).
<p>
[KVSTORE-1822]
</li>
<li>
Fixed a bug that could cause the Streams API to miss an operation when
encountering connection errors.
<p>
[KVSTORE-1832]
</li>
<li>
Fixed a bug in the regex_like function which causes an exception if the
pattern or flags argument is a constant expression but not a constant
literal. For example, a query like this:
<pre>
select id
from foo f
where regex_like(f.address.street, concat("Old ", "Tunnel", ".*"))
</pre>
would throw an exception.
<p>
[KVSTORE-1890]
</li>
<li>
Fixed a bug that causes infinite loop at RNs when a query uses the
count(expr) function, the input expr returns a NULL value, and the
query does non index-based grouping.
<p>
[KVSTORE-1861]
</li>
<li>
Improved checking of zone RF, arbiters, and master affinity:
<ul>
<li>Modified <code>topology change-zone-type</code> to also remove master
affinity and remove allowing arbiters when changing to type secondary,
and to also add allowing arbiters when changing to type primary when the
replication factor is 0.
<li>Note that <code>topology change-rep-factor</code> can reduce the
replication factor for a secondary zone.
<li>Modified <code>topology change-zone-master-affinity</code> to prohibit
master affinity for primary zones with replication factor 0.
<li>Modified <code>topology change-zone-arbiters</code> to require
allowing arbiters for primary zones with replication factor 0.
<li>Modified <code>plan deploy-topology</code> to fail if the new topology
would reduce the primary replication factor. Previously, the primary
replication factor could be reduced by either changing a primary zone to
secondary zone, or by changing a primary to a secondary zone, reducing
its replication factor, and changing it back to a primary zone.
<li>Note that the replication factor for <code>plan deploy-zone</code>
must be non-negative and can only be 0 for either primary zones
that allow arbiters or secondary zones; that arbiters are not allowed by
default, are only allowed for primary zones, and must be allowed for
primary zones with replication factor 0; and that master affinity is
disabled by default and is only allowed for primary zones with
replication factor greater than 0.
<li>Modified <code>topology preview</code> to include information about
changes to the replication factor and allowing arbiters.
</ul>
<p>
[KVSTORE-1739]
</li>
<li>
Fixed a bug for proxy-based queries. Due to rare race condition and lack of
appropriate synchronization, this bug could cause query results to be lost.
<p>
[KVSTORE-1498]
</li>
<li>
Fixed a bug that can cause a join query to miss results when
<ul>
<li>the target table is accessed via a secondary index,
<li>a query batch finishes at a target-table row R, and
<li>row R is deleted before the next query batch starts.
</ul>
<p>
[KVSTORE-1746]
</li>
<li>
Fixed a bug that shows up in join queries, when
<ul>
<li>the query orders by the primary key of the target table in
descending order,
<li>it uses the primary index to scan the target table, and
<li>accesses descendant tables.
</ul>
<p>
In this case, the query would fail to find descendant-table rows that
match with a target-table row.
<p>
[KVSTORE-1770]
</li>
<li>
Fixed a bug in the heuristic that chooses the "best" index for queries
when more than one index is applicable. The bug can show up when the
query specifies a complete key (that is, there are equality predicates
for all indexed fields) for more than one of the applicable indexes.
<p>
[KVSTORE-1810]
</li>
<li>
Fixed a bug that could cause the stream API to skip some stream records from
some partitions when a partition migration attempt failed.
<p>
[KVSTORE-1645]
</li>
<li>
Take advantage of a new facility in the storage engine to handle
durability acknowledgements asynchronously. This change reduces thread
usage on the server and increases throughput for inserts and updates
under load.
<p>
[KVSTORE-330]
</li>
<li>
Fixed an issue where read operations that use Consistency.Time could
return incorrect results if performed during an elasticity operation
that includes partition migration. The return value could be more out of
date than the specified permissible lag.
<p>
[KVSTORE-981]
<li>
Fixed a bug in the output of "create snapshot" admin cli command. The fix is to
modify the non-JSON output of "create snapshot" to match the JSON output and
correct the returnCode and description in the JSON output for quorum RNs.
<p>
[KVSTORE-1205]
</li>
<li>
Fixed a bug that migrator exports wrong table ddl for MR counter data type, the
"NOT NULL" should not be used for MR counter type and MR counters in JSON column
are missing.
<p>
[KVSTORE-1857]
</li>
<li>
Fixed a bug that "describe as json table" may return an invalid JSON
string if the escape character('\') was missing before special characters
in field path for JSON index and JSON MR_COUNTER.
<p>
[KVSTORE-1905]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 22.3.13</u></h3>
<h3><a name="NewFeatures22300">New Features</a></h3>
<ol>
<li>
Implemented functional indexing in SQL queries. With this feature, an index can
also index the values of one or more functions over index paths. The functions
that can be indexed are a subset of the builtin functions. Specifically, the
following functions can be indexed: modification_time, expiration_time,
expiration_time_millis, row_storage_size, year, month, day, hour, minute,
second, millisecond, microsecond, nanosecond, week, length, replace, reverse,
substring, trim, ltrim, rtrim, lower, upper.
<p>
For example, the following index indexes the rows of the Users table by their
latest modification time:
<pre>
create index idx_modtime on Users (modification_time())
</pre>
As another example, the following index indexes users in the Users table by the
year of the start date of their address:
<pre>
create index idx_year on Users (substring(address.startDate as string, 0, 4))
</pre>
The above definition declares that the "startDate" field of the "address"
column (which is of type JSON) must be of type STRING. Furthermore, it assumes
that these date strings are in the YYYY-MM-DD format. So, the substring
function is used to extract the YYYY part of the date and use it as the index
key.
<p>
[KVSTORE-1129]
</li>
<li>
Added support for compressing rotated log files. Compression is
currently disabled by default.
<p>
You can enable log file compression by setting the new
<code>serviceLogFileCompression</code> Storage Node parameter to "true".
Restart the associated Storage Node Agent to make the new setting take
effect for new files and to compress existing files.
<p>
Compressed log files store significantly more logging output in the same
amount of disk space. As a result, logging output can be retained for
longer, making more of it available to debug older issues. Log files
contain a lot of redundancy, so compressing them with the standard gzip
algorithm is very effective. The implementation makes conservative
assumptions about the compression ratio, allowing it to store
approximately 5 times more data by default as compared with uncompressed
files.
<p>
When compression is enabled, the meaning of the
<code>adminLogFileLimit</code> and <code>serviceLogFileLimit</code>
parameters is adjusted to take the expected compression ratio into
account, meaning that log files will be allowed to grow larger than the
specified size. With the default maximum file count, the actual size
limit will be approximately 5 times larger than the one specified.
<p>
Log file sizes may temporarily exceed the requested limits in some cases
when the value of the compression parameter is changed.
<p>
Compression is applied to the rotated copies of the store combined debug
logs, stat files, and perf files, plus the service debug log files for
all services (RNs, Arbiters, Admins, and SNs). Bootstrap debug log
files, GC log files, JE debug log files, and JE stats files are not
currently compressed.
<p>
The compressed rotated log files are renamed with a .gz suffix and the
filename is modified to use the creation time rather than the standard
log rotation number. For example, the standard rotated log file
<code>rg1-rn1_1.log</code> would be renamed after it was compressed to a
file with a name like <code>rg1-rn1_20220720-201902.log.gz</code>, where
the date portion means the file was created at '2022-07-20 20:19:02
UTC'. In the unusual case that multiple rotated log files are created in
the same second, a unique suffix is added to the date portion of the
filename. For example: <code>rg1-rn1_20220720-201902-1.log.gz</code>.
<p>
When working with compressed log files, consider using the gzcat or
zgrep commands, or uncompress the files into another directory, to avoid
using extra disk space in the standard log directory. Manually
uncompressed files will not be deleted automatically.
<p>
[KVSTORE-879]
</li>
<li>
Made several improvements intended to make it easier to use the debug
logs to diagnose store failures.
<ul>
<li>All services (Rep Nodes, Admins, Arbiters, and Storage Node Agents)
now consistently log status changes with log entries that include the
text "LIFECYCLE" in the logging message. The entries also identify when
the service is starting after a crash.
<li>Log entries for Rep Node and Admin replication state changes have
been updated to include the text "LIFECYCLE", and the format has been
modified slightly to make it easier to read.
<li>Services now log software version information both on service
startup and whenever a new service log file is started after log file
rotation.
</ul>
<p>
[KVSTORE-1417]
</li>
<li>
Registering an Elasticsearch cluster with the store to enable Full Text
Search now requires that the store be running Java 11 or later. Using
the Admin CLI <code>plan register-es</code> command to register a
Elasticsearch cluster when the store is running with an earlier Java
version will fail with a message such as:
<pre>
kv-> plan register-es -clustername fts -host ftshost -port 20000
oracle.kv.impl.admin.IllegalCommandException:Can not register ES Cluster, as it requires Java 11 or later, but running Java version 1.8.0_351
</pre>
If the nodes of the store are running different Java versions, only some
of them Java 11 or later, the plan command may not fail, but Full Text
Search will not work properly.
<p>
[KVSTORE-1503]
</li>
</ol>
<h3><a name="BugFixes22300">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug that could yield warning messages like the following during upgrade:
<pre>
2023-02-16 16:38:20.190 UTC WARNING [admin4] async-remote-initiator:
Dialog end: Unexpected exception reading response:
dialogHandler=AsyncVersionedRemoteDialogInitiator@7563669d[methodCall=MonitorAgent.getMeasurements[null]]
dialogId=2:42182bf4957433df peer=localhost:57648 state=DONE
exception=java.lang.IllegalStateException: Exception deserializing
object: java.lang.Object
      at oracle.kv.impl.util.SerializationUtil.getObject(SerializationUtil.java:108)
      at oracle.kv.impl.util.SerializationUtil.readJavaSerial(SerializationUtil.java:149)
      at oracle.kv.impl.async.JavaSerialMethodTable$JavaSerialMethodCall.readResponse(JavaSerialMethodTable.java:200)
      at oracle.kv.impl.async.AsyncVersionedRemoteDialogInitiator.onCanRead(AsyncVersionedRemoteDialogInitiator.java:172)
      ...
Caused by: java.lang.ClassNotFoundException:
oracle.kv.impl.async.perf.DialogEndpointGroupPerf$Stats
      at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)
      at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)
      at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:520)
      at java.base/java.lang.Class.forName0(Native Method)
      at java.base/java.lang.Class.forName(Class.java:467)
      at java.base/java.io.ObjectInputStream.resolveClass(ObjectInputStream.java:778)
      ...
</pre>
<p>
[KVSTORE-1815]
</li>
<li>
Fixed a bug in multi-region tables that could cause a multi-region table
to fail to stream writes from remote regions when it is created. A
thread in the multi-region table agent may encounter
NullPointerException with stack trace as following:
<pre>
2023-02-03 12:45:51.148 UTC WARNING - [ReqRespMan-ReqPolling-1_0] Error=java.lang.NullPointerException
java.lang.NullPointerException
        at oracle.kv.impl.xregion.service.ReqRespManager.processTableUpdate(ReqRespManager.java:601)
        at oracle.kv.impl.xregion.service.ReqRespManager.handleRequest(ReqRespManager.java:416)
        at oracle.kv.impl.xregion.service.ReqRespManager.access$800(ReqRespManager.java:61)
        at oracle.kv.impl.xregion.service.ReqRespManager$PollingTask.run(ReqRespManager.java:1132)
</pre>
<p>
[KVSTORE-1492]
</li>
<li>
Fixed a bug in the initialization of multi-region tables that could cause the
copying of table data to fail to complete for very large tables.
<p>
[KVSTORE-1588]
</li>
<li>
Fixed a bug that, in some uncommon cases, could cause the Streams API to resume
streaming from the wrong checkpoint, possibly causing some stream operations to
be missed.
<p>
[KVSTORE-1630]
</li>
<li>
Fixed a bug where a multi-region table might miss some changes from a
remote region if the table in the remote region was dropped and recreated
around the same time that a replication node in local region restarted.
<p>
[KVSTORE-1649]
</li>
<li>
Updated the output format of the verify configuration Admin CLI command,
modifying the warning message "Storage directory on rgX-rnY is running
low ..." to change from showing the amount of space used to showing the
amount of space available. The format of the new warning message matches
the availableStorageSize entry in the main output and correctly reflects
the amount of space available before the node runs out of space.
<p>
[KVSTORE-399]
</li>
<li>
Fixed a bug that caused the Admin CLI command 'show zones [-zn &lt;id&gt; |
-znname &lt;name&gt;] -json' to not include the information about SNs.
<p>
[KVSTORE-570]
</li>
<li>
Modified the Admin CLI 'plan deploy-sn -zn &lt;zone-name&gt;' command to
provide a better explanation of the problem in the failure message when
an invalid zone name is specified.
<p>
[KVSTORE-565]
</li>
<li>
Fixed a problem that a read operation using Consistency.Version performed on a
multi-shard store could cause a RepNode to restart if the shard specified in
the version did not match the shards available in the RepNode. This situation
could occur if an application performed a read request using
Consistency.Version returned by an update request for a different primary key,
or if the record being read had been migrated by an elasticity operation. The
problem could also occur when performing a multi-key operation, such as
<code>KVStore.storeIterator</code> or <code>TableAPI.tableIterator</code>,
using Consistency.Version on a multi-shard store.
<p>
This bug would produce stack traces like the following:
<pre>
2022-09-01 18:13:37.187 UTC SEVERE [rg2-rn1] Process exiting
java.lang.IllegalArgumentException: Replication environment mismatch. The UUID associated with the commit token is: 8c18cf27-b4fe-4795-8028-f1181ab6cdfc but this replica environment has the UUID: 79e879c7-bd33-4b73-a53c-eba0664c674b
        at com.sleepycat.je.rep.CommitPointConsistencyPolicy.ensureConsistency(CommitPointConsistencyPolicy.java:151)
        at com.sleepycat.je.rep.txn.ReadonlyTxn.checkConsistency(ReadonlyTxn.java:189)
        at com.sleepycat.je.rep.txn.ReadonlyTxn.txnBeginHook(ReadonlyTxn.java:156)
        at com.sleepycat.je.txn.Txn.&lt;init&gt;(Txn.java:353)
        at com.sleepycat.je.txn.Txn.&lt;init&gt;(Txn.java:303)
        at com.sleepycat.je.rep.txn.ReadonlyTxn.&lt;init&gt;(ReadonlyTxn.java:65)
        at com.sleepycat.je.rep.impl.RepImpl.createRepUserTxn(RepImpl.java:1225)
        at com.sleepycat.je.txn.Txn.createUserTxn(Txn.java:393)
        at com.sleepycat.je.txn.TxnManager.txnBegin(TxnManager.java:178)
        at com.sleepycat.je.dbi.EnvironmentImpl.txnBegin(EnvironmentImpl.java:2379)
        at com.sleepycat.je.Environment.beginTransactionInternal(Environment.java:1459)
        at com.sleepycat.je.Environment.beginTransaction(Environment.java:1350)
        at oracle.kv.impl.api.RequestHandlerImpl.executeInternal(RequestHandlerImpl.java:902)
        ...
</pre>
<p>
[KVSTORE-1635]
</li>
<li>
Fixed a bug that using the SQL INSERT statement to set the value of a
field of type NUMBER to a numeric value with an exponent less than -324
was setting the value of the field to 0.
<p>
[KVSTORE-1631]
</li>
<li>
Fixed a bug which could cause the thread in the Storage Node Agent
responsible for master rebalancing to fail because of an attempt to
divide by zero producing an <code>java.lang.ArithmeticException</code>.
After the problem was encountered, the SNA would not perform the
operations needed to distribute masters evenly across shards until the
SNA was restarted.
<p>
This bug would produce log entries like the following:
<pre>
2022-07-27 08:00:18.659 UTC SEVERE [sn5] MasterRebalanceThread thread exiting due to exception.
java.lang.ArithmeticException: / by zero
        at oracle.kv.impl.sna.masterBalance.RebalanceThread.getLeaseAdjustedMD(RebalanceThread.java:858)
        at oracle.kv.impl.sna.masterBalance.RebalanceThread.needsRebalancing(RebalanceThread.java:242)
        at oracle.kv.impl.sna.masterBalance.RebalanceThread.run(RebalanceThread.java:329)
2022-07-27 08:00:18.660 UTC INFO [sn5] Master balance manager shutdown
2022-07-27 08:00:18.661 UTC INFO [sn5] MasterRebalanceThread thread exited.
</pre>
<p>
[KVSTORE-1603]
</li>
<li>
Fixed a problem that, in rare occasions, could cause a Replication Node to
restart. The problem was likely introduced in the 22.1 release and could
generate log entries such as:
<pre>
2022-09-19 17:23:26.934 UTC SEVERE [rg3-rn1] JE: Replica unexpected exception
com.sleepycat.je.EnvironmentFailureException: (JE 22.3.5)
rg3-rn1(1):/block1/opc/workspace/arbiter-stress/kv/workdir/scratch/kvroot/mystore/sn5/disk1/rg3-rn1/env
java.lang.IllegalStateException: update of local topology failed from commit
trigger UNEXPECTED_EXCEPTION_FATAL: Unexpected internal Exception, unable to
continue. Environment is invalid and must be closed. Problem seen replaying
entry Commit/22 vlsn=7795150 isReplicated="1"
com.sleepycat.je.EnvironmentFailureException: (JE 22.3.5)
rg3-rn1(1):/block1/opc/workspace/arbiter-stress/kv/workdir/scratch/kvroot/mystore/sn5/disk1/rg3-rn1/env
java.lang.IllegalStateException: update of local topology failed from commit
trigger UNEXPECTED_EXCEPTION_FATAL: Unexpected internal Exception, unable to
continue. Environment is invalid and must be closed. Problem seen replaying
entry Commit/22 vlsn=7795150 isReplicated="1"
	at com.sleepycat.je.EnvironmentFailureException.unexpectedException(EnvironmentFailureException.java:402)
	at com.sleepycat.je.dbi.TriggerManager.runTriggers(TriggerManager.java:347)
	at com.sleepycat.je.dbi.TriggerManager.runCommitTriggers(TriggerManager.java:231)
	at com.sleepycat.je.txn.Txn.commit(Txn.java:809)
	at com.sleepycat.je.rep.txn.ReplayTxn.commit(ReplayTxn.java:299)
	at com.sleepycat.je.rep.impl.node.Replay.replayEntry(Replay.java:766)
	at com.sleepycat.je.rep.impl.node.Replica$ReplayThread.run(Replica.java:1356)
Caused by: java.lang.IllegalStateException: update of local topology failed
from commit trigger
	at oracle.kv.impl.rep.migration.MigrationManager$CompletionTrigger.commit(MigrationManager.java:2039)
	at com.sleepycat.je.dbi.TriggerManager$7.run(TriggerManager.java:237)
	at com.sleepycat.je.dbi.TriggerManager.runTriggers(TriggerManager.java:343)
	... 5 more
</pre>
<p>
[KVSTORE-1657]
</li>
<li>
Fixed a problem where a request performed on an entry that has been migrated
to another shard as part of an elasticity operation could fail with a
FaultException rather than being automatically retried on the new shard. An
example of the exception thrown:
<pre>
oracle.kv.FaultException: Partition: PARTITION-185 not present at RepNode
rg2-rn3, topology seq#: 383 (22.2.6) on [2022-06-08 05:07:28.351 UTC]
Fault class name: oracle.kv.impl.rep.IncorrectRoutingException
Resource id is: rg2-rn1
Remote stack trace: oracle.kv.FaultException: Partition: PARTITION-185 not
present at RepNode rg2-rn3, topology seq#: 383 (22.2.6) on [2022-06-08
05:07:28.351 UTC]
Fault class name: oracle.kv.impl.rep.IncorrectRoutingException
Resource id is: rg3-rn2
	at oracle.kv.impl.fault.ServiceFaultHandler.getThrowException(ServiceFaultHandler.java:175)
	at oracle.kv.impl.fault.ServiceFaultHandler.getThrowException(ServiceFaultHandler.java:156)
	at oracle.kv.impl.fault.ProcessFaultHandler.rethrow(ProcessFaultHandler.java:231)
	at oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:149)
	at oracle.kv.impl.api.RequestHandlerImpl.execute(RequestHandlerImpl.java:584)
	at oracle.kv.impl.api.RequestHandlerImpl.lambda$executeAsyncRequest$4(RequestHandlerImpl.java:674)
	at oracle.kv.impl.async.FutureUtils$CheckedSupplier.get(FutureUtils.java:560)
	at oracle.kv.impl.async.AsyncVersionedRemoteDialogResponder.withThreadDialogContext(AsyncVersionedRemoteDialogResponder.java:312)
	at oracle.kv.impl.api.RequestHandlerImpl.executeAsyncRequest(RequestHandlerImpl.java:673)
	at oracle.kv.impl.api.RequestHandlerImpl.lambda$execute$1(RequestHandlerImpl.java:622)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.lang.Thread.run(Thread.java:833)
</pre>
<p>
[KVSTORE-1537]
</li>
<li>
Fixed a bug where an index query involving an array could return
incorrect results.
<p>
[KVSTORE-1643]
</li>
<li>
Note that the Ant build script no longer works to build the Community
Edition. This change was not previously mentioned, but went into effect
with the 21.2 release.
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 22.2.10</u></h3>
<h3><a name="NewFeatures22200">New Features</a></h3>
<ol>
<li>
The Rep Node parameter 'enableErasure' now defaults to true, meaning
that Obsolete Data Erasure is now enabled by default.
<p>
When 'enableErasure' is set to true, this enables the erasure feature for
the underlying BDB JE storage layer. Erasure periodically wipes the obsolete
data from the storage layer, by zeroing out corresponding records.  Obsolete
data is data that is no longer returned in queries or scans because it has
been replaced or expired, but still exists in the database.
Note that only table and key/value data is erased. Table
metadata is not subject to erasure.
<p>
The Rep Node parameter 'erasurePeriod' specifies the duration for one
complete erasure pass over data. Erasure is throttled based on this value,
to minimize its impact on performance. By default, it is set to "6 DAYS".
<p>
[KVSTORE-1483]
</li>
</ol>
<h3><a name="BugFixes22200">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug that in some cases could cause the XRegion Service to block
for up to one hour before processing the next request to create or
delete a table.
<p>
[KVSTORE-1595]
</li>
<li>
Fixed a bug that could cause elasticity operations to fail in some cases
where partitions were moved back and forth between two shards.
<p>
[KVSTORE-1547]
</li>
<li>
Fixed a bug that a multi-region table would not be initialized correctly
in some cases when the table was dropped and recreated in a remote region.
<p>
[KVSTORE-1535]
</li>
<li>
Added 95% and 99% percentile latency values to the XRegion Service
statistics.
<p>
[KVSTORE-1404]
</li>
<li>
Fixed a bug in multi-region tables that, in some cases with high load, caused
requests to create, alter and drop multi-region tables to become blocked
inside the XRegion Service.
<p>
[KVSTORE-1559]
</li>
<li>
Fixed a bug in multi-region tables that stream operations from remote regions
could in some cases be lost when the XRegion Service writes them to the local
region.
<p>
[KVSTORE-1542]
</li>
<li>
Discovered that a bug fixed in the 21.1 release, but not previously reported,
could have user-visible consequences. Prior to that release, checkpointing a
multi-region table might cause some data to be lost during replication. In
other words, some writes from one region might not be replicated to remote
regions.
<p>
[KVSTORE-772]
</li>
<li>
Discovered that a bug fixed in the 21.1 release, but not previously reported,
can have user-visible consequences. Prior to that release, checkpointing a
multi-region table might cause a deadlock in data replication. If the issue is
encountered, writes made to a multi-region table in one region may stop
replication to remote regions, and network connections from remote regions
might drop due to inactivity.
<p>
[KVSTORE-1525]
</li>
<li>
Fixed a problem that could cause a thread deadlock in the direct Java
driver for applications that perform queries. The problem was seen in
the httpproxy, which uses the direct Java driver for queries, but is not
specific to it. The result was that the application would hang.
<p>
Using the <code>jstack</code> utility to create a thread dump for the
application showed two characteristic stack traces, which represent the
two sides of the deadlock:
<pre>
"nioEventLoopGroup-3-11" #70 prio=10 os_prio=0 cpu=66.97ms elapsed=5790.89s tid=0x00007f6fdc017800 nid=0x9e in Object.wait()  [0x00007f6fecbf3000]
   java.lang.Thread.State: RUNNABLE
	at oracle.kv.impl.api.table.FieldDefImpl.&lt;clinit&gt;(FieldDefImpl.java:90)
	at oracle.kv.impl.query.types.TypeManager.&lt;clinit&gt;(TypeManager.java:378)
	at oracle.kv.impl.query.compiler.FuncAndOr.&lt;init&gt;(FuncAndOr.java:38)
	at oracle.kv.impl.query.compiler.FunctionLib.&lt;init&gt;(FunctionLib.java:169)
	at oracle.kv.impl.query.compiler.CompilerAPI.&lt;clinit&gt;(CompilerAPI.java:41)
	at oracle.nosql.proxy.sc.TableUtils.getCallbackInfo(TableUtils.java:567)
	at oracle.nosql.proxy.DataService.handlePrepare(DataService.java:2032)
	at oracle.nosql.proxy.DataService$$Lambda$354/0x0000000800551840.handle(Unknown Source)
	at oracle.nosql.proxy.DataService.handleRequestWithContext(DataService.java:664)
	at oracle.nosql.proxy.DataService.handleRequestInternal(DataService.java:451)
	at oracle.nosql.proxy.DataService.handleRequest(DataService.java:424)
	at oracle.nosql.proxy.DataService.handleRequest(DataService.java:399)
	at oracle.nosql.proxy.DataService.handleRequest(DataService.java:355)
</pre>
And:
<pre>
"nioEventLoopGroup-3-9" #66 prio=10 os_prio=0 cpu=124.03ms elapsed=5791.14s tid=0x00007f6fdc015800 nid=0x98 in Object.wait()  [0x00007f7163aef000]
   java.lang.Thread.State: RUNNABLE
	at oracle.kv.impl.api.table.FieldDefSerialization.readTimestamp(FieldDefSerialization.java:433)
	at oracle.kv.impl.api.table.FieldDefSerialization.readFieldDef(FieldDefSerialization.java:346)
	at oracle.kv.impl.api.table.FieldDefSerialization.readFieldDef(FieldDefSerialization.java:261)
	at oracle.kv.impl.api.table.FieldDefSerialization.readRecord(FieldDefSerialization.java:380)
	at oracle.kv.impl.api.table.FieldDefSerialization.readFieldDef(FieldDefSerialization.java:348)
	at oracle.kv.impl.api.table.FieldDefSerialization.readFieldDef(FieldDefSerialization.java:261)
	at oracle.kv.impl.query.runtime.PlanIter.deserializeFieldDef(PlanIter.java:1184)
	at oracle.kv.impl.query.runtime.ReceiveIter.&lt;init&gt;(ReceiveIter.java:367)
	at oracle.kv.impl.query.runtime.PlanIter.deserializeIter(PlanIter.java:876)
	at oracle.kv.impl.api.query.PreparedStatementImpl.&lt;init&gt;(PreparedStatementImpl.java:550)
	at oracle.nosql.proxy.DataServiceHandler.deserializePreparedQuery(DataServiceHandler.java:810)
	at oracle.nosql.proxy.DataService.deserializePreparedQuery(DataService.java:2181)
	at oracle.nosql.proxy.DataService.handleQuery(DataService.java:1661)
	at oracle.nosql.proxy.DataService$$Lambda$353/0x0000000800552440.handle(Unknown Source)
	at oracle.nosql.proxy.DataService.handleRequestWithContext(DataService.java:664)
	at oracle.nosql.proxy.DataService.handleRequestInternal(DataService.java:451)
	at oracle.nosql.proxy.DataService.handleRequest(DataService.java:424)
</pre>
<p>
[KVSTORE-1484]
</li>
<li>
Fixed a bug where using Ctrl+C or Ctrl+D to terminate paginated output
of a query running in the SQL shell would cause a NullPointerException.
<p>
[KVSTORE-1521]
</li>
<li>
Fixed an issue that prevented a storage node from starting when using
Java 8 after calling the securityconfig merge-trust utility to merge a
security configuration with Java keystores in PKCS12 format into a
configuration with Java keystores in JKS format. The start command would
fail with following message:
<pre>
Failed to start SNA: Error contructing RMISocketPolicy using transport class for transport client
</pre>
<p>
[KVSTORE-1594]
</li>
<li>
Fixed a bug that the table description wrongly showed that JSON
MRCounter fields were nullable. Users always need to set values for JSON
MRCounters.
<p>
[KVSTORE-1456]
</li>
<li>
Fixed a bug that caused creating a child table that included a JSON
MRCounter to fail with the following error message:
<pre>
Error: Error found when creating the table: Only multi-region tables support MR_counters.
</pre>
<p>
[KVSTORE-1458]
</li>
<li>
Modified the implementation of <code>KVStore.executeSync</code> to
reduce its thread usage by having it use async network operations.
<p>
[KVSTORE-1072]
</li>
</ol>
<h3><a name="Utilities22200">Utility Changes</a></h3>
<ol>
<li>
Added the "show ddl &lt;table&gt;" command to the SQL shell. The new command
returns the DDL of a table and its indexes, if any.
<p>
[KVSTORE-1479]
</li>
<li>
The deprecated import/export utility and its related jar files
(kvtool.jar, kvmigrator.jar, migrator.jar) have been removed and are no
longer available. The old utility has been replaced by the standalone
migrator utility, which is an independent download. It is available on
the general Oracle NoSQL Database
<a href="https://www.oracle.com/database/technologies/nosql-database-server-downloads.html">download page</a>
<p>
[KVSTORE-1493]
</li>
<li>
Fixed a regression that was discovered affecting query processing for
a small number of Hive query types. Prior to fixing this regression,
each query's state was always reset when the job properties were
configured. Although this addressed an issue with Big Data SQL query
processing, because Hive and Big Data SQL employ different code paths,
it has recently been observed that resetting the query state when the
job properties are configured can result in incorrect results for
some Hive queries. To address this issue, the state from the most
recent query is now reset at the beginning of query processing for
the next query. This addresses both the old issue with Big Data SQL
query processing and this new issue with Hive.
<p>
[KVSTORE-372]
</li>
<li>
Version.fromByteArray() will now throw IllegalArgumentException if the
byte[] argument is invalid. It would previously throw FaultException.
<p>
[KVSTORE-1599]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 22.1.14 </u></h3>
<h3><a name="NewFeatures22100">New Features</a></h3>
<ol>
<li>
Added new classes that allow programmatic creation and control of a
small, standalone store instance, comprising a single partition. The
major classes are
<ul>
  <li>KVLocal - represents the store instance</li>
  <li>KVLocalConfig - allows configuration of the KVLocal instance</li>
</ul>
KVLocal can be configured to use TCP/IP connections or, if using Java 16
or higher, Unix domain sockets.
<p>
In support of KVLocal, the requirement that all keys specified in Operation
and TableOperation lists passed to KVStore.execute and TableAPI.execute,
respectively, share the same Major Path or shard key is relaxed for single
partition stores such as the ones managed by KVLocal.
<p>
[KVSTORE-1064]
</li>
<li>
Added three new SQL functions to do arithmetic operations on Timestamps:
<ul>
<li><code>timestamp(9) timestamp_add(timestamp, string)
</code>
<p>
Adds a duration to a timestamp value and returns the new timestamp. The duration
is a string with format [-]&lt;n&gt; (&lt;UNIT&gt;)+, where the &lt;UNIT&gt;
can be YEAR, MONTH, DAY, HOUR, MINUTE, SECOND, MILLISECOND, NANOSECOND or the
plural form of these keywords (e.g. YEARS). The UNIT keywords are
case-insensitive. (e.g. 1 day 12 hours).
<li><code>long timestamp_diff(timestamp, timestamp)</code>
<p>
Returns the number of milliseconds between two timestamp values (timestamp1 -
timestamp2).
<li><code>string get_duration(long)</code>
<p>
Converts the given number of milliseconds to a duration string.
</ul>
<p>
[KVSTORE-1338]
</li>
<li>
In SQL queries, allow casting of a timestamp value to a long value that is the
number of milliseconds since January 1, 1970, 00:00:00 GMT.
<p>
[KVSTORE-1247]
</li>
<li>
Added support for child tables to multi-region tables. Child tables
always inherit the regions of the associated top level tables, so users
cannot specify regions when creating child tables, nor can they
explicitly add or drop regions for child tables.
<p>
[KVSTORE-1114]
</li>
<li>
Added support for MRCounter in JSON so that the MR_COUNTER data type can
be used inside a schemaless JSON field. The syntax to declare an
MR_COUNTER field for a JSON column is:
<pre>
field-name AS field-type MR_COUNTER
</pre>
A JSON MR_COUNTER can be updated the same way as any other MR_COUNTER
column.
<p>
[KVSTORE-1223]
</li>
<li>
Switched the KeyStore and TrustStore type of the default security configuration
created by makebootconfig or securityconfig utility to PKCS12.
<p>
The KeyStores and TrustStores used by the NoSQL Database server in the default
security configuration will be created as PKCS12 password-protected stores. The
TrustStore used by client applications (client.trust) in the default security
configuration will be created as a PKCS12 password-less store if that feature
is supported by the version of Java used to run the configuration utility. If
not, the utilities will fall back to creating a JKS store if no password is
specified for client.trust.
<p>
Two new optional flags are introduced for security configuration creation:
<ul>
<li><code>-kstype &lt;JKS | PKCS12&gt;</code> <br>
Create KeyStores and TrustStores in the security configuration as PKCS12 or JKS
store, default PKCS12.</li>
<li><code>-ctspwd &lt;client.trust password&gt;</code> <br>
Create client.trust as a password-protected PKCS12 store using the specified
password.</li>
</ul>
<p>
Upgrading to this release won't convert the store type of the existing
KeyStores or TrustStores created by previous releases to PKCS12 automatically.
To switch the store type of an existing configuration, a new command has been
added to securityconfig utility:
<p>
<code>securityconfig config update -secdir security -kstype PKCS12</code>
<p>
Added two new client security properties to configure the password for
client.trust if it's created as a password-protected PKCS12 store.
<ul>
<li><code>oracle.kv.ssl.trustStorePassword</code></li>
<li><code>oracle.kv.ssl.trustStorePasswordAlias</code></li>
</ul>
<p>
The password of client.trust can be specified either directly via
<code>oracle.kv.ssl.trustStorePassword</code> or kept in the password store. If
the latter, specify the alias name of the password in the password store via
the <code>oracle.kv.ssl.trustStorePasswordAlias</code> parameter, and the NoSQL
Database Driver will retrieve the password from the password store
automatically.
<p>
Updated the merge-trust command in securityconfig utility. When merging a
security configuration created with a PKCS12 store into a security
configuration created with a JKS store, this command will automatically convert
the store type of the TrustStore to PKCS12 after merging all trusted
certificates. However, this command won't convert the store type when merging
trusted certificates of security configurations that are both created with JKS
store.
<p>
[KVSTORE-60]
</li>
</ol>
<h3><a name="BugFixes22100">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug that could have caused a NullPointerException when executing
"describe table" against a multi-region table.
<p>
[KVSTORE-1426]
</li>
<li>
Fixed a bug where adding or removing regions from a multi-region table
might not have been executed correctly when the store was under high
stress.
<p>
[KVSTORE-1374]
</li>
<li>
Fixed a bug where if a key-only table was later altered to add an identity
column, an error would be raised if an attempt was made to read a key-only
row that was inserted before the alter.
<p>
[KVSTORE-1370]
</li>
<li>
Fixed a bug that the default value of an internal JE parameter
preHeartbeatTimeoutMs is not set to a proper value. This bug will cause rare
cases that the store takes more than one hour to recover from faults or a
master transfer.
<p>
[KVSTORE-1384]
</li>
<li>
Fixed a bug that when a key-only MR table evolves by adding new columns,
the newly added columns might be lost when being replicated to remote regions.
<p>
[KVSTORE-1333]
</li>
<li>
Fixed a problem where a row with a homogeneous JSON array of type STRING
written with release 20.2 or earlier releases would fail to deserialize in
release 20.3 or later releases. The issue shows up as a row that is not found
in the result of a get() or in results of queries that need to deserialize
the row value. The data remains intact but is not accessible.
<p>
[KVSTORE-1347]
</li>
<li>
Fixed a bug in SQL INSERT when the table has an auto-generated identity or UUID
column and a column list is used before the VALUES clause. In this case, an
exception would be thrown, but should not have been.
<p>
[KVSTORE-1371]
</li>
<li>
Fixed a query bug when the partition() function is used in the WHERE clause.
The following example demonstrates the bug:
<pre>
select id, partition($f) as part
from foo $f
where $f.address.state = "MA" and partition($f) = 2
</pre>
The above query will be sent for execution to an RN that contains partition 2.
If there is an index on address.state, the query will use that index at that
RN. In general, the index will contain entries from multiple partitions that
are stored at the RN. The bug was that while the index was scanned, entries
that do not belong to partition 2 were not filtered out.
<p>
[KVSTORE-1334]
</li>
<li>
Fixed a bug that prevented a table with a UUID column from being altered after
the table was schema evolved: rows inserted before the schema evolution would
not deserialize after the schema evolution.
<p>
[KVSTORE-1357]
</li>
<li>
Fixed a bug in computing the result type of a query. Specifically, the
nullability flag of a field in the result type could be wrongly set to false.
This would happen if the SELECT-clause expression that corresponds to that
field may not return a NULL, but may return an empty result. The nullability
flag should be set to true in this case because the SELECT clause converts
EMPTY to NULL.
<p>
[KVSTORE-1342]
</li>
<li>
Fixed a bug where plans in the APPROVED state would not be run
after an Admin restart.
<p>
[KVSTORE-1194]
</li>
<li>
Fixed a bug where the Streams API could lose writes to a new shard
created during a store expansion.
<p>
[KVSTORE-1336]
</li>
<li>
Fixed a problem that could occur if the XRegion Agent was creating a new
multi-region table and, at the same time, it found a previously missing
multi-region table in a remote region. In this case, the agent could
fail to add the remote region to the table, and the local table would
not receive updates from the remote region.
<p>
[KVSTORE-1300]
</li>
<li>
Fixed compatibility problems in deserializing the server-side execution plan
of proxy-based queries. Problems involving two cases are fixed:
<ol>
<li>A query is prepared with a kvclient that is newer than the servers.
<li>A query is prepared with a kvclient at version V1. The prepared query is
cached by the application. Then, kvclient and kvserver are upgraded to V2. The
application executes the cached query again. In this case, the servers would
attempt (and fail) to deserialize the query plan using V2, instead of V1.
</ol>
<p>
[KVSTORE-1363]
</li>
<li>
Fixed a bug where adding a multi-region table could fail when there were
network or remote region failures. The XRegion agent now has a retry
mechanism so that it will add the table when the failures are resolved.
<p>
Also fixed a bug that when a Streams API subscription reconnects to a
store, the subscription may resume from a position later than expected.
This problem could affect both the Streams API and multi-region tables.
<p>
[KVSTORE-1265]
</li>
<li>
Fixed an incompatible change introduced in 20.3 in the performance JSON
files (e.g., rnOp*.json). The incompatible change was that latency
metrics (for example AllSingleKeyOperations_Interval_Avg) were changed
to integer values where they were previously floating-point numbers.
This change caused sub-millisecond latency values to appear as zero.
Fixed by reverting back to using floating-point numbers.
<p>
[KVSTORE-1289]
</li>
<li>
Fixed a problem where a query run on a table with data that was created
prior to release 19.5 and never modified might fail with an error that
indicates "modification time not available."
<p>
[KVSTORE-1234]
</li>
<li>
Fixed a bug with unnesting queries. Query results would be lost if the
query was not using an unnesting index and the batch size was reached in
the midst of unnesting the arrays or maps specified in the query.
<p>
[KVSTORE-1228]
</li>
<li>
Fixed a bug with unnesting queries. Queries that specified
<code>count(*)</code> were incorrectly using an unnesting index that
unnested at a deeper level than the query.
<p>
[KVSTORE-1292]
</li>
<li>
Fixed two bugs related to query timeouts. The first problem was that a
query could timeout at the driver but keep running at the RNs. The
second problem was that the query timeout would not be respected if the
query performed a generic (non-index-based) sort or group by.
<p>
[KVSTORE-353]
</li>
<li>
Modified the output of the 'show admins' Admin CLI command to display
the admin storage directory path, and of the 'ping' command to display
the size of the admin storage directory.
<p>
[KVSTORE-102]
</li>
<li>
Added TLSv1.3 to the default TLS protocols of security configurations
created with the makebootconfig or securityconfig utilities. The default
TLS protocols for security configuration are now "TLSv1.3, TLSv1.2".
Note that the new protocols are only used when creating new security
configurations with the above utilities. Upgrading to this release will
not automatically update the existing security configuration of a
running store. We recommended upgrading existing stores to use the
TLSv1.3 protocol: see "Guidelines for Enabling TLSv1.3 Protocol" in
Security Guide of Oracle NoSQL Database.
<p>
[KVSTORE-263]
</li>
<li>
The makebootconfig and securityconfig utilities now generate 2048 byte
RSA keys. Note that updated keys are only created when generating new
security configurations using the above utilities. Upgrading to this
release will not automatically update the existing private keys used by
a running store. We recommended upgrading existing stores to use new
private keys so that they have 2048 byte RSA keys: see "Guidelines for
Updating SSL Keys and Certificates" in Security Guide of Oracle NoSQL
Database.
<p>
[KVSTORE-932]
</li>
<li>
Modified the output from the "describe table" DDL command to include
multi-region table information if the table is multi-region.
<p>
[KVSTORE-1155]
</li>
<li>
Made changes to prevent a multi-region table that is missing at a remote
region from disrupting existing multi-region tables in local and other
remote regions. If an MR table is missing or has a incompatible schema
in a remote region, with the fix the agent will check the particular
table periodically while, at the same time, continuing to service other
remote regions where the MR table is available. When the table in
question is available again in the remote region, for example if the
missing table is recreated or the incompatible schema is fixed, the
agent will include the table and service it like other available MR
tables.
<p>
[KVSTORE-395]
</li>
<li>
Fixed a bug that prevented key-only multi-region tables from working
properly.
<p>
[KVSTORE-1302]
</li>
<li>
Fixed several bugs with partition migration, which is the underlying
mechanism to move user data from one shard to another during store
elasticity operations. The following problems were fixed:
<ul>
<li>Record modification times could be migrated incorrectly,
which caused problems with multi-region tables
<li>Client writes could be lost at the end of the migration under some
edge cases
<li>The migration service might not be available after certain RN
replication state changes
</ul>
<p>
[KVSTORE-1250] [KVSTORE-1244] [KVSTORE-1221]
</li>
<li>
Improved the robustness of the Java direct driver in handling network
connection problems it encounters when contacting storage nodes.
<p>
[KVSTORE-1423]
</li>
<li>
Fix a bug that could cause RepNode crashes or RepNode metadata
corruption in a short time window after an upgrade during which the
store version had not been fully updated. This bug could cause RepNodes
to crash if a new table with UUIDs or MRCounters was added, or an
existing table was altered to add UUID or MRCounter fields, during the
time window. For tables with UUIDs, RepNodes would crash during the time
window, but the problem would fix itself after the store version was
updated. For tables with MRCounters, the bug could cause persistent
metadata corruption, which would result in RepNodes continuing to crash
on restart.
<p>
[KVSTORE-1361]
</li>
</ol>
<h3><a name="APIChanges22100">API Changes</a></h3>
<ol>
<li>
<code>Row.getExpirationTime()</code> no longer throws an exception if
the underlying Row metadata is not available. Instead it will return 0
indicating no expiration time. Expiration time is 0 for rows that either
do not have a TTL or were written prior to the introduction of the TTL
feature.
<p>
Also added <code>Row.getLastModificationTime()</code> to return the last
modification time of a Row in milliseconds since January 1, 1970. If the
row was last modified using a version of the system older than release
19.5, the modification time is not available and 0 is returned.
<p>
[KVSTORE-1234]
</li>
<li>
Marked the <code>IndexKeySizeLimitException</code> class as hidden; it
is for internal use only.
<p>
[NOSQL-408]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 21.2.15</u></h3>
<h3><a name="NewFeatures21200">New Features</a></h3>
<ol>
<li>
An off-heap cache is no longer used by Oracle NoSQL Database. The
off-heap cache did not provide the performance benefits we had expected,
and in some cases had a negative performance impact, so it has been
removed.
<p>
As part of this change, the <code>systemPercent</code> parameter, which
was previously used to configure the size of the off-heap cache, has
been made obsolete. The parameter may still be specified, but it will be
ignored.
<p>
For stores with configurations where memory was allocated to the off-heap
cache, that memory is now available for file system caching in the
system buffer pool. In other words, data formerly stored in the off-heap
cache will now be cached in the system buffer pool.
<p>
[KVSTORE-927]
</li>
<li>
Implemented unnesting of arrays and maps.
<p>
The FROM clause has been extended to allow a list of expressions after the
table or tables referenced by the query. Conceptually, for each table row, the
expressions are evaluated, and a cross product is formed by the current row
and the results of these evaluations. The result of the whole FROM clause
is a table containing the union of all these cross products.
<p>
Although any kind of expression may appear in the FROM clause, the primary
purpose of this feature is to unnest arrays (or maps) that appear in table
rows. The main reason to support nesting is to group by fields that are
contained in the arrays or maps. As an example, consider the following table
that stores data from a TV streaming service:
<pre>
create table stream_acct(acct_id integer, value json, primary key(acct_id))
</pre>
A sample row of this table looks like this:
<pre>
{
  "acct_id": 1,
  "value": {
    "firstName" : "John",
    "lastName" : "Sanders",
    "country" : "USA",
    "contentStreamed": [
      {
        "showName": "Call My Agent",
        "showId": 15,
        "showType": "tvseries",
        "numSeasons" : 2,
        "seriesInfo": [
          {
            "seasonNum" : 1,
            "numEpisodes" : 2,
            "episodes": [
              { "episodeID" : 20, "lengthMin" : 45, "minWatched" : 45 },
              { "episodeID" : 30, "lengthMin" : 42, "minWatched" : 42 }
            ]
          },
          {
            "seasonNum": 2,
            "numEpisodes" : 2,
            "episodes": [
              { "episodeID" : 20, "lengthMin" : 50, "minWatched" : 50 },
              { "episodeID" : 30, "lengthMin" : 46, "minWatched" : 46 }
            ]
          }
        ]
      },
      {
        "showName": "Rita",
        "showId": 16,
        "showType": "tvseries",
        "numSeasons" : 1,
        "seriesInfo": [
          {
            "seasonNum" : 1,
            "numEpisodes" : 2,
            "episodes": [
              { "episodeID" : 20, "lengthMin" : 65, "minWatched" : 65 },
              { "episodeID" : 30, "lengthMin" : 60, "minWatched" : 60 }
]
          }
        ]
      }
    ]
  }
}
</pre>
The following query orders the shows in USA according to their "popularity",
i.e., how many users have shown an interest in them.
<pre>
select $show.showId, count(*) as cnt
from stream_acct $s, unnest($s.value.contentStreamed[] as $show)
where $s.value.country = "USA"
group by $show.showId
order by count(*) desc
</pre>
The above query can be optimized if the following index is created:
<pre>
create index idx_country_showid on stream_acct(
    value.country as string,
    value.contentStreamed[].showId as integer) with unique keys per row
</pre>
The query will use this index. The country condition will be pushed to the
index, the group-by will be index-based, and the index is a covering one for
this query. Notice that, for the index to be used, the index keys extracted
per row must not contain any duplicates. This constraint is enforced by
creating the index as "with unique keys per row".
<p>
Notice that the unnest clause in the above query (and in general) is not
strictly necessary; it can be omitted without changing the semantics (and
the results) of the query. However, if it is omitted, the index will not
used. This is because the unnest clause puts some restrictions on the kind
of expressions it wraps, and these restrictions make it possible for the
query processor to find that an index on the arrays/maps that are being
unnested is applicable and rewrite the query accordingly.
<p>
[KVSTORE-822]
</li>
<li>
Added seq_distinct() function. It returns the distinct values of the sequence
produced by its input expression.
<p>
As an example, the following query returns, for each area code, the number of
users having phone numbers in that area code. The query uses the seq_distinct()
because a user may have multiple phone numbers in the same area code, but he or
she must be counted only once per area code.
<pre>
select $areacode, count(*) as cnt
from Users u, seq_distinct(u.address.phones[].areacode) as $areacode
group by $areacode
</pre>
<p>
[KVSTORE-822]
</li>
<li>
In comparison operators, when one operand is a timestamp and the other a
string, the string operand is now implicitly cast to a timestamp with the same
precision as the precision of the timestamp operand. An exception is thrown if
the cast fails.
<p>
[KVSTORE-1016]
</li>
<li>
Enhanced support for nested seq_transform() expressions.
<p>
seq_transform() is useful for transforming JSON documents stored in table rows.
In such situations it is often the case that multiple seq_transform()
expressions must be used, nested into each other. Furthermore, inner
seq_transform() expressions may need to access the "current" input item of
outer seq_transform() expressions. Until now this was not possible. In this
release we enhance seq_transform(), so that each such expression creates an
appropriately named context-item variable that can be referenced by inner
seq_transform() expressions.
<p>
For example, consider the following table that records information about air
travel luggage:

<pre>
create table luggage (
  ticketNo string,
  passengerName string,
  bagInfo json,
  primary key(ticketNo))
</pre>

A sample row for this table is shown below
<pre>
{
  "ticketNo" : "1762352483606",
  "passengerName" : "Willie Hernandez",
  "bagInfo" : [
    {
      "tagNum" : "17657806243915",
      "routing" : "SFO/AMS/HER",
      "lastActionCode" : "offload",
      "lastSeenStation" : "HER",
      "lastSeenTimeGmt" : "2019-03-13T15:19:00",
      "flightLegs" : [
        {
          "flightNo" : "BM604",
          "flightDate" : "2019-03-12T20:00:00",
          "fltRouteSrc" : "SFO",
          "fltRouteDest" : "AMS",
          "estimatedArrival" : "2019-03-13T08:00:00",
          "actions" : [
            { "at":"SFO", "action":"TagScan", "time":"2019-03-12T18:14:00" },
            { "at":"SFO", "action":"onload",  "time":"2019-03-12T19:20:00" },
            { "at":"AMS", "action":"offload", "time":"2019-03-13T08:30:00" }
          ]
        },
        {
          "flightNo" : "BM667",
          "flightDate" : "2019-03-13T11:14:00",
          "fltRouteSrc" : "AMS",
          "fltRouteDest" : "HER",
          "estimatedArrival" : "2019-03-13T15:00:00",
          "actions" : [
            { "at":"AMS", "action":"TagScan", "time":"2019-03-13T10:45:00" },
            { "at":"AMS", "action":"onload",  "time":"2019-03-13T10:50:00" },
            { "at":"HER", "action":"offload", "time":"2019-03-13T15:19:00" }
          ]
        }
      ]
    },
    {
      "tagNum" : "17657806244523",
      "routing" : "SFO/AMS/HER",
      "lastActionCode" : "offload",
      "lastSeenStation" : "AMS",
      "lastSeenTimeGmt" : "2019-03-13T08:35:00",
      "flightLegs" : [
        {
          "flightNo" : "BM604",
          "flightDate" : "2019-03-12T20:00:00",
          "fltRouteSrc" : "SFO",
          "fltRouteDest" : "AMS",
          "estimatedArrival" : "2019-03-13T08:00:00",
          "actions" : [
            { "at":"SFO", "action":"TagScan", "time":"2019-03-12T18:14:00" },
            { "at":"SFO", "action":"onload",  "time":"2019-03-12T19:22:00" },
            { "at":"AMS", "action":"offload", "time":"2019-03-13T08:32:00"  }
          ]
        }
      ]
    }
  ]
}
</pre>
Let's say we want to write a query that will return, for each ticketNo, a
flat array containing all the actions performed on the luggage of that ticketNo.
However, we want only the "at" and "action" fields of each action. Furthermore,
we want the flightNo and the tagNum fields to be included with each action.
Specifically, for the above sample row, the result should be the following:
<pre>
{
  "actions" : [
    {"at":"SFO", "action":"TagScan", "flightNo":"BM604", "tagNum":17657806243915},
    {"at":"SFO", "action":"onload",  "flightNo":"BM604", "tagNum":17657806243915},
    {"at":"AMS", "action":"offload", "flightNo":"BM604", "tagNum":17657806243915},
    {"at":"AMS", "action":"TagScan", "flightNo":"BM667", "tagNum":17657806243915},
    {"at":"AMS", "action":"onload",  "flightNo":"BM667", "tagNum":17657806243915},
    {"at":"HER", "action":"offload", "flightNo":"BM667", "tagNum":17657806243915},
    {"at":"SFO", "action":"TagScan", "flightNo":"BM604", "tagNum":17657806244523},
    {"at":"SFO", "action":"onload",  "flightNo":"BM604", "tagNum":17657806244523},
    {"at":"AMS", "action":"offload", "flightNo":"BM604", "tagNum":17657806244523},
  ]
}
</pre>
Here is the query that will return the above result:
<pre>
select
  seq_transform(
      l.bagInfo[],
      seq_transform(
          $sq1.flightLegs[],
          seq_transform(
              $sq2.actions[],
              {
                "at" : $sq3.at,
                "action" : $sq3.action,
                "flightNo" : $sq2.flightNo,
                "tagNum" : $sq1.tagNum
              }
          )
      )
  ) as actions
from luggage l
</pre>
In this query, $sq1 iterates over the elements of the bagInfo array, $sq2
iterates over the elements of the flightLegs array, and $sq3 iterates over
the elements of the actions array.
<p>
[KVSTORE-1044]
</li>
</ol>
<h3><a name="BugFixes21200">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed an issue with KVStats that the
<code>NodeMetrics.getAverageLatencyNanos</code> method always returns
10000.
<p>
[KVSTORE-996]
</li>
<li>
Disabled JVM Biased Locking for RNs.  Now -XX:-UseBiasedLocking will be
explicitly passed to RNs' JVM cmdline.  This change should make RNs give more
predictable latencies. There should not be any performance degradation
due to this change.
<p>
[KVSTORE-1047]
</li>
<li>
The default partition migration concurrency has been increased. Partition
migration is done during some topology changes, such as redistribute and
rebalance. There are two parameters which limit how may partition migrations
can take place concurrently. The default values for these parameters have been
increased. Specifically:
<ul>
<li><code>rnPMConcurrentSourceLimit</code> - default changed from 1 to 2
<li><code>rnPMConcurrentTargetLimit</code> - default changed from 2 to 4
</ul>
The higher level of concurrency, in most cases, will reduce the overall
time that a topology change takes to complete. The increase should not
negatively impact ongoing data operations during a topology change,
especially when using SSDs. If the store is running on older hardware
with rotating disks, the user may want to explicitly set the parameters
to the original default values.
<p>
[KVSTORE-1002]
</li>
<li>
The output of the Admin CLI commands <code>ping</code> and <code>verify
configuration</code> now includes information about service start times and
state change times.
<p>
[KVSTORE-876]
</li>
<li>
The use of Java RMI in the direct Java driver is now optional. The
driver now only uses RMI when accessing servers running software prior
to the 21.2 release, or if the driver has been configured to disable use
of the async network protocol by calling
<code>KVStoreConfig.setUseAsync(false)</code>. Because the async network
protocol supports concurrent calls on the same socket connection, this
change should reduce socket and other resource usage in some cases,
particularly for stores with large numbers of shards.
<p>
[KVSTORE-340]
</li>
<li>
The <code>haHostname</code> and <code>haPortRange</code> Storage Node
parameters are now read-only. Changing these parameters already had no
effect; the new behavior is just intended to make it clear that the
parameters should not be changed. The only way to switch to new JE HA
parameters is to migrate to a new Storage Node.
<p>
[KVSTORE-437]
</li>
<li>
There is a new flag to the kvlite command that allows users to control the
storage size associated with a new kvlite store:
<pre>
  -storagedirsizegb size_in_GB
</pre>
The default value is 10GB, which has changed from the previous 1GB default.
This flag only applies for the initial creation of the store and is ignored
when kvlite is started on an existing store.
<p>
In addition, the output of kvlite when started on an existing store now
properly reflects the values in the existing store.
<p>
[KVSTORE-1042]
</li>
<li>
The <code>StringDef.equals()</code> method now considers subtypes when
determining if two fields are equal. The types <code>"STRING"</code>,
<code>"STRING AS UUID"</code> and <code>"STRING AS UUID GENERATED BY DEFAULT"
</code> are now not equal.
<p>
[KVSTORE-1048]
</li>
<li>
Modified the <code>verify configuration</code> Admin CLI command to
report version differences as notes, not violations. Version differences
are expected during upgrades, so they should not be considered
violations.
<p>
Modified the non-JSON output format of the <code>verify
configuration</code> and <code>ping</code> Admin CLI commands to add
spaces after the colon separators that appear at the end of keywords in
the output, to improve readability. Also removed spaces from a couple
keywords, changing "available storage size" to "availableStorageSize"
and "storage type" to "storageType".
<p>
Made changes to the non-JSON output format of Admin CLI commands related
to login issues to make the output more consistent.
<p>
[KVSTORE-448]
</li>
<li>
Modified the Admin CLI <code>plan deploy-topology</code> command to
require that the new topology being deployed reduce the number of
outstanding topology violations, if any, rather than just not increase
the number. As before, the command can still be forced to deploy a new
topology by specifying the -force flag. Also fixed a problem with the
way the command counted topology violations that was inaccurate in some
cases.
<p>
These two changes together fix a problem where deploying a new zone
without providing sufficient SNs, or providing ones with insufficiently
large storage directory sizes, could result in a topology deployment
appearing to succeed without actually making the changes needed to
populate the new zone.
<p>
[KVSTORE-542]
</li>
<li>
Removed TLSv1 and TLSv1.1 from the default TLS protocol settings. New
security configurations will be created with only TLSv1.2 by default
starting with this release.
[KVSTORE-903]
</li>
<li>
Added two new Rep Node parameters 'enableErasure' and 'erasurePeriod' to
control data erasure.
<p>
If 'enableErasure' is set to true, then this enables the erasure feature for
the underlying BDB JE storage layer. Erasure periodically wipes the obsolete
data from the storage layer, by zeroing out corresponding records. The default
value is false. Note that only table and key/value data is erased. Table
metadata is not subject to erasure.
<p>
When erasure is enabled, the value specified for the 'erasurePeriod' parameter
specifies the duration for one complete erasure pass over data. Erasure is
throttled based on this value, to minimize its impact on performance. By
default, it is set to "6 DAYS".
<p>
[KVSTORE-1033]
</li>
<li>
Fixed an issue that causes some BigDataSQL queries to encounter a
NullPointerException in certain cases. That issue was characterized by
a stacktrace like the following:
<pre>
Caused by: java.lang.NullPointerException
at java.util.Objects.requireNonNull(Objects.java:203)
at java.util.AbstractCollection.retainAll(AbstractCollection.java:405)
at oracle.kv.impl.query.runtime.RuntimeControlBlock.setPartitionSet(RuntimeControlBlock.java:258)
at oracle.kv.impl.query.runtime.ReceiveIter.open(ReceiveIter.java:1252)
at oracle.kv.impl.api.query.QueryStatementResultImpl$QueryResultIterator.&lt;init&gt;(QueryStatementResultImpl.java:297)
at oracle.kv.impl.api.query.QueryStatementResultImpl.&lt;init&gt;(QueryStatementResultImpl.java:153)
at oracle.kv.impl.api.query.QueryStatementResultImpl.&lt;init&gt;(QueryStatementResultImpl.java:115)
at oracle.kv.impl.api.query.PreparedStatementImpl.executeSyncPartitions(PreparedStatementImpl.java:365)
at oracle.kv.impl.api.KVStoreImpl.executeSyncPartitions(KVStoreImpl.java:3635)
at oracle.kv.hadoop.table.TableRecordReaderBase.getNextOnqlIteratorPartitions(TableRecordReaderBase.java:523)
at oracle.kv.hadoop.table.TableRecordReaderBase.getNextIterator(TableRecordReaderBase.java:500)
at oracle.kv.hadoop.table.TableRecordReaderBase.nextKeyValue(TableRecordReaderBase.java:391)
... 11 more
</pre>
<p>
With this release, the issue above has been fixed and no longer occurs.
<p>
[KVSTORE-1123]
</li>
<li>
Fixed a issue that when there are multiple subscriptions for the Streams API
on a shard, changes to the tables on a subscription, like adding or removing
tables, would cause the same changes of tables to other subscriptions as well.
<p>
[KVSTORE-35]
</li>
<li>
Fixed a deadlock issue related to SSLDataChannel. The issue will produce stack
traces similar to the following in a thread dump:
<pre>
"ReplicaOutputThread" #829 daemon prio=5 os_prio=0 cpu=8695.34ms elapsed=66577.11s tid=0x000055f030c1f800 nid=0x49f2 waiting for monitor entry  [0x00007fc720171000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelWriteTask.run(SSLDataChannel.java:1425)
	- waiting to lock <0x00000010046df7e0> (a java.nio.HeapByteBuffer)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelWriteTask.access$1100(SSLDataChannel.java:1413)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel.flush(SSLDataChannel.java:590)
    ......
"REPLICA rg15-rn2(2)" #68 daemon prio=5 os_prio=0 cpu=9106.65ms elapsed=68622.76s tid=0x000055f030c55800 nid=0xb24 in Object.wait()  [0x00007fc722b93000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(java.base@11.0.8/Native Method)
	- waiting on &lt;no object reference available>
	at java.lang.Object.wait(java.base@11.0.8/Object.java:328)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelTask.transitToInProgress(SSLDataChannel.java:1335)
	- waiting to re-lock in wait() <0x00000010046e01b8> (a java.lang.Object)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelWriteTask.run(SSLDataChannel.java:1423)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelWriteTask.access$1100(SSLDataChannel.java:1413)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel.doWrap(SSLDataChannel.java:910)
	- locked <0x00000010046df7e0> (a java.nio.HeapByteBuffer)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel.handshake(SSLDataChannel.java:847)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel.unwrap(SSLDataChannel.java:771)
	at com.sleepycat.je.rep.utilint.net.SSLDataChannel.read(SSLDataChannel.java:403)
	......
</pre>
<p>
[KVSTORE-1021]
</li>
<li>
Fixed a livelock issue related to SSLDataChannel. The issue is observed as
an inactive channel with either SSLDataChannel doWrap or doUnwrap.  Stack
traces similar to the following will be seen in a thread dump:
<pre>
   java.lang.Thread.State: RUNNABLE
        at java.lang.Object.hashCode(java.base@11.0.6/Native Method)
        at java.util.concurrent.ConcurrentHashMap.replaceNode(java.base@11.0.6/ConcurrentHashMap.java:1111)
        at java.util.concurrent.ConcurrentHashMap.remove(java.base@11.0.6/ConcurrentHashMap.java:1102)
        at com.sleepycat.je.utilint.LoggerUtils.logMsg(LoggerUtils.java:538)
        at com.sleepycat.je.utilint.LoggerUtils.logMsg(LoggerUtils.java:445)
        at com.sleepycat.je.rep.utilint.net.DataChannelFactoryBuilder$ChannelInstanceLogger.log(DataChannelFactoryBuilder.java:417)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelWriteTask.run(SSLDataChannel.java:1636)
        - locked <0x00000000f037cc80> (a java.lang.Object)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelWriteTask.access$1400(SSLDataChannel.java:1613)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel.doWrap(SSLDataChannel.java:990)
	......
</pre>
<pre>
   java.lang.Thread.State: RUNNABLE
        at java.lang.Object.notifyAll(java.base@11.0.6/Native Method)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelTask.transitToIdle(SSLDataChannel.java:1513)
        - locked <0x00000000f039e788> (a java.lang.Object)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelReadTask.run(SSLDataChannel.java:1808)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel$ChannelReadTask.access$1800(SSLDataChannel.java:1751)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel.readChannelForBufUnderflow(SSLDataChannel.java:1168)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel.doUnwrap(SSLDataChannel.java:1079)
        - locked <0x00000000f0386f20> (a java.lang.Object)
        - locked <0x00000000f0386ea8> (a java.lang.Object)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel.handshake(SSLDataChannel.java:930)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel.unwrap(SSLDataChannel.java:828)
        at com.sleepycat.je.rep.utilint.net.SSLDataChannel.read(SSLDataChannel.java:441)
    ......
</pre>
<p>
[KVSTORE-1022]
</li>
<li>
Fixed a problem where RepNode or MasterRebalanceThread in StorageNode may exit
unexpectedly due to uncaught InternalFaultException(s) when transient network
issues occur. In this case, the logging output shows both of them exit because
of SessionAccessException, which is incorrect and has also been fixed.
<pre>
2021-02-12 10:16:26.575 UTC SEVERE [sn6] MasterRebalanceThread thread exiting due to exception.
oracle.kv.impl.security.SessionAccessException: java.rmi.ConnectIOException: Exception creating connection to:
...

2021-02-12 10:16:26.575 UTC SEVERE [sn6] MasterRebalanceThread thread exiting due to exception.
oracle.kv.impl.security.SessionAccessException: java.rmi.ConnectIOException: Exception creating connection to:
...
</pre>
<p>
[KVSTORE-942]
</li>
<li>
Fixed a bug with the <code>DROP NAMESPACE</code> command where any existing
tables in the namespace will also be dropped but their data remains in the store.
Since the tables have been dropped their data can not be accessed or removed.
<p>
[KVSTORE-1076]
</li>
<li>
Fixed a bug that using UPDATE statement with REMOVE clause to remove an element
from ARRAY(RECORD) or MAP(RECORD) fails with java.lang.IllegalArgumentException:
Error: at (...) Cannot remove fields from records.
<p>
[KVSTORE-1200]
</li>
<li>
Fixed a bug which could cause a drop table DDL operation to hang when
the dropped table is a multi-region table.
<p>
[KVSTORE-1408]
</li>
<li>
A combination of code changes and bug fixes were made related to
upgrades and the multi-region agent. With these changes, when a
multi-region agent is started for the first time on an existing store,
the agent must be running the same software version as the store, or
newer.
<p>
[KVSTORE-1393]
</li>
</ol>
<h3><a name="Packaging21200">Packaging Changes</a></h3>
<ol>
<li>
The packaging of kvclient.jar and kvstore.jar has been changed to
include classes from Oracle internal libraries that are not available in
public Maven repositories and were previously included as separate JAR
files in the distribution. This change is intended to make it easier to
create and use a Maven pom.xml file that depends on kvclient.jar since
the JAR file now only has dependencies that are available publicly. The
libraries included are:
<ul>
<li>commonutil.jar</li>
<li>sklogger.jar</li>
<li>sdoapi.jar</li>
<li>sdoutl.jar</li>
<li>sdodep3prt.jar</li>
</ul>
<p>
In addition, classes from Enterprise Edition-only libraries referenced
by kvstore-ee.jar are now directly included in that library, again for
simplicity in handling dependencies. The libraries included are the ones
associated with the Oracle Wallet:
<ul>
<li>osdt_core.jar</li>
<li>osdt_cert.jar</li>
<li>osraclepki.jar</li>
</ul>
Also, the XML build files have been removed from the Community Edition release
as it is not currently possible to fully build from source.
<p>
[KVSTORE-1100]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 21.1.12</u></h3>
<h3><a name="NewFeatures21100">New Features</a></h3>
<ol>
<li>
Added support for indexing nested arrays and map, and using such indexes
in queries.
<p>
Previously, Oracle NoSQL could index only one array or map per table
row, meaning that an indexed array or map could not be nested inside
another array or map. This release adds support for indexing nested
arrays and maps. For example, consider the following table that records
information about air travel baggage:

<pre>
create table baggage (
  ticketNo string,
  passengerName string,
  bagInfo json,
  primary key(ticketNo))
</pre>

A sample row for this table is shown below. In this row, there is
only one piece of baggage for ticketNo "1762352483606", but in general,
passengers may have more than one piece of baggage, and as a result,
"bagInfo" is an array of documents.

<pre>
{
  "ticketNo" : "1762352483606",
  "passengerName" : "Willie Hernandez",
  "bagInfo" : [
    {
      "tagNum" : "17657806243915",
      "routing" : "MIA/LAX/MEL",
      "lastActionCode" : "OFFLOAD",
      "lastSeenStation" : "MEL",
      "lastSeenTimeGmt" : "2019.03.13 at 22:10:00 EDT",
      "flightLegs" : [
        {
          "flightNo" : "BM604",
          "flightDate" : "2019.03.12 at 20:00:00 EDT",
          "fltRouteSrc" : "MIA",
          "fltRouteDest" : "LAX",
          "estimatedArrival" : "2019.03.12 at 23:00:00 PDT",
          "actions" : [
            { "actionCode" : "ONLOAD to LAX",
              "actionTime" : "2019.03.12 at 21:14:00 EDT" },
            { "actionCode" : "BagTag Scan at MIA",
              "actionTime" : "2019.03.12 at 20:48:00 EDT"
            },
            { "actionCode" : "Checkin at MIA",
              "actionTime" : "2019.03.12 at 19:50:00 EDT"
            }
          ]
        },
        {
          "flightNo" : "BM667",
          "flightDate" : "2019.03.12 at 23:14:00 PDT",
          "fltRouteSrc" : "LAX",
          "fltRouteDest" : "MEL",
          "estimatedArrival" : "2019.03.13 at 22:16:00 EDT",
          "actions" : [
            { "actionCode" : "Offload to Carousel at MEL",
              "actionTime" : "2019.03.13 at 22:14:00 EDT"
            },
            { "actionCode" : "ONLOAD to MEL",
              "actionTime" : "2019.03.13 at 03:35:00 PDT"
            },
            { "actionCode" : "OFFLOAD from LAX",
              "actionTime" : "2019.03.13 at 03:19:00 PDT"
            }
          ]
        }
      ]
    }
  ]
}
</pre>
The following index can be created on the baggage table.

<pre>
create index idx on baggage (
  bagInfo[].lastSeenStation as string,
  bagInfo.flightLegs[].fltRouteSrc as string,
  bagInfo.flightLegs[].flightDate as string)
</pre>

The index indexes 3 fields of the baggage table: one is the lastSeenStation
field of the outer bagInfo array and the other two are the fltRouteSrc and
flightDate fields of the nested flightLegs array. The contents of this index
for the sample row in baggage are:

<pre>
  [ "MEL", "MIA", "2019.03.12 at 20:00:00 EDT", "1762352483606" ]
  [ "MEL", "LAX", "2019.03.12 at 23:14:00 PDT", "1762352483606" ]
</pre>

The following query returns the number of bags that traveled from "MIA" to
"MEL" during the whole year 2019. All of the conditions in the WHERE clause
are pushed to the above index, as start/stop predicates.

<pre>
select count(b.info.bagInfo.flightLegs[$element.fltRouteSrc ="MIA"])
from baggage b
where exists b.info.bagInfo[$element.lastSeenStation = "MEL"].
             flightLegs[$element.fltRouteSrc = "MIA" and
                        $element.flightDate >= "2019.01.01" and
                        $element.flightDate <= "2019.12.31"]
</pre>
<p>
[KVSTORE-271]
</li>
<li>
Added a parameter to control the maximum number of index keys generated per
row. The parameter is called rnMaxIndexKeysPerRow and its default value is
10,000. When a row is being indexed (either for the first time or after an
update), if the number of index keys extracted from the row exceeds the
maximum, an IllegalArgumentException will be thrown.
<p>
[KVSTORE-978]
</li>
<li>
Added the following five new SQL functions to extract row properties
that are not stored as table columns. Although the signature of these
functions specifies AnyRecord as the type of the input parameter, the
functions actually require a row as input. The only expression that
returns a row is a row variable, that is, a table alias whose name
starts with "$".
<ul>
<li><code>integer partition(AnyRecord)</code>
<p>
Returns the partition the row belongs to.
<li><code>integer shard(AnyRecord)</code>
<p>
Returns the shard that contains the row currently.
<li><code>integer row_storage_size(AnyRecord)</code>
<p>
Returns the storage size (in bytes) of the most recent version of the
row. The returned size includes any overhead (bookkeeping) bytes. It
does not include the storage size of any older versions of the row
(which are now obsolete and subject to removal by the storage engine
cleaner module).
<li><code>integer index_storage_size(AnyRecord, string)</code>
<p>
The second argument to this function is supposed to be the name of an
index on the table containing the input row. The functions returns the
storage size (in bytes) of the index entry or entries that "point" back
to the input row from the given index. The returned size includes any
overhead (bookkeeping) bytes associated with these entries.
<p>
Notice: for performance reasons it is recommended that queries do not contain
multiple calls to the index_storage_size function, for different indexes.
<li><code>timestamp(3) modification_time(AnyRecord)</code>
<p>
Returns the most recent modification time of the row, as a timestamp value of
precision 3 (milliseconds). If the row has never been modified since its
insertion, it returns the insertion time.
</ul>
Here is an example query that returns, for each partition, the total number
of bytes used to store all the rows of table "foo" contained in that partition:
<pre>
select partition($f), sum(row_storage_size($f))
from foo $f
group by partition($f)
</pre>
<p>
[KVSTORE-127]
</li>
<li>
Added SQL function parse_json(string). It converts a string argument, which
is supposed to be JSON text, to an Oracle NoSQL value that represents the
given JSON. Here is a usage example:

<pre>
create table foo (id integer, jcol json, primary key(id))

insert into foo values (10, parse_json("{ \"name\" : \"john\", \"age\" : 30 }"))
</pre>
</li>
<li>
Support LEFT OUTER JOIN SQL syntax.
<p>
The NESTED TABLES clause is equivalent to a number of left-outer-join operations
"centered" around the target table, this feature supports LEFT OUTER JOIN(LOJ)
syntax to be compatible with standard ANSI SQL. The functionality of LOJ is
subset of that of NESTED TABLES, it supports to query linear nested tables only.
Here is an example:
<pre>
create table A (ida integer, a1 string, primary key(ida));
create table A.B (idb integer, b1 string, primary key(idb));
create table A.B.C (idc integer, c1 integer, primary key(idc));

select * from A a LEFT OUTER JOIN A.B b ON a.ida = b.ida
                  LEFT OUTER JOIN A.B.C c ON b.ida = c.ida and b.idb = c.idb
</pre>
<p>
[KVSTORE-265]
</li>
<li>
Support MRCounter for integer, long and number value types in multi-region
tables. It's a data structure that can be replicated across regions, where
replicas are updated independently and can always converge to a correct
common state.
<p>
The syntax to create a MRCounter column is:
<pre>
AS MR_COUNTER
</pre>
Such columns can only be updated using + or - operators in UPDATE DML.
<p>
[KVSTORE-803]
</li>
</ol>
<h3><a name="BugFixes21100">Bug and Performance Fixes</a></h3>
<ol>
<li>
Changed the Streams API such that by default it would reconnect infinitely when
the connection to any shard in source store is dropped, till the connection is
back or the user shuts down the stream. Today the Streams API would reconnect
up to a limit before shutting down the stream.  The previous behavior favors
consistency while the new behavior favors availability over consistency. The
Streams API user can override the default behavior by the public API
<code>NoSQLSubscriptionConfig.Builder.setMaxReconnect()</code>.
<p>
[KVSTORE-726]
</li>
<li>
Changed the Streams API that only durable write operations will be streamed.
By durable write it means only the writes satisfying the durability setting.
For example, if a write operation comes with durability setting COMMIT_SYNC,
it will be stream only after it has been acknowledged by majority of replicas.
Previously, such write may be streamed before it is acknowledged by majority of
replicas, and when master migrates, the streamed operation may be missing
from the new master.
<p>
[KVSTORE-686]
</li>
<li>
Fixed a bug that when the user drops a region with pending DDLs to create,
alter or drop a multi-region tables from that remote region, the region agent
serving that remote region may not shut down correctly. Consequently if
the user creates multi-region tables  again immediately after the region is
dropped, the XRegion service may not be able to work properly to serve the newly
created multi-region tables.
<p>
[KVSTORE-901]
</li>
<li>
Fixed a bug that when all subscribed tables are unsubscribed from a stream
to create an empty stream, and later the user subscribes tables to the empty
stream, the Stream client may throw NullPointerException.
<p>
[KVSTORE-904]
</li>
<li>
Improved javadoc for asynchronous execution methods. We added the "Thread Model
for Asynchronous Execution" section in the KVStore interface to describe our
thread model as well as the requirement for user-supplied actions triggered
after the asynchronous execution.
<p>
[KVSTORE-938]
</li>
<li>
GC tuning for more predictable latencies. The following changes are
made to the RN's GC parameters:
<ol>
<li> -XX:G1MixedGCCountTarget to 12 from 32.
<li> -XX:ConcGCThreads is set to the same values as -XX:ParallelGCThreads.
</ol>
These changes should make full GC pauses less frequent. There may be a
throughput degradation of around 5%, depending on the workload.
<p>
[KVSTORE-888]
</li>
<li>
Fixed a bug where an httpproxy instance running on a 19.3-based client library
communicating with a 20.2-based server might fail to execute queries.
<p>
[KVSTORE-833]
</li>
<li>
Query processor will now always raise an error if the search-geometry argument
to the geo search functions is not a valid geometry. Until now, an error would
be raised only if it could be detected at compile time that the argument was
invalid. If not, then during runtime the geo search functions would return
false in this case.
<p>
[KVSTORE-805]
</li>
<li>
Fixed a bug that would cause an IllegalArgumentException to be raised due to
imprecise computation of the return type of conditional array constructor
expression. For example, IAE would be raised for this query:

select arr[] from Foo

where "arr" is a column of table Foo with type ARRAY(ARRAY(integer)). This is
because the arr[] expression in the SELECT is wrapped into a conditional array
constructor whose type would be ARRAY(JSON) and it is not allowed to insert
a value of type ARRAY(integer) into an array of type ARRAY(JSON). Now, the
type of the conditional array constructor is set to ARRAY(ANY).
<p>
[KVSTORE-968]
</li>
<li>
Because support for the oracle.kv.Consistency.NONE_REQUIRED_NO_MASTER
consistency policy has been deprecated, the Oracle NoSQL Hadoop/Hive/BigDataSQL
integration no longer supports that policy. Applications that employ those
integrations should use the oracle.kv.Consistency.NONE_REQUIRED consistency
policy instead.
<p>
[KVSTORE-837]
</li>
<li>
The socket read timeout, which can be changed by calling
<code>KVStoreConfig.setSocketReadTimeout</code>, no longer needs to be
greater than the request timeout when using the async network protocol,
which is enabled by default.
<p>
[KVSTORE-776]
</li>
<li>
Fixed a bug in GROUP BY query based on full table scan that returns unexpected
results with specified size limit. The bug exists only on cloud environment.
<p>
[NOSQL-338]
</li>
<li>
Fixed a bug that would cause an exception if a bind variable were used in
an ADD clause of an UPDATE statement. This is when the bind variable is
the new element to add to the target array and there is no position
expression. For example:

<pre>
declare $userid integer;
update teams t
add t.info.teams[1].userids $userid
where id = 1
returning *
</pre>
<p>
[KVSTORE-963]
</li>
<li>
Increased the sizes of the default values of several debug and GC log
parameters so that more information is retained, to help when debugging
problems. Also, to save space, disabled JE debug logging by default,
since the entries in those files are present in the associated service
debug log files.
<p>
Note that default parameter values are only used for new stores and new
services. If you are upgrading an existing store, we recommend changing
these parameters for existing services.
<p>
Parameters that were changed:
<ul>
<li><b>rnGCLogFileSize</b> - Changed the default file size limit for GC
log files on RNs from 1048576 bytes (1 MB) to 5242880 bytes (5 MB)
<li><b>adminLogFileLimit</b> - Changed the default file size limit for
debug log files on admins from 4000000 bytes to 5242880 bytes (5 MB)
<li><b>GCLogFileSize</b> - Changed the default file size limit for GC
log files on admins from 1048576 bytes (1 MB) to 5242880 bytes (5 MB)
<li><b>serviceLogFileLimit</b> - Changed the default file size limit for
other debug log files, including the store wide log, stat file, perf
file, and RN debug log files, from 2000000 bytes to 5242880 bytes (5 MB)
<li><b>loggingConfigProps</b> - Set the default value of the logging
configuration for RNs and admins to
<code>com.sleepycat.je.util.FileHandler.level=OFF</code>, which disables
logging to JE debug log files
</ul>
<p>
[KVSTORE-878]
</li>
<li>
Fixed a bug in master rebalancing to avoid futile retries when the capacity of
the SN is not a multiple of the RF.
<p>
[KVSTORE-869]
</li>
<li>
Fixed a bug that the final "Z" was missing from the timestamp string in ISO8601
format that indicates UTC.
<p>
[KVSTORE-801]
</li>
<li>
If a prepared proxy-based query was executed after its table was drooped, an
NPE would be raised. Now, a QueryException is raised.
<p>
[KVSTORE-920]
</li>
<li>
Fixed a bug that would cause an exception if a query compared a timestamp field
with a bind variable and the timestamp field is indexed.
<p>
Also allow a timestamp index to be used by a query that compares a timestamp
field with a timestamp value when the precisions of the timestamp field and
the value are different.
<p>
[KVSTORE-950]
</li>
<li>
Fixed a rare problem where write requests could be sent to a RepNode
that was in the UNKNOWN state and was not the master. In this case, the
request would fail, but would have succeeded if it had been sent to the
actual master. The client now gets the correct node status information
and sends the request to the master.
<p>
[KVSTORE-681]
</li>
<li>
Modified the rnRHAsyncMaxConcurrentRequests RepNode parameter to require
that RNs be restarted when these parameters are changed. The facilities
needed to support changing this value without requiring a restart had a
negative impact on performance.
<p>
[KVSTORE-941]
</li>
<li>
Both the JSON and text output of the ping command contain a new boolean
attribute <code>isMasterBalanced</code>. If the value is
<code>false</code>, that means there is an excess of RepNodes in the
Master state and one or more of the nodes in the Master state will
transition to a Replica at a suitable time in the future.
<p>
[KVSTORE-799]
</li>
<li>
The ping command now exits with exit code 103 when the store is
operational but some RepNodes are in the UNKNOWN state.
<p>
[KVSTORE-756]
</li>
<li>
The output of the ping command now includes information about the
storage type for RepNodes and Admins. The possible storage types
reported are:
<ul>
<li>HD - Hard Disk
<li>SSD - Solid-State Drive, flash-based
<li>NVME - NVM Express, non-volatile memory
<li>HD (default for UNKNOWN) - the storage type is assumed to be Hard
Disk because it was not possible to determine the actual storage type.
</ul>
<p>
[KVSTORE-802]
</li>
<li>
Fixed a bug where, in rare cases, operations may return with the following
error when a client using 20.3.17 release is connecting to a store with 20.3.17
release or after:
<pre>
java.lang.IllegalStateException: Expected state BEFORE_READ, was DONE
	at oracle.kv.impl.async.AbstractResultHandler.checkCallOnResult(AbstractResultHandler.java:71)
	at oracle.kv.impl.async.AbstractResultHandler.checkCallOnResult(AbstractResultHandler.java:49)
	at oracle.kv.impl.async.AbstractDelegatingResultHandler.onResult(AbstractDelegatingResultHandler.java:49)
	at oracle.kv.impl.async.AsyncVersionedRemoteDialogInitiator.onCanRead(AsyncVersionedRemoteDialogInitiator.java:157)
	at oracle.kv.impl.async.dialog.DialogContextImpl$OnCanReadTask.doWork(DialogContextImpl.java:1028)
	at oracle.kv.impl.async.dialog.DialogContextImpl$OnCanReadTask.run(DialogContextImpl.java:1017)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.runTasks(NioChannelExecutor.java:1493
</pre>
<p>
[KVSTORE-880]
</li>
<li>
Fixed a bug where operations may return with the following error when there is
a network-related problem:
<pre>
java.lang.IllegalStateException: Unexpected null read
    at oracle.kv.impl.async.AsyncVersionedRemoteDialogInitiator.onCanRead(AsyncVersionedRemoteDialogInitiator.java:131)
    at oracle.kv.impl.async.dialog.DialogContextImpl$OnCanReadTask.doWork(DialogContextImpl.java:1078)
    at oracle.kv.impl.async.dialog.DialogContextImpl$OnCanReadTask.run(DialogContextImpl.java:1049)
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
    at java.util.concurrent.FutureTask.run(FutureTask.java:266)
    at oracle.kv.impl.async.dialog.nio.NioChannelExecutor.runTasks(NioChannelExecutor.java:1655)
</pre>
<p>
[KVSTORE-899]
</li>
<li>
Fixed a scalability problem for the storage nodes that when the storage nodes
have a limited CPU resource and a large number of client connections,
OutOfMemoryError may occur.
<p>
[KVSTORE-390]
</li>
<li>
In previous versions, the syntax of the CREATE INDEX and CREATE FULLTEXT INDEX
statements allowed square brackets ([&lt;cond>?]) when indexing the values of
map fields. With this release, square brackets ([&lt;cond>?]) are no longer
allowed, and only .values(&lt;cond>?) can be used. This new requirement exposed
a bug in the integration with Elasticsearch fulltext indexing. This bug occurs
when .values(&lt;cond>?) rather than brackets is used in the CREATE FULLTEXT INDEX
statement to specify that the values of a given map should be indexed. Without
the fix delivered in this release, the mechanism that generates the document
to index in Elasticsearch will employ the wrong mapping; which causes fulltext
search queries on the values of the map to fail. This bug is now fixed; thus,
when .values(&lt;cond>?) is used in the CREATE FULLTEXT INDEX statement, such
queries will now succeed.
<p>
[KVSTORE-959]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 20.3.17</u></h3>
<h3><a name="NewFeatures20300">New Features</a></h3>
<ol>
<li>
Support Universally Unique Identifier
<p>
Added new SQL function random_uuid() which returns a randomly generated UUID,
as a string of 36 characters.
<p>
Added new option "AS UUID" for the STRING data type. The syntax is "STRING AS
UUID".  The input and output format of "STRING AS UUID" column must be UUID
canonical format: 32 hexadecimal (base 16) digits, displayed in five groups
separated by hyphens, in the form 8-4-4-4-12 for a total of 36 characters
(32 hexadecimal characters and 4 hyphens).
<p>
Added new option "GENERATED BY DEFAULT" for the "STRING AS UUID" data type.
The syntax is STRING AS UUID GENERATED BY DEFAULT. The system automatically
generates a value for the UUID column if the user does not supply a
value for it.
<p>
[KVSTORE-215]
</li>
<li>
New client side cache of table metadata.
<p>
Added a new client side cache of table metadata. This affects the various
<code>TableAPI.getTable()</code> methods. The cache will improve performance
of these methods by not requiring a remote call to the server for
<code>Table</code> instances found in the cache.
<p>
[KVSTORE-608]
</li>
</ol>
<h3><a name="BugFixes20300">Bug and Performance Fixes</a></h3>
<ol>
<li>Fixed a scalability problem for the storage nodes that when the storage
nodes have a limited CPU resource and a large number of client connections,
Out-of-memory error may occur.
<p>
[KVSTORE-390]
</li>
<li>Fixed a problem that the Streams API may incorrectly pull a table with
earliest version when it subscribes a new table. Instead, it should pull
the table with latest or required version.
<p>
[KVSTORE-492]
</li>
<li>Made the region name defined in the JSON configuration file required by
the XRegion agent case-insensitive.
<p>
[KVSTORE-335]
</li>
<li>Fixed a problem that the XRegion agent may fail to initialize the table
when reading/writing internal info from/to the local store.
<p>
[KVSTORE-638][KVSTORE-651]
</li>
<li>Modified the default timeout of a subscription created by Streams API from
10 minutes to 30 seconds.
<p>
[KVSTORE-660]
</li>
<li>Fixed a performance bug where, during the multi-region table transfer
from a remote region, the table might be copied more than once.
<p>
[KVSTORE-483]
</li>
<li>Fixed a problem where setting a mutable JE parameter for an Admin or an
Arbiter Node did not have an effect unless the node was restarted
explicitly.
<p>
[KVSTORE-621]
</li>
<li>
Modified the implementation of multi-region tables to create checkpoints
when initializing tables. If XRegion Agent fails while it is copying the
contents of a multi-region table from another region, the copy can
resume from a checkpoint when the agent restarts, reducing the time
needed to complete initialization.
<p>
[KVSTORE-40]
</li>
<li>
Plan locking has been changed to reduce failures due to concurrent plan
execution. This change generally impacts system plans run by the Admin.
<p>
[KVSTORE-432]
</li>
<li>
Less strict indexing in case of typed JSON indexes.
<p>
Currently, if a JSON field is indexed as double/float and a row to be inserted
contains an integer/long on that field, that insertion raises an error. This is
too strict. To fix, the integer/long value is cast to double/float and if the
cast is lossless, the insertion succeeds.
<p>
[KVSTORE-571]
</li>
<li>
Made modifications to avoid a problem where Java RMI temporarily creates
additional RenewClean threads. The additional threads were being created
in both Replication Nodes and clients.
<p>
[KVSTORE-493]
</li>
<li>
Fixed problems with the KVStore.executeAsync() API. Previously, this API
worked for very simple queries only. For other queries, it could cause
crashes or infinite loops. The API now works for all queries.
<p>
[KVSTORE-597]
</li>
<li>
Some behavior of the SET LOCAL REGION DDL command has been changed. With
the new behavior, the local region name cannot be changed if a
multi-region table has been created. The one exception is if the store
is upgraded from a version that did not support the local region name.
In that case the local region name can be set once if multi-region
tables exist. Lastly, though the local region name is case insensitive,
case will be preserved.
<p>
[KVSTORE-572]
</li>
<li>
Fixed a problem where, if a sorting/grouping query used hints to force
an index and the index was not a sorting one, generic order-by/group-by
was not added to the query.
<p>
[KVSTORE-624]
</li>
<li>
Fixed a bug with queries that use multi-key index and aggregate function but no
grouping expressions. A multi-key index can never be a sorting index. This rule
was not taken into account when a query contained aggregate functions without
any group-by clause. As a result, generic group by was not added as required.
<p>
[KVSTORE-626]
</li>
<li>
In previous releases, the integration of Oracle NoSQL Database with Apache
Hadoop MapReduce, Apache Hive, and Oracle Big Data SQL was documented via
javadoc package summaries included with the separate example distribution.
With this release, that information is now formally documented in the
following publicly available user guides:
<ul>
  <li><a href="https://docs.oracle.com/en/database/other-databases/nosql-database/20.3/integrations/fts1.html"><b><code>Integration with Apache Hadoop MapReduce</code></b></a>
  <li><a href="https://docs.oracle.com/en/database/other-databases/nosql-database/20.3/integrations/integration-apache-hive.html"><b><code>Integration with Apache Hive</code></b></a>
  <li><a href="https://docs.oracle.com/en/database/other-databases/nosql-database/20.3/integrations/integration-bds.html"><b><code>Integration with Oracle Big Data SQL</code></b></a>
</ul>
<p>
[KVSTORE-213][KVSTORE-430][KVSTORE-431][#27588]
</li>
<li>
The integration of Oracle NoSQL Database with Elasticsearch so that
full text search queries can be performed on data stored in an Oracle
NoSQL Database table is now formally documented in the following
publicly available user guide:
<ul>
  <li><a href="https://docs.oracle.com/en/database/other-databases/nosql-database/20.3/integrations/integration-elastic-search-full-text-search.html"><b><code>Integration with Elasticsearch for Full Text Search</code></b></a>
</ul>
<p>
[#27380]
</li>
<li>
Fix problems that could cause calls made using the asynchronous table
API (for example TableAPI.getAsync) on a secure store to fail if an
authentication token could not be renewed and reauthentication was
needed.
<p>
[KVSTORE-727]
</li>
<li>
Fixed a problem where adding an empty row to a table with an identity
column would result in an exception: "IllegalArgumentException: Primary
key is empty".
<p>
[KVSTORE-502]
</li>
<li>
Fixed a bug where "get kv" failed when used with multi-region tables.
<p>
[KVSTORE-615]
</li>
<li>
Fix a bug that null value instead of "null" string should be used for the index
declared type in table JSON representation.
<p>
[KVSTORE-771]
</li>
</ol>
<h3><a name="Storage20300">Storage Engine Changes (JE 20.3)</a></h3>
<ol>
<li>
If the master in a replication group is about to fail with a DiskLimitException
it will first check if there are any lagging replicas that are preventing it
from from deleting logs. If a lagging replica is found, the master will break
the connection with the replica, forcing the replica to reconnect and perform a
NetworkRestore.
<p>
[KVSTORE-145] (20.3.0)
</li>
<li>
Several fixes were made to Btree/data verification.
<ul>
    <li>When an invalid LSN for an IN (as opposed to an LN) is discovered, the
        verifier is designed to abort verification of the current database and
        move to the next database. Previously, the verifier was not aborting
        verification properly and was reporting an internal exception
        (OperationVerifyException) along with potentially large numbers of
        NullPointerExceptions before moving on to the next database. These
        errors were logged and reported as
        VerifyError.Problem.RECORD_ACCESS_EXCEPTION. This has been fixed so
        verification does abort properly and these exceptions do not occur.
    </li>
    <li>When verification is run via DbVerify, logging of individual problems
        is not enabled because the JE environment is read-only. To cause output
        to System.err, the java.util.logging.config.file JVM property may be
        set to the name of a file containing
          <pre>com.sleepycat.je.util.ConsoleHandler.level=ALL</pre>
        Previously, because rate-limited logging is used by the verifier, when
        explicitly enabling logging as described above, only a small subset of
        the individual problems were logged. Now, rate-limited logging is
        disabled when DbVerify is used. This ensures that all problems are
        logged for debugging purposes, but may produce a large amount of
        output.
    </li>
    <li>The javadoc for DbVerify, VerifyConfig and RateLimitingLogger has been
        improved.
    </li>
</ul>
[KVSTORE-616] (20.3.4)
</li>
<li>
Fixed a bug that could cause DbVerify to report false
VerifyError.Problem.DATABASE_ACCESS_EXCEPTION errors, and other utilities and
programs that open the environment as read-only to report false
EnvironmentFailureException.UNEXPECTED_STATE errors.
<p>
[KVSTORE-706] (20.3.9)
</li>
<li>
CkptStart and CkptEnd log records will now be printed with a timestamp using
UTC instead of the local time.  This is the format used for all other log
records.
<p>
[KVSTORE-627] (20.3.13)
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 20.2.17</u></h3>
<h3><a name="BugFixes20217">Bug and Performance Fixes</a></h3>
<ol>
<li>
Updated 3rd party libraries to current versions.
</li>
<li>
In extreme situations, when an RN is unable to find a suitable feeder for a
Network Restore because all other RNs are down or unreachable, the RN gives up,
but does not exit the process. This can result in the environment never being
restored and the RN process is effectively hung, unable to process requests and
needs to be explicitly killed and restarted. The behavior has been changed so
that the RN exits and the SNA restarts it with a clean process state with which
to retry the Network Restore.
<p>
[KVSTORE-610]
</li>
<li>
A SessionAccessException in the SNA resulted in the SNA halting the Master
Balancing functionality at the SN, as indicated by the following
representative entries in the SNA's logs:
<pre>
...
2020-08-10 00:27:33.875 UTC SEVERE [sn5] MasterRebalanceThread thread exiting due to exception.
...
2020-08-10 00:27:33.878 UTC INFO [sn5] Master balance manager shutdown
2020-08-10 00:27:33.878 UTC INFO [sn5] MasterRebalanceThread thread exited.
...
</pre>

The SNA now handles the SessionAccessException and retries the operation.
<p>
[KVSTORE-595]
</li>
<li>
Fixed a problem where setting a mutable JE parameter for a Replication
Node did not have an effect unless the node was restarted explicitly.
This problem was introduced in release 20.2.16.
<p>
[KVSTORE-574]
</li>
<li>
Fixed a problem where an unresolved network address for the host of a
storage node could cause requests to fail with RequestTimeoutException.
Once the problem occurred, it was persistent, and all future client
calls would timeout until the client was restarted. If client logging
was enabled, the logging output might include an exception like the
following:
<pre>
2020-08-12 13:09:40.047 UTC SEVERE - Uncaught exception in thread:KV c-5287366135758798770 RepNodeStateUpdateThread_Updater_1
java.nio.channels.UnresolvedAddressException
	at oracle.kv.impl.async.AbstractCreatorEndpoint.startDialog(AbstractCreatorEndpoint.java:87)
	at oracle.kv.impl.async.AsyncVersionedRemoteInitiator.startDialog(AsyncVersionedRemoteInitiator.java:131)
	at oracle.kv.impl.async.AsyncVersionedRemoteInitiator.getSerialVersion(AsyncVersionedRemoteInitiator.java:102)
	at oracle.kv.impl.async.registry.ServiceRegistryInitiator.getSerialVersion(ServiceRegistryInitiator.java:53)
	at oracle.kv.impl.async.AsyncVersionedRemoteAPI.computeSerialVersion(AsyncVersionedRemoteAPI.java:111)
	at oracle.kv.impl.async.registry.ServiceRegistryAPI.access$000(ServiceRegistryAPI.java:47)
	at oracle.kv.impl.async.registry.ServiceRegistryAPI$Factory.wrap(ServiceRegistryAPI.java:152)
	at oracle.kv.impl.util.registry.AsyncRegistryUtils.getRegistry(AsyncRegistryUtils.java:354)
	at oracle.kv.impl.util.registry.AsyncRegistryUtils.getRequestHandler(AsyncRegistryUtils.java:314)
	at oracle.kv.impl.api.rgstate.RepNodeState$AsyncReqHandlerRef.getRequestHandler(RepNodeState.java:1179)
	at oracle.kv.impl.api.rgstate.RepNodeState$AsyncReqHandlerRef.resolveInternal(RepNodeState.java:1138)
	at oracle.kv.impl.api.rgstate.RepNodeState$AsyncReqHandlerRef.resolve(RepNodeState.java:1083)
	at oracle.kv.impl.api.rgstate.RepNodeState.resolveReqHandlerRef(RepNodeState.java:251)
	at oracle.kv.impl.api.rgstate.UpdateThread$ResolveHandler.run(UpdateThread.java:322)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at java.base/java.lang.Thread.run(Thread.java:834)
</pre>
<p>
[KVSTORE-523]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 20.2.16</u></h3>
<h3><a name="NewFeatures20216">New Features</a></h3>
<ol>
<li>
Modified the Hive/Big Data SQL integration mechanism to support querying
table fields of the data types FieldDef.Type.JSON, FieldDef.Type.NUMBER,
and FieldDef.Type.TIMESTAMP. Along with this feature, new example code
is also provided to help create tables with fields of these new types.
<p>
[#25802]
</li>
<li>
Support Time to Live (TTL) in the Streams API and in Multi-Region
Tables. The Rows supplied by the Streams API to subscribers will include
the TTL expiration time for the operation from source store. Note that
the expiration time is computed from the original TTL at source store
where and when the operation is made, instead of the time when Streams
API receives the operation. Therefore, the operation that Streams API
returns may have already expired if its expiration time has passed. For
Multi-Region Tables, the TTL expiration time of each row is replicated
to other regions, and thus a row in Multi-region table in any region
will expire at the expiration time replicated from the region where and
when operation is made.
<p>
We strongly recommended upgrading multi-region agents and stores in all
regions to this release before specifying any rows with non-zero TTL
values for multi-region tables. Expiration times will be lost when rows
are replicated to regions running older software versions, meaning that
the copied rows will not expire.
<p>
[#28165]
</li>
<li>
Make XRegion Service agent parameter configurable in JSON config file. This
release adds following configurable parameters with their default values in
the JSON config file:
<pre>
{
  "checkpointIntvSecs" : 300,
  "checkpointIntvOps" : 1048576
}
</pre>
<p>
[#28152]
</li>
<li>
Implemented generic order-by and group-by.
<p>
In previous releases, order-by and group-by were possible only if there was an
index that sorted the rows by the order-by/group-by expressions. Furthermore,
it was not possible for queries to include both order-by and group-by. These
restrictions are lifted in this release. For example, the following query
returns the monthly sales for year 2020, ordered by the sales amount.
<pre>
select f.xact.month, sum(f.xact.amount) as sales
from Foo f
where f.xact.year = 2020
group by f.xact.month
order by sum(f.xact.amount)
</pre>
Notice that generic order-by and group-by may consume a lot of driver memory,
because of the need to materialize the full query result in driver memory. In
contrast, index-based order-by/group-by exploit the row sorting provided by the
index to avoid the materialization and caching of any intermediate results. As
a result, it is recommended that users create appropriate indexes for use in
order-by/group-by queries. For example, if there is an index on both xact.year
and xact.month, the above query will use that index and the group-by will be an
index-based one. If no such composite index exists, but instead there are two
separate indexes on xact.year and xact.month respectively, the above query will
use the index on xact.year and the group by will be a generic one. This is
because, in general, indexes that "cover" query predicates are preferred
over indexes that "cover" order-by/group-by expressions.
<p>
For generic order-by/group-by, applications can specify (via a query-level
execution option) how much memory such operations are allowed to consume at
the driver, and a query will raise an exception if the maximum allowed
threshold is exceeded.
<p>
[#28202]
</li>
<li>
Implemented SELECT DISTINCT.
<p>
The DISTINCT keyword is now supported in the SELECT clause. If present,
duplicate results will be removed from query result set. As with generic
order-by and group-by, SELECT DISTINCT needs to cache the full result set
in driver memory. The same execution option controls how much memory such
operations are allowed to consume at the driver.
<p>
[#28202]
</li>
<li>
Introduced a new Admin CLI command <code>show mrtable-agent-statistics</code>
to show the latest statistics for multi-region table agents.
<pre>
  show mrtable-agent-statistics [-agent &lt;agentID&gt;]
  [-table &lt;tableName&gt;] [-merge-agents]
</pre>
With no argument, the command shows combined statistics over all tables
for each agent. The -agent flag limits the statistics shown to the agent
with the specified agent ID. The -table flag limits the statistics shown
to the multi-region table with the specified name. The -merge-agents flag
combines statistics over all agents.
<p>
[#28155]
</li>
<li>
Key distribution statistics enabled by default
<p>
The collection of key distribution statistics is now enabled by default.
You can control whether statistics are collected by setting the
<code>rnStatisticsEnabled</code> parameter.
<p>
[KVSTORE-155]
</li>
<li>
Key distribution statistics include storage size information by default
<p>
The collection of key distribution statistics now, by default, collects
information about the storage size of the associated table entries. This
information can be used to find the storage size for a table in specific
partitions and across the store as a whole.
<p>
The new <code>statsIncludeStorageSize</code> parameter controls whether
the collection of key distribution statistics includes information about
entry storage sizes.
<p>
[KVSTORE-375]
</li>
<li>
Updated the 'topology change-repfactor' Admin CLI command to support
reducing the replication factor for online secondary zones. You can now
use this command to reduce the replication factor for a secondary zone
that you want to keep, or in preparation for removing the zone. To
remove a secondary zone, use 'topology change-repfactor' to change the
replication factor of the zone to zero, and then use the 'plan
remove-sn' and 'plan remove-zone' commands to remove the storage nodes
and complete the removal of the zone. Note that you can only reduce the
replication factor of a zone whose storage nodes and replication nodes
are currently online.
<p>
[KVSTORE-185]
</li>
<li>
In the regex_like function, the source param is now always implicitly cast to
a string.
<p>
[KVSTORE-342]
</li>
</ol>
<h3><a name="BugFixes20216">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug which could cause OutOfMemoryErrors in service processes
when there are many new client connections established during a short
time. The problem is more likely for secure stores. It also appears more
often on SNs, since they usually have smaller heap sizes. A heap dump
from the process with such problem will show a large number of
SSLDataChannel and ConnectTimeoutTask.
<p>
[KVSTORE-288]
</li>
<li>
Fixed a bug that the XRegion Service agent may be blocked when a multi-region
table is not found at remote regions. If any multi-region table is missing,
the table polling thread will be created if not exist, and periodically poll
the remote regions for missing tables till the table is found, and the
thread will start initialization and include it in the running stream.
<p>
[#28218][#28194]
</li>
<li>
Fixed incomplete table initialization bug.
<p>
When the multi-region agent restarts from a crash, there was a problem
that incomplete table initialization might not resume correctly,
resulting in table corruption in some cases. The fix ensures that when
the multi-region agent restarts, the agent will reinitialize all tables
whose initialization was not complete before the crash.
<p>
[KVSTORE-321]
</li>
<li>
Fixed bug in min/max aggregate functions.
<p>
In previous releases, these functions were non-deterministic if their input
were values of different types. For example, if you had min(t.a.b) and t.a.b
was a number in some rows and a string in others, the result would be either
the min number or the min string, depending on which row was encountered
first. For order-by, we already defined an ordering among otherwise
non-comparable values. This ordering is now used for min/max as well, thus
making their results deterministic.
<p>
[#28202]
</li>
<li>
Fixed a bug that can cause a query that has both index-based group-by and
joins to miss one result per partition/shard.
<p>
[KVSTORE-276]
</li>
<li>
When running Big Data SQL queries on tables mapped to different
tables in the Oracle NoSQL store, the split information for each
table is now cleared in the storage handler before executing
the query. Before this fix, errors could occur in the Oracle DB
when split information from a previous query on a different
table is inconsistent with the split information for the
current table.
<p>
[KVSTORE-372]
</li>
<li>
Update security DDL commands to work with bootstrap admin without
deploying any storage nodes. Before this fix, security DDL commands,
such as CREATE USER, GRANT and etc, only can be executed after a
storage node is deployed. You can now use security DDL command to
create the initial admin user instead of deprecated 'plan create-user'
right after configure the store name.
<p>
[KVSTORE-382]
</li>
<li>
Fixed a bug that could cause queries on multi-region tables to not work when
the region id was greater than 119.
<p>
[KVSTORE-418]
</li>
<li>
Fixed a problem which could cause a Replication Node to create a large number
of threads while shutting down after encountering a fatal error. In some
cases, the large number of threads created could cause other processes on the
same host to fail because the maximum processes limit was reached.
<p>
[KVSTORE-405]
</li>
<li>
Fixed bugs in "show tables" command on admin CLI and sql CLI
<p>
If global namespace of CLI is set to "sysdefault", "show tables" is expected to
return all tables in both default and non-default namespaces.  If the global
namespace of CLI is set to a non-default namespace, "show tables" is expected to
return those tables in the specified namespace.
<p>
Before the fix, "show tables" on admin CLI returns no table if global namespace
is "sysdefault". On sql CLI, the global namespace was ignored, "show tables"
always returns all tables.
<p>
[#28195]
</li>
<li>
Fixed a bug that "show snapshots" return empty when kvstore uses customized
admin storage directory.
<p>
[KVSTORE-326]
</li>
<li>
Fixed a bug that "show indexes" on admin CLI does not return the index in the
case where child table has index but there is no index on its parent table.
<p>
[KVSTORE-394]
</li>
<li>
Fixed a bug so RNs are not restarted if a mutable JE parameter is changed.
<p>
[KVSTORE-1]
</li>
<li>
Fixed a bug that the put methods in TableAPI threw a FaultException when the
table has an identity column that ran out of values. The exception could cause
unexpected retries and the request time out. Now an IllegalArgumentException
will be thrown when an identity column reaches the limit.
<p>
[KVSTORE-261]
</li>
<li>
Fixed a bug that the TableAPI could throw an IllegalArgumentException when the
multi-region table service agent merges remote rows for key-only tables. The
exception would eventually cause the agent terminate the stream and log the
error.
<p>
[KVSTORE-253]
</li>
<li>
Fixed a bug where modifying a multi-region table using an SQL UPDATE
statement could cause a Replication Node to crash when the multi-region
agent processed table data from a remote store. The exception that caused
the crash was "IllegalArgumentException: This is not a record of multiregion
tables".
<p>
[KVSTORE-463]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 20.1.17</u></h3>
<h3><a name="BugFixes20117">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug where a LOG_FILE_NOT_FOUND exception could be generated.  If
TTL is used and some rows are using TTL in hours and others in days, or
there is an update to the TTL with a unit change from hours to days, then
it is possible to get the exception after the rows get deleted.  To
recover from this exception, a restore was needed.
<p>
[KVSTORE-406]
</li>
<li>
Fixed a problem where setting the DNS cache TTL parameters from makebootconfig
can result in a violation warning when running "verify configuration" command
from the admin. The issue is that the SN correctly adopts the set TTL value but
the admin is not updated during SN deployment resulting in the violation
warning on the discrepancy. The warning looks like the following:
<pre>
Verify:         sn1: Mismatch between metadata in admin service and sn1:  Parameters in Admin database but not from configuration for service sn1: dnsCacheTTL=10
</pre>
[KVSTORE-373]
</li>
<li>
Fixed a compatibility problem
<p>
The problem would occur when upgrading from 19.5 release to a 20.1
release prior to this patch due to an incompatible change on the
<code>EndpointGroupStats</code> object. When the problem occurs during
the upgrade, the admin would observe a <code>NullPointerException</code>
and a stack trace that looks like the following:
<pre>
2020-06-02 09:23:12.398 UTC SEVERE - [admin1] Collector: exception when polling agentId: rg1-rn3 Exception: java.lang.NullPointerException
at oracle.kv.impl.measurement.EndpointGroupStats.getFormattedStats(EndpointGroupStats.java:95)
at oracle.kv.impl.measurement.EndpointGroupStats.getFormattedStats(EndpointGroupStats.java:88)
at oracle.kv.impl.monitor.views.PerfView.displayConciseStats(PerfView.java:172)
at oracle.kv.impl.monitor.views.PerfView.applyNewInfo(PerfView.java:136)
</pre>
<p>
[KVSTORE-368]
</li>
<li>
Fixed a problem where delete operations could deadlock with concurrent delete
requests on the same key.
<p>
[KVSTORE-272]
</li>
<li>
Added the new parameters <code>javaRnParamsOverride</code>,
<code>javaAnParamsOverride</code>, and
<code>javaAdminParamsOverride</code> to allow users to alter the JVM
command line parameters for Replication Nodes, Arbiter Nodes, and Admin
Nodes. Users can set these parameters for individual services, and can
also make policy settings to apply to future instances of the associated
service types. Going forward, users should set these new parameters
rather than the <code>javaMiscParams</code> parameter, which should now
be considered reserved for system use, although the old parameter is
still supported for compatibility in old stores.
<p>
[KVSTORE-277]
</li>
<li>
Fixed an incompatibility with the 20.1 client when used with earlier version
stores. This bug would cause some table related calls to fail with a
<code>java.lang.UnsupportedOperationException</code>.
<p>
[KVSTORE-416]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 20.1.16</u></h3>
<h3><a name="BugFixes20116">Bug and Performance Fixes</a></h3>
<ol>
<li>
Bug fix for IN operator. When the non-standard version of the IN operator
(the one that has a single expression in the right-hand-side) is used and
the left-hand-side is a primary key, the compiler would worngly determine
that the query is a SINGLE_PARTITION query, instead of ALL_PARTITIONS. As
a result, the query will be sent to a single partition, and any results
from other partitions would be lost. For example, the bug applies to the
following query, if "id" is the primary key column of table Foo:
<pre>
declare $arr array(int);
select * from Foo where id in $arr[]
</pre>
<p>
[#28145]
</li>
<li>
Fixed a bug in INSERT statement, when the DEFAULT keyword is used as the
value of an IDENTITY column. The INSERT statement would throw an exception
in this case. The bug exists only when the proxy is used.
<p>
[NOSQL-224]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 20.1.15</u></h3>
<h3><a name="NewFeatures20100">New Features</a></h3>
<ol>
<li>
Added IN operator in SQL for Oracle NoSQL. The IN operator is essentially a compact
alternative to a number of OR-ed equality conditions. For example, the query
<pre>
select * from Foo where a in (1, 5, 4)
</pre>
is equivalent to
<pre>
select * from Foo where a = 1 or a = 5 or a = 4
</pre>
and the query
<pre>
select *
from Foo
where (a, b) in ((1, "a"), (5, "g"), (4, "t"))
</pre>
is equivalent to
<pre>
select *
from Foo
where (a = 1 and b = "a") or (a = 5 and b = "g") or (a = 4 and b = "t")
</pre>
However, in addition to being more compact, queries using IN operators will
be executed more efficiently if appropriate indexes exist. For example, if
table Foo has an index on columns a and b, then both of the above IN queries
will use that index to find the qualifying rows, whereas the equivalent
OR queries will be executed via full table scans.
<p>
The above IN queries follow the standard SQL syntax. An alternative syntax has
also been implemented, that allows a relative large number of search keys to be
provided via a single bind variable. For example, if the $keys variable is bound
to the array [ 1, "a", 5, "g", 4, "t"], then the following query is equivalent to
the second IN query above.
<pre>
declare $keys array(json);
select *
from Foo
where (a, b) in $keys[]
</pre>
<p>
[#27900]
</li>
<li>
Support for "untyped" json indexes.
<p>
So far, indexing a field inside json documents required the specification of
a concrete json atomic type for the field (one of integer, long, double,
number, string, or boolean). If, for some document, the index field did not
conform to its declared type, index creation or the insertion of that document
in a table would fail. In this release, anyAtomic is added as a valid type for
indexed json fields. A field indexed with the anyAtomic type can be of any
valid json atomic type and the index will store all the heterogeneous values
of that field.
<p>
[#27989]
</li>
<li>
Query execution plans are now being displayed in json format.
<p>
[#26016]
</li>
<li>Added the new <code>rnRHAsyncMaxConcurrentRequests</code> parameter,
which specifies the maximum number of concurrent asynchronous requests
that a Rep Node can handle before it should do throttling. This
parameter replaces the <code>rnRHAsyncExecQueueSize</code> parameter,
which is now ignored, since the queue size is now computed from the
difference between the <code>rnRHAsyncMaxConcurrentRequests</code> and
<code>rnRHAsyncExecMaxThreads</code> parameters
<p>
[#27823]
</li>
<li>
The SQL command "ALTER TABLE" now supports adding or removing regions
from existing multi-region tables.
<p>
[#28027]
</li>
<li>
The new SQL command "SET LOCAL REGION" can be used to specify the name
of the local region for use with multi-region tables.
<p>
[#28013]
</li>
<li>
When creating a multi-region table or adding new regions to an existing
multi-region table, the associated tables in remote regions no longer
have to be empty.
<p>
[#28120]
</li>
<li>
Multi-region tables are now only supported in the Enterprise Edition.
<p>
[#28144]
</li>
</ol>
<h3><a name="BugFixes20100">Bug and Performance Fixes</a></h3>
<ol>
<li>
When upgrading from a version prior to 18.3, the store must be fully upgraded
before an elasticity plan that includes migrating partitions can be run. If the
store is not fully upgraded to 18.3 or above, a partition migration may fail,
causing the elasticity plan to exit. The plan can be re-run once the store is
fully upgraded. This new behavior avoids a deadlock risk between the deploy
topology plan and an internal Admin plan.
<p>
[#28036]
</li>
<li>
Added the snapshotName to the JSON output of the snapshot command result.
<p>
[#27700]
</li>
<li>
Fixed a bug affecting on-prem, proxy-based, join queries. In this mode, some
join queries would wrongly raise exception saying that a single results
consumes more bytes than the max allowed.
<p>
[#28103]
</li>
<li>
Fixed problems when the Java client is used to access multiples stores
which have the same name. Previously, for secure stores, client access
to the store could fail with a certificate signature validation error.
In addition, socket open and read timeout values specified for a
particular store were not applied correctly. Both problems are now
fixed.
<p>
[#27952]
</li>
<li>
TableAPI.getTable() is now more reliable when one or more nodes is
unavailable.
<p>
[#28150]
</li>
<li>
Made scalability improvements to reduce the overhead of using large
numbers of tables and indexes.
<p>
[#27204]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 19.5.19</u></h3>
<h3><a name="BugFixes19519">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a couple of problems that prevented the system from working
properly when using recent Java patch releases (Java versions 1.8.0_241,
11.0.6, and 13.0.2). In one case, starting the server would fail with a
NullPointerException while handling a remote call, while in the other
case a RemoteException was thrown saying that a remote method's
interface did not implement Remote.
<p>
[#28063]
</li>
<li>
Improved system behavior in a cluster that is read-only due to multiple
node failures. Previously operations would retry until the request timeout
has passed. This change detects errors that cause the operation to fail
more quickly if it seems that retries will not help. An example is an
error indicating that reauthentication may be required.
<p>
[#28015]
</li>
<li>
Fixed a problem that could occur when using the HTTP proxy and drivers
on queries with a LIMIT clause. It was possible that some results within
the limit would be omitted, but some outside of the limit included.
<p>
[#28034]
</li>
<li>
Fixed a problem where the incorrect math context might be used in
queries that use sum() and seq_sum() functions on the Number data type.
<p>
[#28040]
</li>
<li>
Fixed bug causing over-reporting of query byte consumption to the aggregation
service. The bug occurs when a query executing at an RN would (a) scan an
index more than once or (b) scan more than one index. An example of (a) is
a geo-search query. An example of (b) is ALL PARTITION queries, where we
try to access as many local partitions as possible (before reaching the
2MB limit). In such cases, consumption reported to the AS during earlier
index scans would be reported again during subsequent scans.
<p>
[#28081]
</li>
<li>
Updated the bundled HTTP proxy to a newer version.
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 19.5.16</u></h3>
<h3><a name="NewFeatures19516">New Features</a></h3>
<ol>
<li>
<p>
Introduced Multi-Region Tables, a feature that lets users create
"read-anywhere" and "write-anywhere" tables that live in multiple
regions, where each region is a separate Oracle NoSQL Database store.
This is a preview release and a general availability version will be
available in a future release.
<p>
[#27728]
</li>
<li>
<p>
Improved the way to configure the network name resolution cache for services.
The address cache is used to resolve host names during name resolution. Two
values are used to specify how long the results of successful or unsuccessful
name lookups should be kept in the cache. See <a
href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/doc-files/net-properties.html#AddressCache">
the Address Cache section of the Networking Properties page</a> for more
details.
<p>
When creating a new SN, the values can be configured with the
<code>-dns-cachettl</code> flag to the <code>makebootconfig</code> command.
After deployment, the initial values can be overridden by changing the
parameters <code>dnsCacheTTL</code> and <code>dnsCacheNegativeTTL</code> of
the SN. Those two parameters are also policy parameters so that it can be set
for future SN deployments. Each service shares the same parameter values with
its monitoring SN. When changing the parameters for an SN, all service
processes need to be restarted for the new values to take effect. Admin, RN,
and arbiter services will be restarted automatically, but the SNs must be
restarted manually.
<p>
[#27660]
</li>
<li>
Added new asynchronous methods to the table API. Applications can use
these methods to make calls without using a thread to wait for results,
which can improve the efficiency of clients that make many concurrent
calls.
<p>
Clients now use a new network protocol that supports multiplexing
multiple calls on the same socket, which is used to support asynchronous
operation and to reduce the number of socket connections needed. New
clients are only compatible with this version of the server, although
the server continues to support old clients. When upgrading to this
release, make sure to upgrade the store first before upgrading clients
or HTTP proxies.
<p>
New methods on <code>TableAPI</code>:
<ul>
<li><code>getAsync</code>
<li><code>multiGetAsync</code>
<li><code>multiGetKeysAsync</code>
<li><code>tableIteratorAsync</code>
<li><code>tableKeysIteratorAsync</code>
<li><code>putAsync</code>
<li><code>putIfAbsentAsync</code>
<li><code>putIfPresentAsync</code>
<li><code>putIfVersionAsync</code>
<li><code>deleteAsync</code>
<li><code>deleteIfVersionAsync</code>
<li><code>multiDeleteAsync</code>
<li><code>executeAsync</code>
</ul>
<p>
New methods on <code>KVStore</code>:
<ul>
<li><code>executeAsync</code>
</ul>
<p>
New fields and methods on <code>KVStoreConfig</code>
<ul>
<li><code>DEFAULT_NETWORK_ROUNDTRIP_TIMEOUT</code>
<li><code>USE_ASYNC</code>
<li><code>DEFAULT_USE_ASYNC</code>
<li><code>getNetworkRoundtripTimeout</code>
<li><code>setNetworkRoundtripTimeout</code>
<li><code>getUseAsync</code>
<li><code>setUseAsync</code>
</ul>
<p>
New field in <code>KVStoreFactory</code>:
<ul>
<li><code>ENDPOINT_GROUP_NUM_THREADS_PROPERTY</code>
</ul>
<p>
New interfaces:
<ul>
<li><code>oracle.kv.ExecutionSubscription</code>
<li><code>oracle.kv.IterationSubscription</code>
</ul>
<p>
Iteration methods (<code>TableAPI.tableIteratorAsync</code>,
<code>TableAPI.tableKeysIteratorAsync</code>, and
<code>KVStore.executeAsync</code>) are implemented using the <a
href="http://www.reactive-streams.org">Reactive Streams</a> framework.
Other asynchronous methods return
<code>java.util.concurrent.CompletableFuture</code>.
<p>
Also added the new <code>table.AsyncExample</code> example.
<p>
[#24773]
</li>
<li>
Added the <code>ServerResourceLimitException</code> class. Instances of
this class may be thrown if the server is unable to handle a request
because of resource constraints.
<p>
[#27301]
</li>
<li>
Added the new <code>WRITE_SYSTEM_TABLE</code> privilege and
<code>writesystable</code> role to support modifications to system
tables. The new privilege and role are intended to be used with the
multi-region table agent. Normal users typically should not modify
system tables.
<p>
[#27830]
</li>
<li>
The Oracle NoSQL Hadoop/Hive/BigDataSQL integration code now works
with Hadoop3, Hive2, and BigDataSQL 4.0. Because changes were made
in Apache Hive that make Hive1 incompatible with Hive2, if you wish
to run MapReduce jobs, Hive queries, and/or BigDataSQL queries in
a Hadoop2, Hive1, and/or BigDataSQL 3.5.x environment, then you
should use the 18.3 release of Oracle NoSQL Database; and use
this release in Hadoop3/Hive2/BigDataSQL 4.0 environments.
<p>
[#27898]
</li>
<li>
Source code for the NoSQL Database storage engine, also known as
"Berkeley DB Java Edition", is now included in the Community Edition
release package.
<p>
[#27478]
</li>
<li>
Added the following string manipulation SQL functions:
<ul><li><code>
  concatenation: arg1 || arg2 -> string , concat(arg1, arg2, ...) -> string?
</code></li><li><code>
  substring(str, position[, for_substring_length] ) -> string
</code></li><li><code>
  upper(str) -> string
</code></li><li><code>
  lower(str) -> string
</code></li><li><code>
  trim(from_str[, where[, trim_chars]]) -> string
</code></li><li><code>
  ltrim(str) -> string
</code></li><li><code>
  rtrim(str) -> string
</code></li><li><code>
  length(str) -> integer
</code></li><li><code>
  contains(str, contained_str) -> boolean
</code></li><li><code>
  starts_with(str, start_str) -> boolean
</code></li><li><code>
  ends_with(str, end_str) -> boolean
</code></li><li><code>
  index_of(str, search [, pos]) -> integer
</code></li><li><code>
  replace(str, search_str [, replacement_str] ) -> string
</code></li><li><code>
  reverse(str) -> string
</code></li></ul>
<p>
Also the result of casting a JSON null value to a string has been changed
from RuntimeError to string "null".
<p>
[#27771]
</li>
</ol>
<h3><a name="BugFixes19516">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixes a bug where AbsoluteConsistency read requests could be directed to
the master on the minority side of a network partition.
AbsoluteConsistency read requests now require an authoritative master:
one that is in contact with a quorum of replicas. The request will
timeout if a suitable master is not available within the request timeout
period.
<p>
[#27785]
</li>
<li>
Enhanced the predicate pushdown mechanism in the Oracle NoSQL Hive
integration code to work with changes made in Hive2 that cause
some queries to produce incorrect results under Hive2.
<p>
[#27898]
</li>
<li>
Fixed a bug in capacity planning spreadsheet, where the number of machines
required by a store could be over estimated in some cases.
<p>
[#27939]
</li>
<li>
Fixed a bug where in some cases executing a DDL command which is a duplicate of
a running DDL command, an Admin plan will be orphaned in the APPROVED state.
<p>
[#27688]
</li>
<li>
Fixed a bug in sorting the special values (NULL, json null, and EMPTY) when
the direction of the sort is descending.
<p>
[#27945]
</li>
<li>
Fixed a bug in REMOVE clause of UPDATE statement, when the path to remove
evaluates to NULL. In this case the UPDATE statement would get into an infinite
loop.
<p>
[#27812]
</li>
<li>
Fixed a bug that caused importing data into a table whose shard key is
different than the one of the table from which the data was exported to
cause the imported data to be corrupted. The data is now imported
correctly.
<p>
[#27782] [#27783]
</li>
<li>
Fix a problem that caused the Admin CLI history to not be loaded on
startup.
<p>
[#27810]
</li>
<li>
Fixed a problem that could cause the Admin CLI 'plan verify data'
command to fail to complete, and instead remain in the "RUNNING" state.
This problem only occurred on stores with 5 or more shards.
<p>
[#27750]
</li>
<li>
Fixed a problem that could cause the Admin CLI 'plan verify data'
command to fail on nodes which had a master change after restarting. The
command will now work in those cases, although a master change during
the verification of an individual node will still cause that
verification to fail and mean that the node's verification needs to be
redone. We expect to fix this additional problem will be fixed in a
future release.
<p>
[#27773]
</li>
<li>
Fixed a problem that caused using the stop command to fail when used to
stop a kvlite instance. For example:
<pre>
java -jar KVHOME/lib/kvstore.jar stop -root /tmp/mykvlite
Failed to stop SNA: Bootstrap config file ./mykvlite/config.xml does not exist
</pre>
<p>
[#27748]
</li>
<li>
Fixed a problem that DDLGenerator did not create correct DDLs for tables with
Timestamp or Map of enums.
<p>
[#28010]
</li>
<li>
The 'Shaded' version of the <code>antlr4-runtime</code> 3rd party library
that was previously shipped under the name <code>antlr4-runtime.jar</code>
is shipped with this release under the name <code>antlr4-runtime-nosql-shaded.jar</code>.
Shading that library is necessary to avoid ClassLoader conflicts (typically
manifested as a NoClassDefFoundError) when an application runs in an
environment that depends on a different, incompatible version of that library;
for example, various containers, Hadoop clusters, Hive clients, etc. When
running in those environments, in general, this will require no changes to
current applications other than making the corresponding name changes in the
application's classpath.
<p>
[#27616]
</li>
</ol>
<h3><a name="Utilities19516">Utility Changes</a></h3>
<ol>
<li>
Removed support for the -r2-compat option from the 'table create'
command in the Admin CLI. The ability to create tables on top of
key/value data was removed in release 19.3 as part of removing support
for Avro, but this option had been left in place by mistake.
<p>
[#27907]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 19.3.12</u></h3>
<h3><a name="NewFeatures19312">New Features</a></h3>
<ol>
<li>
Added support for indexes that do not index NULL and non-existent values. This
is an index property that can be specified in the index-creation DDL (the
default is to index NULL and non-existent values). Such indexes may be useful
when the data contain a lot of NULL and/or non-existent values on the indexed
fields, because the time and space overhead of indexing is reduced. However,
use of such indexes by queries is restricted. Specifically, they can be used
only if for every indexed field, there is a sargable predicate on that field
and the predicate in not IS NULL or NOT EXISTS.
<p>
[#27486]
</li>
<li>
Modified operation and request count statistics to use long values to
support stores with larger numbers of operations.
<p>
Added some new JMX bean methods that return total counts as longs. In
some cases, for large stores, counts could exceed 2^31, so these new
methods are needed to return accurate values for these statistics. The
old methods are maintained for compatibility and will return
<code>Integer.MAX_VALUE</code> if the count gets too large.
<p>
New methods on the <code>OperationMetrics</code> interface:
<ul>
<li><code>getIntervalTotalOpsLong</code>
<li><code>getCumulativeTotalOpsLong</code>
</ul>
<p>
New methods on the <code>RepNodeMXBean</code> interface:
<ul>
<li><code>getIntervalTotalOpsLong</code>
<li><code>getCumulativeTotalOpsLong</code>
<li><code>getMultiIntervalTotalOpsLong</code>
<li><code>getMultiIntervalTotalRequestsLong</code>
<li><code>getMultiCumulativeTotalOpsLong</code>
<li><code>getMultiCumulativeTotalRequestsLong</code>
</ul>
<p>
The new long values are also reported in .perf files, collector .csv
files, and in JSON output.
<p>
[#27517]
</li>
<li>
The Streams API now supports dynamically adding or removing subscribed
tables to or from any running stream without needing to terminate
and recreate the stream.
<p>
[#27381]
</li>
<li>
Users can now use the "describe table" statement to describe the schema
of a system table.
<p>
[#27602]
</li>
<li>
Added the new built-in function <code>regex_like</code> to the query
language. The function is used for string datatype regular expression
pattern matching. For example, assume table "persons" has a string field
"lastName". The following select statement will qualify records with a
lastName starting with the letter "C".
<pre>
select * from persons where regex_like(lastName,"C.*")
</pre>
<p>
[#27396]
</li>
<li>
Added div operator to perform floating-point division among integers. div is
the same as the "/" operator, except in the the case where both operands are
integers; in this case, div returns a double, instead of an integer.
</li>
<li>
Removed all classes and interfaces from the oracle.kv.avro package,
which had previously been deprecated. Applications that had been using
Avro should be modified to use the table API.
<p>
[#27387]
</li>
</ol>
<h3><a name="BugFixes19312">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fix a bug that caused plan show-upgrade order to report an incorrect
order if Arbiters were in the topology.
<p>
[#27808]
</li>
<li>
KVStore allows for a maximum of one thousand plans to be persisted.
Plans are removed from the system once the maximum limit has been
exceeded. Plans are removed based on plan priority and plan creation
time. The highest priority are System plans that have been executed. The
second highest priority are User plans that have been successfully
executed. The lowest priority are User plans that have not been executed
or executed successfully. Plan maintenance ends when the number of plans
is less than or equal to the maximum number of plans allowed. The first
pass removes any System plans that have been executed. The subsequent
plan deletion phases introduce a time component. Plans are removed based
on plan priority and creation time. Attempts are made to remove older
plans before newer plans. The plan removal phases target plans older
than a given time. If the number of plans still exceed the maximum, the
time window is reduced. The time thresholds used for these phases are:
one hour, ten minutes and zero. Plans are still removed based on plan
priority for any given time window.
<p>
[#27689]
</li>
<li>
Fix a bug that caused key statistics to be collected more often than the
specified collection period.
<p>
[#27615]
</li>
<li>
Allow single-partition queries to use secondary indexes. In previous releases,
if a query used a secondary index it would be sent to and executed at all the
shards of the queried table. However, if the query also specifies a shard key
in the WHERE clause, sending it to all the shards is wasteful, because the query
will have results only in the partition corresponding to the shard key. To avoid
such waste, previous releases would never choose a secondary index if the query
specified a shard key (i.e., if it was a single-partition query). Furthermore,
if a single-partition contained an ORDER BY or GROUP BY clause that required
the use of a secondary index, the query would raise an error. The current
release lifts these restrictions by allowing single-partition queries to use
secondary indexes and be executed only in the partition corresponding to the
specified shard key.
<p>
[#27573]
</li>
<li>
NOT EXISTS predicates were not considered sargable before. Now they are. For
example, assume table "persons" has a column "info" of type JSON, and there
is an index on info.age. Then, the following query, which looks for persons
that do not have any age information, can now use the index on info.age for
efficient execution.
<pre>
select * from persons p where not exists p.info.age
</pre>
<p>
[#27489]
</li>
<li>
Fixed bug where the sum() and seq_sum() functions would return 0, instead of
NULL, if none of the input values were numeric.
<p>
[#27468]
</li>
<li>
Changed the seq_count() function to return NULL if any of its input items is
NULL.
<p>
[#27582]
</li>
<li>
Fixed a bug where seq_min and seq_max functions would not skip JSON null if it
was the 1st value in the input sequence.
<p>
[#27628]
</li>
<li>
Changed the way the EXISTS and NOT EXISTS operators behave when their input
expression returns NULL. Before, EXISTS would return true and NOT EXISTS
false. Now, they both return NULL, unless it is known that the input expression
will always return at least one item; in the later case EXISTS returns true
and NOT EXISTS returns false.
<p>
[#27492]
</li>
<li>
Fixed a bug where a value-comparison predicate would be erroneously pushed
to a multi-key field of an index.
<p>
[#27491]
</li>
<li>
Fixed 2 bugs where the GeoJson functions would sometimes throw a
NullPointerException if an argument is not a valid GeoJson object.
<p>
[#27496] [#27508] [#27526]
</li>
<li>
Fixed a bug where the geo_distance function would return -1 instead of
NULL.
<p>
[#27546]
</li>
<li>
Fixed a bug where SN memory allocation check would sometimes produce misleading
logging message.
<p>
[#27524]
</li>
<li>
Modified the 'plan migrate-sn' command to continue in the presence of
failures if the -force flag is specified. Administrators can use this
new behavior when migrating SNs from failed zones.
<p>
[#27598]
</li>
<li>
Fix a problem encountered when processing string literals that contain
the backslash character. [#27640]
</li>
<li>
Fix a bug where using bulk put API to load data to a table with identity type
column, the identity column is not filled in value. [#27664]
</li>
<li>
Fix a bug where min()/max(), seq_min()/seq_max() of Timestamp values with
precision less than 9 returns wrong fractional second. [#27662]
</li>
</ol>
<h3><a name="Utilities19312">Utility Changes</a></h3>
<ol>
<li>
Removed deprecated Admin CLI commands that supported Avro:
<ul>
<li>ddl add-schema
<li>ddl enable-schema
<li>ddl disable-schema
<li>table add-schema
<li>put kv -json &lt;schemaName&gt;
<li>get kv -json &lt;schemaName&gt;
<li>aggregate kv
<li>show schemas
</ul>
<p>
[#27387]
</li>
<li>
Upgraded the verify-data plan with the following changes:
<ul>
<li>Made the verify-data plan asynchronous to avoid the timeout of RMI requests.
<li>Added a feature to provide users a list of corrupt keys associated with the
error messages as a part of the plan result.
<li>Added two new flags, -show-corrupt-files and -valid-time.
-valid-time specifies the amount of time for which an existing verification
will be considered valid and not be rerun. The default is '10 minutes'.
-show-corrupt-files specifies whether to show corrupt JE log files in the
plan result. It is disabled by default.
</ul>
<p>
[#27216]
</li>
<li>
  Updated InitialCapacityPlanning.xls (the capacity planning sheet) with the
  following changes:
  <ul>
    <li>Misc. cleanups to text and presentation.</li>
    <li>JVM overheads are now accounted for explcitly when sizing memory requirements.</li>
    <li>Simplified usage by eliminating explicit use of DbCacheSize.</li>
    <li>Support for specifying one index along with the table.</li>
  </ul>
<p>
[#27550]
</li>
</ol>
<ol>
<li>
The Oracle NoSQL Database Hadoop and Hive integration classes can now be
used in environments running CDH6 Hadoop and Hive.
<li>
A 'shaded' version of the antlr4-runtime.jar library is now shipped with
this release; where the path prefix of each class specified in that
library has been changed from the string 'org/antlr' to
'oracle/kv/shaded/org/antlr'. This has been done to avoid ClassLoader
conflicts (typically manifested as a NoClassDefFoundError) when an
application runs in an environment that depends on a different,
incompatible version of that library; for example, various containers,
Hadoop clusters, Hive clients, etc. In general, this will require no
changes to current applications. The only case where a change in your
application will be necessary is in the unlikely event that the
classpath of your application includes the antlr4-runtime.jar library
shipped in this release of Oracle NoSQL Database, rather than a version
of antlr4-runtime.jar installed in the application's particular runtime
environment. In that case, we urge you to change your application's
classpath to reference your own instance of antlr4-runtime.jar; as
the shaded version of antlr4-runtime.jar shipped with this product is
considered private to Oracle NoSQL Database.
<p>
[#27616] [#27126]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 19.1.10</u></h3>
<h3><a name="BugFixes19110">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed the kvclient distribution so that it includes all required jar
files.
<p>
[#27684]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 19.1.8</u></h3>
<h3><a name="NewFeatures1918">New Features</a></h3>
<ol>
<li>
Users can now monitor Admin related metrics using JMX. AdminMXBean.getEnvMetric
returns a JSON string containing a bundle of environment-related metrics.
<p>
[#27077]
</li>
<li>
Stored Admin events used to be pruned by time period only. Starting this
release, they are pruned by the number of events as well. The default maximum
number of events is 10,000. The default time period is 30 days.
<p>
[#22640]
</li>
<li>
Enhanced the CREATE FULLTEXT INDEX command to now support the creation of
text indexes on the contents of a JSON document stored in an Oracle NoSQL
Database table. When the elements stored in a column of a given table are
JSON documents, the enhancements made to CREATE FULLTEXT INDEX allow users
to specify which of the document's attributes to index, as well as the
data type Elasticsearch should use when indexing the attribute.
<p>
[#27069]
</li>
</ol>
<h3><a name="BugFixes1918">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed an issue in the implementation of the Streams API where a stream
client could get a oracle.kv.MetadataNotFoundException during start up,
even after the checkpoint table gets created successfully.
<p>
[#27497]
</li>
<li>
Modified store contraction so that the retired shard waits for stream
clients to finish up to a configurable time out. A new RN parameter
<code>rnStoreContractWait</code> is added.
<p>
[#27306]
</li>
<li>
Improved the scalability of metadata propagation for stores with very large
numbers of tables.
<p>
[#27257]
</li>
<li>
When creating a secure KVStore handle, an application could get a "Too
many open files" exception when KVStoreFactory.getStore() was invoked
many times. This problem is now fixed by properly closing the Java
keystore opens during the SSL initialization.
<p>
[#27322]
</li>
<li>
Fixed a bug that the TableIteratorOption's consistency and requestTimeout
configuration were ignored by index iterator and index keys iterator APIs:
tableIterator(IndexKey, MultiRowOptions, TableIteratorOptions)
and tableKeysIterator(IndexKey, MultiRowOptions, TableIteratorOptions).
<p>
[#27345]
</li>
<li>
The number of user plans that were retained in the non-terminal state
were previously unbounded. The oldest of these types of plans are now
canceled and removed if the number exceeds 1000.
<p>
[#27353]
</li>
<li>
<p>
The handling of server security parameters was modified so that the
server now enforces a standard set of SSL protocols rather than
supporting the protocols enabled in Java. By default, the server now
requires SSL to use either the TLSv1.2, TLSv1.1, or TLSv1 protocol.
Prior to this change, the server supported any protocol enabled in Java,
so clients could be configured to use a non-default protocol without
needing to modify the server configuration.
<p>
The <code>makebootconfig</code> and <code>securityconfig</code>
utilities generate configurations that configure clients to use the
TLSv1.2, TLSv1.1, and TLSv1 protocols by default. As a result, this
change to the default server configuration will only have an effect if
the client uses a non-default configuration for SSL protocols. Users can
configure their clients to use non-default protocols either by
generating a new <code>client.security</code> file by using the
<code>makebootconfig</code> and <code>securityconfig</code> utilities,
or by modifying the <code>oracle.kv.ssl.protocols</code> parameter in
either the security file or security parameters. Prior to this change,
removing the default setting for this parameter would have permitted
using the set of protocols enabled in Java, which includes SSLv2Hello
and, in Java 11, TLSv1.3. Now those protocols will only be used if
explicitly configured for both clients and servers.
<p>
The <code>makebootconfig</code> and <code>securityconfig</code>
utilities can be used to specify non-default values for this security
parameter for a new installation, and <code>securityconfig</code> can be
used to update the parameter in an existing installation.
<p>
For information on setting security parameters, see <a
href="oradoc-absolute:/security/security-configuration.html">Security
Configuration</a>.
<p>
Note that there are issues that prevent the use of the TLSv1.3 protocol
with Java 11 for secure stores. We expect to enable this new protocol in
a future release.
<p>
[#27414]
</li>
<li>
<p>
Fixed TableAPI.getTables("sysdefault") to return only tables in the sysdefault
namespace.
<p>
[#27328]
</li>
<li>
Fixed an exception that occurred when using the NO CACHE value for the
GENERATED AS IDENTITY option in a query.
<p>
[#27368]
</li>
<li>
Fixed a problem where the <code>plan failover</code> Admin command could
produce an incorrectly configured store by leaving electable group size
override parameters enabled. The incorrect configuration could cause
attempts to restore the original store topology to fail.
<p>
[#27513]
</li>
<li>
Fixed a bug where password contain equal mark cannot be read out from plain text
password file store correctly.
<p>
[#27525]
</li>
<li>
Fixed a problem where the checkpoint made by Streams API user maybe overridden
by an internal checkpoint made during elastic operations, or vice-versa. The
incorrect internal checkpoint may cause streams to fail during elastic
operations, and user may lose her previously made checkpoint. To support
elasticity operations correctly, all stream clients need to be upgraded
before performing the elasticity operation.
<p>
[#27521]
</li>
<li>
The import/export utility provides an <code>overwrite</code> option that
automatically overwrites any record that is found to exist in the
Oracle NoSQL Database during import.
<p>
[#27515]
</li>
<li>
Users will no longer get the error "Failed to start SNA: unexpected
snapshot operation state" when trying to recover a snapshot taken using
a prior release, and then restoring it using a later version of Oracle
NoSQL Database. The snapshot.stat file was not getting cleaned up. 19.1
users who try to recover snapshots taken using 18.3 will still see this
error. You can work around the problem by removing the
<code>RESTORE=STARTED</code> entry from the snapshot.stat file found in
the snapshots directory.
<p>
[#27452]
</li>
<li>
<p>
Users can restore a backup that had <code>admindir</code> specified. Prior
to this fix, the Admin failed to come up after a restore from a store that
had <code>admindir</code> specified. Users using versions prior to 19.1
can do the following command and then restart the SNA without the
<code>-restore-from-snapshot</code> option:
<pre>
  cp -r admindir/snapshots/SNAPSHOT_NAME admindir/recovery
 </pre>
[#27454]
</li>
<li>
Oracle NoSQL Database now uses all of the memory it can for the Java
heap for heap sizes that are less than 32 GB rather than using some of
it for the offheap cache. This change was made to improve performance.
<p>
[#27454]
</li>
<li>
NullPointerException no longer occurs when a secure <code>kvstore</code>
registers with a secure Elasticsearch cluster via the <code>register-es</code>
Admin CLI command.
<p>
[#27474]
</li>
</ol>
<h3><a name="Utilities1918">Utility Changes</a></h3>
<ol>
<li>
Changed the default consistency policy for Admin CLI and SQL shell to ABSOLUTE.
<p>
[#27350]
</li>
<li>
The Import/Export utility has been enhanced to support JSON and MongoDB JSON
formats, it incorporates the functionalities of the preview migrator utility
released in 18.3 which is no longer supported. Users of the preview should
use the enhanced version of import/export instead.
<p>
[#27422]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 18.3.11</u></h3>
<h3><a name="Features18311">New Features</a></h3>
<ol>
<li>
Oracle NoSQL's Enterprise Manager plugin has the new capability to
discover store components running on Solaris 10.
<p>
[#26836]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 18.3.10</u></h3>
<h3><a name="Utilities18310">Utility Changes</a></h3>
<ol>
<li>
Added "request-timeout-ms=&lt;milliseconds&gt;" to the config file of export
and import utilities to configure the request timeout for iterator operation
in export process or bulk put operation in import process.
<p>
[#27395]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 18.3.9</u></h3>
<h3><a name="NewFeatures1839">New Features</a></h3>
<ol>
<li>
Streams are now supported during elasticity operations such as redistribution,
store expansion and contraction, etc. The events applied to a particular
key are streamed in the same order that they are applied at the store,
regardless of the shard that event was applied to. Prior to this feature
an AdminFaultException would occur if an elasticity operation was attempted on
a store with active subscribers.
<p>
[#26662]
</li>
<li>
Added namespace component to table names.
<p>
Queries use a namespace qualified name of form: ns:TableName. DDL
adds new statements: CREATE NAMESPACE and DROP NAMESPACE.
<p>
API changes: TableAPI.listNamespaces() returns all known namespaces and
    ExecuteOptions.setNamespace() and getNamespace() to specify the namespace
    of unqualified names used in queries.
<p>
There are 2 new system privileges:
<ul>
<li> CREATE_ANY_NAMESPACE
<li> DROP_ANY_NAMESPACE
</ul>
<p>
And new privileges with a namespace scope:
<ul>
<li>CREATE_TABLE_IN_NAMESPACE
<li>DROP_TABLE_IN_NAMESPACE
<li>EVOLVE_TABLE_IN_NAMESPACE
<li>CREATE_INDEX_IN_NAMESPACE
<li>DROP_INDEX_IN_NAMESPACE
<li>MODIFY_IN_NAMESPACE
<li>READ_IN_NAMESPACE
<li>INSERT_IN_NAMESPACE
<li>DELETE_IN_NAMESPACE
</ul>
<p>
These privileges can be granted or revoked using:
<pre>
GRANT namespace_privilege ON NAMESPACE ns0 TO role_name
REVOKE namespace_privilege ON NAMESPACE ns0 FROM role_name
</pre>
[#26036]
</li>
<li>
Added support for querying GeoJSON data.
<p>
Note: this feature is available only in the Enterprise Edition of Oracle NoSQL.
<p>
The GeoJSON specification (https://tools.ietf.org/html/rfc7946) defines the
structure and content of JSON objects that are supposed to represent geographical
shapes on earth (called geometries). Oracle NoSQL implements a number of
functions that do indeed interpret such JSON objects as geometries and allow
for the search for rows containing geometries that satisfy certain conditions.
Search is made efficient via the use of special indexes on the GeoJSON data.
<p>
As an example consider a table whose rows store points of interest. The table
has an id column as its primary key and a poi column of type JSON. Values of
the poi column may look like these two JSON documents:
<pre>
{
  "kind" : "city hall",
  "address" : { "state" : "CA",
                "city" : "Campbell",
                "street" : "70 North 1st street"
              },
  "location" : { "type" : "point", "coordinates" : [-121.94, 37.29] }
}

{
  "kind" : "nature park",
  "name" : "castle rock state park",
  "address" : { "state" : "CA",
                "city" : "Los Gatos",
                "street" : "15000 Skyline Blvd"
              },
  "location" : { "type" : "polygon",
                 "coordinates" : [
                                   [
                                     [-122.1301, 37.2330],
                                     [-122.1136, 37.2256],
                                     [-122.0920, 37.2291],
                                     [-122.1020, 37.2347],
                                     [-122.1217, 37.2380],
                                     [-122.1301, 37.2330]
                                   ]
                                 ]
               }
}
</pre>
Both of these documents have a "location" field whose value is a GeoJSON object.
In the first document, the GeoJSON represents a single point defined by its
coordinates: a longitude, latitude pair. In the second document, the GeoJSON
represents a polygon defined by the coordinates of its vertices.
<p>
The following query looks for nature parks in northern California (including
parks that straddle the border with neighbor states). The query uses the
geo_intersect function with a polygon representing northern california as its
second argument.
<pre>
select t.poi as park
from PointsOfInterest t
where t.poi.kind = "nature park" and
      geo_intersect(t.poi.location,
                    { "type" : "polygon",
                      "coordinates" : [
                                        [
                                          [-121.94, 36.28],
                                          [-117.52, 37.38],
                                          [-119.99, 39.00],
                                          [-120.00, 41.97],
                                          [-124.21, 41.97],
                                          [-124.39, 40.42],
                                          [-121.94, 36.28]
                                        ]
                                      ]
                    })
</pre>
The following query looks for gas stations within a mile (1609 meters) of a
given route including, for each qualifying gas station, its actual distance
from the route. The query uses the geo_near() function with a LineString
representing the route as its second argument. Furthermore, the geo_near
function adds an implicit order-by distance, and as a result, the query
orders the returned gas stations by ascending distance from the route.
<pre>
select t.poi as gas_station,
       geo_distance(t.poi.location,
                    { "type" : "LineString",
                      "coordinates" : [
                                       [-121.9447, 37.2975],
                                       [-121.9500, 37.3171],
                                       [-121.9892, 37.3182],
                                       [-122.1554, 37.3882],
                                       [-122.2899, 37.4589],
                                       [-122.4273, 37.6032],
                                       [-122.4304, 37.6267],
                                       [-122.3975, 37.6144]
                                     ]
                    }) as distance
from PointsOfInterest t
where t.poi.kind = "gas station" and
      geo_near(t.poi.location,
               { "type" : "LineString",
                 "coordinates" : [
                                   [-121.9447, 37.2975],
                                   [-121.9500, 37.3171],
                                   [-121.9892, 37.3182],
                                   [-122.1554, 37.3882],
                                   [-122.2899, 37.4589],
                                   [-122.4273, 37.6032],
                                   [-122.4304, 37.6267],
                                   [-122.3975, 37.6144]
                                  ]
                },
                1609)
</pre>
Both of the above queries can be executed efficiently by creating the following
index:
<pre>
create index idx_kind_loc on PointsOfInterest(poi.kind as string,
                                              poi.location as geometry)
</pre>
[#27078]
</li>
<li>
Added sequence aggregation functions.
<p>
The following functions were added: seq_count, seq_sum, seq_avg, seq_min, and
seq_max. Contrary to the corresponding SQL aggregate functions (count, sum, etc)
the sequence aggregate functions do not imply grouping of rows and do not
aggregate values from different rows. Instead, they simply aggregate the items
in their input sequence. In doing so, they use the same rules as their
corresponding SQL aggregate functions. For example, seq_sum will skip any
non-numeric items in the input sequence.
<p>
As an example consider a Users table with an expenses column that is a map
containing the expenses of each user for various categories. Then the following
query selects, for each user, their id, the sum of their expenses in all
categories except housing, and the maximum of these expenses.
<pre>
select id,
       seq_sum(u.expenses.values($key != "housing")) as sum,
       seq_max(u.expenses.values($key != "housing")) as max
from Users u
</pre>
[#27082]
</li>
<li>
Implemented SQL INSERT/UPSERT statement.
<p>
This statement is used to construct a new row and insert it in a specified
table. If the INSERT keyword is used, the row will be inserted only if it
does not exist already. If the UPSERT keyword is used, the row will be
inserted if it does not exist already, otherwise the new row will replace
the existing one.
<p>
As an example, consider the following CREATE TABLE statement
<pre>
<code>
create table Users (
  id INTEGER,
  firstName STRING,
  lastName STRING,
  otherNames ARRAY(RECORD(first STRING, last STRING)),
  age INTEGER,
  income INTEGER,
  address JSON,
  expenses MAP(INTEGER),
  PRIMARY KEY (id),
)
</code>
</pre>
Then the following INSERT statement constructs and inserts a new row into
the Users table, if a row with id 10 does not exist already.
<pre>
insert into table users values (
    10,
    "John",
    "Smith",
    [ {"first" : "Johny", "last" : "BeGood"} ],
    22,
    45000,
    { "street" : "Main", "number" : 10, "city" : "Reno", "state" : "NV"},
    { "travel" : 5000, "books" : 2000 }
) set ttl 3 days
</pre>
If the "upsert" keyword is used in place of "insert" in the above statement,
the new row will be inserted if it does not exist already, otherwise it will
replace the current version of the row.
[#27006]
</li>
<li>
It is now possible to cast an integer or long to a timestamp in SQL. The
integer/long is interpreted as the number of milliseconds since the epoch.
[#27006]
</li>
<li>
Added parse_json SQL function to convert a string to a JSON instance.
[#27006]
</li>
<li>
Added support for IDENTITY column for tables.
<p>
Users can create a table with IDENTITY column that uses a sequence generator.
IDENTITY column is of numeric datatypes: INTEGER, LONG, NUMBER for which the
system automatically generates a unique number using an internal sequence
generator(SG) that is attached the column.  Only one IDENTITY column is allowed
for a table. Users can specify the following attributes for the sequence
generator:
START WITH (default =1), INCREMENT BY (default=1),
MINVALUE (default=minimum value of the datatype),
MAXVALUE(default=maximum value of the datatype), CACHE(default=1000), CYCLE or
NO CYCLE(default=NO CYCLE).
<p>
The IDENTITY column can be defined as either GENERATED ALWAYS or GENERATED BY
DEFAULT. For the GENERATED ALWAYS option, the system will always generate a
value for the IDENTITY column and will return an error if the user specifies
a value for it.  For the GENERATED BY DEFAULT option, the system will only
generate a value for the IDENTITY column if the user did not supply a value.
<p>
Users can also alter the IDENTITY column property and the SG attributes using
the ALTER TABLE DDL. New syntax is introduced for defining and modifying the
IDENTITY column using the CREATE TABLE and ALTER TABLE syntax respectively.
For example:
<pre>
CREATE Table t1 (id INTEGER GENERATED ALWAYS AS IDENTITY
  (START WITH 1 INCREMENT BY 2 MAXVALUE 100),
name STRING, PRIMARY KEY (id))
</pre>
This creates a table 't1' for which the system will generate values 1, 3, 5,
..up to 99.
If you want to add a CACHE and CYCLE attribute to the SG, you can issue the
following ALTER TABLE statement.
<pre>
ALTER Table t1 (ADD id INTEGER GENERATED ALWAYS AS IDENTITY
  (CACHE 3, CYCLE))
</pre>
If you want to drop the IDENTITY property of the column 'id', users can do so
as shown below.
<pre>
ALTER Table t1 (MODIFY id DROP IDENTITY)
</pre>
The system generates the IDENTITY column values during SQL statements -
INSERT, UPSERT and UPDATE or Table.Api - PUT, PUTIFPRESENT and PUTIFABSENT.
Refer to Oracle NoSQL Database documentation for the semantics for these when
an IDENTITY column is involved.
<p>
[#25154]
</li>
<li>
Added a new user-specifiable policy parameter for JVM overhead percentage
<p>
Add a new policy parameter named jvmOverheadPercent for the command
change-policy -params [name=value]. If not specified, the default is
25.
<p>
[#27089]
</li>
<li>
Added a new Migrator utility. Migrator utility allows user to import MongoDB
JSON entries in strict mode representation (exported using mongoexport
utility) or normal JSON entries into an Oracle NoSQL store. This is a preview
version. A general availability version that is integrated with IMPORT/EXPORT
will be available in a future release.
</li>
<li>
<p>
Added administrative command through REST API. Admin REST API allows user to run
admin commands through HTTP or HTTPS requests to Oracle NoSQL store. The request
and response payload are in JSON format, user can use utility like "curl" to run
admin commands against the store.
<p>
[#26596]
</li>
<li>
There is a new configuration option in KVStoreConfig that permits specification
of a local address on a client machine when connecting to KVStore. Such
configuration permits an extra level of network traffic control when running on
client machines with multiple NICs. Please review the java doc associated with
oracle.kv.KVStoreConfig.setLocalAddress(InetSocketAddress) for details.
[#26879]
</li>
</ol>
<h3><a name="BugFixes1839">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a number of casting bugs:
1. Casting a string to number was wrong.
2. Any kind of value should be castable to string, but that was not the case.
3. When casting a map to a record, casting of JSON null was not supported.
4. Trying to cast an empty string to a timestamp would raise
   StringIndexOutOfBoundsException. Now it raises IllegalArgumentException
   with an appropriate message.
[#27006]
</li>
<li>
Fixed bug in UPDATE statement: the new version of the row was not set when
the statement has a RETURNING clause.
[#27006]
</li>
<li>
Made the server return the security check failure response to Streams API
client. [#26091]
</li>
<li>
Fixed a problem where alter table would incorrectly remove a table's Time To
Live (TTL) setting. [#26983]
</li>
<li>
The following changes to the key statistics parameters were made:
<ul>
    <li>
        The default value for <code>rnStatisticsSleepWaitDuration</code>
        has been changed from 1 second to 60 seconds
    </li>
    <li>
        <code>rnStatisticsGatherInterval</code> must have a value greater than
        or equal to 60 seconds. If <code>rnStatisticsGatherInterval</code> is
        set to a value less than 60 seconds then 60 seconds is used for its
        value.

    </li>
    <li>
        <code>rnStatisticsLeaseDuration</code> must have a value less than or
        equal to one day (24 hours). If <code>rnStatisticsLeaseDuration</code>
        is set to a value greater than 1 day the value of 1 day is used.
    </li>
    <li>
        <code>rnStatisticsSleepWaitDuration</code> must have a value greater
        than or equal to 10 seconds and less than or equal to
        <code>rnStatisticsGatherInterval</code>. If
        <code>rnStatisticsSleepWaitDuration</code> is set to less than 10
        seconds the value of 10 seconds is used. If
        <code>rnStatisticsSleepWaitDuration</code> is set to greater than
        <code>rnStatisticsGatherInterval</code> the value of
        <code>rnStatisticsGatherInterval</code> is used.
    </li>
</ul><br>
The parameter values are checked on each RN when the RN starts or when the
parameter values are changed. If any of the key statistics parameters are
overridden one or more warning messages will appear in the RN log.
<p>[#26939]
</li>
<li>
<p>
Correct the spelling of the "versionCheckInterval" admin service
parameter introduced in the 18.1 release. Any values specified for the
incorrectly spelled "verionCheckInterval" parameter will be ignored
starting with this release and will need to be specified again using
the correct spelling.
<p>
[#27000]
</li>
<li>
<p>
When upgrading to this release, some elasticity operations, such as
redistribute, rebalance and contraction, will require that all nodes be
upgraded before they can start or resume.
<p>
The elasticity operations that are affected are those that require data to
be migrated from one shard to another.
<p>
If one of these operations is running when the upgrade starts, or is started
during the upgrade, the operation will pause until the upgrade is completed.
Once the upgrade is complete, the elasticity operation will resume.
<p>
[#26943]
</li>
<li>
<p>
The DurabilityException class has a new method getNoSideEffects which
returns whether it is known that the operation that produced this
DurabilityException had no side effects. Applications that receive a
DurabilityException when performing a modify operation and find that
getNoSideEffects() returns true can safely assume that none of the changes
requested by the operation have been performed and then retry the operation. If
it returns false, then the operation may or may not have had side effects.
<p>
[#27073]
</li>
<li>
<p>
The memory allocation calculation now takes into account the JVM overhead.
Made the rnHeapPercent represent the percentage of SN memory reserved for
requested Java heap size, and add a new user-specifiable parameter
jvmOverheadPercent, which represents additional memory used by JVM as a
percentage of requested Java heap size. The default value for
jvmOverheadPercent is 25.
<p>The default SN memory allocation is:
<ul>
<li>85% for Java heap and overhead
<ul>
<li>68% for requested Java heap size (rnHeapPercent)
<li>25% (jvmOverheadPercent) * 68 (rnHeapPercent) = 17% for JVM overhead
</ul>
<li>10% for the operating system (systemPercent)
<li>5% (the remainder) for the off-heap cache
</ul>
<p>
[#27089]
</li>
<li>
Fixed a bug where a query executing using NullValue external variable
won't raise UnsupportedOperationException. [#27177]
</li>
<li>
There have been several bug fixes in elasticity operations (topology
redistribute, rebalance, and contraction) when indexes are present in the
store. Included with these fixes is the new ability to rebuild an index is
the index becomes corrupted. <p> [#26856] [#27024] [#27189]
</li>
<li>
Fixed an issue with exception handling during a query operation which
incorrectly caused a RN to restart.<p>[#27183]
</li>
<li>
Fixed a bug that could cause an exception such as the following, making
the RN unavailable. The bug was present in versions of 18.1 prior to 18.1.20. It
can occur under certain conditions when 336 or more tables have been created
over the lifetime of the store.
<pre>
2018-08-29 14:16:12.965 UTC SEVERE [rg1-rn1] Process exiting
oracle.kv.impl.rep.EnvironmentFailureRetryException: com.sleepycat.je.EnvironmentFailureException: (JE +18.1.xx)
Environment must be closed, caused by: com.sleepycat.je.EnvironmentFailureException:
Environment invalid because of previous exception: (JE 18.1.xx)
rg1-rn1(1):/DATA00/rg1-rn1/env fetchLN of 0x6030/0x95727f6 parent IN=130 IN class=com.sleepycat.je.tree.BIN
lastFullLsn=0x6039/0x1e1138 lastLoggedLsn=0x603a/0x60ac3e parent.getDirty()=false state=0
expires=2018-09-02.00 LOG_FILE_NOT_FOUND: Log file missing, log is likely invalid.
Environment is invalid and must be closed.
        at oracle.kv.impl.api.RequestHandlerImpl.executeInternal(RequestHandlerImpl.java:934)
        at oracle.kv.impl.api.RequestHandlerImpl.executeRequest(RequestHandlerImpl.java:682)
        at oracle.kv.impl.api.RequestHandlerImpl.trackExecuteRequest(RequestHandlerImpl.java:649)
        at oracle.kv.impl.api.RequestHandlerImpl.access$100(RequestHandlerImpl.java:153)
        at oracle.kv.impl.api.RequestHandlerImpl$2$1.run(RequestHandlerImpl.java:523)
        at oracle.kv.impl.api.RequestHandlerImpl$2$1.run(RequestHandlerImpl.java:520)
        at oracle.kv.impl.security.ExecutionContext.runWithContext(ExecutionContext.java:192)
...
</pre>
[#27199]
</li>
</ol>
<h3><a name="Utilities1839">Utility Changes</a></h3>
<ol>
<li>
Added "namespace [namespace]" command to Admin CLI and sql shell to set or clear
namespaces for queries and table operations.
</li>
<li>
Added "-namespace &lt;namespaces&gt;" to export and import utilities to
export/import all the tables within the specific namespaces.
</li>
<li>
Added storagedir and availableLogSize information to verify configuration and
ping command output. If RNs hit out-of-disk limit exception then
violations are raised in verify configuration output. If availableLogSize
drops below 5 GB then warning notes are issued in verify configuration
output. [#25458]
</li>
<li>
Ping and verify will now display read only status for replication nodes.
[#26469][#26711]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 18.1.13</u></h3>
<h3><a name="NewFeatures18113">New Features</a></h3>
<ol>
<li>
<p>
Changed the behavior of CLI command <code>plan stop-service</code> to ensure
store health. After this change, if stopping services using the plan will cause
the store to fall into an unhealthy state, the plan will fail with detailed
health check information as the output, such as,
<blockquote>
<code>One of the groups is not healthy enough for the operation:</code><br>
<code>[rg1] Only 1 primary nodes are running such that a simple majority cannot
    be formed which requires 2 primary nodes. The shard is vulnerable and will
    not be able to elect a new master. Nodes not running: [rg1-rn1]. Nodes to
    stop: {rg1=[rg1-rn2]} ... ...</code>
</blockquote>
The service can be forcefully stopped by adding the <code>-force</code> flag.
<p>
Note that there is one exception. Since <code>plan stop-service -all-rn</code>
will always result in an unhealthy store, the health check is skipped for such
plans and the <code>-force</code> flag is not required.
<p>
[#22425]
</li>
<li>
Implemented group by clause and seq_transform expression in SQL for Oracle
NoSQL.
<p>
Group-by is similar to the one in the standard SQL. However, in Oracle NoSQL
grouping is possible only if there is an index that sorts the rows by the
group-by expressions.
<p>
Together with group-by the following aggregate functions were implemented:
count(*), count(expr), sum(expr), avg(expr), min(expr), and max(expr).
<p>
The seq_transform expression takes as input a "source" expression and a
"mapper" expression. It evaluates the source expr, producing a sequence
of zero or more items, and "transforms" this source sequence by evaluating
the mapper expr on each item of the source sequence and concatenating the
results of these evaluations. The current source item can be accessed by
the mapper expr via the $ variable.
<p>
Here is an example that demonstrates both group-by and seq_transform:
<p>
Assume a "sales" table, whose rows look like this:
<pre>
{
  "id":1,
  "sale":
  {
    "acctno" : 349,
    "year" : 2000, "month" : 10, "day" : 23,
    "state" : "CA", "city" : "San Jose", "storeid" : 76,
    "prodcat" : "vegies",

    "items" : [ { "prod" : "tomatoes", "qty" : 3, "price" : 10.0 },
                { "prod" : "carrots",  "qty" : 1, "price" :  5.0 },
                { "prod" : "pepers",   "qty" : 1, "price" : 15.0 }
              ]
  }
}
</pre>
Assume there is the following index on sales:
<pre>
create index on sales (sale.acctno as integer,
                       sale.year as integer,
                       sale.prodcat as string)
</pre>

Then one can write the following query, which returns the total sales
per acctno and year:

<pre>
select t.sale.acctno,
       t.sale.year,
       sum(seq_transform(t.sale.items[], $.price * $.qty)) as sales
from sales t
group by t.sale.acctno, t.sale.year
</pre>
[#26427]
</li>
<li>
Implemented parent-child joins in SQL.
<p>
More generally, this feature allows for joins among tables in the same table
hierarchy. Syntactically, this is done by a new NESTED TABLES clause that may
appear in the FROM clause of an SQL query. The NESTED TABLES clause specifies
a target table and a number of ancestors and/or descendant tables of the target
table. This is similar to using a MultiRowOptions object as a parameter to the
tableIterator and tableKeysIterator methods of TableAPI. However, NESTED
TABLES greatly extends the capabilities of these programatic APIs and
provides more standard semantics and better performance as well. Specifically,
NESTED TABLES:
<ul>
<li>
Is equivalent to a number of LEFT OUTER JOINS and UNION operations, as they
are defined by standard SQL.
</li>
<li>
Allows projection: the rest of the query can select any subset of the columns
of the participating tables.
</li>
<li>
Allows predicates to be specified on the ancesteros and descendant tables,
using the ON clause from standard SQL.
</li>
<li>
Allows the target table to be accessed via a secondary index even when
descendant tables are specified.
</li>
</ul>
<p>
As an example, consider an application that tracks a population of users and
the emails sent or received by these users. Given that SQL for Oracle NoSQL
does not currently support general purpose joins, the emails are stored in a
table that is created as a child of users, so that queries can be written
that combine information from both tables using the NESTED TABLES clause. The
create table statements for the two tables are shown below.
<pre>
create table users(
    uid integer,
    name string,
    email_address string,
    salary integer,
    address json,
    primary key(id))

create table users.emails(
    eid integer,
    sender_address string,   // sender email address
    receiver_address string, // receiver email address
    time timastamp(3),
    size integer,
    content string,
    primary key(eid))
</pre>

Here are two queries that can be written over the users and emails tables.
Given that users.emails is a child table of users, it has an additional
column, not included in its create table definition. This implicit column
is named uid and has type integer. Normally, its value will be a user id
that appears in the users table, but this is not necessary.
<pre>
#
# Count the number of emails sent in 2017 by all users whose salary is greater
# than 200K
#
select count(eid)
from NESTED TABLES(
       users
       descendants(users.emails ON email_address = sender_address and
                                   year(time) = 2017)
     )
where salary > 200
</pre>
The above NESTED TABLES clause is equivalent to the following left outer join:
<pre>
users u left outer join users.emails e on u.uid = e.uid and
                                          email_address = sender_address and
                                          year(time) = 2017
</pre>
<pre>
#
# For each email whose size is greater than 100KB and was sent by a user in the
# the users table, return the name and address of that user.
#
select name, address
from NESTED TABLES(users.emails ancestors(users))
where size > 100 and sender_address == email_address
</pre>
The above NESTED TABLES clause is equivalent to the following left outer join:
<pre>
users.emails e left outer join users u on u.uid = e.uid
</pre>
[#26670]
</li>
<li>
Introduce new JSON output format for admin CLI commands, run admin CLI command
with "-json" flag will display in the new JSON output format. For compatibility,
previous admin CLI JSON output are still supported, user can use "-json-v1" to
display previous JSON v1 output format.
[#25917]
</li>
<li>
Introduce a new plan <code>plan verify-data</code> that verifies the primary
tables and secondary indices for data integrity. The users can run this plan on
Admins and/or RepNodes and can choose to verify either the checksum of data
records, or the B-tree of databases or both.
<p>
For example:
<pre>
plan verify-data -all-rns
</pre>
verifies both data record integrity and b-tree integrity of primary
tables and secondary indices for all RepNodes.
<p>
And:
<pre>
plan verify-data -verify-log disable -verify-btree enable -index disable -all-rns
</pre>
verifies the b-tree integrity of primary tables for all RepNodes.
<p>
[#26284]
</li>
<li>
Modify the Admin CLI command to support multiple helper hosts. Now users can
use either -helper-hosts or -host/-port to connect to the master admin. The
command can find the admin so long as it can contact any services at the
given hosts/ports, so the given hosts/ports do not need to have an admin. Two
flags -admin-host and -admin-port are removed. Scripts that rely on them can
simply remove these two flags as long as the given hosts/ports for
-helper-hosts or -host/-port can connect to an SN in the store.
[#26633]
</li>
<li>
Changed the release numbering convention to use the last two digits of
the current year as the major version number, and a sequential number
incremented for each release as the minor version number.  This
numbering scheme matches similar changes being made to other Oracle
products, so the Oracle major and minor release numbers
(<code>KVVersion.getOracleMajor()</code>
and <code>getOracleMinor()</code>) are now the same as the regular
release numbers (<code>KVVersion.getMajor()</code>
and <code>getMinor()</code>).  In addition, the release string no longer
contains separate Oracle version numbers.  Applications should use
the <code>KVVersion</code> methods to access individual version number
fields.  If application parse the version string, they will need to be
updated to account for the removal of the Oracle version numbers.
[#26756]
</li>
<li>
Added two new attributes to the RepNodeMXBean that is available via JMX.
<ul>
<li>
RepNodeMXBean.getOpMetric returns a JSON string containing a
bundle of operation-related metrics.
</li>
<li>
RepNodeMXBean.getEnvMetric returns a JSON string containing a
bundle of environment-related metrics.
</li>
</ul>
<p>
These JSON objects have been, and remain, available as the JMX
notifications oracle.kv.repnode.opmetric and
oracle.kv.repnode.envmetric. They are described in the Run Book.
<p>
[#26760]
</li>
<li>
The Key Distribution Statistics Utility (described in Appendix G of the Admin
Guide) has been changed so that if enabled (via the <code>rnStatisticsEnabled</code>
parameter) it is scheduled automatically when a RepNode is lightly loaded. As a
result, the parameters: <code>rnStatisticsLowActivePeriod</code>
and <code>rnStatisticsRequestThreshold</code>, have been rendered obsolete and
are no longer supported. Admin CLI scripts that set these parameters should be
updated to eliminate use of these obsolete parameters.
<p>
[#26635]
</li>
<li>
Added a new parameter, <code>rnStatisticsTTL</code>, to govern how long data
collected by the Key Distribution Statistics Utility remains in system tables
once statistics gathering is disabled (via the <code>rnStatisticsEnabled</code>
parameter) or a table or index has been dropped. The default time-to-live (TTL)
is 60 days. The time unit specified must be either days, or hours.
<p>
[#26796]
</li>
<li>
Release version strings now identify which edition is being used.  The
result of calling
<code>KVVersion.CURRENT_VERSION.toString()</code> will mention the
Client when using the <code>kvclient.jar</code> file.  For example:
<pre>
  18.1.1 2018-01-24 09:06:12 UTC  Build id: 3eef91c0eaf6 Edition: Client
</pre>
If the <code>kvstore.jar</code> file is used, then the version string
will identify the server edition of the release.
<p>
[#24136]
</li>
<li>
Implemented support for specifying the Admin directory, Admin directory
size and RN log directory in the makebootconfig command:
<ul>
<li>
<code>-admindir &lt;directory path&gt;</code>
<br>
A path to the directory that will contain the environment associated
with an Admin Node. In the absence of explicit directory arguments, the
environment files are located under the KVROOT/KVSTORE/SN'ID'/Admin'Id'/
directory. This argument is optional in makebootconfig but recommended.
</li>
<li>
<code>-admindirsize &lt;directory size&gt;</code>
<br>
The size of the Admin storage directory. This argument is optional in
makebootconfig but recommended.
</li>
<li>
<code>-rnlogdir &lt;directory path&gt;</code>
<br>
A path to the directory that will contain the log files associated with
a Replication Node. For capacity values greater than one, multiple
rnlogdir parameters must be specified in makebootconfig, one for each
Replication Node that will be hosted on the Storage Node. If rnlogdir is
not specified, by default the logs will be placed under the
KVROOT/KVSTORE/log directory. This argument is optional in
makebootconfig but recommended.
</ul>
<p>
If <code>-rnlogdir</code> is specified, then the je.info, je.config and
je.stat files for specific RN will be stored in rnlogdir.  In all cases,
the je.info, je.stat and je.config files for Admins will be stored under
kvroot log directory.
<p>
[#26444]
</li>
<li>
Full Text Search now uses an internal HTTP client which supports HTTPS
connections to Elasticsearch.
<p>
FTS does not use the elasticsearch transport client anymore.
It now uses it's own HttpClient built over apache's httpasyncclient library.
This implies that the port used while registering Elasticsearch cluster
changes to http port instead of the transport used in the earlier revision.
<p>
In the command shown below:
<pre>
plan register-es -clustername &lt;es_cluster_name&gt; -host &lt;host_name&gt;
                 -port &lt;http_port&gt; -secure true
</pre>
<p>
The port specified should be the HTTP port of ES cluster. It was the
transport port in the previous release.
<p>
As can be seen in the above command, a new secure flag is added whose
default value is true. That is, FTS now runs in secure mode by default
and this needs some additional certificate set up, as described in the
FTS documentation.
<p>
If an existing KVStore already has a registered Elasticsearch, then,
after the upgrade, it needs to be registered again using the <code>plan
register-es</code> command.  The additional registration is needed
because the registered port has changed from the transport port to the
HTTP port.
<p>
[#26059]
</li>
<li>
FTS security is only available in Enterprise Edition.
<p>
For the basic and community editions, the -secure flag needs to be set
to false explicitly:
<pre>
plan register-es -clustername &lt;es_cluster_name&gt; -host &lt;host_name&gt;
                 -port &lt;http_port&gt; -secure false
</pre>
<p>
[#26781]
</li>
</ol>
<h3><a name="BugFixes18113">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a bug that could cause temporary failures in the <code>plan
switchover</code> Admin CLI command. The bug caused plan task
<code>UpdateRepNodeParams</code> to fail. The failure could be identified by
the plan status output, such as,
<blockquote><code>
Failures:   Task  72       ERROR at   2018-01-01 01:01:01 UTC:
UpdateRepNodeParams rg1-rn1: 72/UpdateRepNodeParams rg1-rn1 failed.: null,
</code></blockquote>together with a message inside the admin log, such as,
<blockquote><code>
2018-01-01 01:01:01.001 UTC INFO [admin1] Couldn't update parameters for
rg1-rn1 because unexpected exception:
com.sleepycat.je.rep.ReplicaStateException: (JE 7.3.6) (JE 7.3.6) GroupService
operation can only be performed at master.
</code></blockquote>
[#26776]
</li>
<li>
Fixed a bug and improved read availability for when a rep node reaches disk
limit. The bug caused a rep node failing to restart after reaching disk limit
with a message inside the rep node log, such as,
<blockquote><code>
2018-01-01 01:01:01.001 UTC SEVERE [rg1-rn1] Process exiting
com.sleepycat.je.DiskLimitException: (JE 7.6.3) Disk usage is not within
je.maxDisk or je.freeDisk limits and write operations are prohibited: ... ...
</code></blockquote>
The fix also enables the rep node to keep serving read requests after reaching
disk limit.
[#26701]
</li>
<li>
Allow predicates inside path-filtering steps to be used as index-filtering
predicates.
<p>
For example, consider the following query:
<pre>
select id
from Foo f
where exists f.info.address.phones[$element.areacode > 408 and
                                   $element.kind = "home"]
</pre>
Assume we have an index on (info.address.phones.areacode,
                            info.address.phones.kind)
<p>
The areacode predicate will be used as a start/stop pred for the index scan.
The kind predicate can be used as an index-filtering pred, but before this
fix it wouldn't be used as such. If the kind pred is not pushed to the index,
we also loose the "covering-index" optimization for this query.
<p>
[#26162]
</li>
<li>
In case of a secondary covering index, locks were being acquired on the
table rows, which means that the primary index was being looked up for
every such lock. Instead, in this case, only the qualifying index
entries need to be locked. This fix can result in significant
performance improvement if all data accessed are found in main memory at
the server. For example, for a simple prepared query, this fix showed a
20% improvement in the end-to-end query latency.
[#26451]
</li>
<li>
Avoid data cloning in UPDATE query statements. In previous releases, new values
(computed in SET, ADD or PUT clauses) were cloned before they were used to update
the target item(s). This is because, it is possible to create cycles among items,
resulting in stack overflows when such a circular data structure is serialized.
This fix tries to avoid avoid such cloning in most common cases, by
detecting at compile time that a cycle is not possible.
</li>
<li>
When a query uses a multi-key index, it is often the case that duplicate results
must be eliminated. This is done based on primary key values. A bug was fixed
that would cause an exception to be thrown if a primary key column is of type
Number or Timestamp.
[#26460]
</li>
<li>
Fixed a bug that was preventing external variables to be used in update
statements.
[#26504]
</li>
<li>
Fixed a bug that ocurred when the SELECT clause contained a single
expression with no AS clause. In this case, the value returned by this expression
must be wrapped in a single-field record (because it may not be a record, and
queries must always return records having the same record type). However,
this wrapping was not always done.
[#26767]
</li>
<li>
Fixed a query bug showing up when querying a key-only table with an order-by query.
A QueryStateEception would be thrown in this case during compilation, because the
order-by expressions were not being rewritten to access the index fields instead
of the table columns.
[#26632]
</li>
<li>
Fixed a bug with a select-star query that (a) queries a key-only table and
(b) uses a secondary index that indexes all the table columns. The bug would
cause the index entries to be returned instead of the table rows. Although,
in this case, the index entries contain the same information as the table
rows, the ordering of the columns and/or their names may be in different.
As part of this fix, an index that indexes all the tale columns will always
be recognized as a covering index, whereas this was not the case before.
[#26838]
</li>
<li>
Fixed a bug showing up in queries like the following example:

<pre>
declare $ext6 string;
select f.str
from foo f
where f.str >= $ext and f.str <= "ab"
</pre>

If the $ext variable is set to "ab", the query will return all rows whose
str column starts with "ab" rather than being equal to "ab". Notice that if an
external variable were not used, the bug would not show up, because the compiler
would convert the WHERE condition to f.str = "ab".
[#26671]
</li>
<li>
Fixed an issue where the <code>topology validate</code> command returns
"null" when the topology candidate that is being validated contains
Storage Nodes that do not exist in the current store. [#26294]
</li>
<li>
There is now a limit on the number of plans stored by the Admin. Plans with
an ID 1000 less than the latest plan will be automatically removed from
the Admin's persistent store. Only plans that are in a terminal state
(SUCCEEDED or CANCELED) are removed. [#22963]
</li>
<li>
A limitation has been placed on plan names which prevents the creation of
new plans with a name starting with "SYS$". This prefix is reserved to plans
which are created internal by the Admin to perform its own administrative
operations. Existing plans starting with "SYS$" are not affected. [#26279]
</li>
<li>
Fixed some issues that prevented requests from completing within the
specified request timeout, in particular when checking for quorum and
specifying JE transaction timeouts. Also, modify request handling to
prioritize ConsistencyException over RequestTimeoutException, since
ConsistencyException provides more specific information about the cause
of the request failure. [#22849]
</li>
<li>
Fixed a table scan issue where the order of rows returned by the following
method on the TableAPI interface may be incorrect when Direction.FORWARD and
Direction.REVERSE are specified. The bug required that the primary key field(s)
be declared in order at the beginning of the DDL statement to create the table.
That is no longer the case. This is the method with the problem:
<pre>
  TableIterator&lt;Row&gt; tableIterator(...)
</pre>
[#26769]
</li>
<li>
Made code changes and upgraded some external libraries to support Java
9.  Note that these changes are still preliminary: full testing will
move to the latest Java version in a future release.
<p>
[#25278]
</li>
<li>
Fixed an issue that Storage Node configured with "-noadmin" flag doesn't
suppress starting a Bootstrap Admin.
[#26840]
</li>
<li>
Fixed an issue that returns "Unknown statement" when execute update statement
on sql shell.
[#26357]
</li>
<li>
Support to parse Timestamp string with zone offset in format of
"+HH:MM"/"-HH:MM" or 'Z'(rep for UTC) with default pattern.
[#25808]
</li>
<li>
Fixed the output message for "show pool -name" command when supplying a
non-exist pool name. Previously it will display "Unknown Exception" with stack
trace.
[#26639]
</li>
<li>
Fixed the output of "ping" command to be directed to stdout when the command
exit code is 0. Previously all the output of "ping" will be directed to stderr.
[#26693]
</li>
<li>
Additional optional argument -shard added in ping command to check for services status specific to a particular shard. These changes have been done for both admin and top level ping version. ping -shard shardId will give status for SN, RNs and Arbiter associated with specific shard. Additional information about number of shard in topology added in show topology output with numShard=X.
[#25348]
</li>
<li>
Fixed a problem which prevented information about storage directories
specified with the <code>-storagedir</code>
and <code>-storagedirsize</code> flags to
the <code>makebootconfig</code> command from being included in the
output of the <code>generateconfig</code> command. [#26353]
</li>
<li>
Fixed a problem of migrate-sn command when the target SN and source SN both set
<code>-storagedir</code> but the paths or sizes are different. The mount point
parameters of relocated RN should be matching the target SN's storage directory
configurations after the movement.
[#26918]
</li>
</ol>
<h3><a name="Storage18113">Storage Engine Changes (JE 18.1)</a></h3>
<ol>
<li>
Fixed a bug that could on occasion cause a NullPointerException after an RN
transitions from Master to Replica with the representative stack trace below:
<pre>
   2017-08-08 06:59:15.498 UTC SEVERE [rg3-rn1] JE: Uncaught exception in feeder
   thread Thread[Feeder Output for rg1-rn1,5,main] nulljava.lang.NullPointerException
    at com.sleepycat.je.rep.vlsn.VLSNIndex.getLatestAllocatedVal(VLSNIndex.java:488)
    at com.sleepycat.je.rep.impl.node.Feeder$OutputThread.writeAvailableEntries(Feeder.java:1337)
    at com.sleepycat.je.rep.impl.node.Feeder$OutputThread.run(Feeder.java:1163)
</pre>
[#26495] (18.1.0)
</li>
<li>
JE's per-Database (per-partition) disk utilization metadata is no longer
maintained in order to better support very large numbers of partitions.
Using a worst case example of 20K partitions per RN with records spread over
1,000 data files, previously the utilization metadata would occupy roughly 2GB
of memory and over 100GB of disk. This metadata has been removed.  Due to the
metadata removal, the dataAdminBytes cache statistic has also been removed.
<p>
[#26597] (18.1.1)
</li>
<li>
JE recovery time (RN and Admin startup time after a crash) has been reduced.
To go along with this optimization, NoSQL DB has increased the default JE
checkpoint interval to reduce writing and improve disk utilization.
<p>
[#26179] (18.1.3)
</li>
<li>
Fixed a NullPointerException during deadlock detection on an RN or Admin, for
example:
<pre>
java.lang.NullPointerException:
  at com.sleepycat.je.txn.LockManager$DeadlockChecker.hasCycleInternal(LockManager.java:1942)
...
</pre>
This was never reported for NoSQL DB, but if it did occur would have caused
the RN or Admin to restart. It did not cause persistent corruption.
<p>
[#26570] (18.1.3, originally fixed in 7.4.6)
</li>
<li>
Fixed two bugs that sometimes caused internal operations to be included in
JE operation stats (priSearchOps, etc).
<ul>
    <li>
        The Btree verifier was incorrectly contributing to operation stats.
    </li>
    <li>
        Deletion operations sometimes incorrectly included search and position
        stats, depending on the timing.
    </li>
</ul>
<p>
[#26694] (18.1.4)
</li>
<li>
Fixed a very rare, timing related bug that could cause internal corruption.
The bug has always been present in JE HA and has been seen only once in a
stress test.
<p>
[#26706] (18.1.4)
</li>
<li>
The default for JE EnvironmentConfig.TREE_COMPACT_MAX_KEY_LENGTH has been
changed from 16 to 42 bytes. This reduces cache usage for Btree internal nodes
by 5 to 25%, depending on the key size used (smaller key sizes give larger
savings).
<p>
[ANDC-203] (18.1.6)
</li>
<li>
Fixed a bug that could cause the following exception on a replica node, when
using TTL in conjunction with record deletions:
<pre>
  2018-02-10 12:00:00.006 UTC INFO [rg1-rn1] JE: Replay thread exiting
  with exception:Environment invalid because of previous exception: ...
  Replicated operation could not be applied. DEL_LN_TX/14
  vlsn=1,711,027,333 isReplicated="1" txn=-834602813 LOG_INCOMPLETE:
  Transaction logging is incomplete, replica is invalid. Environment is
  invalid and must be closed. Problem seen replaying entry DEL_LN_TX/14
  vlsn=1,711,027,333 isReplicated="1" txn=-834602813
</pre>
The problem can occur under the following conditions:
<ul>
  <li>The TTL feature is used.</li>
  <li>A replica is lagging or down (this is not uncommon).</li>
  <li>Records with a TTL are also sometimes deleted explicitly at around
      the time the record expires.</li>
</ul>
Prior to this bug fix, the problem could be corrected only by performing a
network restore on the replica.
<p>
[#26851] (18.1.10)
</li>
</ol>
<h3><a name="Utilities18113">Utility Changes</a></h3>
<ol>
<li>
Snapshot utility will by default create snapshot for configurations as well as
service data. Introduced new arguments <code>-restore-from-snapshot</code> in
"start" command line to allow user directly restore from previous
snapshot when starting up SN.
[#26119]
</li>
<li>
Added new CLI command to limit the type of client requests enabled for the
whole store or specific shards.
<pre>
plan enable-requests -request-type {ALL|READONLY|NONE}
     {-shard &lt;shardId[,shardId]*&gt; | -store}
</pre>
There are three request types can be configured by this command, setting ALL
means the store or shards can process both read and write requests; READONLY
makes the store or shards only respond to read requests; NONE means no
requests will be processed by store or shards.[#25422]
</li>
<li>
Release version information provided in the output of the
<code>version</code> and <code>ping</code> commands, and also
the <code>show versions</code>, <code>ping</code>, and <code>verify
configuration</code> commands in the Admin CLI, now identifies the
edition of the release being used.  For <code>version</code>, the output
identifies the edition of the JAR file used for the command.
For <code>show versions</code>, the server information identifies the
edition of the Admin service.  For the other commands, the version
information for each Storage Node identifies the edition of the JAR file
being used to run that Storage Node.  For example:
<pre>
  java -jar kvstore.jar version
  18.1.1 2018-01-24 09:06:12 UTC  Build id: 3eef91c0eaf6 Edition: Community
</pre>
And:
<pre>
  java -jar dist/lib/kvstore.jar ping -host localhost -port 5000 \
       -security /tmp/kvroot/security/user.security
  Pinging components of store kvstore based upon topology sequence #14
  10 partitions and 1 storage nodes
  Time: 2018-01-24 21:35:59 UTC   Version: 18.1.1
  Shard Status: healthy:1 writable-degraded:0 read-only:0 offline:0 total:1
  Admin Status: healthy
  Zone [name=KVLite id=zn1 type=PRIMARY allowArbiters=false
      masterAffinity=false]   RN Status: online:1 offline:0
  Storage Node [sn1] on localhost:5000    Zone: [name=KVLite id=zn1
      type=PRIMARY allowArbiters=false masterAffinity=false]
      Status: RUNNING   Ver: 18.1.1 2018-01-24 06:34:44 UTC
      Build id: 3eef91c0eaf6 Edition: Community
	Admin [admin1]		Status: RUNNING,MASTER
	Rep Node [rg1-rn1]	Status: RUNNING,MASTER sequenceNumber:50
            haPort:5006
</pre>
[#24136]
</li>
<li>
Implemented the new feature master affinity zone for KVStore. This feature
allows users to set master affinity/no-master affinity for a zone when
deploying a zone. The zone with master affinity property has higher priority to
host master RNs. Besides, the feature also provides a command to allow users to
change the master affinity for the deployed zones.
<p>
The feature adds new flags <b>-master-affinity/-no-master-affinity</b> for the
existing command <b>deploy-zone</b> and adds a new command
<b>topology change-zone-master-affinity</b>. The usage of the new command is as
follows:
<pre>
Usage: topology change-zone-master-affinity -name &lt;name&gt;
    {-zn &lt;id&gt; | -znname &lt;name&gt;}
    {-master-affinity | -no-master-affinity}
    Modifies the topology to change the master affinity of the specified
    zone.
</pre>
<p>
[#25157]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR2.4.5.12</u></h3>
<h3><a name="NewFeatures4512">New Features</a></h3>
<ol>
<li>
Introduced Streams API that allows users to subscribe to all the changes
from write operations to an Oracle NoSQL Database table. The changes
are streamed to your application as a series of discrete
<code>StreamOperation </code> class objects. These APIs are an
implementation of Reactive Streams interface
(http://www.reactive-streams.org). The Oracle NoSQL version of the
streams APIs are prefixed with NoSQL so as to differentiate them from
the APIs described by the Reactive Streams standard. For example,
Reactive Streams describes a <code>Publisher</code> class.
Oracle NoSQL Database's implementation of that class is
<code>NoSQLPublisher</code>. For more information refer to the
"Getting Started with Oracle NoSQL Database Streams API"
[#24871]
</li>
<li>
Added UPDATE statement to perform single-row, server-side updates with SQL.
<p>
The UPDATE statement in Oracle NoSQL is an extended version of the one in
standard SQL. In addition to the SET clause, which is used to replace the value
of existing data fields, the ADD, PUT, and REMOVE clauses have been added to
support adding and removing elements and fields to/from arrays and maps.
Furthermore, the already powerful path expressions of Oracle NoSQL can be used
to identify multiple target fields to update (whether those fields are inside
json or strongly typed data) and to compute new values, potentially based on
the current values. However, in the current implementation, only a single
row may be updated, which implies that the WHERE clause must specify a complete
primary key.
<p>
As an example, assume a table, called "People", with only two columns: an
integer "id" column and an "info" column of type JSON. Furthermore, let's
assume the following row to be updated:

<pre>
{
  "id" : 0,
  "info" :
  {
    "firstName" : "John",
    "lastName" : "Doe",
    "profession" : "software engineer",
    "income" : 200000,
    "address" :
    {
      "city" : "San Fransisco",
      "state" : "CA",
      "phones" : [ { "areacode":415, "number":2840060, "kind":"office" },
                   { "areacode":650, "number":3789021, "kind":"mobile" },
                   { "areacode":415, "number":6096010, "kind":"home" }
                 ]
    },
    "children":
    {
      "Anna" : { "age" : 10, "school" : "ABC", "friends" : ["John", "Maria"] },
      "Ron"  : { "age" : 2 },
      "Mary" : { "age" : 7, "school" : "XYZ", "friends" : ["Mark"] }
    }
  }
}
</pre>

The following UPDATE statement updates various fields in the above row:

<pre>
update People p
set p.info.profession = "surfing instructor",
set p.info.address.city = "Santa Cruz",
set p.info.income = $ / 10,
set p.info.children.values().age = $ + 1,
add p.info.address.phones 0 { "areacode":831, "number":5294368, "kind":"mobile" }
remove p.info.address.phones[$element.kind = "office"]
put p.info.children.Ron { "friends" : ["Julie"] },
where id = 0
returning *
</pre>

The RETURNING clause at the end of the above statement specifies that the
whole row, after the update, must be returned. So, the result of the statement
looks like this:

<pre>
{
  "id" : 0,
  "info" :
  {
    "firstName" : "John",
    "lastName" : "Doe",
    "profession" : "surfing instructor",
    "income" : 20000,
    "address" :
    {
      "city" : "Santa Cruz",
      "state" : "CA",
      "phones" : [ { "areacode":831, "number":5294368, "kind":"mobile" },
                   { "areacode":650, "number":3789021, "kind":"mobile" },
                   { "areacode":415, "number":6096010, "kind":"home" }
                 ]
    },
    "children":
    {
      "Anna" : { "age" : 11, "school" : "ABC", "friends" : ["John", "Maria"] },
      "Ron"  : { "age" : 3, "friends" : ["Julie"] },
      "Mary" : { "age" : 8, "school" : "XYZ", "friends" : ["Mark"] }
    }
  }
}
</pre>

The first two SET clauses change the profession and city of John Doe. The third
SET reduces his income to one tenth. In this SET, the implicitly declared $
variable is bound to the target item of the SET, i.e., to the result of the
p.info.income expression. The fourth SET increases the age of John's children
by 1. Notice again the use of the $ variable here: the expression
p.info.children.values().age returns 3 ages; the SET iterates over these ages,
binds the $ variable to each age in turn, computes the expression $ + 1 for each
age, and updates the age with the new value.
<p>
The ADD clause adds a new phone at position 0 inside the phones array. The REMOVE
removes all the office phones (only one in this example). The PUT clause adds a
friend for Ron. In this clause, the expression p.info.children.Ron returns the
value associated with the Ron child. This value is a map (the json object
{ "age" : 3 }) and becomes the target of the update. The 2nd expression in
the PUT ({ "friends" : ["Julie"] }) constructs and returns a new map. The fields
of this map are added to the target map.
[#26161]
</li>
<li>
Changes in the cast expression.
<ul>
  <li>
  A record can now be cast to a map. This allows a user to cast a record to a
  json object.
  </li>
  <li>
  A map can be cast to a record. This is needed for updates, because we don't
  have a record constructor, so if a user wants to replace a whole record with
  a new record, the user constructs a map, which is then cast to the record by
  the update stmt.
  <li>
  In the previous implementation casting to JSON was a noop if the input value
  was a subtype of JSON. However, this was actually a bug, because for example,
  ARRAY(INT) is a subtype of JSON. and if we want to cast ARRAY(INT) to JSON,
  we should create an array of ARRAY(JSON) type. So, if the target type is JSON,
  the current implementation makes sure that any arrays/maps contained in the
  input value are cast to ARRAY(JSON)/MAP(JSON) in the output value.
  Furthermore, since we now allow casting records to maps, casting a record to
  JSON is now treated as casting the record to MAP(JSON). Before, this would
  raise an error.
  </li>
</ul>
[#26161]
</li>
<li>
Added SQL function seq_concat. It simply returns the concatenation of the
sequences returned by its argument expressions. [#26161]
</li>
<li>
Added SQL functions to extract temporal fields from a TIMESTAMP field. [#26046]
</li>
<li>
Storage directory sizes are now used to enforce disk usage, and new statistics
are provided for monitoring disk usage. We strongly recommend that all
applications:
  <ul>
      <li>Specify storage directories and sizes for all RNs.</li>
      <li>Monitor disk usage using the new availableLogSize statistic and take
          correction action well before this value reaches zero.</li>
  </ul>
<p>
Specifying a storage size is important because the storage engine reserves data
files for potential replication to nodes that are out of contact. More reserved
files are retained for potential replication in this release. If a storage size
is not specified, all the free space on the volume (minus 5GB of free space),
will eventually be used.
<p>
If monitoring is not performed or corrective actions are not taken, there
is a danger that the storage size (or the volume size) will be exceeded as the
size of the data set grows. Although less likely, this could also occur due to
a configuration error (for example, too small a cache size), by neglecting to
delete a snapshot, etc. Disk usage is now monitored internally and write
operations will be rejected when the storage size (or volume size) is in danger
of being exceeded. In this situation, read operations are still allowed.
Previously, the RN would cease to function when the volume was filled, i.e., no
operations could be performed.  Allowing read operations now provides partial
availability in this situation.  In addition, it is now guaranteed that at
least 5GB of free space on the volume will be maintained, regardless of the
specified storage size.
<p>
The availableLogSize statistic represents the amount of space that can be used
by write operations, taking into account that reserved data files will be
deleted automatically when necessary to perform write operations.  Note that
monitoring disk usage in the file system is not meaningful, because of the
presence of these reserved files that will be deleted automatically.
<p>
The availableLogSize statistic is one of several new statistics:
  <ul>
    <li>activeLogSize -- Bytes used by all active data files: files required
        for basic operation.</li>
    <li>reservedLogSize -- Bytes used by all reserved data files: files that
        have been cleaned and can be deleted if they are not protected.</li>
    <li>protectedLogSize -- Bytes used by all protected data files: the subset
        of reserved files that are temporarily protected and cannot be
        deleted.</li>
    <li>protectedLogSizeMap -- A breakdown of protectedLogSize as a map of
        protecting entity name to protected size in bytes.</li>
    <li>availableLogSize -- Bytes available for write operations when
        unprotected reserved files are deleted: free space + reservedLogSize -
        protectedLogSize.</li>
    <li>totalLogSize -- Total bytes used by data files on disk: activeLogSize +
        reservedLogSize.</li>
  </ul>
<p>
These statistics are included in the .stat files and can be monitored using the
JMX oracle.kv.repnode.envmetric type [TODO: doc ref]. In the JMX output, these
statistic names are prefixed by "Cleaning_" because they are in the log
cleaning (disk garbage collection) statistics group, for example:
"Cleaning_availableLogSize".
<p>
For a new store, the storage size is specified using the makebootconfig the
-storagedirsize argument.  For an existing store, the storage size can be added
(or modified) using the change-storagedir plan.  Note that in both cases the
-storageDir must be specified, even if the capacity is one.
<p>
Because specifying a storage directory size is recommended, a warning is now
printed by makebootconfig when -storagedir is specified but -storagedirsize is
not specified.
<p>
[#25220]
</li>
<li>
<p>
<code>Verify Configuration</code> now issues a warning if the user does not
specific the <code>-storagedirsize</code> and <code>-rootdirsize</code>.
We recommend that users set these parameters when installing the store
to help manage disk space.
<p>
[#26187]
</li>
<li>
Increased the table name size from 32 characters to 256 characters. [#26021]
</li>
</ol>
<h3><a name="BugFixes4512">Bug and Performance Fixes</a></h3>
<ol>
<li>
Better index usage by queries.
<p>
In prior releases, conditions that appear inside path filtering steps were
not considered as sargable, that is, they would never be used in determining
the start or stop points of an index scan. In the current release, this
restriction is removed. As an example, consider the following query:

<pre>
select id
from foo f
where f.info.address.phones[408 <= $element.areacode and
                            $element.areacode <= 650].kind =any "work"
</pre>

If there is an index on
(info.address.phones[].areacode, info.address.phones[].kind),
all predicates in the query can now be used for the index scan. So, a scan
on this index will start at areacode 408 and stop right after areacode 650.
During the scan, only entries whose "kind" field is equal to "work"
will be selected. Before this fix, if the index was chosen by the query,
the full index would be scanned and only the equality pred on kind would
applied during this scan.
<p>
In addition to path-filtering predicates, EXISTS predicates are also
treated as potentially sargable predicates in this release. For example,
consider the following query:

<pre>
select id
from foo f
where exists f.info.address.state and exists f.info.address.phones.areacode
</pre>

In this case, if we have an index on
(info.address.state, info.address.phones[].areacode)
both predicates in the query are sargable. Two ranges of the index will be
scanned. The first range starts at the beginning of the index and finishes
at the first entry having EMPTY as the value of the state field. The second
range start just after this EMPTY value and finishes at the end of the index.
During each scan, entries having the EMPTY value for the areacode field will
be eliminated.
[#26044]
</li>
<li>
Fixed a bug in the case where a query uses a secondary index and it also has
a predicate on a primary-key column, which is not part of the index definition.
Under some conditions, the predicate on the primary-key column was used as
a start/stop predicate for the index scan. This is not possible and the query
would raise an IndexOutOfBoundsException during compilation. An example is the
following:

<pre>
create table t1(id integer, name string, primary key(id));

create index idx1 on t1(name);

select * from t1 where name = "alex" and id > 0
</pre>

With this bug fix, the condition on the "id" column is not used as a
start/stop predicate any more, but it is used as an index-filtering
predicate instead. [#26358]
</li>
<li>
Added functionality to plan failover command to add, move or remove
Arbiters to the topology. [#25269]
</li>
<li>
Fixed performance bug in SQL query processing. Removed an unnecessary
remote call to fetch table metadata. This call was adding a one-time
overhead of close to 2ms to each SQL query. For queries that access
few rows, this is a huge overhead, especially when the rows are cached
in memory. For example, the latency of a query that accesses and
returns a single memory-cached row was 5x slower than an equivalent
table iterator API call.
[#26232]
</li>
<li>
Fixed a query bug that occurs when a TableQuery operation
is forwarded by a server to another server. For example, this may
happen during partition migration. The bug was in the serialization
method of TableQuery, because that method assumed that serialization
occurs only when the TableQuery is sent from a client to the servers.
[#26385]
</li>
<li>
Users can now set the <code>PASSWORD LIFETIME</code> to zero.
The password will never expire if the value is set to zero days.
Prior to this fix, when the user tried to issue
"ALTER USER admin PASSWORD LIFETIME 0 DAYS", the statement
will fail with message "Time value must not be zero or negative".
[#26040]
</li>
<li>
Changed the way the Java driver configures Java loggers to make it
easier to configure additional log handlers.  Applications can now be
configured to send logging output to a file by specifying a file logging
handler for the "kv.oracle" logger. [#26134]
</li>
<li>
Fixed bugs that allow queries to execute against a secure kvstore after a
session timeout without returning <code>AuthenticationRequiredException</code>.
[#26250], [#26249]
</li>
<li>
The method <code>oracle.kv.table.Index.createIndexKey(RecordValue value)</code> has been
deprecated in this release, this method is not able to construct index keys for
<em>multi-key</em> indexes that include elements of a map or array and can result in
multiple index entries, or distinct IndexKey values for a single row.
[#26211]
</li>
<li>
Fixed a bug where altering a key-only table by adding a non-primary-key column
would cause subsequent queries and index creation to fail. This bug exists in
R4.4 as well.
[#26354]
</li>
<li>
Fixed the output for <code>SHOW AS JSON USERS</code> and <code>SHOW AS
JSON ROLE role</code> to output results in the correct JSON format. The
incorrect output format was causing parsing issues in their
applications.
[#26355]
</li>
<li>
When upgrading from a pre-4.2 release to 4.2, 4.3, or 4.4, the
presence of multiple outstanding plans in the ERROR state can cause
the Admin to fail when starting up.  That bug has been fixed in this
release.
[#26303]
</li>
</ol>
<h3><a name="Utilities4512">Utility Changes</a></h3>
<ol>
<li>
Introduced two new arguments <code>-registry-open-timeout</code> and
<code>-registry-read-timeout</code> for Admin CLI and ping utility, which are
used to configure open and read timeout in milliseconds associated with the
sockets used to make registry requests.
[#24164]
</li>
</ol>
<h3><a name="Storage4512">Storage Engine Changes (JE 7.5)</a></h3>
<ol>
<li>
Fixed a compatibility problem with the Azul Zulu JVM. Previously the following
exception would occur when using Zulu:
<pre>
The database environment could not be opened: java.lang.IllegalStateException:
Could not access Zing management bean. Make sure -XX:+UseZingMXBeans was
specified.
</pre>
[#26163]
</li>
<li>
Fixed a bug that could cause OutOfMemoryError when performing a network
restore. This could cause an RN to unnecessarily restart and retry the network
restore. (A network restore is used when an RN has been down for some period
of time, and is lagging the master node in its shard.) [#26305]
</li>
<li>
Fixed a bug that could prevent performing a network restore, after a prior
network restore was aborted or incomplete for any reason. (A network restore
is used when an RN has been down for some period of time, and is lagging the
master node in its shard.)
<p>
For example, this could occur if the RN process is killed during the first
network restore, and then another network restore is attempted. The problem
could occur only in an environment with a relatively large data set,
specifically where at least one billion write transactions had been performed.
An example stack trace is below.
<pre>
java.lang.NumberFormatException: For input string: "7473413648"
at java.lang.NumberFormatException.forInputString(
        NumberFormatException.java:65)
at java.lang.Integer.parseInt(Integer.java:583)
at java.lang.Integer.parseInt(Integer.java:615)
at com.sleepycat.je.rep.InsufficientLogException.init(
        InsufficientLogException.java:218)
at com.sleepycat.je.rep.impl.RepImpl.handleRestoreRequired(
        RepImpl.java:2296)
at com.sleepycat.je.recovery.RecoveryManager.findEndOfLog(
        RecoveryManager.java:543)
at com.sleepycat.je.recovery.RecoveryManager.recover(
        RecoveryManager.java:339)
at com.sleepycat.je.dbi.EnvironmentImpl.finishInit(
        EnvironmentImpl.java:841)
at com.sleepycat.je.dbi.DbEnvPool.getEnvironment(DbEnvPool.java:222)
at com.sleepycat.je.Environment.makeEnvironmentImpl(Environment.java:267)
at com.sleepycat.je.Environment.init(Environment.java:252)
at com.sleepycat.je.rep.ReplicatedEnvironment.init(
        ReplicatedEnvironment.java:607)
at com.sleepycat.je.rep.ReplicatedEnvironment.init(
        ReplicatedEnvironment.java:466)
at oracle.kv.impl.rep.RepEnvHandleManager.openEnv(
        RepEnvHandleManager.java:628)
at oracle.kv.impl.rep.RepEnvHandleManager.renewRepEnv(
        RepEnvHandleManager.java:465)
at oracle.kv.impl.rep.RepNode.startup(RepNode.java:913)
</pre>
This has been fixed. Without the fix, a workaround for the problem is to
remove all the .jdb files on the RN node, and restart the RN.
<p>
[#26311]
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR2.4.4.6</u></h3>
<h3><a name="NewFeatures446">New Features</a></h3>
<ol>
<li>
Added indexing for JSON data.
<p>
As of the current release, SQL for Oracle NoSQL supports typed JSON indexes. As
their name implies, such indexes place some type-related restrictions on the
JSON data that is being indexed. Creation of a typed JSON index will fail if
the associated table contains any rows with data that violate the restrictions
imposed by the index. Similarly, an insert/update operation will be rejected
if the new row does not conform to the restrictions imposed by one or more
existing JSON indexes. However, as long as the type constraints are satisfied,
typed JSON indexes are very similar to indexes on strongly typed data, both
in the way their contents are evaluated as well as in the ways they are used
by queries.
<p>
Syntactically, the only difference between JSON and non-JSON indexes is that
a type must be specified in the CREATE INDEX statement for each index path that
indexes a JSON field. The type must be one of the JSON atomic types (a numeric
type, or string, or boolean). Such a type declaration implies that the items
returned by the index path expression, when evaluated on a table row, must be
of the specified type, or SQL NULL, or JSON null. It is also allowed for the
indexed path to not exist in the data; in this case the path expression returns
an empty result and a special (internal) value EMPTY is placed in the index.
<p>
Like non-JSON indexes, JSON indexes may be "simple" or "multikey". The later
are used to index all the elements of an array, or all the entries of a JSON
object. An example for each kind of index is shown below. They examples use
the following table:
<pre>
create table foo (id integer,
                  firstName string,
                  lastName string,
                  address json,
                  primary key(id));
</pre>
A sample row of the above table may look like this (shown in JSON format):
<pre>
{
  "id":0,
  "firstName" : "John",
  "lastName" : "Doe",
  "address": {
    "street" : "somewhere",
    "city": "San Francisco",
    "state"  : "CA",
    "phones" : [ { "area":408,  "number":5039567, "kind":"work" },
                 { "area":415,  "number":2854026, "kind":"work" },
                 { "area":null, "number":8390129, "kind":"home" },
               ]
  }
}
</pre>
<pre>
create index idx1 on foo (address.state as string,
                          address.city as string)
</pre>
In the above index, both the <code>address.state</code> and
<code>address.city</code> paths must return strings, or NULL, or JSON null,
or EMPTY (an SQL NULL may be returned only if the top-level <code>address</code>
column is NULL). Furthermore, since the paths do not contain any multikey steps
([], or .values(), or .keys()), they must return at most one item, which
implies that none of the fields in the paths (<code>address</code>, or
<code>address.state</code>, or <code>address.city</code>) may be arrays.
<pre>
create index idx2 on foo (address.state as string,
                          address.phones[].area as integer,
                          address.phones[].kind as string)
</pre>
In the above index, the paths <code>address.phones[].area</code> and
<code>address.phones[].kind</code> are multikey, because they contain the
[] step. This implies that <code>address.phones</code> is expected to be an
array (and none of the other fields in these 2 paths can be arrays). However,
it is also allowed for <code>address.phones</code> to be a single JSON object,
or even an atomic value. In general, the index paths are evaluated the same
way as path expressions in DML queries. So, if <code>address.phones</code>
is a single object having area and kind fields, the values of these
fields will be indexed. If <code>address.phones</code> is an atomic value,
the result of the path expression is empty, and EMPTY will be placed in the
index.
[#25509]
</li>
<li>
An EMPTY value is used internally to represent cases where an expression
returns an empty result. Applications do not normally have to deal with
EMPTY values. The only exception is in IndexKey instances: when a
TableIterator is used to scan an index and return index keys, the EMPTY
value may appear in the returned IndexKey instances.
The <code>FieldValue.isEMPTY()</code> method can be used to check if the
value of an IndexKey field is EMPTY. Applications may also use the
<code>IndexKey.putEMPTY()</code> method to search an index for entries
containing the EMPTY value in one or more of their fields.
[#25509]
</li>
<li>
Added NUMBER data type.  The NUMBER data type represents the
java.math.BigDecimal value. It can be used as a universal numeric type
that can handle numeric values of any size and precision.  A field of
type NUMBER can be used as a field of a primary key or an index key.
All query expression that work on numbers have been extended to handle
NUMBER values as well. [#25447]
</li>
<li>
Added operators IS NULL and IS NOT NULL in SQL for NoSQL. As in standard
SQL, the operators test whether the result of an expression is (or is not)
the SQL NULL. The operators are "sargable", that is, they can be evaluated
as conditions on index keys, if appropriate indexes exist. [#25809]
</li>
<li>
Indexing of NULL values was introduced in 4.2. However, in 4.2 and 4.3 NULL was
also used to index "missing" values, or more precisely, in cases where the
evaluation of an index path on a row would return an empty result (EMPTY). In
the current release, NULL and EMPTY are indexed separately. This is required
to make the IS (NOT) NULL operators sargable.  To see why, consider the
following example:
<pre>
create table foo (id integer, map MAP(RECORD(f1 integer, f2 integer)))

create index idx on foo (map.somekey.f1)

select * from foo where map.somekey.f1 IS NULL

Row R1: { "id" : 1, "map" : null }

Row R2 : { "id : 2, "map" : { } }

Row R3 : { "id : 3, "map" : { "somekey" : {"f2" : 10} } }
</pre>
Rows R1 and R3 are in the result set of the query, but not R2 (because on R2,
map.key.f1 returns EMPTY).
<p>
In 4.2, the index will contain NULL for all of the above rows. In the current
release, it will contain NULL for R1 and R3, and EMPTY for R2. So, in the
current release, the index can be used to optimize the query. [#25509]
</li>
<li>
Allow quoted strings as steps in index paths. This is needed to be able to
index a specific entry of a map, when the key of that entry in not a simple
identifier. For example:
<pre>
CREATE TABLE Foo(id INTEGER, map MAP(INTEGER)), primary key(id))

create index idx on Foo (map."@abc")
</pre>
<p>
Prior to this release, creating the above index was not possible, because
quoted strings were not allowed as steps. An attempt to use the path
<code>map.@abc</code> would fail, because <code>@abc</code> is not a valid
identifier (due to the '@' char). [#25854][#25958][#25963][#25974]
</li>
<li>
Any escape sequences that appear in string literals inside a query are converted
(inlined) to their corresponding unicode character when the query is parsed.
This is required, because the JSON data model applies the same conversion. So,
for example, when JSON text is loaded into Oracle NoSQL, any escape sequences
in the JSON text are inlined. As a result, the string literal appearing in
queries must have the same "format" internally, as the one used by the stored
data. [#25767]
</li>
<li>
Added a new plan <code>plan network-restore</code> to perform network restore
from one RepNode to another within the same shard. This plan can be used to
restore data from a secondary node to a primary RepNode; restore a replica
from another one if the shard lose quorum and no master available and also
could be used to restore a RepNode having corrupted data. [#25834]
</li>
<li>
Since this release, configuration files of storage node, Admin, RepNode and
security are set to owner read only by default. For example, the "config.xml"
in root directory and "security.xml" in security configuration directory.
[#25835]
</li>
<li>
Oracle NoSQL Database store passwords of users after hashing in the security
metadata database, the hashing algorithm was using PBKDF2WithHmacSHA1. Since
this release, replace with stronger algorithm PBKDF2WithHmacSHA256. Note that
this change won't update hashes of existing user passwords. It's recommended to
update user passwords to make use of the new algorithm after upgrade. [#26014]
</li>
<li>
Supports the "describe table" and "describe index" output in tabular
format. [#25720]
</li>
<li>
Displays the "describe table" and "describe index" output in tabular format. [#25720]
</li>
<li>
The progress of a plan will be available via JMX. A JMX notification is generated to
report on the status of a plan and its associated tasks for both serial and parallel
plans. It reports on both the general tasks as well as tasks associated with
elasticity operations such as migrate partition as shown in the sample out below.
<pre>
{
  "planId": 17,
  "planName": "Deploy Topo (17)",
  "reportTime": 1483445963460,
  "state": "RUNNING",
  "attemptNumber": 1,
  "migratePartition_Total": 150,
  "generalTask_Total": 14,
  "migratePartition_Successful": 15,
  "generalTask_Successful": 13,
  "migratePartition_Running": 135,
  "generalTask_NotStarted": 1
}
</pre>
 [#25200]
</li>
</ol>
<h3><a name="BugFixes446">Bug and Performance Fixes</a></h3>
<ol>
<li>
In previous releases, the "covering index" optimization was not being considered
for queries that did not have a WHERE clause. This has been fixed in the
current release. As a result, a query like <code>select id1 from foo</code>,
where "id1" is a primary key column of table "foo", will be evaluated by a
keys-only scan over the primary index of the table, instead of retrieving all
the table rows. [#25509]
</li>
<li>
A bug has been fixed for order-by queries where the order-by clause includes
primary-key columns. Because sorting is indexed-based, <b>all</b> of the
indexed fields must appear in the order-by clause, before the primary-key
columns. Otherwise, the query should be rejected. This restriction was not
enforced in prior releases, which could lead to wrongly sorted results. [#25509]
</li>
<li>
Certain combinations of queries and indexes on maps would cause ar error
during query execution. The most important case is when an index indexes
more than 2 specific keys of a map and a query is using the index to evaluate
one or more of its expressions during the index scan using only the index fields
(without the need to retrieve the full table row). Here is an example that
demonstrates such a case:
<pre>
CREATE TABLE Foo(
   id INTEGER,
   g  LONG,
   rec RECORD(a INTEGER,
              b ARRAY(INTEGER),
              c MAP(RECORD(ca INTEGER, cb INTEGER, cc INTEGER, cd INTEGER))),
primary key(id))

create index idx on Foo (rec.c.key1.ca, rec.c.key2.ca, rec.c.key3.cb)
</pre>
<p>
Query:
<p>
<code>
select id
from Foo f
where f.rec.c.key1.ca >= 3 and f.rec.c.key2.ca = 20
</code>
<p>
In this query, the 1st predicate in the WHERE clause is used as the start
condition for the index scan. This does not cause any problems. The problem
is caused by the 2nd predicate, which  is used as a "filtering" predicate:
it is evaluated as the index is being scanned, using the 2nd field
("rec.c.key2.ca") of the current index entry. Furthermore, the index indexes
3 specific map keys ("key1", "key2", and "key3"). If the path "rec.c.key3.cb"
was not part of the index definition, the bug would not show up.
[#25822]
</li>
<li>
The fact that map keys are case-sensitive was not taken into account when
the query processor would consider using an index on a specific map key.
This could lead to the wrong index being used by a query. For example:
<pre>
CREATE TABLE Foo (id INTEGER, map MAP(INTEGER), primary key(id))

CREATE INDEX idx ON Foo (map.SomeKey)

select id
from Foo f
where f.map.somekey = 3
</pre>
The above query would use the index. But this would be wrong because the map
keys "SomeKey" and "somekey" are not the same.
<p>
The case-sensitivity of the map keys was also not taken into account when,
during and INDEX CREATE statement, a check is made to see if an index with
the same fields exists already.
[#25959]
</li>
<li>
Elimination of duplicate query results was not done in some cases. Specifically,
if a query used a multikey index and no predicates were pushed to that index,
duplicate elimination was not done. An index will be used by a query, even if
no predicates are pushed into ti, if the index is used for sorting (order-by
queries) or if its use is forced by an index hint. [#26008]
</li>
<li>
Fixed several bugs in comparison operators. The bugs can cause a
query to return wrong results or raise an NPE. Fortunately the bugs show
up in corner cases only. [#25832]
<ul>
<li>
A bug can occur when long or double literal is compared with an expression
whose type is integer or float, respectively, and the long/double literal
is outside the range of integers/floats. Furthermore, the expression must
return one or more NULLs, or an empty result, or more than one items and
the operator is a value comparison operator.
</li>
<li>
A bug can occur when long or double literal is compared via != or !=any with
an expression whose type is integer or float, respectively, and the long/double
literal is outside the range of integers/floats.
</li>
<li>
A bug occurs when JSON null is compared with an expression whose
type does not contain JSON null, and either (a) the expression returns SQL
NULL, or (b) the expression returns EMPTY (the empty sequence) and the
comparison operator is !=any.
</li>
<li>
A bug occurs when a multi-valued path expression is compared
with a const, the path expression matched a multi-key path of an index,
the query will use that index, and the comparison predicate is converted
to a start/stop condition for the index scan. For example, t.array[] = 5
where "array" is a column of table t with type array(integer). Normally,
this predicate will raise an error if there is any row where the array
contains more than 1 elements. However, if there is also an index on
"array" and the predicate is pushed to that index, the error could be lost,
and the query would return a result.
</li>
</ul>
</li>
<li>
Fixed a compilation bug in array filter expression, when the input expression
has EMPTY type. For example, the following query will raise an
EmptyStackException:

select f.info.children.keys().age[$element > 4]
from foo f

In the path expression appearing in the SELECT clause, the keys() step will
always return a bunch of strings. As a result, the .age step on those strings
will always an empty result. So, the compiler would assign the type EMPTY to
the f.info.children.keys().age expression. This was not handled correctly by
the following array-filter step ([$element > 4]). [#25877]
</li>
<li>
The code that parses JSON text and maps it to a strongly-typed table schema
was not handling invalid JSON documents correctly. This has been fixed in this
release. [#25842]
</li>
<li>
Clarified in the documentation that the values returned
by <code>toByteArray</code> (and related) methods are not guaranteed to
work with older releases.  Byte array values created with either the
current or earlier releases can passed to the associated methods that
accept byte array values for the current or later releases, but values
created by later releases are not guaranteed to be compatible when
passed to methods for earlier releases.
<p>
These are the affected methods:
<ul>
<li><code>Consistency.toByteArray</code> and <code>fromByteArray</code>
<li><code>Durability.toByteArray</code> and <code>fromByteArray</code>
<li><code>ExecutionFuture.toByteArray</code>
  and <code>KVStore.getFuture</code>
<li><code>Key.toByteArray</code> and <code>fromByteArray</code>
<li><code>KeyRange.toByteArray</code> and <code>fromByteArray</code>
<li><code>Value.toByteArray</code> and <code>fromByteArray</code>
<li><code>Version.toByteArray</code> and <code>fromByteArray</code>
</ul>
<li>
Fixed the RMI registry filter issue occurs while running a secure store
with Java SE Development Kit 8, Update 121 (JDK 8u121), which is caused by
the Java new feature called RMI better constraint checking. The fix is to
add patterns <code>oracle.kv.**;java.lang.Enum</code> to RMI registry filter
<code>sun.rmi.registry.registryFilter</code> automatically if they are not
present while starting a Storage Node Agent for both secure and non-secure
stores. [#25923]
</li>
<li>
Changed the SSL cipher suites preference order to favor suites using GCM cipher
algorithm mode if no user-specified cipher suite is configured. In our
experimental performance test, it is tracked that suites using GCM provide
better performance, particularly on hardware with limited sources of secure
randomness. [#25949]
</li>
<li>
Changed the error message when issue a query on a closed store handle to be more
understandable. [#25883]
</li>
<li>
Fixed the issue that failover operation may fail if a secondary zone has more
recent data than existing alive primary zones. The fix added potential data
loss verification to detect if there is a data loss after failover. To retain
data in secondary zones, users need to perform network restore first from
leading secondary nodes to primaries. If not,specify force and re-execute the
failover plan. [#24772]
</li>
<li>
Fixed the issue that the '0.0' in JSON string is failed to be parsed as a float value.
[#25983]
</li>
<li>
Fixed the issue that restarting a secured KVLite in EE version may fail with
IllegalStateException "Unable to access the configured wallet store". This is
due to concurrent attempts to open the wallet file.[#25990]
</li>
<li>
Upgraded the Elasticsearch library to v2.4.4. [#25943]
</li>
<li>
Fixed the issue where the Admin failed to restart on a IllegalCommandException.
When an Admin node restarts and becomes a master, it restarts all the plans that
were running at the time of failover. Prior to this fix If
IllegalCommandException occurred during the restarting of a plan, the Admin may
fail to restart. [#26022]
</li>
<li>
Fixed the issue for bulk put API where the entries with duplicate key supplied
by a single stream are marked as existed before the key is actually found in
store. [#25903]
</li>
</ol>
<h3><a name="Utilities446">Utility Changes</a></h3>
<ol>
<li>
Change field name from "datetime" to "reportTime" in following type of SN JMX
notification JSON format data.
<ul>
<li>oracle.kv.repnode.opmetric</li>
<li>oracle.kv.repnode.envmetric</li>
<li>oracle.kv.repnode.replicationstate</li>
<li>oracle.kv.repnode.status</li>
<li>oracle.kv.plan.status</li>
</ul>
[#25979]
</li>
<li>
Added "put" command to sql shell to put row(s) into the named table:
<code>
put -table &lt;name&gt; [-json &lt;string&gt; | -file &lt;file&gt; [JSON | CSV]]
</code>
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR1.4.3.11</u></h3>
<h3><a name="BugFixes4311">Bug and Performance Fixes</a></h3>
<ol>
<li>
Updates to improve security related to JLine and the shell command line
history. [#25940]
</li>
<li>
Fixed an RMI registry filter failure that could occur when running the
Oracle NoSQL Database in a secure configuration using Java SE
Development Kit 8, Update 121 (JDK 8u121). The failure was caused by the
new <i>RMI better constraint checking</i> feature. The fix adds the
patterns <code>oracle.kv.**;java.lang.Enum</code> to the RMI registry filter
<code>sun.rmi.registry.registryFilter</code> automatically if they are
not present when starting a Storage Node Agent.
<p>
The failures would produce stack traces like the following:
</p>
<pre>
Jan 25, 2017 11:15:45 AM java.io.ObjectInputStream filterCheck
INFO: ObjectInputFilter REJECTED: class java.lang.Enum, array length: -1, nRefs: 14, depth: 4, bytes: 768, ex: n/a
KVLite: exception in start: java.rmi.RemoteException: Can't rebind snaService at localhost:5000 csf: &lt;SSLClientSocketFactory name=$|sna|main id=1690670528 connectMs=0 readMs=0 kvStoreName=null clientUse=USER&gt; ssf: &lt;SSLServerSocketFactory backlog=1024 port range=0,0 ssl control = oracle.kv.impl.security.ssl.SSLControl@5836ad63&gt;; nested exception is:
	java.rmi.ServerException: RemoteException occurred in server thread; nested exception is:
	java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is:
	java.io.InvalidClassException: filter status: REJECTED
	at oracle.kv.impl.util.registry.RegistryUtils.rebind(RegistryUtils.java:853)
	at oracle.kv.impl.sna.StorageNodeAgent.bindUnregisteredSNA(StorageNodeAgent.java:974)
	at oracle.kv.impl.sna.StorageNodeAgent.startupUnregistered(StorageNodeAgent.java:793)
	at oracle.kv.impl.sna.StorageNodeAgent.start(StorageNodeAgent.java:624)
	at oracle.kv.impl.sna.StorageNodeAgentImpl.start(StorageNodeAgentImpl.java:133)
	at oracle.kv.util.kvlite.KVLite.startSNA(KVLite.java:298)
	at oracle.kv.util.kvlite.KVLite.start(KVLite.java:524)
	at oracle.kv.util.kvlite.KVLite.start(KVLite.java:513)
	at oracle.kv.util.kvlite.KVLite.main(KVLite.java:647)
	at oracle.kv.impl.util.KVStoreMain$1.run(KVStoreMain.java:190)
	at oracle.kv.impl.util.KVStoreMain.main(KVStoreMain.java:477)
Caused by: java.rmi.ServerException: RemoteException occurred in server thread; nested exception is:
	java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is:
	java.io.InvalidClassException: filter status: REJECTED
	at sun.rmi.server.UnicastServerRef.oldDispatch(UnicastServerRef.java:460)
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:294)
	at sun.rmi.transport.Transport$1.run(Transport.java:200)
	at sun.rmi.transport.Transport$1.run(Transport.java:197)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.Transport.serviceCall(Transport.java:196)
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
	at sun.rmi.transport.StreamRemoteCall.exceptionReceivedFromServer(StreamRemoteCall.java:276)
	at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:253)
	at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:379)
	at sun.rmi.registry.RegistryImpl_Stub.rebind(Unknown Source)
	at oracle.kv.impl.util.registry.RegistryUtils$ExceptionWrappingRegistry.rebind(RegistryUtils.java:1339)
	at oracle.kv.impl.util.registry.RegistryUtils.exportAndRebind(RegistryUtils.java:1184)
	at oracle.kv.impl.util.registry.RegistryUtils.rebind(RegistryUtils.java:849)
	... 10 more
Caused by: java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is:
	java.io.InvalidClassException: filter status: REJECTED
	at sun.rmi.registry.RegistryImpl_Skel.dispatch(Unknown Source)
	at sun.rmi.server.UnicastServerRef.oldDispatch(UnicastServerRef.java:450)
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:294)
	at sun.rmi.transport.Transport$1.run(Transport.java:200)
	at sun.rmi.transport.Transport$1.run(Transport.java:197)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.Transport.serviceCall(Transport.java:196)
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)
	at java.security.AccessController.doPrivileged(Native Method)
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.io.InvalidClassException: filter status: REJECTED
	at java.io.ObjectInputStream.filterCheck(ObjectInputStream.java:1244)
	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1832)
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1713)
	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1829)
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1713)
	at java.io.ObjectInputStream.readEnum(ObjectInputStream.java:1938)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1532)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2231)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2155)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2013)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:422)
	at sun.rmi.transport.tcp.TCPEndpoint.read(TCPEndpoint.java:555)
	at sun.rmi.transport.LiveRef.read(LiveRef.java:292)
	at sun.rmi.server.UnicastRef2.readExternal(UnicastRef2.java:78)
	at java.rmi.server.RemoteObject.readObject(RemoteObject.java:455)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1058)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2122)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2013)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2231)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2155)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2013)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:422)
	... 15 more
</pre>
<p>
[#25923]
</p>
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR1.4.3.10</u></h3>
<h3><a name="NewSQLFeatures4310">New Features in SQL for Oracle NoSQL</a></h3>
<ol>
<li>
JSON data type and querying of JSON data.
<p>
JSON can be used as the data type of a top-level table column, of a nested
record field, or as the element type of an array or map. JSON is an abstract
type: the actual value stored in a field of type JSON can be a valid json
atomic value (integer, long, double, string, boolean, or the json null value),
or an array, or a map. If the value is an array/map, the element type of the
array/map will also be JSON. This implies that, unlike their fixed-schema
counterparts, arrays and maps of JSON can contain heterogeneous elements.
<p>
On input, JSON data is passed to Oracle NoSQL as a string or a text stream.
In both cases, the text is parsed internally, and its constituent parts are
converted to a tree of maps, array, and atomic value instances. Direct
construction of JSON trees is also possible via APIs that construct and
connect maps, array, and atomic values. For persistent storage, the tree
is serialized into a binary format.
<p>
JSON data is schemaless, in the sense that a field of type JSON can have
very different kind of values in different table rows. For example, if
"info" is a top-level table column of type JSON, in one row the value of
"info" may be an integer, in another row an array containing a mix of doubles
and strings, and in a third row a map containing a mix of other maps, arrays,
and atomic values. Furthermore, the data stored in a JSON column or field, can
be updated in any way that produces a still valid JSON instance. As a result,
each JSON tree (either in main memory or as a serialized byte array on disk)
is self-describing with regard to its contents.
<p>
SQL for Oracle NoSQL can operate seamlessly on both data models: the
strongly typed data supported in prior releases, as well as the schemaless
JSON data. Tables can mix data from both models and all of the DML expressions
can operate on both kinds of data.
[#25455]
<p>
Indexing JSON data is not supported yet.
<p>
[#25455] [#25436] [#25437] [#25727] [#25197] [#25731] [#25681] [#25683]
[#25688] [#25559] [#25740] [#25629] [#25669] [#25671]
</li>
<li>
New kinds of expressions in SQL for Oracle NoSQL.
<ul>
<li>
NOT operator.
Negates a boolean value. [#25455]
</li>
<li>
EXISTS operator.
Checks whether an expression returns at least one value. [#25455]
</li>
<li>
IS OF TYPE expression.
Checks whether a value or a set of values has a specified data type. [#25437]
</li>
<li>
CAST expression.
Casts, if possible, a value or set of values to a specified data type. [#25436]
</li>
<li>
Map constructor.
Constructs a new map value. Both the field names and the field values may
be computed by other expressions. Field values may be heterogeneous.
[#25455] [#25629]
</li>
<li>
CASE expression.
Implements if-then-else semantics. [#25197]
</li>
<li>
json null value and true/false literals.

The (case-insensitive) keywrods null, true, and false can be used as literals
in a query. These are the only reserved keywords in SQL for NoSQL. DML operators
and expressions were extended, if needed, to handle the new json null value.
[#25455] [#25731] [#25683]
</li>
</ul>
<li>
TIMESTAMP data type and values.
A timestamp represents a point in time. It contains a date and a time. The
date part has 3 components: year, month, and day of month. The time part has
4 components: hour, minute, second, and a decimal fraction of the second.
The number of digits used to represent the fraction of a second is called
the precision of the timestamp, and it can be a number between 0 (no fractional
second) to 9 (nano second precision). Fields of timestamp types can be indexed
and accessed in SQL queries. The SQL comparison operators have been extended
to compare timestamps, and the cast operator can cast strings of appropriate
formats to timestamp values.
[#24775] [#25707]
</li>
</ol>
<h3><a name="SQLChanges4310">Other Changes in SQL for Oracle NoSQL</a></h3>
Several of the pre-existing expressions in SQL for Oracle NoSQL have changed
in this release, mostly to make such expressions more "JSON friendly". Some
of these changes are backwards incompatible and applications may have to
change their queries as a result.
<ol>
<li>
Implicit array construction in SELECT clause
If any expression in the SELECT list returns more than one values, an array
is constructed to contain the values. [#25455] [#25629]
</li>
<li>
Several changes in path expressions, both syntactic and semantic.
<ul>
<li>
Field steps accept atomic items as input.
A field step returns an empty result if its input is an atomic item. Previously,
an error would be raised in this case. [#25455] [#25688]
</li>
<li>
New syntax for filtering the entries of maps and records.
[#25455] [#25575] [#25740] [#25724]
<p>
Previously, square brackets ([&lt;cond>?]) were used to filter the values of
both maps and arrays. Furthermore, there was no way to filter map entries
and return the qualifying map keys (instead of the values). Finally, there
was no way to filter the entries of records. This release introduces the
.keys(&lt;cond>?) and .values(&lt;cond>?) path steps. They are both supposed to
work primarily with maps and records. .keys(&lt;cond>?) selects the map/record
entries that satisfy the condition (if any) and returns the keys (field names)
of these entries. .values(&lt;cond>?) selects the map/record entries that satisfy
the condition (if any) and returns the field values of these entries.
If the input is an array, .keys(&lt;cond>?) and .values(&lt;cond>?) are applied
recursively on the array elements. If the input is an atomic item, the result
is empty.
<p>
This change also affects DDL statements that use paths, because the syntax for
DDL paths is a subset of the DML syntax for paths. Most importantly, CREATE
INDEX statements must use the new syntax to index maps. Furthermore, applications
that access multi-key map indexes directly, via the TableIterator APIs, must be
updated to use the new path syntax to name the fields of the IndexKey instances
they build to probe the indexes (alternatively, the IndexKey fields can be
accessed by their position as well).
</li>
<li>
Filtering and slicing arrays.
The square brackets are still used to filter or slice arrays. They work the same
way as before on arrays, except that the variable $elementPos has been renamed
to $pos. However, in 4.3, the behavior is different if the input is not an
array: in this case, an array is created on the fly, and the input item is
inserted into that array; then, the filtering/slicing step operates on that
array the same way as with any other array. [#25455] [#25575] [#25740]
</li>
</ul>
</li>
<li>
Change in how the value comparison operators handle empty operands.
Previously, if an operand returned the empty result, the result of the comparison
would also be empty. In 4.3, if both operands return the empty sequence, the
operands are considered equal (so true will be returned if the operator is =,
<=, or >=). If only one of the operands returns empty, the result of the
comparison is false unless the operator is !=.
[#25763]
</li>
<li>
Change in how the value comparison operators handle incomparable values.
Previously, an error would be returned in this case. In 4.3, false is returned
as the result of the comparison.

[#25455] [#25681]
</li>
<li>
Change in how the sequence-comparison operators handle the SQL NULL
Previously, if any of the operand sequences contained NULLs, those NULLs would
just be ignored. In 4.3, if a matching pair of items is not found, and either
of the sequences contains a NULL, the result of the comparison is NULL (instead
of false).
[#25455]
</li>
<li>
Changes in array constructors.
In 4.3, queries can construct arrays containing heterogeneous items. Furthermore,
if an input expression returns an SQL NULL, the NULL is ignored (not inserted in
the constructed array). Previously, both heterogeneous items and NULLs would
cause an error to be raised.

[#25455] [#25730] [#25629]
</li>
</ol>
<h3><a name="OtherNewFeatures4310">Other New Features</a></h3>
<ol>
<li>
The information that is published to the &lt;kvroot>/log/&lt;storename&gt;.stats
and &lt;kvroot&gt;/log/&lt;storename&gt;.perf files is also available through
the NoSQL JMX agent, via the standard javax.management.Notification mechanism.
See the javadoc for oracle.kv.mgmt.jmx.StorageNodeMXBean for more information.
[#24979]
</li>
<li>
The "makebootconfig" command now enables security by default.
The <code>-store-security</code> flag is now optional, and has the
value <code>enable</code> if not specified. You can still configure a
non-secure store by specifying <code>none</code> as the value of this
flag. In addition, the "kvlite" command now creates a secure store by default.
You can create a non-secure store by specifying <code>-secure-config
disable</code>.  [#25440]
</li>
</ol>
<h3><a name="BugFixes4310">Bug and Performance Fixes</a></h3>
<ol>
  <li>Strings used as keys in the MapValue type are now case-sensitive.
  Previously they were case-insensitive, which was a bug. Applications that
  assume case-insensitivity in MapValue keys may be affected. Field names in
  Record values remain case-insensitive, as documented. [#25598]
  </li>
  <li> Tables created with map of json and array of json types will now work
  properly. Previously rows of these types would be created but could not
  be deserialized and retrieved. [#25559]
  </li>
  <li> Removed the no-longer needed MapValue.putNull method and added
  methods on MapValue, ArrayValue, RecordValue and FieldDef, to allow
  construction of JSON null values for insertion into JSON maps and arrays.
  [#25671]
  </li>
  <li> Fixed a problem where, if a table was created with fields other than
  primary key fields and it was evolved such that it contained only primary
  key fields, queries on the table could fail to return data. [#25766]
  </li>
  <li> Fixed a problem that could result in a NullPointerException on a
  RepNode processing a query if a different RepNode were to become unavailable.
  [#25792]
  </li>
  <li> Fixed a problem that could result in an ArrayIndexOutOfBoundsException
  when specifying a ReturnRow on a table where the primary key fields are not
  declared as the first fields of the table.
  [#25819]
  </li>
  <li> Implemented compatibility with pre-4.3 DDL syntax for creating map
  indexes. Syntax allowed now includes:
  <ul>
    <li>path-to-map.keys() and path-to-map.values(), which are the current/new
    syntax.
    <li>KEYOF(path-to-map)</li>
    <li>KEYS(path-to-map)</li>
    <li>ELEMENTOF(path-to-map), path-to-map[]</li>
  </ul>
  In addition, code has been added to handle pre-4.2 clients operating against
  4.2 and later indexes that support null values.
  [#25864]</li>
  <li>
  Added kvstore-ee.jar to the kvclient.jar manifest so that the Enterprise
  Edition works without the need to fix the classpath. This works in the
  Community Edition as well, where kvstore-ee.jar does not exist at all.
  </li>
<li>
Fixed a bug that "create fulltext index if not exists" throws exception if the index
exists, it should complete successfully but not require execution.
[#25664]
</li>
<li>
Fixed a query bug where an "always false" filtering step, like
<code>t.array[false].field</code>, would actually be evaluated as an "always
true" step (<code>t.array[false].field</code>). [#25708]
</li>
<li>
Fixed a query bug that would remove the entire FROM clause if the table name or
table alias was not used anywhere in the rest of the query. This would cause the
query compiler to throw an ArrayIndexOutOfBoundsException. [#25768]
</li>
<li>
Fixed a query bug that would cause a NPE when the table queried is a child table
and is used without a table alias. [#25645]
</li>
<li>
Fixed a query bug that could cause an ArrayIndexOutOfBoundsException if the
compiler could deduce that an expression would always return an empty result.
For example, an ArrayIndexOutOfBoundsException would be thrown by this query:
<code>select id[10:0] from foo f</code>[#25673]
</li>
<li>
Fixed a query bug: The fact the table names are case insensitive was not always
taken into account in resolving column reference in a query. [#25747]
</li>
<li>
Fixed a bug that would cause an IllegalCommandException to be raise for a
valid ALTER TABLE statement, when an index on an array or map existed on
the same table. [#25782]
</li>
<li>
Fixed a query bug where a NULLS LAST directive in the order-by was being
ignored, if the sort direction was DESC. Instead, an error should be thrown
in this case. [#25785]
</li>
<li>
Added new methods to the oracle.kv.table.FieldValueFactory class for
creating a TimestampValue from a Timestamp, String, or components:
<pre>
public static TimestampValue createTimestamp(Timestamp v, int precision);
public static TimestampValue createTimestamp(String s, int precision);
public static TimestampValue createTimestamp(int year, int month, int day,
                                             int hour, int minute,
                                             int second, int nano,
                                             int precision);
</pre>
<p>
Added new methods to the oracle.kv.table.TimestampValue interface to
return the components of a Timestamp value:
<pre>
public int getYear();
public int getMonth();
public int getDay();
public int getHour();
public int getMinute();
public int getSecond();
public int getNano();
</pre>
[#25654]
</li>
<li>
Fixed a bug that could result in failure in reading records from a table which
contains a map/array field with min/max contraints on its element after
upgrade from KV 3.0 to KV 4.3. [#25799]
</li>
<li>
Fixed a problem that could result in failure in table evolving when adding a
new field that contains a nested fixed_binary, enum or record field. [#25793]
</li>
<li>
Changed query shell output default from COLUMN to JSON. [#25700]
</li>
<li>
Restricted numeric type mapping in JSON to integer, long, and double.
This eliminates float as an option in JSON. [#25699]
</li>
<li>
Improved the error checking performed when processing DDL commands to
provide clearer feedback when the requested command uses a feature that
is not supported on all of the nodes in the store because of the nodes
still need to be upgraded.  [#25712]
</li>
<li>
Added checks to confirm that all shards have quorum and a majority of
nodes in each zone being changed are online before deploying a topology
that changes the type of one or more zones.  This change makes it more
likely that the topology change will detect and report, prior to making
any changes, that, given the current lack of availability of certain
replication nodes, the command will fail.  [#24503]
</li>
<li>
Fixed upgrade problem where primary key fields marked as not nullable
would cause serialization issues in queries causing them to fail. Primary keys
can no longer be explicitly marked a not nullable or with a default because
they are implicitly not nullable and cannot have default values. [#25533]
</li>
<li>
Fixed a memory leak that could, in some cases, cause an OutOfMemoryError
to be thrown when a replication node needs to do a Network Restore when
performing replication. [#25649]
</li>
<li>
Improved the ability of the Admin CLI to validate new SN parameters when
performing 'plan change-parameters' and 'change-policy' commands.  With
this change, commands that specify invalid SN parameters will fail
without modifying the parameters, rather than having the incorrect
parameters prevent SNs from being restarted.  [#25636]
</li>
<li>
Fixed a problem in the Load utility that prevented it from restoring
security information for a secure store. [#24642]
</li>
<li>
Fixed a problem that could prevent master rebalancing from working
correctly because of excessive logging by reducing redundant debug
logging entries.  [#25625]
</li>
<li>
Fixed a problem in Hive and Big Data SQL query processing where a the
SELECT clause from one query might affect the behavior of the next query
if that query did not specify a SELECT clause. [#25626]
</li>
</ol>
<h3><a name="Storage4310">Storage Engine Changes (JE 7.3)</a></h3>
<ol>
<li>
JE's low-level operation throughput statistics have been simplified and
improved. Previously, these statistics represented API calls rather than CRUD
operations and this caused confusion when a single API call performed multiple
CRUD operations. Also, some CRUD operations (key search operations on any RN
in a shard, all operations on a replica RN) were missing, and no operation
statistics were included in the admin .stat files. The JE throughput stats were
previously only visible via the env/je.stat.csv file.
<p>
Now, the following statistics representing CRUD operations are output in the
admin .stat files as well as env/je.stats.cvs, and are included for all RNs,
including replicas.  The new statistics should be considered internal
operations or internal units of work. This approach is used to allow
correlating internal operations to performance measurements.
<pre>
    priSearch
    priSearchFail
    secSearch
    secSearchFail
    priPosition
    secPosition
    priInsert
    priInsertFail
    secInsert
    priUpdate
    secUpdate
    priDelete
    priDeleteFail
    secDelete
</pre>
<p>
[#23792]
</li>
<li>
Data corruption is now detected as soon as possible by a new internal JE
background task. This detects data corruption caused by media/disk failure by
reading the log sequentially and verifying checksums. This is the equivalent of
running the JE DbVerifyLog utility, but it is performed automatically and
periodically on every RN.
<p>
By default, verification is on and occurs once a day at midnight, local time.
Although this should not normally be necessary, verification can be disabled
or the verification schedule can be changed using the JE
EnvironmentConfig.ENV_RUN_VERIFIER, VERIFY_SCHEDULE and VERIFY_LOG parameters
(je.env.runVerifier, je.env.verifySchedule and je.env.verifyLog).
<p>
When corruption is detected, the RN will be shut down and will not be restarted
automatically by the SN. A SEVERE level exception will be logged in the RN's
log and the exception message will contain the LOG_CHECKSUM token. Manual
intervention by an administrator is necessary in this situation. We do not
recommend restarting the RN without first replacing the media and/or forcing a
network restore from another node in the shard.
<p>
The advantage of performing verification frequently is that a media/disk
problem may be detected sooner than it would be otherwise. This means that the
network restore can be done while the other RNs in the shard are up, minimizing
exposure to additional failures.
<p>
[#25221]
</li>
<li>
Repeat-fault reads have been eliminated for LNs (Btree leaf nodes, which
represent record data on disk.) Previously, if an LN's on-disk size was greater
than 4kB, two reads would be required to fetch the LN from disk. The first read
would always include the log entry header, which contains the exact entry size,
and the second read (repeat-read) was needed to read the entire entry. The
second read includes the entire entry, although normally it will be cached by
the file system.
<p>
Now, only a single read is needed because the last logged size for LNs is now
stored in the Btree, and this can be used to determine the exact size needed
for the read buffer.  The benefits of this change are 1) the amount of IO is
reduced (although the repeat-read normally reads data that is cached by the
file system), and 2) the statistics describing IO activity are simpler to
analyze without the repeat-reads in the picture.
<p>
Note that INs (Btree internal nodes) can still cause repeat-reads when they are
fetched, because the last logged size for INs is not stored in the Btree.
However, in most applications all INs are cached and therefore INs are rarely
read from disk (except during a cache warm-up period). The nRepeatFaultReads
statistic (EnvironmentStats.getNRepeatFaultReads) indicates the number of
repeat-reads.
<p>
[#25387]
</li>
<li>
A network restore (data copy from one RN to another RN in a shard) may be
instigated for various reasons, for example, when a replica has been down for a
long time period and is then brought up again.  Previously, if a network
restore was interrupted and the RN was then restarted, the RN could have
attempted to operate with a partial data set, causing unpredictable results.
Now, the use of a partially restored RN is not possible, and the network
restore will automatically be restarted.  If a network restore is interrupted,
the RN's env directory will contain a marker file named 0x7fffffff.jdb, which
is recognized and managed by JE.
<p>
[#25369]
</li>
<li>
Fixed a bug that prevented the request timeout for a write operation from being
honored. Under certain circumstances, the request took longer than the
specified timeout.
[#25692]
</li>
</ol>
<h3><a name="Deprecation4310">Deprecated and Removed Features</a></h3>
<ol>
<li>
The NONE_REQUIRED_NO_MASTER
(oracle.kv.Consistency.NONE_REQUIRED_NO_MASTER) consistency policy that
requires that a read operation be serviced on a replica, never the
Master, is deprecated in this release. Applications should use the
NONE_REQUIRED consistency policy or KVStoreConfig.setReadZones instead.
</li>
<li>
The web-based Admin Console feature has been removed in this release.
Since removal of this feature also eliminates the need for the Admin's
http port, the -admin parameter of the makebootconfig command has been
deprecated.
</li>
<li>
The capability to monitor Oracle NoSQL Database via SNMP has been
removed in this release. As a result, several commands have changed
syntax; in particular makebootconfig and the change-params commands no
longer allow SNMP as an option, and have lost their SNMP-specific
flags for specifying pollport, traphost, and trapport.
</li>
</ol>
<!-- ============================================================ -->
<h3 align="center"><u>Changes in 12cR1.4.2.14</u></h3>
<h3><a name="NewFeatures4214">New Features</a></h3>
<ol>
<li>
This release introduces the Basic Edition. Basic Edition (BE) only
contains the server and is distributed under the Oracle Database
Enterprise Edition license.  The Basic Edition is functionally identical
to NoSQL Database Community Edition. [#25663]
</li>
</ol>
<h3><a name="BugFixes4214">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fix a bug that was introduced in release 4.2.10 that results in failures when
executing some Admin commands. The bug arises after an upgrade, when the store
has explicit storage directories. These are the directories used by
Replication Nodes and are specified via the <code>plan change-storagedir</code>
CLI command or the <code>makebootconfig</code> utility. After the upgrade
the <code>verify configuration</code> and some <code>plan</code> CLI commands
will fail, with an error reporting that a parameter cannot be represented as
long. [#25689]
</li>
<li>
 Fix a bug in the EXPORT utility where it no longer hangs when the number of
 tables exceeds the fixed number of threads allocated for the operation.[#25717]
</li>
<li>
Oracle NoSQL Database server will only verify the major and minor versions of
Oracle Java SE and not the patch version at <code>makebootconfig</code>
time. [#25647]
</li>
<li>
Primary keys are implicitly not nullable but also have no default values. Marking
primary key fields as not nullable or with default values is no longer allowed and
the table schema reflects that. This also fixed an upgrade issue related to allowing
this in earlier releases.
[#25533]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.4.2.10</u></h3>
<h3><a name="NewFeatures4210">New Features</a></h3>
<ol>
<li>
The topology builder has been enhanced to take storage directory sizes into
account when laying out shards and partitions. What this means is a RepNode
with larger storage directory will be assigned a larger portion of the store's
data than a RepNode with smaller directory. Storage directory size layout will
happen automatically during elasticity operations when directory sizes have
been configured. To enable this feature on an existing store the size of
storage directory for each RepNode needs to be set, usually by the
administrator. Then a rebalance, redistribute, or contract topology operation
will adjust the shards and/or partitions to account for differences in
directory sizes.
<p>
To set or change the directory size on existing stores there is a new
<code>-storagedirsize</code> flag on the <code>plan change-storagedir</code>
Admin CLI command. To set the directory size on a new configuration the flag
<code>-storagedirsize</code> has been added to
<code>makebootconfig</code>. Both flags can accept size values with units, for
example: "1_TB" can be used to specify a 1 terabyte directory.
[#24981] [#25166]
</li>
<li>
DDL operations are now logged with the standard audit logging prefix,
"<i>timestamp</i> KVAuditInfo", to support searching and filtering.
[#25460]
</li>
<li>
Added Arbiter functionality. Using this feature, KVStore DML operations using
Durability.ReplicaAckPolicy.SIMPLE_MAJORITY durability succeeds even with one
RepNode node unavailable in a shard. The data written with "relaxed" durability
will be migrated to the other RepNode when it becomes available. Also, only the
node with the "relaxed" durability data can become master until the data is
migrated to the other RepNode. This fact relaxes the write availability to a
single node failure as opposed to write availability with any node failure
(on a shard basis).  [#20590]
</li>
<li>
Added the new 'topology contract' command to the Administrative CLI.
This command provides support for removing a specified set of storage
nodes from the topology and shrinking the size of the store by removing
shards.  Also added the new 'pool leave' command to simplify the process
of specifying which storage nodes should be removed.  [#24425]
</li>
<li>
Secondary indexes now contain entries for rows that have null values for
index fields. This serves two purposes:
<ol>
  <li>It means that an index will have an entry for every row in the table,
  regardless of values, which was not true previously</li>
  <li>It makes composite indexes (those with multiple fields) more useful
  because an application can use a partial key and know that rows will
  not be skipped because of a null in another field</li>
</ol>
<p>
This change required a modification of the format of the index databases
themselves. All new indexes will have this new format and will support
null values. Existing indexes cannot support null values and will continue
to operate as they have in the past, without nulls. For this reason, it is
recommended that indexes be dropped and re-added if null values are desired.
[#24785]
</li>
<li>
Added new policy parameters that permit administrators to enforce
password complexity requirements when users create a new passwords or
change existing passwords.  [#24985]
</li>
<li>
Added new position-based put and get methods on RecordValue that work more
efficiently than the name-based methods if the application knows the position
of a field within a RecordValue. [#25214]
</li>
<li>
Includes a preview release of Java API support for a field type of JSON. Use of
this type is for preview only.  Any stores that use this type will <em>not</em>
be supported, and must be removed and not re-used when full support is
provided. This preview includes
<ul>
  <li> The ability to declare a field as type JSON. Doing so means that any type
  that can be interpreted as valid JSON can be used in this field, including the
  numeric types, boolean, string, map (JSON object), array (JSON array).
  </li>
  <li> Methods on FieldDef and FieldValue and related types to put and get
  JSON values as well as to navigate into JSON fields in a Row.
  </li>
</ul>
The preview release has the following known limitations and issues, which can
result in failures or unpredictable results:
<ul>
  <li>Indexes into JSON are not yet supported. This is a feature that will be
  supported in a future release.
  </li>
  <li>Queries involving JSON are not yet supported, and will fail to compile
  and/or execute. This is a feature that will be supported in a future release
  </li>
  <li> Not all numeric values in JSON are supported. Any number that cannot be
  represented as a long or double will fail to be handled. This feature will be
  supported in a future release.
  </li>
  <li>Map keys are case-insensitive, which extends to JSON objects. This is a
  bug and will be fixed in a future release.
  </li>
  <li>Support for declarations of MAP(JSON) and ARRAY(JSON) in fields is not
  complete. These declarations will work in DDL statements, but rows in such
  tables will not be usable and must be avoided. This is a bug and will be
  fixed in a future release.
  release.
  </li>
</ul>
[#23589]
</li>
</ol>
<h3><a name="BugFixes4210">Bug and Performance Fixes</a></h3>
<ol>
<li>
Enhanced the Load utility to use a disk-ordered cursor to read entries
from multiple databases of snapshot.  This change improves the input
throughput, thus improving the overall performance of loading. [#25294]
</li>
<li>
Fixed a problem where specifying a large value for the rnHeapMaxMB
storage node parameter could result in the replication nodes hosted by
that storage node being given heap sizes that do not support compressed
object references, even though a smaller heap size that supports
compressed object references would be more efficient. [#25472]
</li>
<li>
Fixed a bug that the TextIndexFeeder failed to act accordingly when the
topology changed and partition migrated between replication groups. The
fix ensures that the TextIndexFeeder will stream all writes to
Elasticsearch when the store undergoes elasticity operations. [#25334]
</li>
<li>
Fixed a problem where an unexpected InsufficientAcksException caused by
a lack of shard quorum during an access control change could cause a
replication node to be restarted. [#25439]
</li>
<li>
Fixed a problem where a lack of shard quorum during an access control
change could result in a temporary deadlock and an unexpected
InsufficientAcksException. [#25442]
</li>
<li>
Fixed a problem where an upgrade of a 3.x version store would fail if
the store contained a table that previously had been schema
evolved. [#25532]
</li>
<li>
Disable full text search (FTS) in secure store. If a KV store is
configured as a secure store, FTS will be disabled and user will not be
allowed to register an external Elasticsearch cluster. In addition, for
a KV store in which FTS is already enabled, user will not be able to
re-configure the store from a non-secure to a secure store. Instead,
she need to drop all text indices, deregister the external Elasticsearch
cluster, and re-configure the non-secure store to a secure store.
[#25245][#25246]
</li>
<li>
RepNodes are now configured to use the Java option -XX:+AlwaysPreTouch
by default on Linux platforms when using the Oracle Java virtual
machine. This change slows Java startup slightly (roughly 10 sec for a
32GB heap using 4K pages and less than 1 sec if using 2MB Large pages),
but reduces subsequent latency pauses as larger amounts of heap storage
are used by the RepNode. [#25161]
</li>
<li>
RepNodes now use the Garbage First Garbage Collector (G1 GC) by default.
The G1 GC typically provides shorter GC pause times than the Concurrent
Mark Sweep (CMS) collector, which was the previous default.  As a
result, the G1 GC should reduce both average and peak latency for store
operations, and improve throughput.
<p>
Applications can revert to the previous GC settings using the CMS GC by
including <code>-XX:+UseConcMarkSweepGC</code> in the value of the
RepNode <code>javaMiscParams</code> parameter. [#24695]
</li>
<li>
The representation of IndexKey has been changed in an incompatible manner.
The reason is a combination of ease of use, function, and performance.
Prior to this release an IndexKey shared schema (the RecordDef) with
the corresponding Row objects for the same table. The old
representation was confusing and cumbersome in the face of indexes on fields
in deeply nested records, maps, and arrays. The new representation is a
<em>flattened</em> version of the fields indexed, with only a single level
of structure, where the field name is a path to the indexed field.
<p>
Consider this table and index:
<pre>
  CREATE TABLE user (id INTEGER, PRIMARY KEY(id), address RECORD(city String, state String))
  CREATE INDEX City on user(address.city)
</pre>
Prior to this release the Java code required to create an IndexKey used to
iterate the City index would look like this:
<pre>
  /* assume userTable is a handle on the table */
  Index index = userTable.getIndex("City");
  IndexKey indexKey = index.createIndexKey();
  indexKey.createRecord("address").put("city", "Chicago");
</pre>
Note the need to create the <em>structure</em> of the record to use it.
The new flattened representation is:
<pre>
  /* assume userTable is a handle on the table */
  Index index = userTable.getIndex("City");
  IndexKey indexKey = index.createIndexKey();
  indexKey.put("address.city", "Chicago");
</pre>
The syntax for indexes involving maps and arrays is as follows:
<ul>
  <li> Map keys:  <em>keys(path-to-map-field)</em>.
  For example <em>keys(this_is_a_map)</em></li>
  <li> Map values: <em>path-to-map-field[]</em>. For example,
  <em>this_is_a_map[]</em>.
  If the index is on a field within a map of records it would look like
  <em>map_of_records[].path-to-field</em>
  <li> Array values: these are similar to map values and require use of "[]":
  <em>path-to-array[]</em>.
</ul>
The same syntax rules are used for these paths as are used in the
statements that create the indexes themselves.  Similar syntax works for
indexes on other complex types such as maps and arrays.
<p>
This is an incompatible change and will require any applications that use indexes
on complex types to be modified to use the new format and syntax. If unchanged,
errors will be seen as IllegalArgumentException thrown from
IndexKey.put*() calls as well as FieldRange construction for such fields.
Applications that do not use indexes on records, maps, or
arrays will continue to work without modification. See the documentation for
details on how to represent paths to complex index fields.
[#25090]
</li>
<li>
Changed to allow an existing client to access store without reopening a KVStore
handle during updating SSL certificate of a secure store.  [#25062]
</li>
<li>
The exception, KVSecurityException, extended FaultException, which was not
correct, according to the contract for FaultException. KVSecurityException
now extends RuntimeException.
<p>
This is a minor API change but it affects the possible exceptions thrown
from most of the methods on the KVStore and TableAPI interfaces. They can
now throw KVSecurityException, which no longer falls under the umbrella of
FaultException. Applications that need to catch one or more of the
KVSecurityException instances &mdash; UnauthorizedException,
AuthenticationRequiredException, and AuthenticationFailureException &mdash;
need to do so explicitly. [#24967]
</li>
<li>
To make text indexing more efficient, index population now uses
Elasticsearch's bulk operations interface. [#25040]
</li>
<li>
Duplicate results from map and array indexes have been eliminated. Previously,
when performing a query involing map value or array indexes, it was possible
to see duplicate results for rows that have multiple independent entries in
the index. This would occur when using the index iteration methods as well.
These duplicates are now removed so that the user will see only one instance
of each matching record. [#25023]
</li>
<li>
To avoid a compatibility issue, NoSQL Database by default now connects
to an Elasticsearch cluster via Elasticsearch's Transport Client
rather than its Node Client. [#25146]
</li>
<li>
Records that contain only empty strings in text-indexed fields are now
correctly added to the text index. Previously, such records were
omitted. [#25058]
</li>
<li>
Two race conditions that could occur during text index creation have
been fixed. [#25093] [#25182]
</li>
<li>
The size of the service port range required for storage nodes has been
reduced.  Previously, when -servicerange was used when calling
makebootconfig to configure a storage node that hosts an admin, the
range required 8 ports for a non-secure deployment.  That number has now
been reduced to 3.  For details, see the documentation for the
servicePortRange parameter in the section on
<a href="oradoc-lookup:/NSADM-GUID-E5F09161-ABD3-4F8A-8EF8-26271EB82116/Storage+Node+Parameters">
Storage Node Parameters</a> in the Admin Guide. [#24708]
</li>
<li>
Allow the anonymous user to use a DDL statement in the Admin CLI to
create the first user for a secure store. [#25051]
</li>
<li>
Fixed a problem where a client with an incorrect set of helper hosts
could cause replication nodes to fail and not restart.  The problem
could occur if the client was configured with helper hosts from
unrelated stores and attempted to forward topology updates obtained from
one store to another store.  Such an occurrence is now logged but no
longer causes the replication node to fail.  [#24693]
</li>
<li>
Changed the maximum value of the memoryMB parameter from 500 GB to 128
TB, to accommodate machines with large amounts of memory.  [#25017]
</li>
<li>
Fixed a problem in the statistics gathering code that could cause a
replication node to fail because of an unexpected InterruptedException:
<pre>
2016-04-12 13:34:42.678 UTC INFO [rg1-rn3] Exception accessing the migration db {0}
com.sleepycat.je.ThreadInterruptedException: (JE 7.0.5) Environment must be closed, caused by: com.sleepycat.je.ThreadInterruptedException: Environment invalid because of previous exception: (JE 7.0.5) rg1-rn3(3):/scratch/yfei/nftest/dm_mode/kv_isolate_rn/scratch/kvroot/mystore/sn3/rg1-rn3/env java.lang.InterruptedException THREAD_INTERRUPTED: InterruptedException may cause incorrect internal state, unable to continue. Environment is invalid and must be closed.
       at com.sleepycat.je.ThreadInterruptedException.wrapSelf(ThreadInterruptedException.java:135)
       at com.sleepycat.je.dbi.EnvironmentImpl.checkIfInvalid(EnvironmentImpl.java:1720)
       at com.sleepycat.je.Transaction.checkEnv(Transaction.java:886)
       at com.sleepycat.je.Transaction.commit(Transaction.java:350)
       at oracle.kv.impl.rep.migration.PartitionMigrations.fetch(PartitionMigrations.java:295)
       at oracle.kv.impl.rep.migration.MigrationManager$3.call(MigrationManager.java:1286)
       at oracle.kv.impl.rep.migration.MigrationManager$3.call(MigrationManager.java:1282)
       at oracle.kv.impl.rep.migration.MigrationManager.tryDBOperation(MigrationManager.java:1464)
       at oracle.kv.impl.rep.migration.MigrationManager.getMigrations(MigrationManager.java:1282)
       at oracle.kv.impl.rep.migration.MigrationService.pendingSources(MigrationService.java:180)
       at oracle.kv.impl.rep.migration.MigrationManager.awaitIdle(MigrationManager.java:445)
       at oracle.kv.impl.rep.table.MaintenanceThread.run(MaintenanceThread.java:149)
</pre>
[#25046]
</li>
<li>
Fixed an unhandled security exception in the master rebalancing code
that could cause a replication node to fail unexpectedly when a storage
node is being restarted. [#25134]
</li>
<li>
Fixed a problem where a replication node in a secure store could exit
with a NullPointerException if it received a request before it is fully
initialized.
<pre>
2016-05-03 18:08:42.191 UTC SEVERE [rg5-rn3] Process exiting
java.lang.NullPointerException
at oracle.kv.impl.rep.login.KVSessionManager.initializeKVStore(KVSessionManager.java:495)
at oracle.kv.impl.rep.login.KVSessionManager.isReady(KVSessionManager.java:259)
at oracle.kv.impl.rep.login.KVSessionManager.resolve(KVSessionManager.java:425)
at oracle.kv.impl.security.login.TokenResolverImpl.resolvePersistentToken(TokenResolverImpl.java:216)
at oracle.kv.impl.security.login.TokenResolverImpl.resolve(TokenResolverImpl.java:168)
at oracle.kv.impl.security.login.TokenVerifier.verifyToken(TokenVerifier.java:97)
at oracle.kv.impl.security.AccessCheckerImpl.identifyRequestor(AccessCheckerImpl.java:141)
at oracle.kv.impl.security.ExecutionContext.create(ExecutionContext.java:181)
at oracle.kv.impl.security.SecureProxy$CheckingHandler$1.execute(SecureProxy.java:609)
at oracle.kv.impl.security.SecureProxy$CheckingHandler$1.execute(SecureProxy.java:600)
at oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:148)
at oracle.kv.impl.rep.admin.RepNodeAdminFaultHandler.execute(RepNodeAdminFaultHandler.java:124)
at oracle.kv.impl.security.SecureProxy$CheckingHandler.invoke(SecureProxy.java:598)
at oracle.kv.impl.security.SecureProxy.invoke(SecureProxy.java:144)
at com.sun.proxy.$Proxy9.getTopoSeqNum(Unknown Source)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:323)
at sun.rmi.transport.Transport$1.run(Transport.java:200)
at sun.rmi.transport.Transport$1.run(Transport.java:197)
at java.security.AccessController.doPrivileged(Native Method)
at sun.rmi.transport.Transport.serviceCall(Transport.java:196)
at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)
at java.security.AccessController.doPrivileged(Native Method)
at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
at java.lang.Thread.run(Thread.java:745)
</pre>
[#25092]
</li>
<li>
Added TableOperationResult.getPreviousExpirationTime() to return the
expiration time of a previous row, if defined. Previously the expiration
time was available from the previous Row, which was a partial solution.
[#25229]
</li>
<li>
Fixed a problem that client may push update of topology without signature
against a secure store. Before this fix, server audit logging may have warning
entries like:
<pre>
2016-06-13 06:53:32.476 UTC SEC_WARNING [rg2-rn1] Empty signature. Verification failed for topology seq# 38
</pre>
[#25273]
</li>
<li>
Fixed a bug where an application that used a KVStore handle from an
old, defunct store, against a new, recreated store on the same hosts
with the same ports could cause replication node restarts in the new
store. Now the store is unaffected and the application will receive an
oracle.kv.StaleStoreHandleException, letting it know that the handle
should be closed and reopened.
[#24693]
</li>
</ol>
<h3><a name="Utilities4210">Utility Changes</a></h3>
<ol>
<li>
If users need to configure Kerberos manually, for example when using
Active Directory, they can now specify "none" for the "-kadmin-path"
argument in the makebootconfig and securityconfig commands. In this
case, the keytab is not automatically generated and must be generated
and copied manually. [#25445]
</li>
<li>
The <code>verify configuration</code> Administrative CLI command now
shows a warning if a failed deployment resulted in a store topology with
shards that have no partitions. [#22098]
</li>
<li>
Added security configuration utilities:
<ul>
<li>security config update<br/>
Update security parameters in given security configuration.
<li>security config verify<br/>
Verify the consistency and correctness of given security configuration.
<li>security config show<br/>
Print out all information of given security configuration.
</ul>
[#24948]
</li>
<li>
Enhanced "oracle.kv.util.Load" utility to support loading data from multiple shard backup
directories concurrently, and use bulk put to improve performance of loading data.
[#25085]
</li>
<li>
Running the admin web service is no longer supported for secure stores,
which results in the following changes to utilities:
<ul>
<li>Using the <code>makebootconfig</code> command to configure a storage
node for a secure store must specify <code>-runadmin</code> if the
storage node should run an admin, and either specify the admin port as 0
or leave the admin port unspecified
<li>An admin deployed on a secure store with <code>plan
deploy-admin</code> must specify 0 for the value of
the <code>-port</code> flag
<li>The <code>securityconfig add-security</code> command fails when
performed against a non-secure store that has an admin with an admin web
service
<li>The <code>plan change-parameters</code> command fails when
attempting to specify a non-zero admin port on a secure store
<li>The <code>plan migrate-sn</code> command fails when attempting to
migrate a storage node with a non-zero admin port on a secure store
</ul>
<p>
Storage nodes in a secure store that run an admin with the admin web
service enabled will not start successfully after upgrading to this
release.  Make sure to disable the admin web service before performing
an upgrade.
<p>
If you attempt to upgrade a storage node for a secure store that has the
admin web service enabled, the node will fail to start with a message
like:
<pre>
Failed to start SNA: Cannot start the storage node agent for a secure
store when the storage node has an admin with the admin web service
enabled.  Please start this storage node and reconfigure the storage
node to disable the admin web service, or disable store security with
12.1.4.0.9 before starting this storage node.
</pre>
If you see this message when starting a storage node, you can work
around the problem by reverting to the previous release software and
restarting the storage node.  Then, use the <code>plan
change-parameters</code> command to disable the admin web service.  For
example, to disable the web service on admin1, you could use the
command:
<pre>
plan change-parameters -service admin1 -wait -params adminHttpPort=0
</pre>
<p>
[#25249]
</li>
</ol>
<h3><a name="Query4210">SQL Query Language and Shell Changes</a></h3>
<ol>
<li>
The Oracle NoSQL Database SQL query language has been enhanced with the
following features:
<ul>
  <li>Support for OFFSET and LIMIT [#25078]</li>
  <li> ALTER TABLE, used for schema evolution, has been modified to allow
  modification of RECORD types nested within other records, maps, and arrays.
  [#24049]
  </li>
</ul>
</li>
<li>
Paths used in DDL statements to reference indexes involving arrays,
map keys, and map values have been modified to be consistent with those
used in queries. The statements affected include <code>CREATE INDEX</code>
and <code>DESCRIBE TABLE</code>.
<p>
There are 3 types of paths:
<ol>
  <li>Paths to array values.
  <pre>
    Previous syntax: path-to-array or path-to_array[]
    New syntax: path-to-array[] ("[]" is required)
    For example, to create an index on the values in an array:
      CREATE TABLE MyTable(id INTEGER, myArray ARRAY(INTEGER), PRIMARY KEY(id))
      CREATE INDEX ArrayIndex on MyTable(myArray[])
  </pre>
  </li>
  <li>Paths to map values:
  <pre>
     Previous syntax: path-to-map or path-to-map[]
     New syntax: path-to-map[] ("[]" is required)
     For example, to describe the field used in a map:
      CREATE TABLE MyTable(id INTEGER, myMap MAP(STRING), PRIMARY KEY(id))
      DESCRIBE AS JSON MyTable(myMap[])
  </pre>
  </li>
  <li>Paths to map keys:
  <pre>
     Previous syntax: KEYOF(path-to-map)
     New syntax: KEYS(path-to-map)
     For example, to create an index on the keys of a map:
      CREATE TABLE MyTable(id INTEGER, myMap MAP(STRING), PRIMARY KEY(id))
      CREATE INDEX MapIndex on MyTable(myMap[])
  </pre>
  </li>
</ol>
[#25167]</li>
<li>
The <b>CREATE FULLTEXT INDEX</b> and <b>DROP INDEX</b> DDL statements
have acquired new syntax to allow overriding of the new constraints.
[#24809]
</li>
<li>
New constraints are now enforced when text indexes are created and
deleted.  These operations are not allowed unless the health status of
the Elasticsearch cluster is <i>GREEN</i>. [#25093]
</li>
<li>
Fixed a bug where executing a query statement that contains != condition in
the SQL shell could result in a java.io.IOException: Invoke method readLine of
Jline.ConsoleReader failed: !=... : event not found. [#25065]
</li>
<li>
Added a command "show query &lt;statement&gt;" to display the query plan
for a query to the SQL shell. This is not part of the query language itself; it
is a feature of the SQL shell. [#25170]
</li>
</ol>
<h3><a name="Storage4210">Storage Engine Changes (JE 7.2)</a></h3>
<ol>
<li>
Fixed a problem where checkpointing sometimes did not occur after log cleaning
when application write operations stopped, which prevented reclamation of disk
space. This was a common problem with tests that expect disk space to be
reclaimed after write operations have stopped. In production systems it could
also be a problem during repair of an out-of-disk situation.  Note that an
earlier fix [#23180] in JE 7.1 caused cleaning to occur in this situation, but
a checkpoint is also needed to reclaim disk space, so the earlier fix was
incomplete.  [#25364]
</li>
<li>
Unexpected JE data file (.jdb file) deletions are now automatically detected by
a background task. Normally all JE data file deletions should be performed
internally as a result of JE log cleaning. If an external file deletion is
detected, JE assumes this was accidental. This will now cause the RN to fail
very quickly, so that the problem is made visible as soon as possible.
Previously, the problem could be undetected for a period of time if the deleted
file was not frequently accessed. [#25201]
</li>
<li>
Further reduced the possibility that multiple node failures could cause the
loss of data (JE's RollbackProhibitedException). When NO_SYNC durability is
used, JE flushes the log to disk periodically to avoid this. Previously, an
fsync (flush to the storage device) was performed every 5 minutes. Now, a flush
to the file system is performed every 5 seconds and an fsync is performed every
20 seconds. [#25417]
</li>
<li>
JE's DbCacheSize utility has been improved for applications like NoSQL DB that
use CacheMode.EVICT_LN and an off-heap cache. The -offheap argument should be
specified when running DbCacheSize during NoSQL DB capacity planning. The
documentation for running DbCacheSize has been updated in the Determine JE
Cache Size section of the NoSQL DB Administrator's Guide, C. Initial Capacity
Planning. This documentation was previously incorrect because it did not take
into account use of the off-heap cache. [#25380]
</li>
</ol>
<h3><a name="Deprecation4210">Deprecated Features</a></h3>
<ol>
<li>
The SNMP agent (oracle.kv.impl.mgmt.snmp.SnmpAgent), which makes store
metrics available for access via the SNMP protocol, is deprecated in
this release.  It will be removed from the product in a future
release, circa July 2017.
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.4.0.9</u></h3>
<h3><a name="NewFeatures409">New Features</a></h3>
<ol>
<li>
Added the ability to define a Time To Live (TTL) on an individual
table row.  The TTL can be defined in terms of hours or days and can
be declared as a default on a table or applied per-row on put
operations. Applying a TTL to a row results in an absolute expiration
time on that row after which it will not be available. The expiration
time is available using new API on Row. [#24743]
</li>
<li>
Includes a preview release of an SQL-like declarative query language,
called ONQL, that can be used to access data in tables in a read-only
fashion. As a preview release its use and feedback is encouraged. We
expect that additions and changes done for a later formal release will
be backward-compatible with this preview, however we cannot rule out
minor incompatibilities.
<p>
As of this preview release the language supports
SELECT-FROM-WHERE-ORDERBY queries that can perform projection,
predicate-based filtering, simple arithmetic operations, index-based
sorting, and path expressions for navigating and projecting out data
from complex structures (records, arrays, and maps). Bind variables
are also supported for reuse of prepared queries.
<p>
The ONQL processor performs all operations on the server side and
automatically takes advantage of primary and secondary indexes to
increase query performance. The language also supports hints to allow
users to explicitly choose an index for a query, in cases where the
query processor is not making the best choice among the multiple
indexes applicable to a query.
<p>
In addition a new ONQL shell has been added to facilitate use of the
query language in an interactive, command line interface. [#24186]
</li>
<li>
Added Export/Import utility. Export utility allows a user to export the
contents from Oracle NoSql Store to an external export store (Local File
System / Oracle Storage Cloud Service). Import utility allows a user to
import the contents from an external export store (Local File System /
Oracle Storage Cloud Service) to Oracle NoSql store. [#24734]
</li>
<li>
Added a preview release of integration with Elasticsearch to provide
full text search indexing.  Text indexes can be added to tables in
Oracle NoSQL Database, which will cause a corresponding index in an
attached Elasticsearch cluster to be populated and maintained. [#23733]
<p>
To use this feature, users must first make available on the network an
Elasticsearch 2.0 cluster, and register the cluster with the NoSQL
Store.  This enables use of the CREATE FULLTEXT INDEX DDL command.
</li>
<li>
Added mechanism to support creating statistics tables automatically at the
end of the existing plan deploy-topology. [#24768]
</li>
<li>
Added a <em>predicate pushdown</em> mechanism to the
<a href="oradoc-absolute:/examples/hadoop/hive/table/package-summary.html#ondb_hive_integration_classes">
<b><code>Oracle NoSQL Database Table API Hive Integration
classes</code></b></a>.  Specifically, a mechanism was added which
supports the decomposition of a Hive or Big Data SQL
query's <code>WHERE</code> clause (the <em>predicates</em>) into
information that can be passed to the KVStore database so that some/all
search processing can be performed in the database itself rather than in
the processing performed on the client side of the query. For more
details on this new mechanism, refer to
<a href="oradoc-absolute:/examples/hadoop/hive/table/package-summary.html#appendix_d_predicate_pushdown">
<b><code>Appendix D of the <em>Table API Hive
Cookbook</em></code></b></a>. [#24525]
</li>
<li>
Added a non-interactive login mode for command line utilities like Admin
command line interface and Ping utility. Setting the login property introduced
this release, "oracle.kv.password.noPrompt" as true, the non-interactive login
mode will be enabled. If users are not using password store and configuring
login properties incorrectly, the utilities would directly exit without
automatically prompting password or user name like previous releases. [#24931]
</li>
<li>
Added a new example that demonstrates how to perform Kerberos
authentication on the client side. [#24328]
</li>
<li>
Ranges declared on fields in DDL "CREATE TABLE" expressions are no longer
supported. In previous releases it was possible to declare range constraints on
fields in tables. This was done using the data definition language (DDL)
keyword "CHECK" and providing a range. The primary intent of this
feature was to allow the system to optimize primary key size for such
fields because keep primary key size small is an important optimization.
This feature was allowed for numeric and String types.
<p>
As of this release the CHECK syntax and generalized ranges are no longer
supported. Existing tables created with such fields will continue to
operate correctly and enforce the range constraints.
To replace this function, an optional storage size
specification is allowed on fields declared in the primary key. This
makes the intent of the feature very clear &mdash; reducing primary key size.
This is only allowed on fields of type INTEGER at this time. [#24769]
</li>
<li>
Added new methods to support bulk put operations in the table API.  See
the documentation for the
<a href="oradoc-absolute:/java-api/oracle/kv/table/TableAPI.html#put-java.util.List-oracle.kv.BulkWriteOptions-">
<code>TableAPI.put(List&lt;EntryStream&lt;Row&gt;&gt;, BulkWriteOptions)
</code></a> and
<a href="oradoc-absolute:/java-api/oracle/kv/KVStore.html#put-java.util.List-oracle.kv.BulkWriteOptions-">
<code>KVstore.put(List&lt;EntryStream&lt;KeyValue&gt;&gt;, BulkWriteOptions)
</code></a> methods for more details. [#24563]
</li>
</ol>
<h3><a name="BugFixes409">Bug and Performance Fixes</a></h3>
<ol>
<li>
Changes have been made to the Admin and Rep Node service's persistent store
to support more flexible upgrades in future releases. This change will have a
one-time impact when upgrading from a previous release to this release. During
the upgrade the Admin may temporarily enter a "read-only" mode. While in the
read-only mode it will not be possible to change the persistent state of the
Admin. This includes creating new topologies, changing parameters, creating
new plans, or running existing plans. A read-only Admin will attempt to
exit this mode by transferring control to another Admin node. [#24634] [#24725]
</li>
<li>
System tables that are internally managed and maintained by the system are
now read-only when security is enabled on the store. In addition,
whether or not security is enabled, the schema for system tables are now
immutable, and users are not permitted to alter, or drop or add indexes
for system tables. The old tables (TableStatsPartition, TableStatsIndex,
PartitionStatsLease and IndexStatsLease) used by statistics gathering are
deprecated in this release.  If enabled statistics gathering in an earlier
release, you are still able to read these tables to check old statistics data,
but they will not be updated in this release. You can drop old tables
if you do not have any plan to maintain old statistics. [#24467]
</li>
<li>
Fixed a problem that prevented the ping command from authenticating
properly when used with a secure store. [#24808]
</li>
</ol>
<h3><a name="Utilities409">Utility Changes</a></h3>
<ol>
<li>
Due to changes in the Admin service's persist store (described in the "Bug and
Performance Fixes" section above) the new versions of the dump and load
utilities can only be used after the store has been fully upgraded. Also,
previous versions of these utilities will no longer work once an upgrade to
this release has begun.  During an upgrade the new utilities will not operate
until all of the Admin nodes have been upgraded and the Admin is no longer in
the read-only mode described above. [#24634] [#24725]
</li>
<li>
The "table size" sub command was mistakenly marked to be deprecated together
with its parent command "table" command in release 12cR1.3.5.2, move "table size"
to top level command and rename it to "table-size".
</li>
<li>
Added a new status utility command that shows the status of a storage
node agent. [#23561]
</li>
<li>
Fixed a problem where executing a Hive query against a table containing
an array with no elements would cause an exception like the following:
<pre>
2016-02-09 13:31:24,213 ERROR [main]: CliDriver (SessionState.java:printError(921)) - Failed with exception java.io.IOException:java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
java.io.IOException: java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:507)
at org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:414)
at org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:138)
at org.apache.hadoop.hive.ql.Driver.getResults(Driver.java:1655)
at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:227)
at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:159)
at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:370)
at org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:756)
at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:675)
at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:615)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:497)
at org.apache.hadoop.util.RunJar.run(RunJar.java:221)
at org.apache.hadoop.util.RunJar.main(RunJar.java:136)
Caused by: java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
at java.util.ArrayList.rangeCheck(ArrayList.java:653)
at java.util.ArrayList.get(ArrayList.java:429)
at oracle.kv.impl.api.table.ArrayValueImpl.get(ArrayValueImpl.java:97)
at oracle.kv.hadoop.hive.table.TableSerDe.objectInspector(TableSerDe.java:458)
at oracle.kv.hadoop.hive.table.TableSerDe.deserialize(TableSerDe.java:286)
at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:488)
... 15 more
</pre>
[#24900]
</li>
</ol>
<h3><a name="Deprecation409">Deprecated Features</a></h3>
<ol>
<li>
The interfaces and classes related to support of Avro have been deprecated
in favor of the use of tables and the table API.
All Avro features are available more simply using the table API. The
interfaces and code supporting Avro will continue remain available for
some time, but users are encouraged to migrate to the table API.
<p>
The interfaces and classes affected are mostly in the oracle.kv.avro
package. Interfaces that use those classes are also affected.
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.5.2</u></h3>
<h3><a name="NewFeatures352">New Features</a></h3>
<ol>
<li>
Added support for gathering key distribution statistics. To enable
statistics gathering, the statistics tables need to be created first by
executing the runadmin script
file <code>CreateStatisticTables.kvs</code>, which is located in
the <code>lib</code> directory of the release package. [#23422]
</li>
<li>
Added support for Kerberos user authentication.
Users that wish to use this new capability should be aware of the
following changes:
<ul>
<li>
The makebootconfig utility has a new optional
<code>-external-auth</code> command-line argument which is used to
enable external authentication mechanisms. Currently, Kerberos is the
only supported mechanism. This new flag is only permitted when the value
of the <code>-store-security</code> flag is specified
as <code>configure</code> or <code>enable</code>.
</li>
<li>
The securityconfig tool has been enhanced to provide the ability to:
<ul>
<li>Add Kerberos configuration information to an existing security
configuration</li>
<li>Renew a store's Kerberos service principal keytab for security
maintenance tasks</li>
</ul>
</li>
<li>
A new class, KerberosCredentials, which implements LoginCredentials, has
been introduced, and its instances can be used in the
KVStoreFactory.getStore method to perform a Kerberos login:
<ul>
<li><code>KVStoreFactory.getStore(KVStoreConfig, LoginCredentials, ReauthenticateHandler)</code></li>
</ul>
<li>New Kerberos-related security properties have been added that must
be specified when using a KVStore command-line utility program against a
secure store that has enabled Kerberos authentication.</li>
</ul>
<p>
There are two approaches that applications can use to authenticate using
Kerberos. Client applications that use the
<a href="https://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASRefGuide.html">
Java Authentication and Authorization Service (JAAS)</a> programming
framework can specify credentials by using <code>Subject.doAs</code>.
Applications that do not use the JAAS framework can use the new security
properties to specify parameters needed to acquire user credentials from
the Kerberos Key Distribution Center (KDC).
<p>
Kerberos authentication is described in greater depth in the Oracle
NoSQL Database Security Guide, as well as in the Administrators Guide
and the Javadoc.  [#24328]
</li>
<li>
The off-heap cache is now enabled by default with a systemPercent setting of
10%. Please
review <a href="oradoc-lookup:/NSADM-GUID-A467B643-9D14-43AF-AD4B-65A3376D802C/Managing+the+Off-heap+Cache">
Managing the Off-heap Cache</a> for details.
</li>
</ol>
<h3><a name="BugFixes352">Bug and Performance Fixes</a></h3>
<ol>
<li>
In earlier versions, a LOB read operation with
<code>Consistency.NONE_REQUIRED</code> could
fail in the absence of a master for the shard hosting the LOB metadata. The read
operation will now use a suitable replica when the read consistency allows for
it. [#24460]
</li>
<li>
Fixed a bug where a client calling TableAPI.getTable() while an index is being
created and populated (is not yet ready) could result in a
ConcurrentModificationException on a RepNode, causing the RepNode to become
unavailable. [#24691]
</li>
<li>
Corrected a problem in the configuration of the external tables example
that caused the example to generate errors.  The property name for
specifying the name of the table in the <code>config.xml</code> file was
incorrect &mdash; changed from "oracle.kv.table" to
"oracle.kv.tableName". [#24650]
</li>
<li>
Fixed a problem in the implementation of the <code>show admins</code>
command in the Administrator CLI that prevented it from authenticating
correctly when used with a secure store. [#24648]
</li>
<li>
Improved the algorithm used to calculate the maximum number of threads
used to perform concurrent table requests when the default is requested
by specifying <code>TableIteratorOptions.maxConcurrentRequests</code>
as <code>0</code>.  This change affects the behavior of table multi-get
operations, and table and index iterations. [#24188]
</li>
<li>
Fixed a security flaw in table-level access checking.  Before this
fix, it might have been possible for an authenticated client to access
a table without permission if the user had permission to access other
tables in the store.
</li>
</ol>
<h3><a name="Utilities352">Utility Changes</a></h3>
<ol>
<li>
There were several changes made to the ping command to make it easier to
use in scripts.
<p>
First, modified the <code>java -jar kvstore.jar ping</code> command to
add a new flag, <code>-helper-hosts</code>, which is an alternative to
the existing <code>-host</code> and <code>-port</code> flags. If
multiple helper hosts are provided, the ping utility will have multiple
nodes it can use to make an initial point of contact with the store, and
will have a greater chance of success if some nodes of the store are
unavailable.  The new <code>-helper-hosts</code> flag can be specified
as a comma-separated list of hosts and ports.  For example:
<pre>
java -jar kvstore.jar ping -helper-hosts hst1:5000;hst2:5100
</pre>
<p>
Second, ping now generates an exit code which acts as a quick summary of
the results.  The exit code is returned both as a process exit code, if
ping is called as a standalone utility, and as part of the JSON
output. The exit code is meant to direct the caller to perform the
appropriate follow-on action.  The values, defined in
the <code>Ping.ExitCode</code> enum, are:
<dl>
<dt>0 (EXIT_OK)
<dd>All services in the store could be located and are in a known, good
    state (e.g. RUNNING).
<dt>1 (EXIT_OPERATIONAL)
<dd>One or more services in the store could not be reached, or are in an
    unknown or not usable state.  In this case the store should support
    all data operations across all shards, as well as all administrative
    operations, but may be in a state of degraded performance.  Some
    action should be taken to find and fix the problem before part of
    the store becomes unavailable.
<dt>2 (EXIT_NO_ADMIN_QUORUM)
<dd>The Admin Service replication group does not have quorum or is not
    available at all, and it's not possible to execute administrative
    operations which modify store configuration. The store supports all
    normal data operations despite the loss of admin quorum, but this
    state requires immediate attention to restore full store
    capabilities.
<dt>3 (EXIT_NO_SHARD_QUORUM)
<dd>One or more of the shards does not have quorum and either cannot
    accept write requests, or is completely unavailable.  This state
    requires immediate attention to restore store capabilities.  This
    exit code takes precedence over EXIT_NO_ADMIN_QUORUM, so if this
    exit code is used it is possible that the admin capabilities are
    also reduced or unavailable.
<dt>100 (EXIT_USAGE)
<dd>A usage error.
<dt>101 (EXIT_TOPOLOGY_FAILURE)
<dd>Ping was unable to find a Topology in order to operate.  This could
    be a store problem, a network problem, or it could be a usage
    problem with the parameters passed to Ping (e.g. the host and port
    or helper-hosts list are not part of a store).
<dt>102 (EXIT_UNEXPECTED)
<dd>The utility has experienced an unexpected error.
</dl>
<p>
Note that exit codes 1 through 3 may indicate a network connectivity
issue that should be checked first before concluding that any services
have a problem.
<p>
Finally, the following section has been added to Ping's JSON output,
which can be requested using the <code>-json</code> flag, and appears
when ping is called as a standalone command or as part of the Admin CLI.
For example:
<pre>
  "operation" : "ping",
  "return_code" : 5000,
  "description" : "No errors found",
  "exit_code" : 0
</pre>
<p>
[#24407]
</li>
<li>
Some table commands in the Administrative CLI were deprecated in favor
of using the execute command to perform DDL statements.  The newly
deprecated commands are:
<ul>
<li>table
<li>plan add-index
<li>plan add-table
<li>plan evolve-table
<li>plan remove-index
<li>plan remove-table
</ul>
<p>
[#23937]
</li>
<li>
Some additional Admin CLI commands now support displaying output in JSON
format. If <code>-json</code> is specified when starting the Admin CLI
using <code>runadmin</code>, or is specified as an argument of a command, the
execution result of the command will be displayed in a JSON format string
containing standard NoSQL error messages.  In addition to the
`configure` command, support has been added for the following commands:
<ul>
<li>plan deploy-zone
<li>plan deploy-sn
<li>pool create
<li>pool join
<li>plan deploy-admin
<li>topology create
<li>plan deploy-topology
<li>show plan
<li>verify configuration|upgrade|prerequisite
</ul>
<p>
[#24346]
</li>
<li>
The admin CLI command `pool add` is now idempotent.  Calling the command
with a pool that already exists now returns without error. This change
is intended to make the command easier to use in scripts. [#24445]
</li>
<li>
The <code>makebootconfig</code> command was modified to support the
new <code>-dns-cachettl</code> flag.  This flag specifies the number of
seconds that replication nodes should cache host name to IP address
mappings.  A value of 0 means mappings should not be cached.  A value of
-1 means mappings should be cached indefinitely, which is the default.
The value of the flag is used to set the "networkaddress.cache.ttl" and
"networkaddress.cache.negative.ttl" security properties.  Note that
specifying a non-default value can have security implications.  See the
Java <a href="https://docs.oracle.com/javase/7/docs/api/java/net/doc-files/net-properties.html#AddressCache">
Networking Properties</a> page for more details. [#24087]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.4.7</u></h3>
<h3><a name="NewFeatures347">New Features</a></h3>
<ol>
<li>
Added a new command to the CLI for reestablishing Admin service quorum
that has been lost due to failure:
<pre>
repair-admin-quorum {-zn &lt;id&gt;|-znname &lt;name&gt;|-admin &lt;id&gt;}...
</pre>
The command repairs admin quorum by reducing membership of the admin
group to the admins included in the specified zones and in the list of
the specific admins.  Reestablishing admin quorum is one of the first
steps in performing disaster recovery. [#23983]
</li>
<li>
Added a new command to the Admin CLI to recover shard quorum lost due to
failure by change zone types:
<pre>
plan failover { {-zn &gt;zone-id&lt;|-znname &gt;zone-name&lt;}
                -type {primary|offline-secondary} }...
              ...
</pre>
The command repairs shard quorum by changing the type of currently
offline primary zones to secondary zones and, optionally, changing some
secondary zones to primary zones.  Failover is one of the final steps in
performing a disaster recovery. [#23546]
</li>
<li>
Added the ability to change a zone type. Previously a zone could be created as
either a PRIMARY or SECONDARY zone and once created the type could not be
changed. With this release the new CLI command:
<code>topology change-zone-type</code> allows
the administrator to change a zone in a topology from PRIMARY to SECONDARY or
from SECONDARY to PRIMARY. Once changed the topology can then be deployed as
normal with the <code>plan deploy-topology</code> command. [#24308]
</li>
<li>
The Storage Node Agent (SNA) now supports a start-up mode that ensures its
managed services are disabled before the SNA starts. If the
<code>-disable-services</code> flag is specified on the SNA command line
with the kvstore <code>start</code> command, the SNA's services will
first be disabled before the SNA starts. If there is a failure disabling
the services the SNA will not start. This ability is useful during
disaster recovery to prevent unwanted services from starting.
<p>
The kvstore <code>disable-services</code> command has been removed. Instead
use <code>stop -disable-services</code>. The <code>-disable-services</code>
option can be used with the kvstore <code>start</code>, <code>stop</code>, and
<code>restart</code> commands.
[#24337]
</li>
<li>
Improved the <code>plan repair-topology</code> command.  The command now
can repair parameter differences for Admin and Replication Node services
between the reference copy maintained by the Admin and the storage node
configuration files or parameters in the running services. [#23555]
</li>
<li>
Added a new command to the CLI which will wait for replica nodes to
reach a specified threshold of consistency with their masters. This
command can be used when performing a switchover to wait for secondary
nodes to catch up with their masters and to obtain information about
progress towards reaching consistency. The new command:
<pre>
await-consistent -timeout &lt;timeout-secs&gt;
    [-zn &lt;id&gt; | -znname &lt;name&gt;]...
    [-replica-delay-threshold &lt;time-millis&gt;]
</pre>
will wait up to <code>timeout-secs</code> seconds for the replication
delay of the replica nodes in the zones specified by <code>-zn</code>
or <code>-znname</code> to be less than or equal to <code>time-millis</code>
milliseconds.
If no zones are specified then the command will wait on all replicas
in the store.
If <code>-replica-delay-threshold</code> is not specified the default value
of 5000 milliseconds (5 seconds) is used.
<p>
If any replicas do not reach the threshold within the timeout period
the command will return with a list of those nodes along with their
lag time, and information about whether the replica is catching up if known.
[#23982]
</li>
<li>
Modified the output of the `ping` and `verify configuration` Admin CLI
commands so that shard and zone status entries are named more clearly
using non-overlapping categories.  For shard status, the 'total' entry
has been removed, the 'degraded' entry has been renamed to
'writable-degraded', and the 'noQuorum' entry has been renamed to
'read-only'.  For zone status, the 'total' entry has been removed, and
the 'offline' entry has been added. [#24336]
</li>
<li>
Modified the output of the `ping` and `verify configuration` Admin CLI
commands to add an entry that provides an overview of the status of the
Admin service nodes.  Also modified the output of the `show admins` command
to include information about the status and replication state of each
admin. [#23984]
</li>
<li>
Modified the classes and interfaces in <code>oracle.kv.hadoop.table</code>
and <code>oracle.kv.hadoop.hive.table</code> to support the Oracle NoSQL Database
security model. Specifically, you can now run MapReduce jobs, Hive queries, and
Big Data SQL queries against table data located in a store configured for secure access.
In addition to the changes made in <code>oracle.kv.hadoop.table</code> and
<code>oracle.kv.hadoop.hive.table</code> to support security, example code and
detailed documentation has also been provided that explains and walks you through
the details of executing a MapReduce job or Hive/Big Data SQL query against table
data in a secure store; which can be found, respectively, in the sections of
<a href="oradoc-absolute:/examples/hadoop/table/package-summary.html"> <code>The Table API MapReduce Cookbook</code></a>
and
<a href="oradoc-absolute:/examples/hadoop/hive/table/package-summary.html"> <code>The Table API Hive Cookbook</code></a>.
[#23714] [#24107] [#24108]
</li>
<li>
Modified the <code>oracle.kv.hadoop.hive.table.TableSerDe</code> and related
classes to support executing Hive or Big Data SQL queries against data contained
in tables whose schema may consist of complex (non-<em>primitive</em>) data types;
that is, <code>Map</code>, <code>Record</code>, <code>Array</code> types.
Additionally, documentation and examples have been provided that walk you through
the details of the data model and how it maps to the Hive and Big Data SQL data
models; which can be found
<a href="oradoc-absolute:/examples/hadoop/hive/table/package-summary.html#mapping_hive_to_ondb_data_model"> <code>here</code></a>
and
<a href="oradoc-absolute:/examples/hadoop/hive/table/package-summary.html#mapping_ora_to_ondb_data_model"> <code>here</code></a>
respectively. [#24357] [#24358]
</li>
<li>
Topology candidates with names that contain the dollar sign ('$')
character are now reserved for use by the system, which may modify or
remove them.  The `topology create` and `topology clone` commands will
print a warning if they are called to create topology candidates whose
names contain the reserved character.  Administrators should avoid
creating or using topology candidates with names using dollar
signs. [#24386]
</li>
<li>
The <code>plan start-services</code> and <code>plan stop-services</code>
commands now support starting and stopping Admin services. Previously,
these plans only operated on Replication Nodes (RNs). With this release
the <code>-service</code> option accepts the name of an Admin service.
In addition, if a zone is specified (with either the <code>-zn</code> or
<code>-znname</code> flags) and the <code>-all-rns</code> is not
specified, then all of the services, RNs and Admins, in that zone are affected.
[#24149]
</li>
<li>
Some commands in the Admin CLI now supports displaying JSON format results. If
<code>-json</code> is specified when starting the Admin CLI using
<code>runadmin</code>, or is specified as an argument of a command, the
execution result of the command will be displayed in a JSON format string
containing standard NoSQL error messages. In this release, only the `configure`
command has been changed to support JSON format result.
[#24444]
</li>
<li>
The admin CLI commands `configure`, `topology create`, `pool join` and
`plan deploy-admin` are now idempotent to support admin automation scripting.
[#24445]
</li>
<li>
Added support for configuring replication nodes to use off-heap caches,
which are disabled by default.  An off-heap cache can be used to utilize
large memories more efficiently than when using the same memory for the
file system cache, while avoiding the Java GC overhead associated with
large Java heaps.  Please see
<a href="oradoc-lookup:/NSADM-GUID-A467B643-9D14-43AF-AD4B-65A3376D802C/Managing+the+Off-heap+Cache">
Managing the Off-heap Cache</a> for details.  [#24370]
</li>
</ol>
<h3><a name="APIChanges347">API Changes</a></h3>
<ol>
<li>
The iterators <code>ParallelScanIterator</code> and <code>TableIterator</code>
now support both <code>Direction.FORWARD</code> and
<code>Direction.REVERSE</code>.
<p>
Note that, due to the internal changes to support the new iterator options,
the method <code>getStoreIteratorMetrics</code> on
<code>oracle.kv.stats.KVStats</code> has been deprecated. This method returns
an instance of <code>oracle.kv.stats.StoreIteratorMetrics</code> which has
also been deprecated. All of the methods of the returned
<code>StoreIteratorMetrics</code> object will return <code>0</code>.
[#23583]
</li>
<li>
Add Java <code>Map</code> based API for Record and Map field in
<code>RecordValue</code> interface. Add Java <code>Iterable</code> and
array based API for Array field in <code>RecordValue</code> interface.
[#24177]:
<pre>
<code>RecordValue putRecord(String fieldName, Map&lt;String, ?&gt; map)</code>
<code>RecordValue putMap(String fieldName, Map&lt;String, ?&gt; map)</code>
<code>RecordValue putArray(String name, Iterable&lt;?&gt; list)</code>
<code>RecordValue putArray(String name, Object[] array)</code>
</pre>
</li>
<li>
The interfaces for the methods <code>oracle.kv.hadoop.table.TableInputFormat.setKVSecurity</code>
and <code>oracle.kv.hadoop.hive.table.TableInputSplit.setKVStoreSecurity</code> have
each been changed to specify new information needed for security-related initialization;
specifically,
<ul>
  <li>The name of the file that specifies the transport properties the client uses when connecting to the store (the <em>login file</em>).
  <li>The PasswordCredentials containing the username and password the client presents to the store during authentication.
  <li>The name of the file containing the public keys and/or certificates needed for authentication (the <em>trust file</em>).
</ul>
<p>
[#23714] [#24107] [#24108]
</li>
<li>
A new exception, <code>MetadataNotFoundException</code>, has been added to
indicate that a client's metadata may be out of sync.  It extends
<code>FaultException</code> and can be caught by applications to trigger the
need for a refresh of their metadata, and in particular, <code>Table</code>
handles obtained via <code>TableAPI.getTable</code>.
</li>
<li>
Added bulk get APIs to fetch large numbers of keys and values efficiently based
on discrete keys. The APIs can be used with both the Key/Value and Table data
models. The following is a list of the new methods:
<ul>
<li>New methods defined on <code>oracle.kv.KVStore</code>:
<pre>
ParallelScanIterator&lt;KeyValueVersion&gt; storeIterator(Iterator&lt;Key&gt;, int, KeyRange, Depth, Consistency, long, TimeUnit, StoreIteratorConfig)
ParallelScanIterator&lt;Key&gt; storeKeysIterator(Iterator&lt;Key&gt;, int, KeyRange, Depth, Consistency, long, TimeUnit, StoreIteratorConfig)
ParallelScanIterator&lt;KeyValueVersion&gt; storeIterator(List&lt;Iterator&lt;Key&gt;&gt;, int, KeyRange, Depth, Consistency, long, TimeUnit, StoreIteratorConfig)
ParallelScanIterator&lt;Key&gt; storeKeysIterator(List&lt;Iterator&lt;Key&gt;&gt;, int, KeyRange, Depth, Consistency, long, TimeUnit, StoreIteratorConfig)
</pre>
</li>
<li>New methods defined on <code>oracle.kv.table.TableAPI</code>:
<pre>
TableIterator&lt;Row&gt; tableIterator(Iterator&lt;PrimaryKey&gt;, MultiRowOptions, TableIteratorOptions)
TableIterator&lt;PrimaryKey&gt; tableKeysIterator(Iterator&lt;PrimaryKey&gt;, MultiRowOptions, TableIteratorOptions)
TableIterator&lt;Row&gt; tableIterator(List&lt;Iterator&lt;PrimaryKey&gt;&gt;, MultiRowOptions, TableIteratorOptions)
TableIterator&lt;PrimaryKey&gt; tableKeysIterator(List&lt;Iterator&lt;PrimaryKey&gt;&gt;, MultiRowOptions, TableIteratorOptions)
</pre>
</li>
</ul>
<p>
Please review the javadoc associated with these new methods for details.
<p>
[#24285]
</li>
</ol>

<h3><a name="BugFixes347">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a problem where some plans would enter the INTERRUPTED state.
This would happen when a plan needed to stop, or restart the master Admin which
was running the plan. Once in the INTERRUPTED state, user action
was required to have the plan resume execution. The fix allows the plan to
automatically restart on the new master Admin (either some other Admin, or the
original Admin which has restarted).
<p>
Along with this fix, the Admin CLI has been updated so that it will wait
for a plan even if the plan is restarted on an Admin which was not the Admin
the CLI was originally connected to. This change affects the <code>plan</code>
command's <code>-wait</code> flag as well as the <code>plan wait</code> command.
[#24535]
</li>
<li>
Fixed a problem where <code>ArrayValue.set()</code> would result in the same
behavior as <code>ArrayValue.add()</code>, mistakenly adding to the array
rather that putting an entry at a specific index. [#24326].
</li>
<li>
Fixed a bug that a release 3.2 replication node cannot resolve the name of a
role principal created by a new replication node running release 3.3 during an
upgrade of a NoSQL cluster. This situation works properly when upgrading from
the 3.2 release to the current release. [#24502].
</li>
<li>
Fixed a bug that caused the <code>makebootconfig</code> utility command
to fail when it was called with a value for the <code>-capacity</code>
flag that was greater than 1 when using a 32-bit Java virtual
machine. [#24550]
</li>
<li>
Improved the performance of topology redistribution by batching
transactional operations performed during partition migrations. [#24529]
</li>
<li>
Corrected problems where the table API implementation failed to perform
case insensitive comparisons when comparing field names. [#24553]
</li>
<li>
Modified elasticity operations to provide improved store availability
during an elasticity change by waiting for replicas to catch up with
masters before counting them as contributing to the shard quorum.  This
change reduces the chance of a temporary loss of write availability
during an elasticity change that moves replication nodes, particularly
when the store is under heavy write loads. [#24511]
</ol>
<h3><a name="Utilities347">Utility Changes</a></h3>
<ol>
<li>
The Admin CLI utility (<code>runadmin</code>) and the Admin
CLI <code>connect store</code> command now support the following new
flags to override the default configuration:
<ul>
<li><code>-timeout</code> to specify the store request timeout,
<li><code>-consistency</code> to specify the store request consistency, and
<li><code>-durability</code> to specify the store request durability.
</ul>
<p>
[#24101]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.3.4</u></h3>
<h3><a name="NewFeatures334">New Features</a></h3>
<ol>
<li>
A number of new security features have been added.
<p>
Users are now able to enforce table-level access checks through both
the API and administrative command line interface (Admin CLI) by using
the following new series of table-specific privileges:
<table border="true" summary="List security privileges">
    <tr>
        <td><strong>Privilege</strong></td>
        <td style="text-align: left"><strong>Description</strong></td>
    </tr>
    <tr>
        <td>READ_ANY_TABLE</td>
        <td>Read from any table in kvstore</td>
    </tr>
    <tr>
        <td>DELETE_ANY_TABLE</td>
        <td>Delete data from any table in kvstore</td>
    </tr>
    <tr>
        <td>INSERT_ANY_TABLE</td>
        <td>Insert and update data to any tables in kvstore</td>
    </tr>
    <tr>
        <td>READ_TABLE</td>
        <td>Read from a specific table in kvstore</td>
    </tr>
    <tr>
        <td>DELETE_TABLE</td>
        <td>Delete data from a specific table in kvstore</td>
    </tr>
    <tr>
        <td>INSERT_TABLE</td>
        <td>Insert and update data to a specific table in kvstore</td>
    </tr>
    <tr>
        <td>CREATE_ANY_TABLE</td>
        <td>Create any table in kvstore</td>
    </tr>
    <tr>
        <td>DROP_ANY_TABLE</td>
        <td>Drop any table in kvstore</td>
    </tr>
    <tr>
        <td>EVOLVE_ANY_TABLE</td>
        <td>Evolve any table in kvstore</td>
    </tr>
    <tr>
        <td>CREATE_ANY_INDEX</td>
        <td>Create any index on any table in kvstore</td>
    </tr>
    <tr>
        <td>DROP_ANY_INDEX</td>
        <td>Drop any index on any table in kvstore</td>
    </tr>
    <tr>
        <td>EVOLVE_TABLE</td>
        <td>Evolve a specific table</td>
    </tr>
    <tr>
        <td>CREATE_INDEX</td>
        <td>Create index on a specific table</td>
    </tr>
    <tr>
        <td>DROP_INDEX</td>
        <td>Drop index on a specific table</td>
    </tr>
</table>
<p>
Users are now able to create new roles to group together privileges or
other roles. This provides a way to grant a group of desired
privileges to a user. New role management commands have been added to
support create and drop roles, and to grant and revoke privileges or
roles to and from other roles.
<p>
Modifications to the data definition language (DDL) have been added to
provide a declarative interface to all security operations. The
language reference is
in <a href="oradoc-lookup:/NSSEC-GUID-6C5875FE-9765-45E6-9EC7-0D6EAEE3F95D/security">
Security Guide</a>. The language is accessible via the API as well as
via the "execute" command in the Admin CLI.
<p>
Passwords now have lifetimes and will expire when they have been in use beyond
the specified lifetime. It is also possible now to explicitly expire a
password when adding a new user or by altering the profile of an existing
user. Users are required to renew the expired password before they can log in
to the store successfully.
[#23951]
</li>
<li>
Admin service configuration has been enhanced to better match the use
of primary and secondary zones. It is now possible for an Admin
service to be a <i>primary</i> or a <i>secondary</i>
Admin. This <i>Admin type</i> is analogous to zone type. A primary
Admin can serve as a master or replica of the Admin shard, and vote in
master elections.  Secondary Admins can only serve as replicas and do
not vote in master elections.  All Admins created in earlier releases
are primary Admins. With this release new Admins are created with the
same type as their containing zone.
<p>
Admin services created in a secondary zone by previous release will have the
wrong type (primary). This mismatch will be reported as a <i>violation</i>
from the <code>verify configuration</code> command. This condition can be
remedied through the <code>plan repair-topology</code> command.
<p>
In addition to the changes in Admin service type behavior, new rules have
been put in place regarding Admin service deployment. In general it is
recommended that Admin services follow the same rules as data nodes,
specifically the number of Admin services in a zone should match the zone's
replication factor. [#23985][#24182]
</li>
<li>
The Command Line Interface (Admin CLI) now supports a <i>read only</i> mode if
the Admin shard does not have quorum or if the master Admin is unreachable.
In this read-only mode any commands which require the Admin to
update persistent state, such as plan creation and execution, are disabled.
However, most commands which provide status or configuration information will
function. In addition to a notification in the CLI informing the user that
the CLI is in this mode, the <code>show admins</code> command will also
indicate that the CLI is connected read-only.
<p>
Additional re-connect capabilities have been added to the Admin CLI to
improve robustness of the CLI in the face of Admin node failures.
[#23943]
</li>
</ol>

<h3><a name="APIChanges334">API Changes</a></h3>
<ol>
<li>
The methods <code>oracle.kv.table.TableAPI.execute</code> and
<code>oracle.kv.table.TableAPI.executeSync</code> have been deprecated in
favor of the new APIs, <code>oracle.kv.KVStore.execute</code> and
<code>oracle.kv.KVStore.executeSync</code>. The motivation for the
change is the introduction of new DDL statements which
manage objects that are above the scope of a single table, such as
users and roles. Likewise, the
classes <code>oracle.kv.table.ExecutionFuture</code> and
<code>oracle.kv.table.StatementResult</code> are deprecated in favor of
<code>oracle.kv.ExecutionFuture</code> and
<code>oracle.kv.StatementResult</code>.
[#23937]
</li>
<li>
New methods have been added
to <code>oracle.kv.table.RecordValue</code> to provide the ability to
use JSON values for complex fields in a table. In the past, JSON could
be used to specify the entire row, but not portions of a row. The
following 6 JSON input methods for complex types in RecordValue are
new: [#24069]
<pre>
<code>RecordValue putRecordAsJson(String fieldName, String jsonInput, boolean exact);</code>
<code>RecordValue putRecordAsJson(String fieldName, InputStream jsonInput, boolean exact);</code>
<code>RecordValue putArrayAsJson(String fieldName, String jsonInput, boolean exact);</code>
<code>RecordValue putArrayAsJson(String fieldName, InputStream jsonInput, boolean exact);</code>
<code>RecordValue putMapAsJson(String fieldName, String jsonInput, boolean exact);</code>
<code>RecordValue putMapAsJson(String fieldName, InputStream jsonInput,boolean exact);</code>
</pre>
</li>
<li>
New methods have been added to better support DDL use by stateless
applications. <code>oracle.kv.ExecutionFuture.toByteArray()</code>
returns a serialized version of the future that can later be passed to
<code>oracle.kv.KVStore.getFuture(byte[])</code> to recreate a Future
instance.
[#24228]
</li>
<li>
There are changes to the way the results and status of DDL operations
are reported in the API. Information about the execution of a DDL
operation continues to be returned
via <code>oracle.kv.StatementResult</code>. In past releases, both
return values and execution status were returned
via <code>StatementResult.getInfo(),
StatementResult.getInfoAsJson()</code>. Now, results are return via a
new method, <code>StatementResult.getResult()</code>, while status is
returned via <code>StatementResult.getInfo(),
getInfoAsJson</code>. [#24277]
</li>
</ol>
<h3><a name="Utilities334">Utility Changes</a></h3>

<ol>
<li>
<code>plan deploy-admin</code> now deploys an Admin with the same
type (primary or secondary) as the zone in which it resides. Previously
the Admin was always created as a primary.
</li>
<li>
<code>plan repair-topology</code> will change an Admin's type so that
the type matches the zone in which it resides.
</li>
<li>
<code>verify configuration</code> will report the following:
<ul>
<li>
A <i>violation</i> for each Admin service whose type does not match the
type of the zone in which it resides
<li>
A <i>violation</i> if the number of Admin services in a zone is less than
the zone's rep factor
</li>
<li>
A <i>note</i> if the number of Admins services in a zone is greater than
the zone's rep factor
</li>
</ul>
</li>
<li>
The put command in the Admin CLI now has a new <code>-exact</code> flag. When
true, the input json string or file specified to the command must
contain values for all columns in the table, and cannot contain
extraneous fields.
</li>
<li>
The Admin CLI now supports a new "show versions" command, which
displays client and server version information. [#24005]
</li>
<li>
The Admin CLI now provides the ability to use the semicolon character as a
command terminator to enter multiple commands, or to enter commands on
multiple lines.
<p>
For example, the following command would have had to be typed in a single line:
<pre>
  kv-> execute "create table users(name string, address string, primary key (name))"
</pre>
or
<pre>
  kv-> execute "create table users \
    ->                 (name string, \
    ->                  address string, \
    ->                  primary key (name))"
</pre>
but can now be entered this way:
<pre>
  kv-> execute "create table users
    ->                 (name string,
    ->                  address string,
    ->                  primary key (name))";
</pre>
In addition, multiple commands can be entered as below, using a semicolon as
a terminator.
<pre>
  kv-> show table -name users; get table -name users;
</pre>
[#24119]
</li>
<li>
A new command line utility has been added that disables services
associated with a storage node.  You can use the new utility when
starting a storage node whose services had configuration changes while
the node was offline, to allow the configuration to be updated so that
the services can be started with the proper configuration.
<p>
The new utility is invoked this way:
<pre>
  java jar -kvstore.jar disable-services -root ROOT_DIRECTORY [-config CONFIG_FILE]
</pre>
[#23988]
</li>
<li>
Improvements have been made to the output of the Admin CLI <code>verify
configuration</code> command, and both the Admin CLI and top level
versions of the <code>ping</code> command:
<ul>
<li>Output now uses JSON format if the new <code>-json</code> flag is
specified
<li>Output now includes summaries of the status of shards and zones in
the store, and information about the replication status of non-master
replication nodes
<li>Output for the ping commands now includes information about admin
services, to match the information provided by verify configuration
</ul>
<p>
[#23981]
</li>
<li>
A new "verify" option has been added to the  diagnostics command line
utility. This option does a variety of health and configuration
checks, such as:
<ul>
<li>configuration values are valid</li>
<li>inter-node clock skew is within the permissible maximum skew value </li>
<li>all nodes have supported Java versions</li>
<li>all nodes have correct network connectivity</li>
<li>all nodes have compatible NoSQL DB versions</li>
</ul>
<pre>
java -jar kvstore.jar diagnostics verify -help

Usage: verify -checkLocal |
              -checkMulti

</pre>
</li>
</ol>

<h3><a name="BugFixes334">Bug and Performance Fixes</a></h3>

<ol>
<li>
Changes have been made to transfer the RN master nodes on SN shutdown.
When a SNA shuts down it checks if any of the RNs managed by the SNA is
a master for its replication group. If an RN is a master, the SNA causes
a master-transfer before shutting down the RN. The implementation performs
the transfers one at a time so that each transfer can take into account the
results of the previous one, to avoid overloading the target SNs.  [#22426]
</li>
<li>
Modified the replication node and admin services to permit them to start
up even if other members of a service's replication group were managed
by storage nodes whose hostnames cannot be resolved via DNS.  This
change allows the store to continue to function, and in particular to
support restarting services, if failures of storage nodes cause the
nodes to have unresolvable DNS names.  [#23120]
</li>
<li>
Modified the 'topology validate' CLI command. In addition to the
'violations' and 'notes' that are currently displayed by that command,
it now also notes when the topology contains any zones that are empty;
that is, the zones that contain no SNs.  [#23222]
</li>
<li>
Currently the 'verify configuration' CLI command performs a
component-by-component comparison of the store's current state or
configuration against what is reflected in the store's Admin database,
and displays any inconsistencies. Modified the command to also note
when any empty zones exist in the store. With respect to the current
the flags taken by the 'verify configuration' command, any changes
related to empty zones should apply to all arguments except the
optional -sn argument; in which case, the new behavior related to
identifying empty data centers should not be executed.  [#23223]
</li>
<li>
The CLI 'snapshot' commands currently allow one to collect a snapshot
from each Admin and RN of every reachable SN in the store, or to
remove one or all instances of previously collected snapshot
data. These commands have been modified to take a '-zn' or '-znname'
flag so that the command applies to all the SNs executing in the zone
with the specified id or name.  [#23224]
</li>
<li>
A bug has been fixed that could cause the Admin service to hang if the
Admin web console is enabled, and is displaying log file output within
the logtail pane, and an administrative command that updates Admin
service configuration, such as plan deploy-admin, is running. [23907]
</li>
<li>
Clarified an error message that would occur when a field name was
used instead of <i>elementof()</i> in a CHECK expression involving a map
or array. [#24055]
</li>
<li>
Relaxed the DDL PRIMARY KEY expression, allowing the statement to
redundantly specify single primary key fields as a SHARD keys as
well.  In a top-level (non-child) table the primary key is equivalent
to the shard key unless otherwise specified.  This change makes statements
like this legal even though use of "SHARD" is redundant:
<i>CREATE TABLE mytable(id INTEGER, PRIMARY KEY(SHARD(id)))</i>.
[#24105]
</li>
<li>
Changes have been made to the request dispatcher to favor more rapid
request failover on a node failure, reducing the possibility of a
RequestTimeoutException. As part of this change, the default socket
open timeouts have been reduced from 5 seconds to 3 seconds to permit
a redispatch of requests within the request timeout period.  [#24152]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.2.15</u></h3>
<h3><a name="NewFeatures3215">New Features</a></h3>
<ol>
<li>
A declarative data definition language has been defined that allows
declarative creation and management of tables and indexes.  The
language reference is
in <a href="oradoc-lookup:/NSTBJ-GUID-F1053BED-01E9-4BD4-BF9E-6354A8AA12FF/Table+Data+Definition+Language+Overview">
Table Data Definition Language Overview</a>.  The language is accessible via APIs
in Java as well as the new C driver.  It can also be executed using the new
"execute" command in the administrative command line interface (Admin CLI).
</li>
<li>
The Command Line Interface (Admin CLI) has a new "execute" command that can
be used to execute data definition language (DDL) statements. The Java
or C API is the preferred mechanism for defining tables, but if you
wish to define and manage tables via the Admin CLI, the "execute" command is
preferred over the previous "table" command.
</li>
<li>
A new C driver has been created to operate on tables and indexes
in Oracle NoSQL Database.  It is a separately downloadable product on
the same page as this distribution.  It is source code and must be compiled,
along with its dependent libraries.  Complete instructions are in its
distribution.
</li>
<li>
The implementation of indexes on maps has been enhanced so that it is
now possible to create an index on the key strings of a map as well as
an index on the values of a map, making these indices much more useful
for a variety of data models. These indexes result in multiple
index entries for a given row, up to the number of map
entries. Additional APIs were added to help use these indexes.
</li>
<li>
When using the Admin CLI interactively, you can now use backslash to
enter a command on multiple lines. For example, you can now type:
<pre>
kv-> show events -type stat
 or
kv-> show events \
> -type stat
</pre>
</li>
<li>
A new diagnostics command line utility is available to provide support
for troubleshooting an Oracle NoSQL DB cluster. Currently, the
"collect" functionality lets a user easily retrieve and package
logfiles each node in the cluster for further analysis. Additional
functionality will be rolled out over time. The new utility is invoked
this way:
<pre>
java -jar kvstore.jar diagnostics

diagnostics-> help
Oracle NoSQL Database Diagnostic Utility Commands:
	setup
	collect
	exit
	help

diagnostics->
</pre>
</li>
</ol>
<h3><a name="APIChanges3215">API Changes</a></h3>
<ol>
<li>
<code>oracle.kv.table.TableAPI.execute(String)</code> and
<code>oracle.kv.table.TableAPI.executeSync(String)</code> were added
to execute Data Definition Language (DDL) statements.
</li>
<li>
New interfaces, <code>oracle.kv.table.StatementResult</code> and
<code>oracle.kv.table.ExecutionFuture</code> were added to handle
results of the new statement execution methods
on <code>TableAPI</code>.
</li>
<li>
<code>oracle.kv.table.MapValue.putNull(String)</code> and the constant,
<code>oracle.kv.table.MapValue.ANONYMOUS</code>, were added in order to
handle new the map indexes.
</li>
<li>
<code>oracle.kv.table.Index.createMapKeyFieldRange(String)</code> and
<code>oracle.kv.table.Index.createMapValueFieldRange(String)</code> were added
to create <code>FieldRange</code> instances for the new map indexes.
</li>
<li>
The method
<code>oracle.kv.table.TableAPI.execute(List&lt;TableOperation&gt;,
WriteOptions)</code> used to throw
<code>oracle.kv.OperationExecutionException</code>. However,
<code>OperationExecutionException</code> provides information that
applies to the key value API in the <code>oracle.kv</code> package
rather than the Table API in
<code>oracle.kv.table</code>.The method has been changed to throw a
new exception,
<code>oracle.kv.table.TableOpExecutionException</code>, which provides
information suitable for the Table API.
<p>
Note that this is an incompatible API change. Applications which
invoked <code>TableAPI.execute(List&lt;TableOperation&gt;,
WriteOptions)
</code> must be modified to
handle <code>TableOpExecutionException</code> instead of
<code>OperationExecutionException</code>.

</li>
</ol>
<h3><a name="BugFixes3215">Bug and Performance Fixes</a></h3>
<ol>
<li>
The CLI verbose and hidden commands have been enhanced so they can be
specified using on/off parameters in addition to the previous toggle
type functionality.
[#23245]
</li>
<li>
Modified the Admin CLI help to not display deprecated commands by
default.A new -includeDeprecated flag was added for the CLI help
command. If this flag is used, the deprecated commands are listed along
with other commands.
[#23365]
</li>
<li>
The <code>java -jar kvstore.jar load</code> utility did not provide
proper feedback when there were errors in operation, and incorrectly
returned "Load succeeded". Now it returns both a non-zero status code
when an error has been found and an accurate status message. [#23681]
</li>
<li>
Fixed a security weakness that let arbitrary authenticated clients
modify the store's topology by specifying an altered topology when
propagating topology changes from one RN to another. A signature-based
topology integrity check is employed to prevent it. [#23709]
</li>
<li>
A window existed where a secondary index could incorrectly lose
entries if the store was expanded while updates to the underlying
table were happening. This window has been closed. [#23724]
<li>
Fixed an issue that required users to reauthenticate to the store in
order for changes made by granting or revoking roles for the current
user to take effect. A real-time session update mechanism was
introduced that allows existing login sessions to reflect role changes
immediately without reauthentication. [#23839]
</li>
<li>
Fixed a bug that sometimes prevented re-execution of interrupted
change-parameters plans, when Admin parameters were being changed. [#23880]
</li>
<li>
Fixed a problem where a client performing a parallel scan against a
secure store without having permission to read the store would get a
timeout exception rather than having the scan return no values. This
problem could be encountered when using the <code>get kv -all</code>
command with the administrative CLI:
<pre>
kv-> get kv -all
Error handling command get kv -all: Failed to iterate records :
Parallel storeIterator Request Queue take timed out.
(12.1.3.1.3) Timeout: 5000ms
</pre>
If the scan was performed via the API using the
<code>KVStore.storeIterator</code> or <code>storeKeysIterator</code>
method overloadings that supply a <code>StoreIteratorConfig</code>, the
problem could cause the method call to throw a
<code>RequestTimeoutException</code>. In all of these cases, the
iteration now returns no elements. [#23881]
</li>
<li>
Fixed an issue that would result in duplicate values returned from the
Hadoop APIs when a complete primary key is specified. [#23958]
</li>
<li>
Fixed a bug where iteration over array indexes when the result set was
larger than the batch size (default 100) could result in incorrect
results or a hang. [#23977].
</li>
<li>
Fixed a slow memory leak in the handling of socket timeouts: The socket
object associated with a failed socket connect operation continued to be
referenced and could not be garbage collected. [#24039]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.1.7</u></h3>
<h3><a name="NewFeatures317">New Features</a></h3>
<ol>
<li>Added a convenience method on the Table interface to construct a
  MultiRowOptions instance from a single list of table names and
  optional FieldRange. [#23807]
</li>
<li>Added FieldRange.getField() to return the FieldDef instance that
was used to construct the FieldRange object. [#23908]</li>
</ol>
<h3><a name="BugFixes317">Bug and Performance Fixes</a></h3>
<ol>
<li>
Fixed a problem that caused index creation on an empty table to take as
much as 10 minutes to complete. [#23826]
</li>
<li>
Fixed a performance regression in the CLI delete command.  This fix
may result in some delete commands being slower because the problem
was an optimization for some delete cases, but in the general
case delete will have the same performance it had in release
3.0.5. [#23918]
</li>
<li>
Removed unnecessary non-topology metadata broadcasts to replica rep nodes.
Since only a master rep node can update the metadata for the shard there is no
point in attempting to update a replica. With this change two new admin
parameters have been added to control the metadata broadcast:
<ul>
    <li>
    <i>broadcastMetadataDelay</i> specifies the broadcast metadata retry delay.
    This delay is the time between attempts to update RNs when trying to meet
    the metadata threshold. If not specified, the default delay is 10 seconds.
    </li><li>
    <i>broadcastMetadataThreshold</i> specifies the broadcast metadata
    threshold. The threshold is the percent of shards that must be successfully
    updated during a broadcast. If not specified, the default threshold is 20%.
    </li>
</ul>
<br>
Note that this fix only affects the broadcast of table and security metadata.
The topology broadcast parameters and behavior remain unchanged. [#23362]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.1.5</u></h3>
<h3><a name="NewFeatures315">New Features</a></h3>
<ol>
<li>
Added support for role-based authorization for both the API and the
administrative CLI. Authorization is built on the authentication mechanism
introduced in release 3.0. Each authenticated user of the KVStore can be
granted roles which determine which APIs and CLI commands the user can
access. This release only supports built-in roles, including the "read" and
"write" roles for data access control, and the "sysadmin" and "dbadmin" roles
for system and database operation control, respectively. More details of this
feature are described in the Oracle NoSQL Database Security Guide.
<p>
The KVStore logging system has also been enhanced to log security
sensitive events.  Two new logging levels named SEC_WARNING and
SEC_INFO have been introduced.  Messages logged at SEC_WARNING level
will produce critical events in the CLI.  High level security events
like failed login attempts and unauthorized operations will be
recorded as SEC_WARNING KVStore events. Execution of CLI commands
which require sysadmin or dbadmin roles will be recorded as SEC_INFO
events. Logging messages of all security sensitive events have
"<i>timestamp</i> KVAuditInfo" as the prefix for the ease of grepping
and filtering. [#23423]
</li>

<li>
The makebootconfig command has been enhanced to do validity checking
of all parameters. The -force flag has been added to let the user
manually override the default validity checks if desired.
[#23422]
</li>
</ol>

<h3><a name="BugFixes315">Bug and Performance Fixes</a></h3>
<ol>
  <li>Fixed a bug that could cause the plan change-parameters command
  to fail in some cases, reporting a NullPointerException in the plan
  history. This could only come about in some situations where the
  parameter change requires restarting all nodes, but not all nodes
  are available.
  [#22673]
  </li>

  <li>
  Modified heap size calculations for replication nodes to reduce heap
  sizes in some cases to permit using compressed object references.
  <p>
  The supported Java environments can use compressed object references
  when the heap size is smaller than a certain size, currently between
  25 and 32 GB depending on the implementation. Because the space
  savings provided by compressed references are substantial, using a
  larger heap size typically results in less usable space unless the
  heap size is at least 50% larger than the largest size that supports
  compressed references.
  <p>
  The system now automatically reduces the replication node heap size if
  the value of the memoryMB storage node parameter produces a heap size
  that is too large to support compressed references but not large
  enough to provide more usable space. The heap size is not reduced if
  the application specifies a javaMiscParams replication node parameter
  that explicitly specifies either non-compressed references or the
  maximum heap size. Note that, if the memoryMB parameter is not
  specified explicitly, or is set to zero, the system sets it to the
  amount of physical memory available on the host, and will reduce the
  heap size in the same way as when memoryMB is set explicitly to a
  non-zero value. [#22695]
  </li>

  <li>The Version.getVersion method has been deprecated and removed from
  the public documentation.  It will probably be removed entirely in a
  future release.  The getVersion method returns an internal version
  number which is only meaningful relative to a particular shard.  For
  that reason, it is not a safe to compare the method results for
  arbitrary versions, and so it has been removed.  Applications can
  continue to use the equals method to compare versions for identity,
  but there is currently no official way to compare versions to
  determine which is newer.  We could add that capability in the future
  if applications have a need for it.  [#23526]
  </li>

  <li> The plan add-index command has been changed to check for
  index creation status more promptly, which lets the command finish sooner.
  [#23568]
  </li>

  <li>Added additional type validation when JSON input is used to
  construct Row and PrimaryKey instances.  Previously it was possible
  to provide incorrect types that were silently cast to the correct
  type based on the table schema, possibly resulting in loss of
  information. [#23765].
  </li>

  <li>Fixed a problem that could be encountered during the
  configuration of a NoSQL Database cluster hosted within an IBM J9
  JVM environment.  If the Storage Nodes were deployed without
  providing an explicit value for the optional memory_mb parameter,
  the available memory calculation for the Replication Node hosted on
  that SN was incorrect, which might cause an "OutOfMemoryError" for
  that replication node when the plan deploy-topology command was
  run. This could only happen on the J9
  JVM, and has been fixed. [#23737].
  </li>

  <li>
  Both Hadoop and Oracle External Tables employ independent processes to
  read data from a store in parallel. A change has been made to the way work is
  distributed among these processes. The new algorithm attempts to distribute
  work in a way that minimizes contention on a single replication node, while
  maximizing the amount of parallelism across the store. The number of shards,
  the replication factor, and the requested consistency, are input into the
  calculation. This change may also affect the number of Hadoop processes, or
  splits which are generated. In addition to the change in work distribution,
  both Hadoop and external table processes may use the Parallel Scan APIs,
  allowing multiple threads to operate in a single process. [#23749]
  <br>
  Note that the public method
  <code>oracle.kv.hadoop.KVInputFormatBase.setDirection(Direction)</code>
  has been deprecated since only <code>Direction.UNORDERED</code> is supported.
  </li>

  <li>Fixed a problem where, if an index was created on an array, or
  field in an array, and the array itself is null in a Row, a
  ClassCastException could be thrown during index key extraction on a server
  node. [#23757].
  </li>

  <li> Modified the Ant build script so that the default target, which
  builds the JAR files, works for the Community Edition.  You can now
  use ant to build new versions of the JAR files after making
  modifications to the source code. [#23764]
  </li>

  <li>
  If a client program made an unexpected, non-secure call to the trusted
  login service of an Storage Node, a flaw in the service implementation caused the
  service to hang, causing future user logins to fail. This bug has been
  fixed. [#23786]
  </li>

  <li>Fixed an issue with a runaway number of client threads when multiple
  index iterators are opened and closed in quick succession. Specifically,
  the iterator's close() method will now wait for its threads to exit before
  returning. This is the same behavior as the parallel scan iterators,
  though it is documented that it does not wait. The documentation has
  been corrected. [#23797]
  </li>

  <li> Fixed a bug which could result in a deadlock situation when an index
  iterator is closed. As part of this fix the Javadoc for the
  <code>oracle.kv.KVStore</code> and <code>oracle.kv.table.TableAPI</code>
  interfaces have been updated to make it clear that the iterators returned by
  those interfaces can only be used safely by one thread at a time unless
  synchronized externally.
  [#23799]
  </li>

  <li>
  In the course of upgrading a NoSQL cluster from R2.X to R3.x, when
  the first Storage Node upgrade occurs, the Replication Node it hosts
  will transition into "STARTING" status and will wait until more nodes
  are upgraded. If the user runs the "verify upgrade" command at this
  point, they would see the following, misleading error:
  <pre>
   kv-> verify upgrade
   Unknown Exception: class oracle.kv.impl.rep.admin.RepNodeAdminFaultException
   RepNode is not RUNNING, current status is STARTING (12.1.3.1.2)
   oracle.kv.impl.rep.admin.IllegalRepNodeServiceStateException:
   RepNode is not RUNNING, current status is STARTING
  </pre>
  This has been fixed. [#23859]
  </li>

  <li>The following parameters used by the Berkeley DB JE storage
  engine used within NoSQL Database have been changed to reflect
  changes in the updated version of JE used by this release:
  <ul>
  <li>EnvironmentConfig.EVICTOR_MAX_THREADS which was previously set to 2
  now uses the default JE value.
  </li>
  <li>EnvironmentConfig.CHECKPOINTER_BYTES_INTERVAL has been changed from
  200000000 to 500000000.
  </li>
  </ul>
  </li>

  <li>
  Fixed a performance issue where
  the <a href="oradoc-absolute:/AdminGuide/independent_commands.html#stopagent">
  stop</a> utility command resulted in an incomplete checkpoint
  if the checkpoint took more than 10 seconds. The incomplete checkpoint could
  result in the replication node taking longer to restart than it would
  with a complete checkpoint. The <i>stop</i> command has also been modified to
  initiate checkpoints in parallel across all the replication nodes hosted by
  the storage node being shutdown, thus making the command run faster.
  </li>
  <li>
  Fixed a problem that caused upgrading from earlier releases to a 3.0
  release to fail in some cases, with the following stack trace in the
  Admin log. [#23879]
  <pre>
com.sleepycat.persist.evolve.IncompatibleClassException: (JE 6.2.5) Changes to the fields or superclass were detected when evolving class:
oracle.kv.impl.admin.plan.task.StopAdmin version: 1 to class: oracle.kv.impl.admin.plan.task.StopAdmin version:
1 Error: A new higher version number must be assigned
---
(Note that when upgrading an application in a replicated environment, this exception may indicate that the Master was mistakenly upgraded
before this Replica could be upgraded, and the solution is to upgrade this Replica.)
    at com.sleepycat.persist.impl.PersistCatalog.init(PersistCatalog.java:512)
    at com.sleepycat.persist.impl.PersistCatalog.initAndRetry(PersistCatalog.java:268)
    at com.sleepycat.persist.impl.PersistCatalog.&lt;init&gt;(PersistCatalog.java:228)
    at com.sleepycat.persist.impl.Store.&lt;init&gt;(Store.java:202)
    at com.sleepycat.persist.EntityStore.&lt;init&gt;(EntityStore.java:190)
    at oracle.kv.impl.admin.Admin.initEstore(Admin.java:2126)
</pre>
  </li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.0.14</u></h3>
<h3><a name="NewFeatures3014">New Features</a></h3>
<ol>
<li>
When using the Table API, it is now possible to create indices on
fields in records, maps, and arrays. [#23091]
</li>
<li>
The integration of Oracle NoSQL Database with Oracle Coherence has been updated to
support Coherence 12c (12.1.2). As of Coherence 12.1.2, cache configuration
parameters are specified within a custom XML namespace and are processed by the
NoSQL Database namespace handler at runtime. Though it's possible to use this
updated module with Coherence version 3.7.1, we highly recommend that you upgrade
Coherence to the latest version. Please see the javadoc for
<code>oracle.kv.coherence</code> package for information on how to configure a NoSQL Database
backed cache with Coherence 12.1.2, or the earlier Coherence 3.7.1. [#23350]
</li>
<li>
It is now possible to use Oracle External Tables to access Oracle NoSQL Database tables created with the Table API.
In addition to the usual required properties, users need to specify the
table name in the external table configuration file.
Please see KVHOME/examples/externaltables/cookbook.html for details.[#23605]
</li>
<li>
Added a new "size" option to the Admin CLI table command, to estimate
the in-memory size of the given table. The results of the size command
can be used as inputs when planning resource requirements for a store.
[#23444]
</li>
<li>
Oracle Enterprise Manager can now monitor instances of Oracle NoSQL Database.
For more information, please see
<a href="oradoc-lookup:/NSADM-GUID-414B80D2-64EF-4C64-8515-025481DACF05/Integrating+Oracle+Enterprise+Manager+(OEM)+with+Oracle+NoSQL+Database">
Integrating Oracle Enterprise Manager (OEM) with Oracle NoSQL Database</a> in the Admin Guide.
</li>
<li>
It is now possible to access data written to an Oracle NoSQL Database via the
Table API from within a Hadoop MapReduce job. In addition to the usual required
properties, users now need to specify the table name in the command line used
to initiate the MapReduce job. Please refer to the javadoc of the class,
KVHOME/examples/hadoop/table/CountTableRows.java for additional details.[#23714]
</li>
<li>
It is now possible to execute Hive queries against data written to an Oracle
NoSQL Database via the Table API. To employ this feature, one must create a
Hive external table that is 'STORED BY' the new oracle.kv.hadoop.hive.table.TableStorageHandler
class, with fields similar to the fields with which the Oracle NoSQL Database
table was created; that is, same number and types. Additionally, the Hive
TBLPROPERTIES must specify the store name, the helper host and ports, and the
table name (which does not have to be equal to the Hive table name).[#23714]
</li>
</ol>
<h3><a name="BugFixes3014">Bug and Performance Fixes</a></h3>
<ol>
<li>
Added more sanity checking and improved error messages for the
securityconfig add/remove-security commands.  [#23311]
</li>
<li>
Fixed a bug where specifying an invalid value for the Storage Node
parameter, "mgmtClass" could cause a crash in the Admin service.
[#23227]
</li>

<li>
Modified the oracle.kv.RequestLimitConfig constructor to improve
bounds checking and correct problems with integer overflow. [#23244]
</li>

<li>
Fixed a bug that sometimes caused Admin parameters not to take effect
until the Admin's hosting SNA was rebooted. [#23429]
</li>

<li>
Added a new attribute (String replicationState) in the RepNode MBean
presented via JMX, to indicate the state of the RepNode's membership
in its replication group.  Typically the value will show "MASTER" or
"REPLICA", but it can also report "DETACHED" or "UNKNOWN".  This same
value is reported via SNMP in the repNodeReplicationState object, as
defined in nosql.mib. [#23459]
</li>

<li>
Modified the Durability, RequestLimitConfig, and Version classes to
implement Serializable to permit serializing instances of
oracle.kv.KVStoreConfig, which was already serializable.  [#23474]
</li>

<li>
Fixed a bug where an operation using the Table API might see a
SecondaryIntegrityException if there is a replication node failover
while secondary index is populated. [#23520]
</li>

<li>
Prior to this release, it was not possible use the Load utility to create
a new store from snapshot files that had been taken against a store
with security enabled, or a store that was using the Table API.  This
has been fixed. The -security, -username, -load-admin, and -force
flags were added to the load utility to use in this case. See the
Administrator's Guide for more information. [#23528]
</li>

<li>
Fixed a bug where invoking the "history" command in the Admin CLI with
the "-last" option and a value that is greater than the total number
of commands executed in the store could result in a
java.lang.ArrayIndexOutOfBoundsException. [#23579]
</li>

<li>
Fixed a bug where an Admin service might exit with the following
exception. Before the fix, administrative functionality would
seamlessly fail over to another admin service, but the process exit
was unnecessary and would show up as an alertable event.
<pre>
com.sleepycat.je.rep.UnknownMasterException:
Transaction -XXX cannot execute write operations because this node is no longer a master
</pre>
[#23580]
</li>

<li>
Fixed a bug in the Table API so that enum fields may have names that begin
      with an underscore.
</li>

<li>
In rare cases, when a store has been deployed with Storage Nodes with
capacity > 1 and there are concurrent delete operations, table iteration operations,
and a transfer of mastership roles in a shard, it could be possible
for the iteration operation to incorrectly skip a value that should
have been returned by the iterator. This has been fixed. [#23608]
</li>

<li>
Fixed a GC configuration issue that could cause the CMS phase of the Java GC to
run repeatedly, consuming CPU resources on an otherwise idle RepNode. The fix
changed the default JVM CMSInitiatingOccupancyFraction from 77 to
80. Our testing indicates that this is a better configuration under a broad
range of application access patterns. However, if you need to override this new
configuration in some unusual circumstance, you can use the Admin's
<i>change-policy</i> command and, if it's an existing store, the <i>plan
change-parameter</i> command, as below:
<pre>
change-policy -params "javaMiscParams=-XX:CMSInitiatingOccupancyFraction=77"
plan change-parameters -all-rns -params "javaMiscParams=-XX:CMSInitiatingOccupancyFraction=77"
</pre>
[#23652]
</li>
<li>
Fixed the following bugs which could occur in a store with security
enabled:
<ul>
<li>
The following error could be reported after a deploy-topology command
which deploys a new replication node in a security enabled store:
[#23682]
<pre>
Task 23/DeployNewRN on sn1(slc06tyu:5000) ended in state ERROR
oracle.kv.impl.fault.RNUnavailableException: Security metadata
database is not opened yet.
</pre>
<li>
The following exception could be seen after an elasticity change in a
          security enabled store: [#23703]
<pre>
Insufficient access rights : client host: xx.xxx.xxx.xx:
attempt to call RepNodeAdmin.updateMetadata(MetadataInfo,AuthContext,short)
</pre>
<li>
The following problem might be logged after an elasticity change in a
          security enabled store: [#23704]
<pre>
ProcessMonitor: java.lang.NullPointerException
ProcessMonitor: at oracle.kv.impl.api.rgstate.RepNodeState$ReqHandlerRef.resolve(RepNodeState.java:649)
ProcessMonitor: at oracle.kv.impl.api.rgstate.RepNodeState$ReqHandlerRef.get(RepNodeState.java:709)
</pre>
</ul>
</li>
<li>
Fixed a bug where application requests might unnecessarily time out
for a brief period of time directly after an elasticity change [#23705]
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Packaging3014">Packaging and Documentation Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
The version of the Oracle Coherence library bundled with Oracle NoSQL
Database has been upgraded to the more recent Coherence 12.1.2. This
requires a change in the way cache configuration parameters are
specified for the NoSQL Database backed cache.
</li>
<li>
New documentation has been added on how to use the Large Object
API. See the index page, and "Oracle NoSQL Database Large Object API".
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.0.9</u></h3>
<h3><a name="NewFeatures309">New Features</a></h3>
<ol>
<li>
Modified the administrative CLI to save its command line history to a
file so that it is available after restart.  If you want to disable this
feature, the following Java property should be set while running
runadmin:
<pre>
java -Doracle.kv.shell.jline.disable=true -jar KVHOME/kvstore.jar runadmin -host &lt;hostname&gt; -port &lt;portname&gt;
</pre>
<p>
The CLI attempts to save the history in a
<code>KVHOME/.jlineoracle.kv.impl.admin.client.CommandShell.history</code>
file, which is created and opened automatically. The default history
saved is 500 lines.  If the history file cannot be opened, it will fail
silently and the CLI will run without saved history.
<p>
The default history file path can be overridden by setting
the <code>oracle.kv.shell.history.file=</code><i>path</i> Java property.
<p>
The default number of lines to save to the file can be modified by
setting the <code>oracle.kv.shell.history.size=</code><i>int_value</i> Java
property. [#22690]
</li>
<li>
Modified the admin CLI <code>aggregate</code> command to provide
subcommands for tables and key/value entries.  The <code>aggregate
table</code> subcommand performs simple data aggregation operations on
numeric fields of a table, while the <code>aggregate kv</code>
subcommand performs aggregation operations on keys. [#23258]
</li>
</ol>
<h3><a name="BugFixes309">Bug and Performance Fixes</a></h3>
<ol>
<li>
Modified the implementation of index iterators to use weak references so
that the garbage collector can remove the resources associated with
unused index iterators. [#23306]
</li>
<li>
Improved the handling of metadata propagation and other
internal operations. [#23355] [#23368] [#23385]
</li>
<li>
Modified the external tables integration to distribute the concurrent
processing load more evenly across processes. [#23363]
</li>
<li>
Fixed a problem where a failure during a partition migration performed
during a topology redistribution for a store that has indexes resulted
in <code>SecondaryIntegrityException</code>s being thrown when the
migration was restarted. [#23392]
</li>
<li>
Removed the <code>FieldRange.setEndDate</code> method, in favor of the
existing <code>setEnd</code> method. [#23399]
</li>
<li>
Modified schema evolution to prevent changes that could resurrect an old
field using a different type. Such a change would cause old data to
become unreadable by the current table. This fix prevents resurrection
of a field name unless it exactly matches the previous
definition. [#23403]
</li>
<li>
Fixed a problem with handling network timeouts that could result
in <code>FaultException</code> being thrown from KVStore operations
instead of <code>RequestTimeout</code> when a timeout occurs.  Here's a
sample stack trace:
<pre>
Caused by: oracle.kv.FaultException: Problem during unmarshalling (12.1.2.1.24)
Fault class name: java.rmi.UnmarshalException
    at oracle.kv.impl.api.RequestDispatcherImpl.faultIfWrite(RequestDispatcherImpl.java:968)
    at oracle.kv.impl.api.RequestDispatcherImpl.handleRemoteException(RequestDispatcherImpl.java:883)
    at oracle.kv.impl.api.RequestDispatcherImpl.handleDispatchException(RequestDispatcherImpl.java:736)
    at oracle.kv.impl.api.RequestDispatcherImpl.execute(RequestDispatcherImpl.java:572)
    at oracle.kv.impl.api.RequestDispatcherImpl.execute(RequestDispatcherImpl.java:1031)
    at oracle.kv.impl.api.KVStoreImpl.executeRequest(KVStoreImpl.java:1251)
    at oracle.kv.impl.api.KVStoreImpl.putIfVersion(KVStoreImpl.java:990)
    at oracle.kv.impl.api.KVStoreImpl.putIfVersion(KVStoreImpl.java:968)
    [...]
    ... 41 more
Caused by: java.rmi.UnmarshalException: Error unmarshaling return header; nested exception is:
    java.net.SocketException: Socket closed
    at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:228)
    at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:161)
    at java.rmi.server.RemoteObjectInvocationHandler.invokeRemoteMethod(RemoteObjectInvocationHandler.java:194)
    at java.rmi.server.RemoteObjectInvocationHandler.invoke(RemoteObjectInvocationHandler.java:148)
    at com.sun.proxy.$Proxy21.execute(Unknown Source)
    at oracle.kv.impl.api.RequestHandlerAPI.execute(RequestHandlerAPI.java:94)
    at oracle.kv.impl.api.RequestDispatcherImpl.execute(RequestDispatcherImpl.java:560)
    ... 46 more
Caused by: java.net.SocketException: Socket closed
    at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:121)
    at java.net.SocketOutputStream.write(SocketOutputStream.java:159)
    at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)
    at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)
    at java.io.ObjectOutputStream$BlockDataOutputStream.flush(ObjectOutputStream.java:1822)
    at java.io.ObjectOutputStream.flush(ObjectOutputStream.java:718)
    at sun.rmi.transport.StreamRemoteCall.releaseOutputStream(StreamRemoteCall.java:114)
    at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:212)
    ... 52 more
</pre>
[#23411]
</li>
<li>
Modified table iteration to optimize performance when all matching
entries fall within a single shard. [#23412]
</li>
<li>
Fixed an issue where the index scan iterator would fail to return
records from a shard if there was a record that compared equal to a
record from another shard.  This situation occurred when there was more
than one shard in a store and there were equivalent index entries for a
given index in both shards.  The symptom was index iteration returning
fewer rows than expected. [#23421]
</li>
<li>
Added several interfaces to the table package:
  <ul>
    <li> <code>List&lt;String&gt;IndexKey.getFields()</code> to return the
    fields used to define the index.</li>
    <li> <code>List&lt;String&gt;PrimaryKey.getFields()</code> to return the
    fields used to define the primary key.</li>
    <li> <code>List&lt;String&gt;RecordValue.getFields()</code> to return the
    fields used to define the record, in declaration order.</li>
    <li> <code>Map&lt;String, FieldValue&gt; MapValue.getFields()</code> to
    return an immutable view of the map.</li>
  </ul>
The related javadoc was also updated to indicate that the lists and
maps returned from these, and similar interfaces, are immutable.
[#23433]
</li>
<li>
The data Command Line Interface (CLI) has a method to input table rows
from a file with a JSON representation.  This input method had an
issue where a blank line could cause an infinite loop in the input
path.  This has been fixed in a way that will result in silently
skipping blank lines as well as comment lines (those whose first
non-whitespace character is "#").
[#23449]
</li>
<li>
Fixed handling of null values in indexed fields and in IndexKey.
Previously, a null value in an indexed field could cause a server side
exception.  During a put, null values in indexed fields will result in
no index entries for indexes in which that field participates.  Further,
null values are not allowed in IndexKey instances.
IllegalArgumentException is thrown if an attempt is made to set a null
value in an IndexKey. [#23588]
</li>
<li>
Modified the Admin Service to listen on all interfaces on a host. This
change permits deployment of KVStore in heterogeneous network
environments, where a hostname may be resolved to different IP
addresses to make the best possible use of the available network
hardware.  [#23524]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.3.0.5</u></h3>
<h3><a name="NewFeatures305">New Features</a></h3>
<ol>
<li>
  A new client interface has been added that includes a set of
  datatypes and a tabular data model using those types. The tabular
  data model is used to provide support for secondary indexes which
  are defined on fields in a  table.  The model is discussed in the
  <a
  href="oradoc-lookup:/NSTBJ-GUID-2C12DC44-6459-4190-93CB-5DC6C3A7C6DA/java-driver-table">
  Getting Started Guide for Tables</a>
  <p>
  Tables and indexes are defined using the administrative CLI and
  accessed via programmatic API.  The data CLI has been enhanced to
  perform operations on tables and indexes as well.  The API is
  documented in the <a href="oradoc-absolute:/java-api/index.html">
  Oracle NoSQL Database javadoc</a>, and is primarily in  the
  <i>oracle.kv.table</i> package.
  <p>
  It is possible to define tables that overlay data created with NoSQL
  DB Release 2 if that data was created using a conforming Avro
  schema.  This overlay is required in order to create secondary
  indexes on conforming Release 2 data.
  <p>
  The existing key/value interface remains available.
</li>
<li>
It is now possible to define secondary indexes for records.  See the previous
changelog entry about tables.  Index entries for a given record have
transactional consistency with their corresponding primary records.
Index iteration operations are part of the new table API.  Index scan
operations allow applications to iterate over raw indexes in 3
ways -- forward order, reverse order, and unordered.  It is possible
to define exact match and range scans in indexes.  Indexes can be on
single fields or defined as composite indexes on multiple fields in a
table.
</li>
<li>
Support for username/password authentication and secure network communications
has been added.  Existing applications that do not require this feature are not
impacted except for a change to makebootconfig, which adds a new required
argument (<code>-store-security</code>). Users that wish to use the new
capabilities should be aware of the following areas of change:
<ul>
<li>
The makebootconfig utility has a new required
<code>-store-security</code> command-line argument, which is used to
enable security for a new KVStore deployment. The -store-security flag
is also used to enable a non-secure deployment, and is actually
required in that case (-store-security none).
</li>
<li>
A new securityconfig tool has been added, which provides the ability to:
<ul>
<li>Create security configurations</li>
<li>Create/modified password stores</li>
<li>Enable security on a pre-existing, non-secure KVStore</li>
<li>Perform security maintenance tasks</li>
</ul>
</li>
<li>
Additional methods on the KVStoreConfig class:
<ul>
<li><code>setSecurityProperties()</code></li>
<li><code>getSecurityProperties()</code></li>
</ul>
</li>
<li>
An additional method on the KVStoreFactory class supporting authentication:
<ul>
<li><code>KVStoreFactory.getStore(KVStoreConfig, LoginCredentials, ReauthenticateHandler)</code></li>
</ul>
<p>
This new method utilizes the new interfaces
<ul>
<li><code>LoginCredentials</code></li>
<li><code>ReauthenticateHandler</code></li>
</ul>
<p>
As well as the new class <code>PasswordCredentials</code>.
</li>
<li>
Additional methods on the KVStore interface:
<ul>
<li><code>login()</code></li>
<li><code>logout()</code></li>
</ul>
</li>
<li>
New exception classes:
<ul>
<li><code>UnauthorizedException</code></li>
<li><code>AuthenticationFailureException</code></li>
<li><code>AuthenticationRequiredException</code></li>
</ul>
</li>
</ul>
<p>
Users should also familiarize themselves with security property files, which
are required when using a KVStore command-line utility program against a secure
store, and which may also be useful when running an application against a secure
store.
<p>
This feature is described in much greater depth in the Oracle NoSQL Database Security Guide, as well as in the Administrators Guide and product Javadoc.
</li>
<li>
The administrative CLI has been modified to use new terminology to refer
to data centers.  Data centers are now called <i>zones</i>.  The new
terminology is meant to clarify that these node groupings may not always
coincide with physical data centers.  A zone is a collection of nodes
that have good network connectivity with each other and have some level
of physical separation from nodes in other zones.  That physical
separation may mean that different zones are located in different
physical data center buildings, but could also represent different
floors, rooms, pods, or racks, depending on the particular deployment.
<p>
Commands that contained the word "datacenter" have been deprecated, and
are replaced with commands using the word "zone". The previous commands
will continue to work in this release. New commands are:
<ul>
<li><code>plan deploy-zone</code>
<li><code>plan remove-zone</code>
<li><code>show zones</code>
</ul>
<p>
Command flags that specify a zone have been changed to <code>-zn</code>,
for a zone ID, and <code>-znname</code>, for a zone name. The
earlier <code>-dc</code> and <code>-dcname</code> flags have been
deprecated but will continue to work in this release.  In addition, zone
IDs can now be specified using the "zn" prefix, with the earlier "dc"
prefix still currently supported.
<p>
The administrative GUI has also been modified to use the new Zone
terminology. [#22878]
</li>
<li>
There are now two types of zones.  <i>Primary</i> zones contain
electable nodes, which can serve as masters or replicas, and vote in
master elections.  All zones (or data centers) created in earlier
releases are primary zones, and new zones are created as primary zones
by default.  <i>Secondary</i> zones contain nodes of the
new <i>secondary node</i> type, which can only serve as replicas and do
not vote in master elections.  Secondary zones can be used to make a
copy of the data available at a distant location, or to maintain an
extra copy of the data to increase redundancy or read capacity. [#22483]
</li>
<li>
The <code>show plan</code> command now provides an estimated migration completion time. For example:
<pre>
Plan Deploy Topo (12)
State:                 RUNNING
Attempt number:        1
Started:               2014-01-14 17:35:09 UTC
Ended:                 2014-01-14 17:35:27 UTC
Total tasks:           27
 Successful:           12
 Incomplete:           15
Incomplete tasks
   3 partition migrations queued
   1 partition migrations running
   11 partition migrations succeeded, avg migration time = 550164 ms.
<b>Estimated completion:  2014-01-14 19:57:37 UTC</b>
</pre>
[#22183]
</li>
<li>
A new read consistency option has been added for this release.
<code>oracle.kv.Consistency.NONE_REQUIRED_NO_MASTER</code> can now be
used to specify that the desired read operations must always be serviced
by a replica, never the master. For read-heavy applications (ex. analytics),
it may be desirable to isolate read requests so that they are performed
only on replicas, never a master; reducing the load on the master. The
preferred mechanism for achieving this sort of read isolation is the new
secondary zone feature; which users are encouraged to employ for this
purpose. But for cases where the use of secondary zones is not desired
or impractical, <code>oracle.kv.Consistency.NONE_REQUIRED_NO_MASTER</code>
can be used to achieve a similar effect, without the additional resources
that secondary zones may require. [#22338]
</li>
<li>
The following methods have been added:
<ul>
<li><code>KVStoreConfig.setReadZones()</code></li>
<li><code>KVStoreConfig.getReadZones()</code></li>
</ul>
<p>
These methods make it possible to require that read operations only be
performed on nodes located in the specified zones.
</li>
<li>
The <i>show plans</i> command has been changed so that a range of plan
history can be specified.  With no arguments, <i>show plans</i> now
displays only the ten most recently created plans, but new arguments
can be used to select ranges by creation time and by plan id.  Issue
the command "show plans -help" to see the complete set of options.
</li>
<li>
The makebootconfig utility has a new optional <code>-runadmin</code>
command-line argument, which allows the SNA to force the start of a bootstrap
admin even if the value of <code>-admin</code> is set to 0.
<p>
The option <code>-port</code> of <i>plan deploy-admin</i> within the admin CLI
has been changed to be able to control the start of the admin web service. No
web service of the admin will be started if the <code>-port</code> is set to
0 in deploying.
<p>
Users can also change the http port of an admin after deployment via
<i>plan change-param</i> command of admin CLI to change the setting for whether
an admin runs a web server. [#22344]
</li>
<li>
The <i>plan change-param</i> command has been changed to allow changing the
parameters for a single admin service. [#22244]
</li>
<li>
NoSQL topology information is stored both in the Admin services and on
Storage Nodes, and can become inconsistent if topology changing plans
such as deploy-topology and migrate-sn are canceled before
completion. Inconsistencies can be repaired by redeploying the target
topology. In this release, a "plan repair-topology" command is also provided
as an additional way of repairing topology inconsistencies. The verify
configuration command now generates recommendations for when it may be
beneficial to use repair-topology. [#22753]
</li>
</ol>
<h3><a name="BugFixes305">Bug and Performance Fixes</a></h3>
<ol>
<li>
The makebootconfig command now prints a message when it declines to
overwrite existing configuration files. [#23012]
</li>
<li>
The "plan remove-admin" now permits removal of an Admin that is hosted
by Storage Node that is not running. [#23061]
</li>
<li>
Fixed a bug that sometimes caused a duplication of the admin section
in a Storage Node's config.xml file. As a result, the "plan
change-parameters" command, when applied to an Admin service with this
configuration irregularity, could unexpectedly have no effect.  The
bug could be provoked by attempting to deploy an Admin that is already
deployed; but it could also happen when re-executing a failed
"plan migrate-storagenode" command. [#23152]
</li>
<li>
Fixed a problem that caused the <code>topology redistribute</code>
command to ignore storage directory settings when creating new
replication nodes. [#23161]
</li>
<li>
Previously, when there was no activity during a RepNode's
metrics-gathering period (the <i>statsInterval</i>), the previous
period's metric values would be reported via JMX and SNMP.  This
behavior has changed so that the metrics are updated at every
interval. [#22842][#22537]
</li>
<li>
NoSQL DB automatically adjusts mastership identity so that master
nodes are distributed across a store for optimal performance.
Fixed a problem that prevented Master Balancing from being performed
across multiple zones. [#22857]
</li>
<li>
Modified the LOB implementation to repeat calls to
<code>InputStream.skip</code> as needed to position the input stream to
the start location, so long as the calls return non-zero values.
An <code>IllegalArgumentException</code> will be thrown if the calls do
not advance the stream to the required start location.
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Utilities305">Utility Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
The administrative and data command line interfaces (CLI) have been
merged into a single program.  The usage of the merged CLI is
compatible with most old usage but has additional options that allow
it to work for administrative operations, data operations, or both.
This change requires the use of kvstore.jar for data operations where
in previous releases, the data CLI only required kvcli.jar, which
depended on kvclient.jar.
</li>
<li>
The CLI has been enhanced with commands necessary to manage tables,
indexes, security information, and zones.
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Documentation305">Documentation Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
  With the introduction of the tabular data model and secondary
  indexes, a new <a
  href="oradoc-lookup:/NSTBJ-GUID-2C12DC44-6459-4190-93CB-5DC6C3A7C6DA/java-driver-table">
  Getting Started with the Table API</a> guide has been added.
</li>
<li>
  With the introduction of the new security features, a new <a
  href="oradoc-lookup:/NSSEC-GUID-6C5875FE-9765-45E6-9EC7-0D6EAEE3F95D/security">
  Security Guide</a> has been added.
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Packaging305">Packaging Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
  The versions of the Avro and Jackson libraries bundled with Oracle
  NoSQL database have been upgraded to the more recent Avro 1.7.6 and
  Jackson 1.9.3.  These versions are compatible with the previous API
  versions.
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.57</u></h3>
<h3><a name="NewFeatures2157">New Features</a></h3>
<ol>
<li>
The new method <code>KVStore.appendLOB()</code> now permits appending to an
existing LOB (Large Object). As part of this change, the
method <code>PartialLOBException.isPartiallyDeleted()</code> has been deprecated
in favor of the new
method: <code>PartialLOBException.getPartialState()</code>. Please consult the
javadoc associated with these new methods, as well as the updated doc for the
interface <code>KVLargeObject</code>, for a detailed description of this new
functionality.
<p>
This release is backwards compatible with LOBs created in previous releases,
with one exception: Only LOBs created in this, or a later, release support the
append operation. Attempts to use the append operation on LOBs created in
previous releases will result in the method throwing an
UnsupportedOperationException.
<p>
LOBs created in this release cannot be read or deleted by clients using earlier
releases. Such operations will typically fail with a ConcurrentModificationException.
Please ensure that all clients are updated to this release before creating new
LOBs.
[#22876]
</li>
<li>
GC log files for the Admin and RepNode services are now generated by default and
placed in the <code>KVROOT/&lt;storename&gt;/log</code> directory (the standard
location for all NoSQL related logging information). This default behavior only
applies when using JDK release 1.7 or a later release, since gc log rotation is
only supported in the more recent JDKs. The logging has minimal resource
overheads. Having these log files readily available, conforms to deployment best
practices for production java applications making it simpler to diagnose GC
issues should the need arise. [#22858]
</li>
</ol>
<h3><a name="BugFixes2157">Bug and Performance Fixes</a></h3>
<ol>
<li>
The heap requirement of the Admin service, when operating on a store that has
undergone numerous changes, has been reduced. [#21143]
</li>
<li>
Fixed a bug in the Admin CLI "show plan -id &lt;id&gt;" command, which
resulted in the omission of information about partition migration
tasks from the plan history report. The command now correctly includes
information about partition migrations. [#22611]
</li>
<li>
Reduce internal timeout values, associated with the network connection
between a master and a replica, to permit faster master failover upon
encountering a network hardware failure. [#22861]
</li>
<li>
An attempt to resume a failed put operation on a LOB larger than 3968K bytes
could result in an incorrect ConcurrentModificationException in some
circumstances. The bug has been fixed in this release. [#22876]
</li>
<li>
Changed the way plans are represented in the Admin's memory.
Previously, there was no limit on the potential size of the in-memory
representation of currently active and historical plans.  With this
fix, only active plans are kept in memory. [#22963]
</li>
<li>
Eliminated deadlocks in plan management in the Admin. [#22992]
</li>
<li>
A bug in the argument checking for the
<code>StoreIteratorConfig</code> setter methods has been
fixed. [#23010]
</li>
<li>
The makebootconfig command now prints a message when it declines to
overwrite existing configuration files. [#23012]
</li>
<li>
The Replication Node configuration has been tuned to reduce CPU
utilization when the Replication Node's cache is smaller than
required, and cache eviction is taking place.  [#23026]
</li>
<li>
The remove-admin command now permits removal of an Admin that is
hosted by Storage Node that is not running. [#23061]
</li>
<li>
The show plans command could sometimes cause a crash in the Admin CLI
because it would consume too much memory. This has been fixed. [#23105].
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.54</u></h3>
<h3><a name="NewFeatures2154">New Features</a></h3>
<ol>
<li>
Oracle NoSQL Database now offers a client only package. Oracle NoSQL
Database Client Software Library is licensed pursuant to the Apache
2.0 License (Apache 2.0).  The Apache License and third party notices
for the NoSQL DB Client Software Library may be viewed at this
<a href="http://www.oracle.com/technetwork/products/nosqldb/documentation/nosql-db-agpl-license-1432845.txt"> location </a>
or in the downloaded software.
</li>
<li>
A new overloading of the <code>KVStore.storeIterator()</code>
and <code>KVStore.storeKeysIterator()</code> implements <i>Parallel
Scans</i>. The other <code>storeIterator()</code> methods scan all
shards and Replication Nodes in serial order. The new Parallel
Scan methods allow the programmer to specify a number of client-side
threads that are used to scan Replication Nodes in parallel. [#22146]
</li>
</ol>
<h3><a name="BugFixes2154">Bug and Performance Fixes</a></h3>
<ol>
<li>
Improved error messages in the Data Command Line Interface
(kvshell). For example, a put command with invalid inputs might have
returned this error message in the past:
<pre>
kvshell-> put -key /test -value ./emp.insert -file -json Employee
  Could not create JSON from input:
  Unable to serialize JsonNode
</pre>
but will now produce this more useful response:
<pre>
kvshell-> put -key /test -value ./emp.insert -file -json Employee
Exception handling command put -key /test -value ./emp.insert -file -json Employee:
  Could not create JSON from input:
  Expected Avro type STRING but got JSON value: null in field Address of Employee
</pre>
[#22791]
</li>
<li>
Fixed a bug when using the plan deploy-admin command. In some cases,
if an Admin service encountered an error at start up, the process would
become unresponsive. The correct behavior is for the process to shut
down and be restarted by its owning Storage Node. [#22908]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.25</u></h3>

<h3><a name="BugFixes2125">Bug Fixes</a></h3>
<ol>
<li>
If a Storage Node Agent process received a <i>master balancing</i> related
remote request while shutting down, it could in rare instances throw an
exception that would disable the master balancing function in the Storage Node
Agent that initiated the request. This problem can be identified via the
following (or similar) output in the log of the Storage Node Agent that
initiated the request:

<pre>

2014-03-28 12:13:34.544 UTC SEVERE [sn2] MasterRebalanceThread thread exiting due to exception.
null (12.1.2.1.24) java.lang.NullPointerException
    at oracle.kv.impl.sna.StorageNodeAgentImpl$27.execute(StorageNodeAgentImpl.java:838)
    at oracle.kv.impl.sna.StorageNodeAgentImpl$27.execute(StorageNodeAgentImpl.java:831)
    at oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:119)
    at oracle.kv.impl.sna.StorageNodeAgentImpl.getMDInfo(StorageNodeAgentImpl.java:829)
    at sun.reflect.GeneratedMethodAccessor12.invoke(Unknown Source)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:606)
    ...
    at com.sun.proxy.$Proxy1.getMDInfo(Unknown Source)
    at oracle.kv.impl.sna.StorageNodeAgentAPI.getMDInfo(StorageNodeAgentAPI.java:492)
    at oracle.kv.impl.sna.masterBalance.RebalanceThread.orderMSCNs(RebalanceThread.java:580)
    at oracle.kv.impl.sna.masterBalance.RebalanceThread.candidateTransfers(RebalanceThread.java:485)
    at oracle.kv.impl.sna.masterBalance.RebalanceThread.run(RebalanceThread.java:301)
2014-03-28 12:13:34.546 UTC INFO [sn2] Master balance manager shutdown
2014-03-28 12:13:34.546 UTC INFO [sn2] MasterRebalanceThread thread exited.

</pre>
[#23419]
</li>
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.24</u></h3>

<h3><a name="BugFixes2124">Bug and Performance Fixes</a></h3>
<ol>
<li>
Under certain circumstances, a replication node which was on the verge
of shutting down or in the midst of transitioning from master to
replica state could experience this failure while cleaning up
outstanding requests. Since the node would automatically restart,
and the operation would be retried, the failure was transparent to the
application, but could cause an unnecessary node failover. This has
been fixed.
<pre>
java.lang.IllegalStateException: Transaction 30 detected open cursors while aborting
    at com.sleepycat.je.txn.Txn.abortInternal(Txn.java:1190)
    at com.sleepycat.je.txn.Txn.abort(Txn.java:1100)
    at com.sleepycat.je.txn.Txn.abort(Txn.java:1073)
    at com.sleepycat.je.Transaction.abort(Transaction.java:207)
    at oracle.kv.impl.util.TxnUtil.abort(TxnUtil.java:80)
    at oracle.kv.impl.api.RequestHandlerImpl.executeInternal(RequestHandlerImpl.java:469)
    at oracle.kv.impl.api.RequestHandlerImpl.access$300(RequestHandlerImpl.java:122)
    at oracle.kv.impl.api.RequestHandlerImpl$2.execute(RequestHandlerImpl.java:301)
    at oracle.kv.impl.api.RequestHandlerImpl$2.execute(RequestHandlerImpl.java:290)
    at
oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:135>
</pre>
[#22152]
</li>
<li>
In past releases of NoSQL DB, a replication node which transitioned
from master to replica state would have to close and reopen its
database environment as part of the change in status. This transition
has now been streamlined so that in the majority of cases, the
database environment is not perturbed, the transition requires fewer
resources, and the node is more available.
[#22627]
</li>
<li>
The <code>plan deploy-topology</code> command has additional
safeguards to increase the reliability of the topology rebalance and
redistribute plans. When moving a replication node from one Storage
Node to another, the command will now check that the Storage Nodes
involved in the operation are up and running before any action is
taken. [#22850]
</li>
<li>
Under certain circumstances it was possible for a replication node to
use out of date master identity information when joining a
shard. This could cause a delay if the targeted node was
unavailable. This has been fixed. [#22851]
</li>
<li>
Under certain circumstances operations would end prematurely
with oracle.kv.impl.fault.TTLFaultException. This exception is now
handled internally by the server and client library and the operation
is retried. If the fault condition continues the operation will
eventually fail with a oracle.kv.RequestTimeoutException. [#22860]
</li>
<li>
Previously, there were cases where a replication node would require
the transfer of a copy of the shard data in order to come up and join
the shard, even though it was unnecessary. This has been
fixed. [#22782]
</li>
<li>
When new storage nodes are added to an Oracle NoSQL DB deployment and
a new topology is deployed, the store takes that opportunity to
redistribute master roles for optimal performance. In some cases, the
store might not notice the new storage nodes until other events, such
as failovers or mastership changes had occurred, which caused a delay
in master balancing. This has been fixed. [#22888]
</li>
<li>
The setting of the JE configuration parameter:
je.evictor.criticalPercentage used by the store has been corrected. It
used to be set to 105 and has been changed to 20. This new setting
will provide better cache management behavior in cases where the data
set size exceeds the optimal memory settings. [#22899]
</li>
</ol>
<h3><a name="UtilityAndDocChanges2124">Utility and Documentation Changes</a></h3>
<ol>
<li>
A timestamp has been added to the output of the CLI "ping" command. [#22859]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.19</u></h3>

<h3><a name="documentation2119">Documentation Changes</a></h3>
<ol>
<li>
This release includes a new document, Oracle NoSQL Database
Availability and Failover. It explains the general concepts and
issues surrounding data availability when using Oracle NoSQL Database.
The intended audiences for this document are system architects and
developers. The new information can be found under the "For the
Developer" section in the documentation index page.
</li>
<li>
Clarify the instructions for adding .avsc files to the classpath for
the example on Avro bindings in &lt;KVHOME&gt;/examples/avro.
Improve the error message when the .avsc files are not properly available.
</li>
</ol>

<h3><a name="BugFixes2119">Bug and Performance Fixes</a></h3>
<ol>
<li>
Increased an internal parameter for lock timeouts from 500ms to 10
seconds. Since NoSQL DB ensures that data access is deadlock free, the
small timeout values were unnecessary and could cause spurious errors
in the face of transient network failures. [#22583]
</li>
<li>
Changing the store topology through the <code>plan
deploy-topology</code> command could result in the following
error if there was a transient network failure, or if the movement of
the replication node took longer than a few seconds. Although the store
state was still consistent, and the command could be manually retried,
the command should be more resilient to communication glitches.
<pre>
... [admin1] Task 2/RelocateRN ended in state ERROR with
java.lang.RuntimeException: Time out while waiting for rg4-rn1 to come
up on sn1 and become consistent with the master of the shard before
deleting the RepNode from its old home on sn4 2/RelocateRN failed.

java.lang.RuntimeException: Time out while waiting for rg4-rn1 to come
up on sn1 and become consistent with the master of the shard before
deleting the RepNode from its old home
</pre>
<p>
The command will now adjust waiting times and retry appropriately to
ascertain whether the movement of a
replication node has finished.[#22596]
</li>
<li>
Fixed a bug where a replication node would not restart automatically if
the directory containing its data files was removed, or its data files
were corrupted, but were later repaired. [#22626]
</li>
<li>
Added additional testing to reinforce the existing, correct behavior
that a client directs write requests to the authoritative master in a
segmented network split brain scenario. [#22636]
</li>
<li>
In some cases, the <code>java -jar kvstore.jar ping</code> command
could generate spurious messages about components that are no longer
legitimately within the store.
<pre>
Failed to connect to service commandService

Connection refused to host: 10.32.17.12; nested exception is:
  java.net.ConnectException: Connection refused
        SNA at hostname:localhost registry port: 6000 has no available
        Admins or RNs registered.
</pre>
In particular, these messages could happen for bootstrap Admins on
Storage Nodes that do not host deployed Admin Services. While the
store was consistent, the error messages were confusing and have been
removed. [#22639]
</li>

<li>
Fixed a small timing window in Replication Node master transfer that
could incorrectly cause the transfer transaction catch up point to
regress, when a master transfer is occurring under heavy application
load. The result is that shard mastership can take too long a time or
too short a time to transfer. If the transfer time is too short, the
target master may not be optimally caught up, and a third member of
the shard may detect this and throw an exception.
[#22658]
</li>
<li>
Preemptively shut down and restart the replication node when a node
transitions from master to replica, to reduce GC cost from refreshing
the database environment.
[#22658]
</li>
<li>
Made changes to the NoSQL client library to adapt to replication node
failures more rapidly, by retrying or forwarding data requests when it
detects that its original target is unavailable sooner.
[#22661]
</li>
<li>
A NoSQL deployment could see this transient error when
undergoing topology changes. Although the store remained consistent, the
error messages were confusing and could incorrectly cause a <code>plan
deploy-topology</code> command to fail. This has been corrected.
<pre>
 ... INFO [rg1-rn1] Failed pushing entire topology push to rg1-rn3
updating from topo seq#: 0 to 1001 Problem:Update to topology seq#
1001 failed ... oracle.kv.impl.fault.OperationFaultException:
  Update to topology seq# 1001 failed
    at oracle.kv.impl.rep.admin.RepNodeAdminImpl$6.execute(RepNodeAdminImpl.java:261)
    at oracle.kv.impl.fault.ProcessFaultHandler.execute(ProcessFaultHandler.java:169)
    at oracle.kv.impl.rep.admin.RepNodeAdminFaultHandler.execute(RepNodeAdminFaultHandler.java:117)

 ...INFO [rg1-rn3] Topology update skipped. Current seq #: 1001 Update seq #: 1001
</pre>
[#22678]
</li>
<li>
Fixed a bug where a replication node which experiences an out of
memory error did not restart automatically.
[#22679]
</li>
<li>
Corrected the default calculation of available Storage Node memory when
the Storage Node has been configured without a value for the bootstrap
memory_mb parameter. In the past, the calculation was done using units
of decimal megabytes, rather than MB, resulting in an overestimation
of the appropriate replication node heap size. This default
calculation is only used if the store has been configured without any
bootstrap value for the memory_mb property, and the memory_mb storage node
parameter has never been set.
[#22687]
</li>
<li>
Update the Storage Node more quickly about the replica/master status
of the replication nodes it hosts. The fix applies when executing the
<code>plan deploy-topology</code> command on a store that contains Storage Nodes
that have capacity values greater than 1, and can host multiple
Replication Nodes. A delay in notifying the Storage Node of its
replication nodes status can make the distribution of mastership
responsibilities less optimal.
[#22689]
</li>
<li>
Fixed a bug where the Admin service became unresponsive when executing
a <code>plan deploy-topology</code> command. During this time, the
admin service process appeared idle, only burning a second or two of
CPU time once in a while and would not respond to new attempts to
connect with the Admin CLI. The problem would likely only occur in
large clusters with hundreds of components.  [#22694]
</li>
<li>
Topology changes invoked by the <code>plan deploy-topology</code>
which result in the movement of a replication node from one storage
node to another are now more resilient to transient network failures.
There are now more advance checks to ensure that the shard and storage
nodes involved in the movement are available and ready to accept the
change. In the advent of a network failure mid-move, the command is
better at handling retries issued by the system administrator.
[#22722]
</li>
<li>
Fixed a bug where application requests failed to be processed while the
store is executing topology changes that require partition migration
under heavy load.
[#22778]
</li>
<li>
Adjust the default replication node garbage collection parameters to
be more optimal, reducing CPU utilization in some cases.
[#22779]
</li>
<li>
Reduce the time taken for a replica Replication Node to become up to
date and available to handle application requests when it has fallen
significantly behind due to downtime or to network communication
failures. Previously, it exited and restarted the process before
starting the catch up stage, but will now skip the restart.
[#22783]
</li>
<li>
Fixed a bug where an internal queue in the Storage Node could fill up
if its Replication Node repeatedly and unsuccessfully attempts to
restart, as might happen when a resource is unavailable. In that case,
the Storage Node was no longer able to automatically restart
the replication node, and would have to be rebooted.
[#22786]
</li>
<li>
Fixed a bug where a Replication Node that has been stopped due to
repeated errors, perhaps due to a lack of resource, and then
re-enabled with the "plan start-service" command, still did not
restart. [#22828]
</li>
<li>
Fixed a bug where the following null pointer exception could happen
for a restarting Replication Node. The problem was transient.
<pre>
   INFO [sn1] rg2-rn2: ProcessMonitor: startProcess
   INFO [sn1] rg2-rn2: ProcessMonitor: stopProcess
   SEVERE [sn1] rg2-rn2: ProcessMonitor: Unexpected exception in
MonitorThread:
        java.lang.NullPointerExceptionjava.lang.NullPointerException
        at oracle.kv.impl.sna.ProcessMonitor$MonitorThread.run(ProcessMonitor.java:404)
</pre>
[#22830]
</li>
<li>
Improve the client library's interpretation of UnknownHostException
and ConnectIOException so that it more rapidly detects a network
problem and updates its set of unavailable replication nodes.
[#22841]
</li>

<!--
Fixed a bug in the unadvertised command "topology move-repnode". In
the past, the move-repnode command did not use available storage
directories on the target SN. This has been fixed, so a RN that is
moved will use any available storage dirs on the target SN. The fix
is not documented because this in an undocumented command. [#22648]
-->
</ol>
<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 12cR1.2.1.8</u></h3>
<h3><a name="Features218">New Features</a></h3>
<ol>
<li>
This release includes support for upgrading the NoSQL DB software (client or
server) without taking the store offline or without significant impact to
ongoing operations. In addition, upgrades can be made incrementally, that is,
it should not be necessary to update the software on every component at the
same time. This support includes client and server code changes and new
command line interface (CLI) commands. [#22421]
<p>
The new CLI commands provide the
administrator tools to help with the upgrade process. Using these commands, the
general upgrade procedure is:
<ol>
    <li>Install the new software on a Storage Node running an admin
        service<sup>1</sup>.
    <li>Install the new client and connect to the store.
    <li>Use the <code>verify prerequisite</code> command to verify that the
        entire store is at the proper software version to be upgraded (All
        2.0 versions of NoSQL DB will qualify as prerequisites).
    <li>Use <code>show upgrade-order</code> to get an ordered list of nodes to
        upgrade.
    <li>Install the new software on the Storage Nodes (individually or in groups
        based on the ordered list).
    <li>Use the <code>verify upgrade</code> to monitor progress and verify that
        the upgrade was successful.
</ol><br>
<sup>1</sup> In future releases this step will not be necessary
<p>
If the upgrade procedure is interrupted steps 4-6 can be repeated as necessary
to complete the upgrade.
</li>
</ol>

<h3><a name="BugFixes218">Bug and Performance Fixes:</a></h3>
<ol>
<li>
Unless configured specifically by the application, NoSQL DB specifies the
-XX:ParallelGCThread jvm flag for each Replication Node process to
indicate the number of garbage collector threads that the process
should use. In the past, the algorithm in use generated a minimum
value of 1 thread. After more testing, the minimum value has been
raised to the min(4, &lt;the number of cores on the node&gt;). [#22475]
</li>
</ol>

<h3><a name="APIChanges218">API Changes</a></h3>
<ol>
<li>

The admin command line interface (CLI) provides the following new
commands [#22422]:
<p>
<code>verify prerequisite [-silent] [-sn snX]*</code>
<p>
This command will verify that a set of storage nodes in the store meets the
required prerequisites for upgrading to the current version and display the
components which do not meet prerequisites or cannot be contacted. It will also
check and report an illegal downgrade situation where the installed software is
of a newer minor release than the current version. In this command the current
version is the version of the software running the command line interface. If no
storage nodes are specified, all of the nodes in the store will be checked.
<p>
<code>verify upgrade [-silent] [-sn snX]*</code>
<p>
This command will verify that a set of storage nodes in the store has been
successfully upgraded to the current version and display the components which
have not yet been upgraded or cannot be contacted. In this command the current
version is the version of the software running the command line interface. If no
storage nodes are specified, all of the nodes in the store will be checked.
<p>
<code>show upgrade-order</code>
<p>
This command will display the list of storage nodes in the order that they
should be upgraded to maintain the store's availability. This command will
display one or more storage nodes on a line. Multiple storage nodes on a line
are separated by a space. If multiple storage nodes appear on a single line,
then those nodes can be safely upgraded at the same time. When multiple nodes
are upgraded at the same time, the upgrade must be completed on all nodes
before the nodes next on the list can be upgraded.
<p>
The <code>verify [-silent]</code> command has been deprecated and is replaced by
<code>verify configuration [-silent]</code>. The <code>verify [-silent]</code>
command will continue to work in this release.
</li>
</ol>

<h3><a name="UtilityAndDocChanges218">Utility and Documentation Changes</a></h3>
<ol>
<li>In this release, the sample code provided by the utility
  class <code>WriteOperations</code>
  (located in the <code>examples</code> directory) now includes methods that
  perform write operations for <em>large objects</em> (or <em>LOB</em>,
  see <a href="oradoc-absolute:/java-api/oracle/kv/lob/KVLargeObject.html"> <code>KVLargeObject</code></a>). The
  new utility methods added in this release will properly retry the associated
  LOB operation when
  a  <a href="oradoc-absolute:/java-api/oracle/kv/FaultException.html"> <code>FaultException</code></a>
  is encountered. Prior to this release,
  the <code>WriteOperations</code>
  utility only provided retry methods for objects that are not large
  objects. [#21966]
</li>
<li>
The number of JE lock tables used by Replication Nodes (controlled via
the <i>je.lock.nLockTables</i> JE configuration parameter) has been increased from
1 to 97. This change helps improve performance of applications characterized by
very high levels of concurrent updates, by reducing lock contention. [#22373]
</li>
<li>
The Administration CLI now permits the creation of multiple Datacenters.
By choosing Datacenter replication factors so that each Datacenter holds
less than a quorum of replicas, this change makes it possible to create
store layouts where the failure of a single Datacenter does not result
in the loss of write availability for any shards in the store.  In the
current release, nodes in any Datacenter can participate in master
elections and contribute to durability acknowledgments.  As a
consequence, master failover and durability acknowledgments will take
longer if they involve datacenters that are separated by large
distances.  Future releases will provide greater flexibility in this
area.  [#20905]
</li>
</ol>

<!-- ========================================================= -->
<hr>
<h3 align="center"><u>Changes in 11gR2.2.0.39</u></h3>
<h3><a name="Features2039">New Features</a></h3>
<ol>
<li>
An integration with Oracle Coherence has been provided that allows
Oracle NoSQL Database to be used as a cache for Oracle Coherence
applications, also allowing applications to directly access cached
data from Oracle NoSQL Database.  This integration is a feature of the
Enterprise Edition of the product and implemented as a new, independent jar
file.  It requires installation of the Oracle Coherence product as
well.  The feature is described in the
<a href="oradoc-lookup:/NSCON-GUID-FAB8E233-E99A-48DA-BE44-C1728D2FC601/Coherence+Integration">Coherence Integration</a> as well as the <a
href="oradoc-absolute:/java-api/oracle/kv/coherence/package-summary.html">javadoc</a>. [#22291].
</li>
<li>
The Enterprise Edition now has support for semantic technologies.
Specifically, the Resource Description Framework (RDF), SPARQL query
language, and a subset of the Web Ontology Language (OWL) are now
supported.  These capabilities are referred to as the RDF Graph
feature of Oracle NoSQL Database.  The RDF Graph feature provides a
Java-based interface to store and query semantic data in Oracle NoSQL
Database Enterprise Edition. The feature is described in the
<a href="oradoc-absolute:/RDFGraph/index.html">RDF Graph</a> manual.
</li>
</ol>
<h3><a name="BugsPatch2039">Bug Fixes</a></h3>
<ol>
<li>
The preferred approach for setting NoSQL DB memory resources is to
specify the memory_mb parameter for each SN when running the
makebootconfig utility, and to let the system calculate the ideal
Replication Node heap and cache sizes. However, it is possible to override the
standard memory configurations by explicitly setting heap and cache
sizes using the Replication Node javaMiscParams and cacheSize
parameters. In past releases, setting the explicit values worked
correctly when using the plan change-parameters command, but did not
work correctly when using the change-policy command. This has been
fixed, so that if desired, one can use the change-policy command for
the javaMiscParams and cacheSize parameters to override the default
memory allocation heuristics. [#22097]
</li>
<li>
A NoSQL DB deployment that executes on a node with no network
available, as might happen when running a NoSQL DB demo or tutorial,
would fail with this error:
<pre>
java.net.InetAddress.getLocalHost() returned loopback address:&lt;hostname&gt; and
  no suitable address associated with network interfaces.
</pre>
This has been fixed. [#22252]
</li>
</ol>
<h3><a name="APIPatch2039">API Changes</a></h3>
<ol>
<li>
Prior to this release, if a write operation encountered an exception from the
underlying persistent store indicating that the write completed on the shard's
master but not necessarily on the desired combination of replicas within the
specified time interval, then that exception would be swallowed and thus never
propagated to the client. Originally, this behavior was considered desirable
because not only is that exception rare (because of various preceding checks
performed by the implementation), but swallowing the exception would keep the
API simple by avoiding the introduction of an additional exception and/or
additional communication at the API level. After further thought and
discussion, the team concluded that clients should know when a write operation
fails to complete because of such an exception. As a result, when such a
condition occurs during a write operation, a <a
href="oradoc-absolute:/java-api/oracle/kv/RequestTimeoutException.html">
<code>RequestTimeoutException</code></a> will now be propagated to the client;
wrapping the original exception from the underlying persistent store as the
cause. For additional information, including strategies one might employ when
this exception is encountered, refer to the <a
href="oradoc-absolute:/java-api/oracle/kv/RequestTimeoutException.html">
<code>RequestTimeoutException</code> <em>javadoc</em></a>.
<p>
This has been fixed. [#21210]
</li>
<li>
A new parameter has been added which controls the display of records
in exception and error messages. When <code>hideUserData</code> is set
to true, as it is by default, error messages which are printed to the
server side logs or are displayed via the show CLI commands replace
any key/values with the string "[hidden]". To see the actual record content
in errors, set the parameter to false. [#22376]
</li>
</ol>
<h3><a name="UtilityPatch2039">Utility and Documentation Changes</a></h3>
<ol>
<li>
In previous releases, information about errors that occurred during
NoSQL DB component start up as a result of a <code>plan
deploy-topology</code> command would often be visible only within
the NoSQL DB logs, which made
installation troubleshooting difficult. In this
release, such start up errors can now be seen via the Admin CLI
<code>show plan -id &lt;id&gt;</code> command. [#22101]
</li>
<li>
The Storage Node Agent exposes MBeans on a non-default MBeanServer
instance.  In this release, the non-default MBeanServer now exposes
the standard JVM platform MBeans as well as those relating only to
Oracle NoSQL Database.
</li>
<li>
In both SNMP and JMX interfaces, the new totalRequests metric is now available.  This metric counts the number of multi-operation sequences that occurred during the sampling period.
</li>
<li>
Prior to this release, the product was compiled and built against the 1.x version of Hadoop (CDH3). Thus, when employing a previous release, if one were to run the <code>examples.hadoop.CountMinorKeys</code> example against a cluster based on the 2.x version of Hadoop (CDH4), the MapReduce job initiated by that example would fail as a result of an <code>IncompatibleClassChangeError</code>; which is caused by an incompatibility introduced in <code>org.apache.hadoop.mapreduce.JobContext</code> between Hadoop 1.x and Hadoop 2.x. This failure occurs whether the example is compiled and built against Hadoop 1.x or Hadoop 2.x. Because the product's customer base almost exclusively uses Hadoop 2.x, this release will provide support for Hadoop 2.x instead of 1.x. Future releases may revisit support for both Hadoop version paths, but doing so will involve refactoring the codebase and its associated release artifacts, as well as substantial changes to the product's current build process.
<p>
Support of Hadoop 2.x (CDH4) has been provided. [#22157]
</li>
<li>
The java -jar kvstore.jar makebootconfig -mount flag has been changed
to -storagedir. The "plan change-mountpoints -path &lt;storage
directory&gt;" command is deprecated in favor of "plan
change-storagedir -storagedir &lt;storage directory&gt;". [#21880]
</li>
<li>
The concept of Storage Node capacity is better explained in the
Administrator's Guide.
</li>
<li>
The Administrator's Guide has a revamped section on how to calculate the
resources needed for operating a NoSQL DB deployment.
</li>
</ol>
<!-- ========================================================= -->
<hr>
<h3 align="center"><u>Changes in 11gR2.2.0.26</u></h3>
<h3><a name="Features2026">New Features:</a></h3>
<ol>

<li>
This release adds the capability to remove an Admin service replica.
If you have deployed more than one Admin, you can remove one of them
using the following command:
<blockquote>
<pre>
plan remove-admin -admin &lt;adminId&gt;
</pre>
</blockquote>
<p>
You cannot remove the sole Admin if only one Admin instance is
configured.
</p><p>
For availability and durability reasons, it is highly recommended that
you maintain at least three Admin instances at all times.  For that
reason, if you try to remove an Admin when the removal would result in
there being fewer than three, the command will fail unless you give
the <i>-force</i> flag.
</p><p>
If you try to remove the Admin that is currently the master,
mastership will transfer to another Admin.  The plan will be
interrupted, and subsequently can be re-executed on the new master
Admin.  To re-execute the interrupted plan, you would use this command:
</p>
<blockquote>
<pre>
plan execute -id &lt;planId&gt;
</pre>
</blockquote>
</li>

<li>
The Admin CLI verify has an added check to verify that the Replication
Nodes hosted on a single Storage Node have memory settings that fit
within the Storage Node's memory budget. This guards against mistakes
that may occur if the system administrator overrides defaults and
manually sets Replication Node heap sizes.[#21727]
</li>

<li>
The Admin CLI verify command now labels any verification issues as
violations or notes. Violations are of greater importance, and the
system administrator should determine how to adjust the system to
address the problem. Notes are warnings, and are of lesser
importance. [#21950]
</li>

</ol>

<h3><a name="BugFixes2026">Bug fixes:</a></h3>
<!-- ========================================================= -->
<ol>

<li>
Several corrections were made to latency statistics. These corrections apply
to the service-side statistics in the Admin console, CLI <code>show perf</code>
command, .perf files and .csv files, as well as the client-side statistics
returned by KVStore.getStats. However, corrections to the 95% and 99% values do
not apply to the client-side statistics, since these values do not appear in
the client-side API.
  <ul>
      <li>The definition of latency has been corrected for the "multi"
      operation requests (multiGet, multiDelete, execute, etc).  These are
      labeled "multi" in the <code>Op Type</code> column where latency
      information is displayed.  The previous definition was "latency in
      milliseconds per <em>operation</em>" while the new definition is "latency
      in milliseconds per <em>request</em>".  In other words, for a "multi"
      operation request, latency now applies to the entire request rather than
      to each operation.  For "single" operation requests, the definition of
      latency has not changed.
      </li>
      <li>To go along with the change above, a new column containing the number
      of requests in the sample has been added to all latency information
      displays: <code>TotalReq</code>.  This is also available for client-side
      statistics using the new <code>OperationMetrics.getTotalRequests</code>
      method.  For "multi" operation requests, the total number of requests is
      normally smaller than the total number of operations (the
      <code>TotalOps</code> column).  For "single" operation requests, the
      total number of requests and operations are equal.
      </li>
      <li>Improved the consistency of the values reported in each sample so
      that, for example, the minimum latency is always less than the maximum
      latency.  However, note that statistics are collected without
      synchronization to avoid impacting performance, and for small sample
      sizes the values in a sample are not always accurate or self-consistent.
      </li>
      <li>Fixed a bug that caused the 95% and 99% values to show the maximum
      latency recorded (within 1000 ms), rather than the lowest 95% or 99% as
      intended.  This bug only applied to the "multi" operation requests.
      </li>
      <li>Fixed a bug that caused the 95% and 99% values to sometimes
      mistakenly appear as -1.  These values should only appear as -1 when
      there were no operations in the sample with a latency below 1000 ms.
      </li>
  </ul>
[#21763]
</li>

<li>
Modified the Administration Process to allocate ports from within a port range
if one is specified by the <i>-servicerange</i> argument to
the <i>makebootconfig</i> utility. If the argument is not specified the
Administration Process will use any available port. Please see
the <a href="oradoc-lookup:/NSADM-GUID-4E2F4C8C-6B74-4C05-9CBC-41FEAC4BA4D6/admin">
Admin Guide</a>
for details regarding the configuration of ports used by Oracle NoSQL
Database.  [#21962]
</li>

<li>
Modified the replication node to handle the unlikely case that the locally
stored topology is missing. A missing topology results in a
java.lang.NullPointerException being thrown in the TopologyManager and will
prevent the replication node from starting. [#22015]
</li>

<li>
Replication Node memory calculations are more robust for Storage Nodes
that host multiple Replication Nodes. In previous releases, using the
plan change-params command to reduce the capacity parameter for a
Storage Node which hosts multiple Replication Nodes could result in an
over aggressive increase in RN heap, which would make the Replication
Nodes fail at start up. The problem would be fixed when a topology was
rebalanced, but until that time, the Replication Nodes were
unavailable. The default memory sizing calculation now factors in the
number of RNs resident on a Storage Node, and adjusts RN heap sizes as
Replication Nodes are relocated by the deploy-topology
command. [#21942]
</li>

<li>
Fixed a bug that could cause a NullPointerException, such as the one below,
during RN start-up.  The exception would appear in the RN log and the RN would
fail to start.  The conditions under which this problem occurred include
partition migration between shards along with multiple abnormal RN shutdowns.
If this bug is encountered, it can be corrected by upgrading to the current
release, and no data loss will occur.
<pre>
Exception in thread "main" com.sleepycat.je.EnvironmentFailureException: (JE
5.0.XX) ...  last LSN=.../... LOG_INTEGRITY: Log information is incorrect,
problem is likely persistent. Environment is invalid and must be closed.
    at com.sleepycat.je.recovery.RecoveryManager.traceAndThrowException(RecoveryManager.java:2793)
    at com.sleepycat.je.recovery.RecoveryManager.undoLNs(RecoveryManager.java:1097)
    at com.sleepycat.je.recovery.RecoveryManager.buildTree(RecoveryManager.java:587)
    at com.sleepycat.je.recovery.RecoveryManager.recover(RecoveryManager.java:198)
    at com.sleepycat.je.dbi.EnvironmentImpl.finishInit(EnvironmentImpl.java:610)
    at com.sleepycat.je.dbi.DbEnvPool.getEnvironment(DbEnvPool.java:208)
    at com.sleepycat.je.Environment.makeEnvironmentImpl(Environment.java:246)
    at com.sleepycat.je.Environment.&lt;init&gt;(Environment.java:227)
    at com.sleepycat.je.Environment.&lt;init&gt;(Environment.java:170)
    ...
Caused by: java.lang.NullPointerException
    at com.sleepycat.je.log.entry.LNLogEntry.postFetchInit(LNLogEntry.java:406)
    at com.sleepycat.je.txn.TxnChain.&lt;init&gt;(TxnChain.java:133)
    at com.sleepycat.je.txn.TxnChain.&lt;init&gt;(TxnChain.java:84)
    at com.sleepycat.je.recovery.RollbackTracker$RollbackPeriod.getChain(RollbackTracker.java:1004)
    at com.sleepycat.je.recovery.RollbackTracker$Scanner.rollback(RollbackTracker.java:477)
    at com.sleepycat.je.recovery.RecoveryManager.undoLNs(RecoveryManager.java:1026)
    ... 10 more
</pre>
[#22052]
</li>

<li>
Fixed a bug that causes excess memory to be used in the storage engine cache on
an RN, which could result in poor performance as a result of cache eviction and
additional I/O.  The problem occurred only when the
<code>KVStore.storeIterator</code> or <code>KVStore.storeKeysIterator</code>
method was used.  [#21973]
</li>

</ol>

<!-- ========================================================= -->
<h3><a name="General2026">Performance and other General Changes:</a></h3>
<!-- ========================================================= -->
<ol>

<li>
The replicas in a shard now dynamically configure the JE property
<i>RepParams.REPLAY_MAX_OPEN_DB_HANDLES</i> which controls the size of the cache
used to hold database handles during replication. The cache size is determined
dynamically based upon the number of partitions currently hosted by the
shard. This improved cache sizing can result in better write performance for
shards hosting large numbers of partitions. [#21967]
</li>

<li>
The names of the client and server JAR files no longer include release
version numbers.  The files are now called:
<blockquote>
<pre>
lib/kvstore.jar
lib/kvclient.jar
</pre>
</blockquote>
<p>
This change should reduce the amount of work needed to switch to a new
release because the names of JAR files will no longer change between
releases.  Note that the name of the installation directory continues to
include the release version number. [#22034]
</li>

<li>
A SEVERE level message is now logged and an admin alert is fired when the
storage engine's average log cleaner (disk reclamation) backlog increases over
time.  An example of the message text is below.
<pre>
121215 13:48:57:480 SEVERE [...] Average cleaner backlog has grown from 0.0 to
6.4. If the cleaner continues to be unable to make progress, the JE cache size
and/or number of cleaner threads are probably too small. If this is not
corrected, eventually all available disk space will be used.
</pre>
For more information on setting the cache size appropriately to avoid such
problems, see "Determining the Per-Node Cache Size" in the Administrator's
Guide.
[#21111]
</li>

<li>
The storage engine's log cleaner will now delete files in the latter portion of
the log, even when the application is not performing any write operations.
Previously, files were prohibited from being deleted in the portion of the log
after the last application write.  When a log cleaner backlog was present (for
example, when the cache had been configured too small, relative to the data set
size and write rate), this could cause the cleaner to operate continuously
without being able to delete files or make forward progress.  [#21069]
</li>

<li>
NoSQL DB 2.0.23 introduced a performance regression over R1.2.23. The
kvstore client library and Replication Node consumed a greater
percentage of system CPU time. This regression has been fixed. [#22096]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 11gR2.2.0.23</u></h3>

<!-- ========================================================= -->
<h3><a name="Features2023">New Features:</a></h3>
<ol>
<li>
This release provides the ability to add storage nodes to the system
after it has been deployed. The system will rebalance and redistribute
the data onto the new nodes without stopping operations. See Chapter
6, of the Admin
Guide, <a href="oradoc-lookup:/NSADM-GUID-6AEF70CE-DAF3-40F2-A8CD-463B6ACB43E1/Determining+Your+Store's+Configuration">
Determining Your Store's Configuration</a>, for more details.
<li>
A new <code>oracle.kv.lob</code> package provides operations that can
be used to read and write Large Objects (LOBs) such as audio and video
files. As a general rule, any object larger than 1 MB is a good
candidate for representation as a LOB. The LOB API permits access to
large values without having to materialize the value in its entirety
by providing streaming APIs for reading and writing these objects.
<li>
A C API has been added. The implementation uses Java JNI and requires
a Java virtual machine to run on the client. It is available as a
separate download.
<li>
Added a new remove-storagenode plan. This command will
remove a storage node which is not hosting any NoSQL Database components
from the system's topology. Two examples of when this might be useful
are:
<blockquote>
A storage node was incorrectly configured, and cannot be deployed.<br>
A storage node was once part of a NoSQL Database, but all components have
been migrated from it using the migrate-storagenode command, and the
storage node should be decommissioned.
</blockquote>
[#20530]
</li>
<li>
Added the ability to specify additional physical configuration
information about storage nodes including:
<ul>
  <li>Capacity - the number of RepNodes the SN may host</li>
  <li>Number of CPUs</li>
  <li>Amount of memory to use</li>
  <li>Specific directory paths (mount points) to use for RepNodes</li>
</ul>
This information is used by the system to make more intelligent
choices about resource allocation and consumption.  The administration
documentation discusses how these parameters are set and used.
[#20951]
</li>
<li>Added Avro support.  The value of a kv pair can now be stored in Avro
binary format.  An Avro schema is defined for each type of data stored.  The
Avro schema is used to efficiently and compactly serialize the data, to
guarantee that the data conforms to the schema, and to perform automatic
evolution of the data as the schema changes over time.  Bindings are supplied
that allow representing Avro data as a POJO (Plain Old Java Object), a JSON
object, or a generic Map-like data structure. For more information, see
<a href="oradoc-lookup:/NSKVJ-GUID-5453684B-4BBD-49C2-B5A1-328FE0E7A669/Avro+Schemas">
Avro Schemas</a> and
<a href="oradoc-lookup:/NSKVJ-GUID-FE6EAD0D-3C4A-4B79-BA30-A2B4F202E24F/Avro+Bindings">
Avro Bindings</a>
in the <i>Getting Started Guide</i>. The <code>oracle.kv.avro</code> package is
described in the Javadoc.  The use of the Avro format is strongly
recommended.  NoSQL DB will leverage Avro in the future to provide additional
features and capabilities.  [#21213]
</li>
<li>Added Avro support for the Hadoop <code>KVInputFormat</code> classes.
A new <code>oracle.kv.hadoop.KVAvroInputFormat</code> class returns Avro
<code>IndexedRecord</code>s to the caller. When this class is  used in
conjunction with Oracle Loader for Hadoop, it is possible to read data
directly from NoSQL Database using OLH without using an interim Map-Reduce
job to store data in HDFS. [#21157]
</li>
<li>Added a feature which allows Oracle Database External Tables to be
used to access Oracle NoSQL Database records. There is more
information in javadoc for the
<a href="oradoc-absolute:/java-api/index.html?oracle/kv/exttab/package-summary.html">
<code>oracle.kv.exttab</code></a> package and an "cookbook" example in the
<a href="oradoc-absolute:/examples/index.html?externaltables/package-summary.html">
<code>examples/externaltables</code></a> directory. [#20981]
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="General2023">Performance and other General Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
The following new methods:
<ul>
<li><code>KVStoreConfig.setOpenTimeout()</code></li>
<li><code>KVStoreConfig.getOpenTimeout()</code></li>
<li><code>KVStoreConfig.setReadTimeout()</code></li>
<li><code>KVStoreConfig.getReadTimeout()</code></li>
</ul>
have been added to allow clients to configure the socket timeouts used to make
client requests. Please review the javadoc for details.
<p>
R1 installations must ensure that the software on the storage nodes has
been upgraded as described in the upgrade documentation
accompanying this release before using the above APIs on the client.
[#20997]
</li>

<li>
New service parameters have been added to control the backlog
associated with sockets created by NoSQL Database. These are
controllable for the Rep Node and Storage Nodes' Monitor, Admin, and
Registry Handler interfaces. The parameters
are <code>rnRHSOBacklog</code> (default
1024), <code>rnMonitorSOBacklog</code> (default 0), rnAdminSOBacklog
(default 0), <code>rnAdminSOBacklog</code> (default 0),
<code>snAdminSOBacklog</code> (default
0), <code>snMonitorSOBacklog</code> (default 0), and
<code>snRegistrySOBacklog</code> (default 1024).
[#21322]
</li>

<li>
  Previously, calling <code>Key.isPrefix</code> with an argument containing
  a smaller major or minor path than the target Key object caused an
  IndexOutOfBoundsException in certain cases.  This has been fixed.
</li>
<li>
The <code>KeyRange()</code> constructor now checks that the start
<code>Key</code> is less than the end <code>Key</code> if both are specified,
otherwise an <code>IllegalArgumentException</code> is thrown.
<code>KeyRange</code> also has <code>toString()</code> and
<code>fromString()</code> methods for encoding and decoding
<code>KeyRange</code> instances, similar to the same methods in
<code>Key</code>. [#21470]
</li>
</ol>
<!-- ========================================================= -->
<h3><a name="Utilities2023">Utility Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
Many new commands have been added to the CLI. See
<a href="oradoc-lookup:/NSADM-GUID-59A3CE95-270A-434F-BBF7-331C28938E34/CLI+Command+Reference">
Command Line Interface (CLI) Command Reference</a> of the <i>Administrator's
Guide</i> for details.
<li>
The Admin Console is now for monitoring only.
<li>
Administration CLI commands have been changed so that component ids
match the ids used in the topology display. Previously Datacenters,
Storage Nodes, Admin instances and Replication Nodes were identified
only by number. For example, the syntax to add Storage Node 17 to a
Storage Node pool, or to show the parameters for a given Replication Node was:
<blockquote>
<pre>
joinPool myStorageNodePool 17
show repnode-params 5,3
</pre>
</blockquote>
Datacenters can now be expressed as # or dc#<br>
Admin instances can now be expressed as # or admin#<br>
Storage Nodes can now be expressed as # or sn#<br>
Replication Nodes can now be expressed as groupNum,nodeNum, or rgX-rnY<br>
<p>
The commands shown above are still valid, but can also be expressed as:
<blockquote>
<pre>
joinPool myStorageNodePool sn17
show repnode-params rg5-rn3
</pre>
</blockquote>
[#21099]
</li>
</ol>

<!-- ========================================================= -->
<h3><a name="IandI2023">Documentation, Installation and
    Integration:</a></h3>
<!-- ========================================================= -->

<ol>
<li>
 The javadoc for the <code>Key.createKey</code> methods has been improved to
 warn that List instances passed as parameters are owned by the Key object
 after calling the method.  To avoid unpredictable results, they must not be
 modified.  [#20530]
</li>
</ol>

<!-- ============================================================ -->
<hr>
<h3 align="center"><u>Changes in 11gR2.1.2.123</u></h3>

<!-- ========================================================= -->
<h3><a name="BugFixes12">Bug fixes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
  Previously, executing a change-repnode-params plan in order to
  change Replication Node parameters for a node other than the one
  running the Admin service would fail. This operation will now
  succeed. [#20901]
</li>
<li>
  A deploy-storage-node plan which ran into problems when attempting
  to deploy a new storage node would leave the problematic SN in the
  store. This would require that the user either take manual action to
  remove the bad SN, or fix the problem and retry the plan. For
  convenience, the deploy-storage-node plan will now clean up if it
  runs into errors, and will not leave the failed SN behind. [#20530]
</li>
</ol>

<!-- ========================================================= -->
<h3><a name="General12">Performance and other General Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
  The command line interface's <code>snapshot create</code> command
  has been made significantly faster. Previously, it could take
  minutes if executed on a store with a large amount of data.  This
  should be reduced to seconds. [#20772]
</li>

</ol>

<!-- ========================================================= -->
<h3><a name="Utilities12">Utility Changes:</a></h3>
<!-- ========================================================= -->
<ol>
<li>
The two scripts for starting kvlite and executing control commands,
<code>bin/run-kvlite.sh</code> and <code>bin/kvctl</code>, have been replaced
by a <code>java -jar lib/kvstore-M.N.P.jar</code> command.  This provides portability
to all Java platforms, including Windows.  The two scripts are deprecated, but
will be supported for at least one release cycle.
<p>
The translation from the old script commands to the new -jar commands is as
follows:</p>
<table border="1" summary="Compare script and jar commands">
    <tr><th>Old script command</th><th>New -jar command</th></tr>
    <tr>
        <td><code>bin/run-kvlite.sh args...</code></td>
        <td><code>java -jar lib/kvstore-M.N.P.jar kvlite args...</code></td>
    </tr>
    <tr>
        <td><code>bin/kvctl command args...</code></td>
        <td><code>java -jar lib/kvstore-M.N.P.jar command args...</code></td>
    </tr>
</table>
<p>
There are a few differences to be aware of between the old and new commands.
<ul>
    <li><p><code>nohup</code>, if desired, must be explicitly specified.  In
    the <code>bin/kvctl</code> script, nohup was added automatically for the
    <code>start</code> and <code>restart</code> commands.  To specify the
    equivalent command, use:</p>
    <p><code>nohup java -jar lib/kvstore-M.N.P.jar start args... &gt; /dev/null &lt;
    /dev/null 2&lt;&amp;1 &amp;</code></p>
    </li>
    <li><p>The logging configuration file for kvlite is now specified using
    standard Java syntax.  Previously, the
    <code>examples/logging.properties</code> configuration file was added
    automatically when passing <code>-logging</code> to the
    <code>run-kvlite.sh</code> script.  The new equivalent is:</p>
    <p><code>java -Djava.util.logging.config.file=examples/logging.properties
    -jar lib/kvstore-M.N.P.jar kvlite args...</code></p>
    </li>
    <li><p>Previously, the <code>-host</code> argument defaulted to
    the local machine name (via the <code>`hostname`</code> command) when
    running the <code>kvctl</code> script.  Now, for all control commands, no
    default hostname is used and the <code>-host</code> argument must be
    specified explicitly.  This change was made for two reasons: 1)
    consistency, since the port and other arguments have no default value for
    control commands, and 2) safety, since specifying an explicit hostname
    guards against accidental errors.</p>
    </li>
    <li><p>Previously, the <code>-host</code> argument defaulted to
    <code>localhost</code> when running the <code>run-kvlite.sh</code> script.
    Now, the default is the local machine name rather than (literally)
    <code>localhost</code>.  Note that the kvlite command, unlike the control
    commands, has default values for all arguments.  This is because the kvlite
    command is designed for ease-of-use during development on a single machine.
    kvlite should not be used in production or for performance testing.</p>
    </li>
    <li><p>Previously, running <code>java -jar lib/kvstore-M.N.P.jar</code>, with or
    without arguments, printed the product version.  Now, if no arguments are
    specified, a usage message is printed.  To print the version, use the
    version command:</p>
    <p><code>java -jar lib/kvstore-M.N.P.jar version</code></p>
    </li>
</ul>
</li>
</ol>

</body>
</html>
